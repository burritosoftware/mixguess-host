/*


 Rat Game Engine

 Copyright 2013-2018 Wahoo Studios, Inc. and Steven H. Taylor.

 See the Rat home page for publicly released versions
 and license information for those public releases:
 http://www.wahoo.com/rat/

*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(c){return $jscomp.SYMBOL_PREFIX+(c||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var c=0;return $jscomp.iteratorPrototype(function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var c=a[Symbol.iterator];return c?c.call(a):$jscomp.arrayIterator(a)};
$jscomp.polyfill=function(a,c,b,d){if(c){b=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in b||(b[e]={});b=b[e]}a=a[a.length-1];d=b[a];c=c(d);c!=d&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function c(){this.batch_=null}function b(a){return a instanceof e?a:new e(function(b,d){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;c.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};c.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var d=$jscomp.global.setTimeout;c.prototype.asyncExecuteFunction=function(a){d(a,
0)};c.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var d=a[b];delete a[b];try{d()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};c.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var e=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(k){b.reject(k)}};e.prototype.createResolveAndReject_=
function(){function a(a){return function(c){d||(d=!0,a.call(b,c))}}var b=this,d=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};e.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof e)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};e.prototype.resolveToNonPromiseObj_=function(a){var b=
void 0;try{b=a.then}catch(k){this.reject_(k);return}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};e.prototype.reject_=function(a){this.settle_(2,a)};e.prototype.fulfill_=function(a){this.settle_(1,a)};e.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),a[b]=null;this.onSettledCallbacks_=null}};var f=new c;e.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};e.prototype.settleSameAsThenable_=function(a,b){var d=this.createResolveAndReject_();try{a.call(b,d.resolve,d.reject)}catch(l){d.reject(l)}};e.prototype.then=function(a,b){function d(a,b){return"function"==typeof a?function(b){try{c(a(b))}catch(q){f(q)}}:b}var c,f,g=new e(function(a,
b){c=a;f=b});this.callWhenSettled_(d(a,c),d(b,f));return g};e.prototype.catch=function(a){return this.then(void 0,a)};e.prototype.callWhenSettled_=function(a,b){function d(){switch(c.state_){case 1:a(c.result_);break;case 2:b(c.result_);break;default:throw Error("Unexpected state: "+c.state_);}}var c=this;null==this.onSettledCallbacks_?f.asyncExecute(d):this.onSettledCallbacks_.push(function(){f.asyncExecute(d)})};e.resolve=b;e.reject=function(a){return new e(function(b,d){d(a)})};e.race=function(a){return new e(function(d,
c){for(var e=$jscomp.makeIterator(a),f=e.next();!f.done;f=e.next())b(f.value).callWhenSettled_(d,c)})};e.all=function(a){var d=$jscomp.makeIterator(a),c=d.next();return c.done?b([]):new e(function(a,e){function f(b){return function(d){g[b]=d;k--;0==k&&a(g)}}var g=[],k=0;do g.push(void 0),k++,b(c.value).callWhenSettled_(f(g.length-1),e),c=d.next();while(!c.done)})};return e},"es6","es3");
$jscomp.executeAsyncGenerator=function(a){function c(b){return a.next(b)}function b(b){return a.throw(b)}return new Promise(function(d,e){function f(a){a.done?d(a.value):Promise.resolve(a.value).then(c,b).then(f,e)}f(a.next())})};$jscomp.arrayFromIterator=function(a){for(var c,b=[];!(c=a.next()).done;)b.push(c.value);return b};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
$jscomp.checkStringArgs=function(a,c,b){if(null==a)throw new TypeError("The 'this' value for String.prototype."+b+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+b+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var b=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var d="";a;)if(a&1&&(d+=b),a>>>=1)b+=b;return d}},"es6","es3");
$jscomp.iteratorFromArray=function(a,c){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var b=0,d={next:function(){if(b<a.length){var e=b++;return{value:c(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.polyfill("Array.prototype.entries",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,b){return[a,b]})}},"es6","es3");$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,b){return b})}},"es8","es3");$jscomp.owns=function(a,c){return Object.prototype.hasOwnProperty.call(a,c)};
$jscomp.polyfill("Object.entries",function(a){return a?a:function(a){var b=[],d;for(d in a)$jscomp.owns(a,d)&&b.push([d,a[d]]);return b}},"es8","es3");$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,b,d){var c=this.length||0;0>b&&(b=Math.max(0,c+b));if(null==d||d>c)d=c;d=Number(d);0>d&&(d=Math.max(0,c+d));for(b=Number(b||0);b<d;b++)this[b]=a;return this}},"es6","es3");"undefined"!==typeof WinJS&&(window.WinJS.Binding.optimizeBindingReferences=!0);var rat=rat||{};
rat.loaded=!1;rat.getGlobalApp=function(){if("undefined"!==typeof app)return app};rat.debug={};
rat.console={output:[],saveOutputToLocalStorage:!1,copyToSystem:!1,logRemotely:!1,remoteURL:!1,maxLogLines:200,onceRecord:{},logPrefix:"|",lastText:"",repeat:0,logNewlines:function(a){if(a){a=a.toString();a=a.split("\n");for(var c=a.length;""===a[c-1];)c--;for(var b=0;b<c;++b)rat.console.log(a[b])}},log:function(a,c){var b=rat.console,d=b.output;a===b.lastText?(b.repeat+=1,d[d.length-1]=b.logPrefix+"(X"+b.repeat+") "+b.lastText):(b.lastText=a,b.repeat=1,d.push(b.logPrefix+" "+a),d.length>b.maxLogLines&&
d.splice(0,1));rat.console.saveOutputToLocalStorage&&rat.system.has.localStorage&&rat.system.getLocalStorage().setItem("RAT_LOG",JSON.stringify(d));b.copyToSystem&&!rat.console.redirectedSystem&&(rat.system.has.chromeBrowser?"error"===c?window.console.error(b.logPrefix+a):"warning"===c?window.console.warn(b.logPrefix+a):window.console.log(b.logPrefix+"%c"+a,"background:lightcyan; color:black;"):window.console.log(b.logPrefix+a),(rat.system.has.xboxLE||rat.system.has.xbox)&&Debug.writeln(b.logPrefix+
a));b.logRemotely&&b.remoteURL&&(c=new XMLHttpRequest,c.open("GET",b.remoteURL+a,!0),c.send());b.logCustom&&b.logCustom(a,b.repeat)},error:function(a){rat.console.log(a,"error")},logError:function(a){for(var c=[],b=0;b<arguments.length;++b)c[b-0]=arguments[b];rat.console.error.apply(rat.console,[].concat($jscomp.arrayFromIterable(c)))},warn:function(a){rat.console.log(a,"warning")},logWarning:function(a){for(var c=[],b=0;b<arguments.length;++b)c[b-0]=arguments[b];rat.console.warn.apply(rat.console,
[].concat($jscomp.arrayFromIterable(c)))},info:function(a){rat.console.log(a)},assert:function(a,c){a||rat.console.log(c,"error")},redirectSystemConsole:function(a){void 0===a&&(a=!0);a&&!rat.console.redirectedSystem?(a=function(a){rat.console.redirectedSystem=!0;rat.console.systemConsole=a;return{log:function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];rat.console.log.apply(rat.console,[].concat($jscomp.arrayFromIterable(b)))},info:function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-
0]=arguments[c];rat.console.info.apply(rat.console,[].concat($jscomp.arrayFromIterable(b)))},warn:function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];rat.console.warn.apply(rat.console,[].concat($jscomp.arrayFromIterable(b)))},error:function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];rat.console.error.apply(rat.console,[].concat($jscomp.arrayFromIterable(b)))},assert:function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];rat.console.assert.apply(rat.console,
[].concat($jscomp.arrayFromIterable(b)))},clear:function(){}}}(window.console),window.console=a):!a&&rat.console.redirectedSystem&&(window.console=rat.console.systemConsole,rat.console.redirectedSystem=!1)}};rat.system={has:{},onPlatform:"",applyCacheBuster:!1};rat.events={queued:{}};
rat.detectPlatform=function(){if(!rat.detectPlatform.detected){rat.detectPlatform.detected=!0;rat.system.has.pointer=!0;navigator.gamepadInputEmulation&&(navigator.gamepadInputEmulation="keyboard");if("undefined"!==typeof Windows&&"undefined"!==typeof MSApp){rat.system.has.windows=!0;rat.system.has.windows10=!0;var a=Windows.System.Profile.AnalyticsInfo.VersionInfo||Windows.System.Profile.AnalyticsInfo.versionInfo;a&&(a=a.DeviceFamily||a.deviceFamily)&&-1<a.indexOf("Xbox")&&(rat.system.has.uwpXbox=
!0,rat.system.has.pointer=!1,a=Windows.UI.ViewManagement.ApplicationViewScaling.trySetDisableLayoutScaling(!0),rat.console.log("scalingDisabled "+a),a=Windows.UI.ViewManagement.ApplicationView.getForCurrentView().setDesiredBoundsMode(Windows.UI.ViewManagement.ApplicationViewBoundsMode.useCoreWindow),rat.console.log("overscanDisabled "+a))}else"undefined"!==typeof Windows&&"undefined"!==typeof WinJS?(rat.system.has.windows=!0,rat.system.has.windows8=!0,void 0===window.Windows.Xbox&&(rat.system.has.realWindows8=
!0)):"undefined"!==typeof XboxJS&&(rat.system.has.xboxLE=!0,rat.system.has.pointer=!1);/MSAppHost/.test(navigator.userAgent)&&(rat.system.has.msAppHost=!0);window.Windows&&void 0!==window.Windows.Xbox&&(rat.system.has.xbox=!0,rat.system.has.pointer=!1);"undefined"!==typeof WinJS&&(rat.system.has.winJS=!0);"undefined"!==typeof Wraith&&Wraith&&Wraith.w_isNative&&(rat.system.has.Wraith=!0,rat.system.onPlatform=Wraith.w_onPlatform);a=navigator;rat.system.has.gamepadAPI=!!a.getGamepads||!!a.gamepads||
!!a.mozGetGamepads||!!a.mozGamepads||!!a.webkitGetGamepads||!!a.webkitGamepads;rat.system.has.gamepadAPI&&rat.system.has.xboxLE&&(rat.system.has.gamepadAPI=!1);rat.system.has.gamepadAPIEvent=rat.system.has.gamepadAPI&&-1!==navigator.userAgent.indexOf("Firefox/")&&!rat.system.has.Wraith;a&&(0<=a.userAgent.search("iPad")||0<=a.userAgent.search("iPod")||0<=a.userAgent.search("iPhone"))?rat.system.has.iOSBrowser=!0:rat.system.has.iOSBrowser=!1;a&&0<=a.userAgent.search("PlayStation 4")?rat.system.has.PS4Browser=
!0:rat.system.has.PS4Browser=!1;if(a&&0<=a.userAgent.search("Chrome")){rat.system.has.chromeBrowser=!0;var c=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);rat.system.has.chromeVersion=c?parseInt(c[2],10):0}else rat.system.has.chromeBrowser=!1;a&&-1!==a.userAgent.indexOf("Firefox/")?rat.system.has.firefoxBrowser=!0:rat.system.has.firefoxBrowser=!1;a&&-1!==a.userAgent.indexOf("Gecko/")?rat.system.has.geckoBrowser=!0:rat.system.has.geckoBrowser=!1;a&&(0<=a.userAgent.search("MSIE")||0<=a.userAgent.search("Edge"))?
(rat.system.has.IEBrowser=!0,a&&0<=a.userAgent.search("Edge/")?(c=navigator.userAgent.match(/Edge\/(\d+)/),rat.system.has.IEVersion=c?parseInt(c[1],10):0):a&&0<=a.userAgent.search("like Gecko")?rat.system.has.IEVersion=11:a&&0<=a.userAgent.search("MSIE 10")?rat.system.has.IEVersion=10:a&&0<=a.userAgent.search("MSIE 9")?rat.system.has.IEVersion=9:rat.system.has.IEVersion=0,rat.system.has.chromeBrowser=!1,rat.system.has.chromeVersion=void 0,rat.system.has.firefoxBrowser=!1,rat.system.has.geckoBrowser=
!1):rat.system.has.IEBrowser=!1;"undefined"!==typeof chrome&&chrome.app&&chrome.app.runtime&&(rat.system.has.chromeApp=!0);/Mobi/.test(navigator.userAgent)&&(rat.system.has.mobile=!0);rat.system.has.cpuClass=a&&a.cpuClass?a.cpuClass:"unknown";"undefined"!==typeof QUnit&&(rat.system.has.QUnit=!0,rat.system.has.unitTest=!0);rat.system.has.electron=!!(window.process&&window.process.versions&&window.process.versions.electron);rat.system.has.electronVersion=rat.system.has.electron?window.process.versions.electron:
0;try{var b=window.localStorage}catch(e){b=null}b?(rat.system.has.localStorage=!0,rat.system.localStorageObject=b):(rat.system.has.localStorage=!1,rat.system.localStorageObject=null);try{var d=document.cookie}catch(e){d=null}rat.system.has.cookies=d?!0:!1}};rat.system.getLocalStorage=function(){return rat.system.localStorageObject};
(function(a){a.system.baseURL="";if(window.location){var c=window.location.href,b=c.indexOf("?");a.system.baseURL=0<b?c.slice(0,b):c;a.system.URLVars={};c.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(b,c,f){a.system.URLVars[c]=f})}})(rat);
rat.system.fixPath=function(a){if(0===a.length)return a;var c=-1<a.search(/^http/);if(!c){rat.system.rootFolder&&(a=rat.system.rootFolder+a,rat.utils.cleanPath&&(a=rat.utils.cleanPath(a)));rat.system.ratAltFolder&&"rat/"===a.substring(0,4)&&(a=rat.system.ratAltFolder+a.substring(4));rat.system.rootSubFolder&&(a="../"+a);if(rat.system.has.xboxLE||rat.system.applyCacheBuster)a=a+"?_="+Math.random();rat.system.has.xboxLE&&(a=window.adParams._projectBase+a)}return a};
if(void 0!==window.WinJS){var activation;window.Windows&&window.Windows.ApplicationModel&&(activation=window.Windows.ApplicationModel.Activation);activation||(activation={});activation.ActivationKind||(activation.ActivationKind={});activation.ApplicationExecutionState||(activation.ApplicationExecutionState={});window.WinJS.Application.onactivated=function(a){var c={};switch(a.detail.kind){case activation.ActivationKind.launch:c.kind="launched";break;case activation.ActivationKind.search:c.kind="searchWith";
break;case activation.ActivationKind.shareTarget:c.kind="shareTarget";break;case activation.ActivationKind.file:c.kind="file";break;case activation.ActivationKind.protocol:c.kind="protocol";break;case activation.ActivationKind.fileOpenPicker:c.kind="fileOpenPicker";break;case activation.ActivationKind.fileSavePicker:c.kind="fileSavePicker";break;case activation.ActivationKind.cachedFileUpdater:c.kind="cachedFileUpdater";break;case activation.ActivationKind.ContactPicker:c.kind="contactPicker";break;
case activation.ActivationKind.device:c.kind="autoplay";break;case activation.ActivationKind.printTaskSettings:c.kind="print";break;case activation.ActivationKind.cameraSettings:c.kind="camera";break;case activation.ActivationKind.restrictedLaunch:c.kind="launched-restricted";break;case activation.ActivationKind.appointmentsProvider:c.kind="appointmentsProvider";break;case activation.ActivationKind.Contact:c.kind="contact";break;case activation.ActivationKind.lockScreenCall:c.kind="launch-locked";
break;default:c.kind="unknown"}switch(a.detail.previousExecutionState){case activation.ApplicationExecutionState.notRunning:c.prevState="notRunning";break;case activation.ApplicationExecutionState.running:c.prevState="running";break;case activation.ApplicationExecutionState.suspended:c.prevState="suspended";break;case activation.ApplicationExecutionState.terminated:c.prevState="terminated";break;case activation.ApplicationExecutionState.closedByUser:c.prevState="closed";break;default:c.prevState=
"unknown"}c.sessionState=(window.WinJS.Application.sessionState||{}).savedState;a.setPromise(window.WinJS.UI.processAll().then(function(){rat.events.queued.activated=["activated",c];"terminated"===c.prevState&&(rat.events.queued.resumeFromTerminated=["resumeFromTerminated",c])}))};window.WinJS.Application.start()}else rat.events.queued.activated=["activated",{kind:"launched",prevState:"notRunning",sessionState:void 0}];
window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,c){return window.setTimeout(a,1E3/60)};window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout;rat.utils={loadedScripts:{length:0}};
(function(a){a.utils.dumpException=function(c,b){if(b)for(a.console.logError("======================================================="),a.console.log("ERROR!  "+c),a.console.log("->   Got Exception "+b.name+"("+(b.number||"???")+")"),a.console.log("->   "+b.description||b.message),b.stack&&"string"===typeof b.stack&&a.console.log("->   "+b.stack),delete b.message,delete b.description,delete b.name,delete b.number,c=JSON.stringify(b).split("\\n"),b=0;b<c.length;++b)a.console.log("->"+c[b]);else a.console.log("Unable to dump undefined exception")};
a.utils.loadResources=function(c,b,d){function e(a,d){if(a){if(a.loaded)return;a.loaded=!0;a.callback&&a.callback(d)}--h;f&&f({left:h,loaded:g-h,of:g});0>=h&&b&&b()}Array.isArray(c)||(c=[c]);d=d||{};void 0===d.async&&(d.async=!0);var f=d.update,g=c.length,h=c.length,k;var l=0;for(k=c.length;l!==k;++l)"string"===typeof c[l]&&(c[l]={source:c[l]}),c[l].loaded=!1;f&&f({left:g,loaded:0,of:g});if(0>=h)b&&b();else{l=0;for(k=c.length;l!==k;++l){var m=c[l];if(void 0===m.type){var n=m.source.lastIndexOf(".");
m.type=-1===n?"UNKNOWN":m.source.substr(n+1).toUpperCase()}"JS"!==m.type||a.utils.loadedScripts[m.source]||(a.utils.loadedScripts[m.source]="pending",++a.utils.loadedScripts.length)}l=0;for(k=c.length;l!==k;++l)switch(m=c[l],m.type){case "JS":a.utils.loadScriptWithCallback(m.source,!!d.async,e.bind(void 0,m));break;case "JSON":d.async?a.utils.loadJSON(m.source,e.bind(void 0,m)):a.console.logError("ERROR!  Unable to load JSON files synchronously");break;default:a.console.logWarning("WARNING! Attempting to load unrecognized resource "+
m.source),e(m,void 0)}}};a.utils.loadResourcesSync=function(c,b,d){function e(){++f;if(!d.update||!d.update({index:f,list:c,startAgain:e}))if(f>=c.length)b&&b();else{var g=c[f];d.verbose&&a.console.log("Sync load of list item "+f+":"+JSON.stringify(g));a.utils.loadResources(g,e,{async:!1})}}"string"===typeof c&&(c=[c]);c=c||[];var f=-1;d=d||{};e()};a.utils.loadScriptWithCallback=function(c,b,d,e){function f(b){!b||"load"!==b.type&&"complete"!==b.readyState||(a.utils.loadedScripts[c]="loaded",d&&d(c))}
void 0!==a.utils.loadedScripts[c]&&"pending"!==a.utils.loadedScripts[c]&&(a.console.log("WARNING:  File "+c+" is getting loaded twice!"),c+=Math.random());a.utils.loadedScripts[c]||++a.utils.loadedScripts.length;a.utils.loadedScripts[c]="downloading";var g=a.system.fixPath(c);if(a.system.has.Wraith)Wraith.LoadScript({src:g,async:b,complete:f});else{var h=document.createElement("script");h.async=b||!1;h.type="text/javascript";h.onreadystateChange=f;h.onload=f;h.onerror=function(){a.utils.loadedScripts[c]=
"error";a.console.log("Failed to load file "+g);e&&e(c)};h.src=g;document.getElementsByTagName("head")[0].appendChild(h)}};a.utils.loadQUnit=function(c){function b(){function a(a){var d=document.createElement("div");d.id=a;f.insertBefore(d,b)}if(d&&e){var b=document.getElementsByTagName("canvas")[0],f=document.getElementsByTagName("body")[0];f.style.overflow="visible";a("qunit");a("qunit-fixture");c()}}var d=!1,e=!1;a.utils.loadScriptWithCallback("http://code.jquery.com/qunit/qunit-1.20.0.js",!0,
function(){e=!0;b()});var f=document.createElement("link");f.setAttribute("rel","stylesheet");f.setAttribute("type","text/css");f.onload=function(){d=!0;b()};f.setAttribute("href","http://code.jquery.com/qunit/qunit-1.20.0.css");document.getElementsByTagName("head")[0].appendChild(f)}})(rat);
(function(a){function c(a){a=a.replace(/\./g,"/");return a+".js"}function b(d,e){var f=[],g;if(Array.isArray(d)){for(g=0;g!==d.length;++g){var l=b(d[g],e);f=f.concat(l)}return f}if("object"===typeof d){if(!a.modules.checkPlatformDep(d.platform))return[];d=d.name}if(".js"===d.substr(-3).toLowerCase()){g=d;l=g.lastIndexOf(".");-1<l&&(g=g.substring(0,l));g=g.replace(/\//g,".");if(a.modules.byName[g])return[];g=d}else{if(a.modules.byName[d])return[];(g=a.modules.moduleFileLookup[d])||(g=c(d))}l=g.toLowerCase();
a.modules.missingFiles.byPath[l]||a.utils.loadedScripts[g]||(e&&e.justGenFileList||(a.modules.missingFiles.byPath[l]=!0,a.modules.missingFiles.list[a.modules.missingFiles.list.length]=l),f[f.length]=g,(d=a.modules.moduleRequiresList[d])&&d.length&&(l=b(d,e),f.concat(l)));return g}function d(b,d){if(!b)return[];var c=b;d=d||{};"string"===typeof b&&(c=a.modules.byName[b]);b=c.requires;c=[];for(var e=0;e!==b.length;++e){var f=b[e];!a.modules.checkPlatformDep(f.platform)||!d.forFiles&&f.fileOnly||(c[c.length]=
f.name)}return c}a.modules={};a.modules.byName={};a.modules.length=0;a.modules.pending=[];a.modules.moduleFileLookup={};a.modules.moduleRequiresList={};a.modules.addModulesToFileLookup=function(b){for(var d in b)b.hasOwnProperty(d)&&(a.modules.moduleFileLookup[d]&&a.modules.moduleFileLookup[d]!==b[d]?a.console.log("Module name "+d+" duplicated. in file lookup for "+a.modules.moduleFileLookup[d]+"/"+b[d]):a.modules.moduleFileLookup[d]=b[d])};a.modules.addModulesToRequiresLookup=function(b){for(var d in b)b.hasOwnProperty(d)&&
(a.modules.moduleRequiresList[d]?a.console.log("Module name "+d+" duplicated. in requires lookup"):a.modules.moduleRequiresList[d]=b[d])};a.modules.missingFiles={list:[],byPath:{}};a.modules.checkPlatformDep=function(b){if(b&&b.length){if("!"==b[0])return void 0==a.system.has[b.substring(1)];if(a.system.has[b])return!0}else return!0;return!1};var e=["rat.os.r_system","rat.os.r_events","rat.debug.r_console","rat.debug.r_trackvalue","rat.debug.r_profiler","rat.utils.r_utils","rat.math.r_math","rat.math.r_vector",
"rat.math.r_matrix",{name:"rat.test.r_qunit",platform:"QUnit"}];a.modules.add=function(e,g,h){e="object"!==typeof e?{name:e,requires:g,code:h}:e;e.name||(a.console.logError("ERROR: Modules must be given a name"),e.name="_"+(1E4*Math.random()|0));e.hasBeenProcessed=!1;e.requires?Array.isArray(e.requires)||(e.requires=[e.requires]):e.requires=[];for(g=0;g!==e.requires.length;++g)h=e.requires[g],h.name||(h={name:h,platform:void 0,processBefore:!1,fileOnly:!0}),void 0!==h.processBefore?h.fileOnly=!h.processBefore:
void 0!==h.fileOnly?h.processBefore=!h.fileOnly:(h.fileOnly=!0,h.processBefore=!1),e.requires[g]=h;a.modules.byName[e.name]?a.console.logError("ERROR: Attempting to re-define module "+e.name):(a.modules.byName[e.name]=e,a.modules.pending[a.modules.pending.length]=e,++a.modules.length,g=d(e,{forFiles:!0}),b(g),e=c(e.name).toLowerCase(),g=a.modules.missingFiles.list.indexOf(e),0<=g&&(a.modules.missingFiles.list.splice(g,1),delete a.modules.missingFiles.byPath[e]))};a.modules.isReadyToProcess=function(b,
c){if(!b)return!1;c=c||[];var e=a.modules.byName;if(!b)return a.console.log("Testing if undefined module is ready to process"),!1;if(b.hasBeenProcessed)return!1;b=d(b);for(var f=0;f!==b.length;++f){var g=b[f];(g=e[g])&&g.fileOnly||(g?g.hasBeenProcessed||c.push(g):c.push({name:b[f],hasBeenProcessed:!1,isMissing:!0}))}return 0===c.length};a.modules.process=function(b){b=b||{};for(var d=b.maxToCall||0,c=!!b.noError,e=a.modules.pending;0<e.length;){++a.modules.process.passes;for(var f=e.length-1,m=e.length;0<=
f;){var n=e[f];if(a.modules.isReadyToProcess(n)){b.verbose&&a.console.log("rat module processing : "+n.name);if(n.code)try{n.code(a,a.getGlobalApp())}catch(p){throw a.utils.dumpException("Failed to process module "+n.name+".",p),p;}b.verbose&&a.console.log("done with : "+n.name);n.hasBeenProcessed=!0;e.splice(f,1);if(0<d&&0<e.length&&(--d,0>=d))return"HIT_LIMIT"}--f}if(e.length===m){if(c)return"PENDING";a.console.logError("ERROR! BAD REQUIRES TREE!  Unable to process "+e.length+" modules.  (circular or missing dependencies?)");
for(f=0;f!==e.length;++f)for(a.console.log(">"+e[f].name),b=[],a.modules.isReadyToProcess(e[f],b),d=0;d!==b.length;++d)a.console.log("  >"+b[d].name+(b[d].isMissing?" MISSING!":""));return"ERROR"}}};a.modules.process.passes=0;a.load=function(d){function c(){if(!a.load.failed){++u;if(!A)var c=E/a.utils.loadedScripts.length*100;else if(!B){if("ERROR"===a.modules.process({maxToCall:a.system.has.Wraith&&d.async?1:0,verbose:d.verbose})){a.load.failed=!0;return}0>=a.modules.pending.length&&(B=!0,D=void 0,
p("rat.modules.process finished.  Took "+a.modules.process.passes+" passes."));c=(a.modules.length-a.modules.pending.length)/a.modules.length*100}c!==D&&(D=c,u=0);if(6E3<=u)if(u=0,A)a.console.logWarning('How did we go "idle" while trying to process files?!?  Modules left to proccess: '+a.modules.pending.length);else{a.console.logWarning('Went "idle" waiting for '+y+" of "+a.utils.loadedScripts.length+" file(s) to load.");for(var e in a.utils.loadedScripts)"pending"!==a.utils.loadedScripts[e]&&"downloading"!==
a.utils.loadedScripts[e]&&"error"!==a.utils.loadedScripts[e]||a.console.log("---\x3e"+e)}d.update&&d.update({load:{done:E,left:y,total:a.utils.loadedScripts.length,isDone:A},process:{done:a.modules.length-a.modules.pending.length,left:a.modules.pending.length,total:a.modules.length,isDone:B}});if(A&&B){if(!C)if(C=!0,w.length){p("Starting sync load of "+w.length+" files.");c=b(w,{justGenFileList:!0});var g=function(b){if(0<a.modules.missingFiles.list.length)return g.paused?a.console.log("Keep sync loading paused.  More missing files..."):
(g.paused=!0,a.console.log("Pause sync loading after "+b.index+" of "+b.list.length+" files...")),k(function(){g(b)},{logTag:"paused sync"}),"abort";a.modules.process({noError:!0});g.paused&&(a.console.log("Resume sync loading "+(b.list.length-(b.index+1))+" of "+b.list.length+" files..."),g.paused=!1,b.startAgain());return!1};g.paused=!1;a.utils.loadResourcesSync(c,function(){F=!0},{update:g,verbose:d.verbose})}else F=!0;F?(a.modules.process(),a.loaded=!0,z&&(n(z),z=0),d.done&&d.done(a,a.getGlobalApp())):
z||(z=m(f))}else z||(z=m(f))}}function f(){z=0;c()}function k(b,d){d=d||{};d.logTag=d.logTag||"";++a.load.numLoadPasses;var c=a.modules.missingFiles.list;a.modules.missingFiles.list=[];a.modules.missingFiles.byPath={};p("WARNING!  Another "+d.logTag+" load phase ("+a.load.numLoadPasses+") is needed to get "+c.length+" required file(s).","warning");for(var e=0;e!==c.length;++e)p("--\x3e"+c[e]);a.utils.loadResources(c,b,{update:d.update})}function l(){0<a.modules.missingFiles.list.length?k(l,{update:function(b){y=
b.left;E=a.utils.loadedScripts.length-b.left;c()}}):(p("File load finished.  "+a.modules.pending.length+" Modules to process."),A=!0,d.async||c())}var m=window.requestAnimationFrame,n=window.cancelAnimationFrame;m=function(a,b){return window.setTimeout(a,1E3/60)};n=window.clearTimeout;d=d||{};a.console.log("rat.load Verbose="+!!d.verbose);a.load.numLoadPasses=0;var p=function(b,c){d.verbose&&a.console.log(b,c)};d.async=void 0===d.async||d.async?!0:!1;var r=d.addAsync||[],w=d.addSync||[],q=[r,w];a.detectPlatform();
for(var t=0;t!==q.length;++t)for(var v=q[t],x=v.length-1;0<=x;--x)v[x]?v[x].name||(v[x]={name:v[x]}):v.splice(x,1);q="object"===typeof Wraith;a.system.has.Wraith||!a.load.addWraith||d.skipLoad||(q||b("rat/wraithjs/web/wraith_core.js"),b(["rat/wraithjs/web/wraith_dom.js","rat/wraithjs/web/wraith_canvas.js"]));var y,u=0,D=void 0,A=!1,B=!1,z,C=!1,F=!1;if(d.skipLoad){var E=y=0;F=C=A=!0}else for(b(e),b(r),p("Initial file pass selected the following "+a.modules.missingFiles.list.length+" files to load:"),
r=0;r<a.modules.missingFiles.list.length;++r)p("--\x3e"+a.modules.missingFiles.list[r]);r=a.modules.missingFiles.list;a.modules.missingFiles.list=[];a.modules.missingFiles.byPath={};d.skipLoad?(d.async&&(z=m(f)),l()):d.async?(z=m(f),p("Starting async file load..."),++a.load.numLoadPasses,a.utils.loadResources(r,l,{update:function(b){y=b.left;E=a.utils.loadedScripts.length-b.left;c()}}),p("... Load Started.")):(p("Starting synchronous file load..."),a.utils.loadResources(r,l,{async:!1}))};a.simpleLoad=
function(b,d){a.load({addSync:b,done:d})};a.simpleload=a.simpleLoad;a.load.setEntryPoint=function(a,b){"object"===typeof Wraith&&Wraith.SetEntryPoint?Wraith.SetEntryPoint(a,b):(b&&(a=a.bind(b)),window.onload=a)};a.ExternalEntryPoint=function(){if(window.onload)window.onload(null)}})(rat);
(function(a){a.unitTest={enabled:!0,group:function(a,b){},test:function(c,b){a.unitTest.enabled&&a.unitTest._test&&a.unitTest._test(c,b)},testGroup:function(c,b,d){a.unitTest.group(c,function(){a.unitTest.test(b,d)})}}})(rat);rat.system.has.minified=!0;
rat.modules.add("rat.os.r_system",["rat.graphics.r_graphics","rat.debug.r_console","rat.debug.r_profiler","rat.debug.r_trackvalue","rat.os.r_events","rat.math.r_math",{name:"rat.os.r_le_core",platform:"xboxLE"}],function(a){function c(){return a.system.has.Wraith?0:window.performance?window.performance.now()/1E3:(new Date).getTime()/1E3}function b(b){a.console.log("JS ERROR! "+JSON.stringify(b));a.events&&a.events.fire&&a.events.fire("error",{sysEvent:b});b=new window.Windows.UI.Popups.MessageDialog(b.detail.errorUrl+
"\n\tLine:\t"+b.detail.errorLine+"\tCharacter:\t"+b.detail.errorCharacter+"\nMessage: "+(b.detail.message||b.detail.errorMessage),"error"===b.type?"Unhanded Error!":b.type);b.cancelCommandIndex=0;b.defaultCommandIndex=0;b.showAsync();return!0}function d(b){b={sysEvent:b};a.events&&a.events.fire&&a.events.fire("resume",b)}function e(b){function d(){++f;1===f&&a.system.has.winJS&&e.setPromise(new window.WinJS.Promise(function(a,b,d){g=a}))}function c(){0>=f||(--f,0===f&&g&&g("Done"))}var e=b,f=0,g,
k={};d();b={store:function(a){k=a},setBusy:d,setDone:c,sysEvent:e};a.events&&a.events.fire&&a.events.fire("suspend",b);a.system.has.winJS&&(window.WinJS.Application.sessionState.savedState=k);c()}a.paused=!1;a.system.debugDrawTiming=!1;a.system.debugDrawStats=!1;a.system.debugDrawFramerateGraph=!1;a.system.debugDrawMemoryGraph=!1;a.system.debugFramerateGraphSettings={bounds:{}};a.system.debugDrawConsole=!1;a.system.load=null;a.system.commandHandler=null;a.system.hasFocus=!0;window.hasFocus?a.system.hasFocus=
window.hasFocus():document.hasFocus&&(a.system.hasFocus=document.hasFocus());a.preLoadTimer=null;a.mousePos={x:-1,y:-1};a.init=function(b,d){d=d||{};if(!a.initialized){if(d.useProtectedCycle){var c=a.system.cycle,e=!1;a.system.cycle=function(b){try{c(b)}catch(y){if(!e||d.protectedCycleAllowMultipleErrors)e=!0,a.console.saveOutputToLocalStorage=!0,a.system.reportSeriousError(y),a.console.logNewlines(y.stack),d.protectedCycleErrorHandler&&d.protectedCycleErrorHandler(y)}}}useProtectedCycle=!!d.useProtectedCycle;
a.console.log("Initializing Rat...");a.system.load&&a.system.load();a.detectPlatform();a.profiler.init();a.graphics.init(b,d.gfxInit);a.particle&&a.particle.init();a.audio&&a.audio.init();a.clipboard&&a.clipboard.init();a.system.requestAnimationFrameID=window.requestAnimationFrame(a.system.cycle);a.input&&(a.input.init(),a.input.autoHandleEvents());a.console.registerCommand("showMemory",function(b,d){a.system.debugDrawMemoryGraph=!a.system.debugDrawMemoryGraph},["showMemory","memory"]);a.initialized=
!0}};a.preLoadImages=function(b,d){a.postLoadFunction=d;a.graphics.preLoadImages(b);a.preLoadTimer=setInterval(a.processPreLoad,1E3/60)};a.processPreLoad=function(){a.graphics.isCacheLoaded()&&(a.console.log("rat preload done."),clearInterval(a.preLoadTimer),a.preLoadTimer=null,"undefined"!==typeof a.postLoadFunction&&a.postLoadFunction())};a.setDraw=function(b){a.draw=b};a.setPostUIDraw=function(b){a.postUIDraw=b};a.setUpdate=function(b){a.update=b};a.system.frameIntervalLimit=0;a.system.setFrameIntervalLimit=
function(b){a.system.frameIntervalLimit=b};a.system.setFrameRateLimit=function(b){a.system.setFrameIntervalLimit(1/b)};a.system.clearFrameRateLimit=a.system.clearFrameIntervalLimit=function(){a.system.frameIntervalLimit=0};a.system.lastCycleTime=0;a.system.cycle=function(b){a.system.requestAnimationFrameID=window.requestAnimationFrame(a.system.cycle);a.graphics.beginFrame();a.profiler.pushPerfMark("Rat.System.Cycle");a.system.dateNow=Date.now();if(a.system.frameIntervalLimit){if(b-a.system.lastCycleTime<
1E3*a.system.frameIntervalLimit)return;a.system.lastCycleTime=b}a.deltaTimeLock||(a.profiler.pushPerfMark("updateDeltaTime"),a.system.updateDeltaTime(),a.profiler.popPerfMark("updateDeltaTime"));b=a.deltaTime;a.update&&(a.profiler.pushPerfMark("GameUpdate"),a.update(b),a.profiler.popPerfMark("GameUpdate"));a.input&&(a.profiler.pushPerfMark("input.update"),a.input.update(b),a.profiler.popPerfMark("input.update"));a.ui&&(a.profiler.pushPerfMark("ui.updateAnimators"),a.ui.updateAnimators(b),a.profiler.popPerfMark("ui.updateAnimators"));
a.screenManager&&(a.profiler.pushPerfMark("updateScreens"),a.screenManager.updateScreens(),a.profiler.popPerfMark("updateScreens"));a.audio&&a.audio.update&&a.audio.update(b);a.cycleUpdate&&(a.profiler.pushPerfMark("cycleupdate"),a.cycleUpdate.updateAll(b),a.profiler.popPerfMark("cycleupdate"));a.timerUpdater&&(a.profiler.pushPerfMark("timerUpdate"),a.timerUpdater.updateAll(b),a.profiler.popPerfMark("timerUpdate"));a.Rumble&&a.Rumble.supported&&a.Rumble.frameUpdate(b);b=a.graphics.getContext();a.profiler.pushPerfMark("Rendering");
a.graphics.save();a.graphics.setupMatrixForRendering();a.graphics.autoClearCanvas&&(a.profiler.pushPerfMark("Clearing Canvas"),a.graphics.clearCanvas(),a.profiler.popPerfMark("Clearing Canvas"));a.graphics.canvas.style&&a.graphics.canvas.style.backgroundImage&&a.system.has.Wraith&&a.graphics.canvas.style.backgroundImage.drawTiled(a.graphics.canvas.width,a.graphics.canvas.height);a.beforeDraw&&(a.profiler.pushPerfMark("BEFORE draw"),a.beforeDraw(b),a.profiler.popPerfMark("BEFORE draw"));a.draw&&(a.profiler.pushPerfMark("rat.draw"),
a.draw(b),a.profiler.popPerfMark("rat.draw"));a.screenManager&&(a.profiler.pushPerfMark("screen draw"),a.screenManager.drawScreens(),a.profiler.popPerfMark("screen draw"),a.postUIDraw&&(a.profiler.pushPerfMark("post UI draw"),a.postUIDraw(b),a.profiler.popPerfMark("post UI draw")));a.profiler.pushPerfMark("Debug Rendering");a.console.drawConsole();a.trackValue&&a.trackValue.draw();a.system.setDebugFont();a.system.debugDrawTiming&&a.system.drawDebugTiming();a.system.debugDrawStats&&a.system.drawDebugStats();
a.system.debugDrawFramerateGraph&&a.system.drawDebugFramerateGraph();a.system.debugDrawMemoryGraph&&a.system.drawDebugMemoryGraph();a.system.debugDrawConsole&&a.console.drawLog();a.profiler&&a.profiler.displayStats&&(a.profiler.pushPerfMark("Profiler draw"),a.profiler.displayStats(),a.profiler.popPerfMark("Profiler draw"));a.profiler.popPerfMark("Debug Rendering");a.graphics.restore();a.profiler.popPerfMark("Rendering");a.afterDraw&&(a.profiler.pushPerfMark("After Draw"),a.afterDraw(b),a.profiler.popPerfMark("After Draw"));
a.profiler.popPerfMark("Rat.System.Cycle");a.graphics.endFrame()};a.system.reportSeriousError=function(b){var d="EXCEPTION: "+b.toString();a.console.logOnce(d);a.console.state.consoleActive||a.console.activate(!0);a.system.errorOutputElement&&(a.system.errorOutputElement.innerHTML+=d+"<br>"+(b.stack||"[no stack]"),a.system.errorOutputElement.style.visibility="visible",window.cancelAnimationFrame(a.system.requestAnimationFrameID))};a.deltaTimeRaw=1/60;a.deltaTimeRawSmoothed=a.deltaTimeRaw;a.deltaTimeMod=
1;a.deltaTimeUnsmoothed=a.deltaTime;a.deltaTime=a.deltaTimeRaw;a.deltaTimeLock=!1;a.runningFpsUnsmoothed=1/a.deltaTimeUnsmoothed;a.runningFps=1/a.deltaTime;a.runningTime=0;var f=c(),g=[];a.SMOOTHING_SAMPLE_SIZE=25;var h=0,k=[],l=[];a.system.FPS_RECORD_SIZE=100;var m=0,n,p=0;a.system.updateDeltaTime=function(){0>=a.deltaTimeMod&&(a.deltaTimeMod=1E-10);if(a.system.has.Wraith)a.deltaTimeRaw=Wraith.getDeltaTime();else{var b=c();a.deltaTimeRaw=b-f;f=b}a.paused&&(a.deltaTimeRaw=0);.1<a.deltaTimeRaw&&!a.paused&&
(a.deltaTimeRaw=.1);a.deltaTimeUnsmoothed=a.deltaTimeRaw*a.deltaTimeMod;a.runningFpsUnsmoothed=1/a.deltaTimeUnsmoothed;b=0;g[h]=a.deltaTimeRaw;h=(h+1)%a.SMOOTHING_SAMPLE_SIZE;for(var d=g.length<a.SMOOTHING_SAMPLE_SIZE?g.length:a.SMOOTHING_SAMPLE_SIZE,e=0;e!==d;++e)b+=g[e];a.deltaTimeRawSmoothed=b/d;a.deltaTime=a.deltaTimeRawSmoothed*a.deltaTimeMod;a.runningFps=1/a.deltaTime;a.runningTime+=a.deltaTimeRaw;k[m]=a.deltaTimeRaw;l[m]=a.deltaTimeRawSmoothed;m=(m+1)%100;if(void 0===n||2<(p+=a.deltaTimeRaw)||
n<a.deltaTimeRaw)n=a.deltaTimeRaw,p=0};a.system.lockDeltaTime=function(b){void 0===b&&(b=!0);a.deltaTimeLock=b};a.system.setDebugFont=function(){var b=a.graphics.getContext();b.font="bold "+a.console.config.textSize+"px monospace";b.textAlign="left";b.textBaseline="middle"};a.system.drawDebugTiming=function(){var b=a.math.floor(a.runningFps),d=a.math.floor(1E3*a.deltaTime)/1E3,c=a.graphics.getContext();c.fillStyle="#F08030";c.fillText("fps: "+b+"  DT: "+d,60,a.graphics.SCREEN_HEIGHT-a.console.config.logLineHeight-
230)};a.system.drawDebugStats=function(){var b=a.graphics.getContext();b.fillStyle="#F08030";var d=a.console.config.logLineHeight,c=a.graphics.SCREEN_HEIGHT-3*d-230;if(a.particle){var e=a.particle.getSystemCount(),f=a.particle.getAllEmitterCount(),g=a.particle.getAllParticleCount(),k=a.particle.State.cacheSize,h=a.particle.State.count;a.particle.stateCaching.enabled&&(b.fillText("   states(cached): "+h+"("+k+")",30,c),c-=d);b.fillText("P: sys: "+e+"  em: "+f+"  p: "+g,30,c);c-=d}a.graphics&&a.graphics.frameStats&&
a.ui&&(b.fillText("UI: elem: "+a.graphics.frameStats.totalElementsDrawn+", mcalls "+a.ui.mouseMoveCallCount+", ucalls "+a.ui.updateCallCount,30,c),c-=d);a.graphics&&a.graphics.Image&&a.graphics.Image.perFrameDrawCount&&(b.fillText("Images: "+a.graphics.Image.perFrameDrawCount,30,c),c-=d);if(a.xuijs){e=0;for(var l in a.xuijs.XuiElementsDrawnThisFrame)e+=a.xuijs.XuiElementsDrawnThisFrame[l],b.fillText("   "+l+": "+a.xuijs.XuiElementsDrawnThisFrame[l]+(a.xuijs.XuiElementsSkippedThisFrame[l]?" (/"+a.xuijs.XuiElementsSkippedThisFrame[l]+
")":""),30,c),c-=d;b.fillText("XUI Elem: "+e,30,c);a.xuijs.XuiElementsDrawnThisFrame={};a.xuijs.XuiElementsSkippedThisFrame={}}};a.system.drawDebugMemoryGraph=function(){a.system.debugMemoryGraphSettings||(a.system.debugMemoryGraphSettings={bounds:{},history:[]});var b=a.system.debugMemoryGraphSettings,d=a.graphics.getContext(),c=a.graphics.SCREEN_WIDTH,e=a.graphics.SCREEN_HEIGHT;b.bounds&&b.bounds.x||(b.bounds={},b.bounds.w=c/4,b.bounds.h=e/8,b.bounds.x=.9*c-b.bounds.w,b.bounds.y=.95*e-2*b.bounds.h-
16);c=b.bounds;d.save();d.fillStyle="white";d.translate(c.x,c.y);for(e=0;3>e;++e){d.lineWidth=1;d.strokeStyle=["red","yellow","blue"][e];d.beginPath();var f=e/2*c.h;d.moveTo(0,f);d.lineTo(c.w,f);d.stroke()}if(window.performance&&window.performance.memory){e=window.performance.memory.totalJSHeapSize||1;var g=window.performance.memory.usedJSHeapSize||0;var k=g/e*100;b.history.push(g);b.history.length>a.system.FPS_RECORD_SIZE&&b.history.shift();d.textAlign="start";d.textBaseline="hanging";d.fillText("Memory: "+
k.toFixed(2)+"% of "+(e/1024/1024).toFixed(2)+"MB",0,c.h+1);d.strokeStyle="green";d.save();d.beginPath();for(g=0;g<b.history.length&&g<a.system.FPS_RECORD_SIZE;++g)k=g,b.history.length<a.system.FPS_RECORD_SIZE&&(k+=a.system.FPS_RECORD_SIZE-b.history.length),f=b.history[g],k=k/(a.system.FPS_RECORD_SIZE-1)*c.w,f=c.h*(1-f/e),0==g?d.moveTo(k,f):d.lineTo(k,f);d.stroke();d.restore()}else d.textAlign="start",d.textBaseline="hanging",d.fillText("Memory unavailable.",0,c.h+1);d.restore()};a.system.drawDebugFramerateGraph=
function(){function b(a,b){d.beginPath();for(var c=0,e,g=a.length,k=f.bounds.w/99,h=0;h!==g;++h)e=a[(h+b)%g],e=1/e/120,e=f.bounds.h-e*f.bounds.h,0===h?d.moveTo(c,e):d.lineTo(c,e),c+=k;d.stroke()}if(!(1>=k.length)){var d=a.graphics.getContext(),c=a.graphics.SCREEN_WIDTH,e=a.graphics.SCREEN_HEIGHT-30,f=a.system.debugFramerateGraphSettings;f&&f.bounds&&f.bounds.x||(f={bounds:{}},f.bounds.w=c/4,f.bounds.h=e/8,f.bounds.x=.9*c-f.bounds.w,f.bounds.y=.95*e-f.bounds.h);d.translate(f.bounds.x,f.bounds.y);d.lineWidth=
1;d.strokeStyle="#F02040";d.beginPath();d.moveTo(0,0);d.lineTo(f.bounds.w,0);d.stroke();d.beginPath();d.moveTo(0,f.bounds.h/2);d.lineTo(f.bounds.w,f.bounds.h/2);d.stroke();d.beginPath();d.moveTo(0,f.bounds.h);d.lineTo(f.bounds.w,f.bounds.h);d.stroke();d.lineWidth=2;if(0<a.profiler.perfmarkers.length){d.save();c=a.profiler.perfmarkers;e=a.graphics.frameIndex;for(var g,h=0;h!==c.length;++h){g=c[h];var p=1-(e-g.frame)/100;d.strokeStyle=g.color;d.beginPath();p*=f.bounds.w;d.moveTo(p,0);d.lineTo(p,f.bounds.h);
d.stroke()}d.restore()}d.strokeStyle="#808000";b(k,m);d.strokeStyle="#8080FF";b(l,m);c=(100*a.runningFps|0)/100;e=(1E3*a.deltaTime|0)/1E3;h=1/n;d.fillStyle="#F0F0F0";c=""+c.toFixed(2);e=""+e.toFixed(3);h=""+h.toFixed(2);c="     ".substr(0,5-c.length)+c;e="     ".substr(0,5-e.length)+e;d.fillText("fps: "+c+" (low "+h+")  DT: "+e,0,f.bounds.h);d.translate(-f.bounds.x,-f.bounds.y)}};a.dispatchCommand=function(b,d){if(a.screenManager)for(var c=a.screenManager.screenStack.length-1;0<=c;c--){var e=a.screenManager.screenStack[c];
if("undefined"!==typeof e.handleCommand&&e.handleCommand(b,d))return}a.system.commandHandler&&a.system.commandHandler(b,d)};a.system.exit=function(){a.system.has.Wraith?window.close&&window.close():a.console.log(">>>>APP REQUESTED CLOSE, but we are just a poor browser and don't know how.<<<<")};a.system.reloadLocation=function(a){void 0===a&&(a=!0);document.location&&document.location.reload&&document.location.reload(a)};a.system.assignLocation=function(a){document.location.assign(a)};a.addOSEventListener=
function(a,b,d,c){if(a&&a.addEventListener)return a.addEventListener(b,d,!!c);if(a&&a.attachEvent)return a.attachEvent(b,d);if("undefined"!==typeof window&&window.addEventListener)return window.addEventListener(b,d,!!c)};a.removeOSEventListener=function(a,b,d,c){a.removeEventListener?a.removeEventListener(b,d,!!c):a.detachEvent?a.detachEvent(b,d):"undefined"!==typeof window&&window.removeEventListener&&window.removeEventListener(b,d,!!c)};a.addOSKeyEventListener=function(b,d,c,e){a.addOSEventListener(b,
d,function(b){a.input&&a.input.standardizeKeyEvent(b);c(b)},e)};var r=!1;(r=a.detectPlatform.detected?a.system.has.winJS:!!window.Windows)&&window.WinJS&&(window.WinJS.Application.onerror=b,window.WinJS.Application.oncheckpoint=e,window.Windows&&window.Windows.UI.WebUI.WebUIApplication.addEventListener("resuming",d,!1));(function(){function b(b){var c={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};b=b||window.event;b=b.type in c?c[b.type]:
this[d]?"hidden":"visible";(a.system.visibility=b)&&a.events&&a.events.fire&&a.events.fire("visibility",b)}var d="hidden";d in document?document.addEventListener("visibilitychange",b):(d="mozHidden")in document?document.addEventListener("mozvisibilitychange",b):(d="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",b):(d="msHidden")in document?document.addEventListener("msvisibilitychange",b):"onfocusin"in document?document.onfocusin=document.onfocusout=b:window.onpageshow=
window.onpagehide=window.onfocus=window.onblur=b})();a.addOSEventListener(window,"focus",function(){a.system.hasFocus||(a.system.hasFocus=!0,a.events&&a.events.fire&&a.events.fire("focus"))});a.addOSEventListener(window,"blur",function(){a.system.hasFocus&&(a.system.hasFocus=!1,a.events&&a.events.fire&&a.events.fire("blur"))})});
rat.modules.add("rat.os.r_events",[],function(a){a.events=a.events||{};a.events.registered={};a.events.firing={};a.events.queued=a.events.queued||{};a.addEventListener=function(c,b,d,e){if(b){a.events.registered[c]=a.events.registered[c]||[];var f=a.events.registered[c];void 0===e&&(e=f.length);f.splice(e,0,{func:b,ctx:d});a.events.queued[c]&&(a.events.fire.apply(a.events,a.events.queued[c]),a.events.queued[c]=void 0)}};a.removeEventListener=function(c,b,d){if(!b)return!1;var e=a.events.registered[c];
if(!e)return!1;c=a.events.firing[c];for(var f,g=0;g!==e.length;++g)if(f=e[g],f.func===b&&f.ctx===d)return c&&(c.index<=g&&--c.index,--c.stopAt),e.splice(g,1),!0;return!1};a.events.queueEvent=function(c){var b=Array.prototype.slice.call(arguments),d=a.events.registered[c];d&&d.length?a.events.fire.apply(a.events,b):a.events.queued[c]=b};a.events.fire=function(c){var b=a.events.registered[c];if(!b||0===b.length)return!1;var d=Array.prototype.slice.call(arguments,1),e=a.events.firing[c];a.events.firing[c]=
{index:0,stopAt:b.length};for(var f=a.events.firing[c],g,h;f.index!==f.stopAt;++f.index)g=b[f.index],h=g.func,g=g.ctx,h.apply(g,d);a.events.firing[c]=e}});
rat.modules.add("rat.debug.r_console",["rat.os.r_system","rat.math.r_math","rat.graphics.r_graphics","rat.utils.r_utils","rat.input.r_input"],function(a){function c(b,c,e){d.currentCommand=b;d.cursorPos=a.math.min(a.math.max(0,d.cursorPos),d.currentCommand.length);c&&(d.commandHistoryIndex=-1);e&&(d.autoComplete=[],d.accessingAutoComplete=-1)}function b(b){return a.utils.get(this,b)}a.console.config={bounds:{x:48,y:0,w:{fromParent:!0,val:-96},h:{percent:!0,val:.6}},textColor:"#90B090",textSize:12,
logLineHeight:14,bgColor:"rgba(0,0,0,0.5)"};a.console.configChanged={};a.console.state={consoleAllowed:!1,consoleActive:!1,cursorPos:0,pulseTimer:0,currentCommand:"",nextCommandID:0,commandList:[],commandHistory:[],commandHistoryIndex:-1,commandHistoryMax:100,autoComplete:[],accessingAutoComplete:-1,logOffset:0,consoleKey:"/",consoleAltKey:!1,consoleCtrlKey:!1,consoleShiftKey:!1};var d=a.console.state,e=a.system.getLocalStorage();if(e){var f=e.getItem("rat_commandHistory");f&&(a.console.state.commandHistory=
JSON.parse(f));if(e=e.getItem("rat_consoleConfig")){e=JSON.parse(e);for(var g in e)a.console.config[g]&&(a.console.config[g]=e[g],a.console.configChanged[g]=!0)}}a.console.writeConfig=function(b){Array.isArray(b)||(b=[b]);for(var d=0;d<b.length;d++)a.console.configChanged[b[d]]=!0;if(a.system.localStorageObject){b={};for(var c in a.console.configChanged)b[c]=a.console.config[c];a.system.localStorageObject.setItem("rat_consoleConfig",JSON.stringify(b))}};a.console.clearConfig=function(){a.system.localStorageObject&&
a.system.localStorageObject.removeItem("rat_consoleConfig");a.console.configChanged={}};a.console.setBounds=function(b,d,c,e){b.x?(a.console.config.bounds.x=b.x,a.console.config.bounds.y=b.y,a.console.config.bounds.w=b.w,a.console.config.bounds.h=b.h):(a.console.config.bounds.x=b,a.console.config.bounds.y=d,a.console.config.bounds.w=c,a.console.config.bounds.h=e)};a.console.getBounds=function(){var b=a.console.config.bounds;a.ui&&a.ui.data&&a.ui.data.calcBounds&&(b=a.ui.data.calcBounds({bounds:b},
{x:0,y:0,w:a.graphics.SCREEN_WIDTH,h:a.graphics.SCREEN_HEIGHT}));return b};a.console.setTextSize=function(b,d){a.console.config.textSize=b;d||(d=Math.floor(1.1*b));a.console.config.logLineHeight=d};a.console.allow=function(b){void 0===b&&(b=!0);a.console.state.consoleAllowed=!!b};a.console.activate=function(b){void 0===b&&(b=!0);a.console.state.consoleActive=!!b};a.console.logOnce=function(b,d,c,e){d||(d=b);c||(c=1);a.console.onceRecord[d]||(a.console.onceRecord[d]=0);a.console.onceRecord[d]++;a.console.onceRecord[d]<=
c&&a.console.log(b,e)};a.console.logWarningOnce=function(b,d,c){a.console.logOnce(b,d,c,"warning")};a.console.logErrorOnce=function(b,d,c){a.console.logOnce(b,d,c,"error")};a.console.drawConsole=function(){if(a.console.state.consoleAllowed&&a.console.state.consoleActive){var b=a.console.getBounds();a.graphics.drawRect(b,{fill:!0,color:a.console.config.bgColor});a.graphics.drawRect(b,{color:a.console.config.bgColor,lineWidth:2});var c=a.utils.copyObject(b);c.h-=a.console.config.logLineHeight+10;a.console.drawLog(c);
c.y=c.h;c.h=b.h-c.h;a.graphics.drawRect(c,{color:a.console.config.bgColor,lineWidth:2});c.x+=4;c.y+=4;b=a.runningTime||0;var e=b/60/60|0;b-=3600*e;var f=b/60|0;b=""+e+":"+f+":"+(b-60*f|0);e=a.graphics.ctx.measureText(b);void 0!==e.width&&(e=e.width);a.graphics.drawText(b,c.x+c.w-e-8,c.y);a.console.config.identifier&&(a.graphics.ctx.textAlign="right",a.graphics.drawText(""+a.console.config.identifier,c.x+c.w-8,c.y-a.console.config.logLineHeight));a.graphics.ctx.textAlign="left";a.graphics.drawText("> "+
d.currentCommand,c.x,c.y);d.pulseTimer+=a.deltaTime;.6<d.pulseTimer&&(d.pulseTimer=0);.3>d.pulseTimer&&(b=d.currentCommand.slice(0,d.cursorPos),e=a.graphics.ctx.measureText("> "+b),e=e.width||e,c.x+=e,a.graphics.ctx.fillStyle="white",a.graphics.ctx.font=" bold"+a.graphics.ctx.font,a.graphics.drawText("|",c.x,c.y))}};a.console.drawLog=function(b){b=b||a.console.config.bounds;var d=a.console.output,c=a.graphics.ctx,e=a.console.config.logLineHeight,f=b.x,g=b.y,h=b.w,w=b.h;0>h&&(h=a.graphics.SCREEN_WIDTH-
f-10);0>w&&(w=a.graphics.SCREEN_HEIGHT-g-10);c.font=""+a.console.config.textSize+"px Arial";c.textAlign="left";c.fillStyle=a.console.config.textColor;b=w-0-e*d.length;w+=g;b+=(a.console.state.logOffset-1)*e;c.textBaseline="top";for(var q=0;q<d.length&&!(b+e>g&&c.fillText(d[q],f,b,h),b+=e,b+e>=w&&0<a.console.state.logOffset&&(c.fillText("...",f,b,h),b+=e),b>=w);q++);};a.console.handleEvent=function(e){if("keydown"!==e.eventType&&"keypress"!==e.eventType)return!1;if("keydown"===e.eventType){if(e.which===
a.keys.f12)return!1;if(e.which===a.keys[d.consoleKey]&&e.sysEvent.altKey===d.consoleAltKey&&e.sysEvent.ctrlKey===d.consoleCtrlKey&&e.sysEvent.shiftKey===d.consoleShiftKey||e.which===a.keys.esc&&a.console.state.consoleActive)return a.console.state.consoleActive=!a.console.state.consoleActive,!0;if(a.console.state.consoleActive)e.allowBrowserDefault=!0;else return!1;if(e.which===a.keys.enter)e.sysEvent.preventDefault(),d.currentCommand=d.currentCommand.trim(),d.currentCommand&&d.commandHistory[d.commandHistory.length]!==
d.currentCommand&&(d.commandHistory.unshift(d.currentCommand),d.commandHistory.length>d.commandHistoryMax&&d.commandHistory.pop(),a.system.localStorageObject&&a.system.localStorageObject.setItem("rat_commandHistory",JSON.stringify(d.commandHistory))),d.currentCommand&&a.console.parseCommand(d.currentCommand.trim()),c("",!0,!0);else if(e.which===a.keys.backspace)e.sysEvent.preventDefault(),0<d.cursorPos&&(--d.cursorPos,c(d.currentCommand.slice(0,d.cursorPos)+d.currentCommand.slice(d.cursorPos+1),!1,
!0));else if(e.which===a.keys.del)e.sysEvent.preventDefault(),d.cursorPos<d.currentCommand.length&&c(d.currentCommand.slice(0,d.cursorPos)+d.currentCommand.slice(d.cursorPos+1),!1,!0);else if(e.sysEvent.shiftKey&&(e.which===a.keys.upArrow||e.which===a.keys.downArrow)){var f=a.console.config.textSize;e.which===a.keys.upArrow?f+=2:e.which===a.keys.downArrow&&(f-=2,4>f&&(f=4));a.console.setTextSize(f);a.console.writeConfig(["textSize","logLineHeight"])}else if(e.which===a.keys.upArrow||e.which===a.keys.downArrow)e.sysEvent.preventDefault(),
c(d.currentCommand.trim(),!1,!1),e.which===a.keys.upArrow?++d.commandHistoryIndex:--d.commandHistoryIndex,-1>d.commandHistoryIndex?d.commandHistoryIndex=-1:0===d.commandHistoryIndex&&0===d.commandHistory.length?c("",!0,!0):d.commandHistoryIndex>=d.commandHistory.length?(d.commandHistoryIndex=d.commandHistory.length-1,c(d.commandHistory[d.commandHistoryIndex],!1,!1)):-1===d.commandHistoryIndex?c("",!1,!1):(c(d.commandHistory[d.commandHistoryIndex],!1,!0),d.cursorPos=d.currentCommand.length);else if(e.which===
a.keys.leftArrow||e.which===a.keys.rightArrow)e.sysEvent.preventDefault(),e.which===a.keys.leftArrow?--d.cursorPos:++d.cursorPos,d.cursorPos=a.math.max(0,d.cursorPos),d.cursorPos=a.math.min(d.cursorPos,d.currentCommand.length);else if(e.which===a.keys.home)e.sysEvent.preventDefault(),d.cursorPos=0;else if(e.which===a.keys.end)e.sysEvent.preventDefault(),d.cursorPos=d.currentCommand.length;else if(e.which===a.keys.tab){e.sysEvent.preventDefault();if(-1===d.accessingAutoComplete){c(d.currentCommand.trim(),
!1,!1);e=d.currentCommand;d.autoComplete=[];for(var g=e.toUpperCase(),h=d.commandList.length,n=0;n!==h;++n){var p=d.commandList[n];if(p.name.slice(0,g.length)===g)d.autoComplete.push(p.name);else for(var r=p.alias.length,w=0;w!==r;++w)p.alias[w].slice(0,g.length)===g&&d.autoComplete.push(p.alias[w])}if(0>=d.autoComplete.length&&(h=e.lastIndexOf("."),1<h&&(g=e.substring(0,h),e=e.substring(h+1),h=b(g),void 0!==h)))for(f in h)!f||e&&f.substring(0,e.length)!==e||d.autoComplete.push(g+"."+f);d.autoComplete.sort();
d.accessingAutoComplete=0}0<d.autoComplete.length&&(c(d.autoComplete[d.accessingAutoComplete],!0,!1),d.cursorPos=d.currentCommand.length,a.input.keyboard.isKeyDown(a.keys.shift)?(d.accessingAutoComplete--,0>d.accessingAutoComplete&&(d.accessingAutoComplete=d.autoComplete.length-1)):(d.accessingAutoComplete++,d.accessingAutoComplete>=d.autoComplete.length&&(d.accessingAutoComplete=0)))}else if(e.which===a.keys.pageUp||e.which===a.keys.pageDown)e.sysEvent.preventDefault(),f=a.console.getBounds().h/
a.console.config.logLineHeight/4|0,f=Math.max(1,f),a.console.state.logOffset=e.which===a.keys.pageUp?a.console.state.logOffset+f:a.console.state.logOffset-f,a.console.state.logOffset=a.utils.clamp(a.console.state.logOffset,0,a.console.output.length-1)}else if("keypress"===e.eventType){if(!a.console.state.consoleActive)return!1;f=e.sysEvent.char;if(32>f.charCodeAt(0))return!1;d.consoleActive&&"\n"!==f&&"\t"!==f&&f!==d.consoleKey&&(d.currentCommand=d.cursorPos===d.currentCommand.length?d.currentCommand+
f:0===d.cursorPos?f+d.currentCommand:d.currentCommand.slice(0,d.cursorPos)+f+d.currentCommand.slice(d.cursorPos),d.cursorPos++,d.autoComplete=[],d.accessingAutoComplete=-1)}return!0};a.console.registerCommand=function(a,b,c){var e={};e.name=a.toUpperCase();e.func=b;e.id=d.nextCommandID++;e.alias=c||[];a=e.alias.length;for(b=0;b<a;b++)e.alias[b]=e.alias[b].toUpperCase();d.commandList.push(e);return e.id};a.console.unregisterCommand=function(a){for(var b=d.commandList.length,c=0;c<b;c++)if(d.commandList[c].id===
a)return d.commandList.splice(c,1),!0;return!1};a.console.getCommand=function(a){a=a.toUpperCase();for(var b=d.commandList.length,c=0;c!==b;++c){var e=d.commandList[c];if(e.name===a)return e;for(var f=0;f!==e.alias.length;++f)if(e.alias[f]===a)return e}};a.console.parseCommand=function(d){var c=d,e=d.split(/\s/);d=e[0];e.splice(0,1);var f=a.console.getCommand(d);if(f)f.func(d,e,c);else{try{var g=b(c)}catch(r){return a.console.log(c),a.console.logError("ERROR evaluating expression: "+r.toString()),
!0}if(void 0!==g)a.console.dumpValue(g,c+" == ");else try{a.console.log(c);var h=eval(c);a.console.dumpValue(h,"returned: ")}catch(r){a.console.logError("ERROR evaluating JS expression: "+r.toString())}}return!0};a.console.dumpValue=function(b,d){d=d||"";switch(typeof b){case "object":null===b?d+="NULL":(a.console.log("------------"),b=a.utils.objectToString(b,d,null,0,0,".."),a.console.logNewlines(b),d=null);break;case "boolean":d+=b.toString();break;case "number":d+=b.toString();break;case "string":d+=
"'"+b.toString()+"'";break;case "function":d+="function";break;case "undefined":d+="undefined"}d&&a.console.log(d)};a.console.listCommands=function(){for(var b=d.commandList.length,c=0;c!==b;++c){var e=d.commandList[c],f="    "+e.name;if(e.alias.length){f+="  (";for(var g=0;g!==e.alias.length;++g)f+=e.alias[g]+" ";f+=")"}a.console.log(f)}};a.console.registerCommand("help",function(b,d){a.console.log("-------------------------------------");a.console.log("rat console help:");a.console.log("* up/down arrows navigate command history");
a.console.log("* shift up/down arrows change font size");a.console.log("* commands:");a.console.listCommands()},["?"]);a.console.registerCommand("log",function(b,d){a.console.log(d.join(" "))});a.console.registerCommand("saveLog",function(b,d){a.console.saveOutputToLocalStorage=!a.console.saveOutputToLocalStorage;a.console.log("Log will "+(a.console.saveOutputToLocalStorage?"":" not ")+" save.")});a.console.registerCommand("restoreLog",function(b,d){a.system.localStorageObject?(b=JSON.parse(a.system.localStorageObject.getItem("RAT_LOG")))&&
Array.isArray(b)?(a.console.output=b,a.console.log("Log restored")):a.console.log("Failed to restore log"):a.console.logError("ERROR! localStorage not supported")});a.console.registerCommand("clear",function(b,d){a.console.output=[]},["cls","clearLog"]);a.console.registerCommand("Alias",function(b,d){if(b=d[0]){d.splice(0,1);a.console.registerCommand(b,function(b,d){b=a.console.getCommand(b);a.console.parseCommand(b.aliasedTo+" "+d.join(" "))});var c=a.console.getCommand(b);c.aliasedTo=d.join(" ");
a.console.log("Added alias "+b+"="+c.aliasedTo)}});a.console.registerCommand("frames",function(b,d){a.dframe()},["showFrames","dframe"]);a.console.registerCommand("dtree",function(b,d){a.dtree()},["dumpTree"]);a.console.registerCommand("showFPSGraph",function(b,d){b=a.system.debugDrawFramerateGraph;a.system.debugDrawFramerateGraph=!b;a.system.debugDrawTiming=!b},["fpsgraph"]);a.console.registerCommand("showFPS",function(b,d){a.system.debugDrawTiming=!a.system.debugDrawTiming},["fps"]);a.console.registerCommand("showStats",
function(b,d){a.system.debugDrawStats=!a.system.debugDrawStats},["stats"]);a.dframe=function(){if(a.screenManager){var b=a.screenManager.getTopScreen();b&&b.frameAllRandom()}};a.dtree=function(){if(a.screenManager){var b=a.screenManager.getTopScreen();if(b){b=b.dumpTree();for(var d=0;d<b.lines.length;d++)a.console.log(b.lines[d]);a.console.log("total:"+b.totalCount+" (vis: "+(b.totalCount-b.hiddenCount)+", hid: "+b.hiddenCount+")")}else a.console.log("no top screen in stack to dump.")}}});
rat.modules.add("rat.debug.r_profiler",["rat.debug.r_console","rat.os.r_system","rat.graphics.r_graphics","rat.input.r_input"],function(a){function c(a){}function b(a,b){this._stats={name:a,parent:b,time:0,lastTick:void 0,calls:0,hasChildren:!1};this._children={}}function d(b){a.profiler.curNode._stats.abortProfilerForFrame||(a.profiler.curNode=a.profiler.curNode.getChild(b),a.profiler.curNode.storeTick(),++a.profiler.curNode._stats.calls)}function e(b){a.profiler.curNode._stats.abortProfilerForFrame||
(a.profiler.curNode._stats.name!==b||void 0===a.profiler.curNode._stats.parent?(a.console.logError("ERROR!  profiler.push does not match profiler.pop"),a.profiler.curNode=a.profiler.profileTrees[0],a.profiler.curNode._stats.abortProfilerForFrame=!0):(a.profiler.curNode.updateElapsed(),a.profiler.curNode=a.profiler.curNode._stats.parent))}function f(b,d,c){c=c||0;d=d||0;for(var e=a.graphics.ctx;c--;)b=a.profiler.displayInfo.tab+b;d>=a.profiler.displayInfo.cols.length&&(d=a.profiler.displayInfo.cols.length-
1);e.fillText(b,a.profiler.displayInfo.atX+a.profiler.displayInfo.cols[d],a.profiler.displayInfo.curY)}function g(){a.profiler.displayInfo.curY+=a.profiler.displayInfo.lineHeight}function h(a,b){return(a/b*100).toFixed(2)+"%"}function k(b){for(var d=1;d<a.profiler.selectedNode.length;++d)b=b.getChild(a.profiler.selectedNode[d]);return b}function l(){if(a.profiler.enableStatsDisplay){var b=a.graphics.ctx;if(b){b.save();b.font=a.profiler.displayInfo.font;b.fillStyle=a.profiler.displayInfo.color;a.profiler.displayInfo.curY=
a.profiler.displayInfo.atY;var d=a.profiler.profileTrees[1];if(d._stats.abortProfilerForFrame)f("***ERROR WITH PROFILER USAGE***",0);else if(d._stats.built){var c=k(d),e=c._stats.parent,l=0;f("NAME",0,2);f("% Parent",1,2);f("% Total",2,2);f("MS Total",3,2);f("MS/call",4,2);f("calls",5,2);g();e?(f("-"+c._stats.name,0),f(h(c._stats.time,e._stats.time),1)):f(" "+c._stats.name,0);f(h(c._stats.time,d._stats.time),2);f(c._stats.time.toFixed(4),3);c._stats.calls&&(f((c._stats.time/c._stats.calls).toFixed(4),
4),f(c._stats.calls,5));g();for(var m in c._children){a.profiler.highlightedNode||(a.profiler.highlightedNode=m);e=c._children[m];m===a.profiler.highlightedNode&&(b.fillStyle=a.profiler.displayInfo.highlightColor);var n=" ";e._stats.hasChildren&&(n="+");f(n+e._stats.name,0,1);f(h(e._stats.time,c._stats.time),1);f(h(e._stats.time,d._stats.time),2);f(e._stats.time.toFixed(4),3);c._stats.calls&&(f((e._stats.time/e._stats.calls).toFixed(4),4),f(e._stats.calls,5));g();m===a.profiler.highlightedNode&&(b.fillStyle=
a.profiler.displayInfo.color);l+=e._stats.time}g();f(" MISSING TIME",0,1);l=c._stats.time-l;f(h(l,c._stats.time),1);f(h(l,d._stats.time),2);f(l.toFixed(4),3)}else f("***STATS PENDING***",0);b.restore()}}}function m(b){var d;if("keydown"===b.eventType){if(a.profiler.enableStatsDisplay){if(b.which===a.keys.j)return 1<a.profiler.selectedNode.length&&(a.profiler.highlightedNode=a.profiler.selectedNode.splice(a.profiler.selectedNode.length-1,1)[0]),!0;if(b.which===a.keys.l)return b=k(a.profiler.profileTrees[1]),
b._children[a.profiler.highlightedNode]&&b._children[a.profiler.highlightedNode]._stats.hasChildren&&(a.profiler.selectedNode.push(a.profiler.highlightedNode),a.profiler.highlightedNode=void 0),!0;if(b.which===a.keys.i){b=k(a.profiler.profileTrees[1]);var c="";for(d in b._children){if(d===a.profiler.highlightedNode){a.profiler.highlightedNode=c;break}c=d}return!0}if(b.which===a.keys.k){c=!1;b=k(a.profiler.profileTrees[1]);for(d in b._children)if(d===a.profiler.highlightedNode)c=!0;else if(c){a.profiler.highlightedNode=
d;break}return!0}}if(b.which===a.keys.p)return a.profiler.enableStatsDisplay=!a.profiler.enableStatsDisplay,!0}return!1}a.profiler={enableProfiler:!1,usingRatProfiler:!1,profileTrees:[void 0,void 0],curNode:void 0,enableStatsDisplay:!1,selectedNode:["ROOT"],displayInfo:{atX:64,atY:64,lineHeight:22,tab:"  ",font:"12px arial",color:void 0,highlightColor:void 0,shadowColor:"black",curY:0,cols:[0,150,225,300,375,450]},highlightedNode:void 0,perfmarkers:[]};var n=a.profiler.perfmarkers,p={last:void 0,
name:void 0};b.prototype.getChild=function(a){this._children[a]||(this._children[a]=new b(a,this),this._stats.hasChildren=!0);return this._children[a]};b.prototype.clear=function(){this._stats.time=0;this._stats.calls=0;for(var a in this._children)this._children[a].clear()};b.prototype.getTick=function(){return a.profiler.usingRatProfiler?window.performance.now():0};b.prototype.storeTick=function(){this._stats.lastTick=this.getTick()};b.prototype.updateElapsed=function(){this._stats.time+=(this.getTick()-
this._stats.lastTick)/1E3;this._stats.lastTick=void 0};a.profiler.addPerfMarker=function(b,d){a.system.debugDrawFramerateGraph&&a.graphics&&a.graphics&&n.unshift({name:b,color:d.toString(),frame:a.graphics.frameIndex})};a.profiler.init=function(){var f=a.profiler;if(a.profiler.enableProfiler)if(a.system.has.Wraith)a.console.log("Using Wraith Profiler"),f.pushPerfMark=Wraith.PushPerfMark,f.popPerfMark=Wraith.PopPerfMark;else if(window.performance&&window.performance.now){a.console.log("Using RAT Profiler");
f.pushPerfMark=d;f.popPerfMark=e;var g=f.beginFrame,k=f.endFrame;f.beginFrame=function(){g()};f.endFrame=function(){k();a.profiler.curNode.parent&&(a.console.logError("ERROR!  profiler.push does not match profiler.pop"),a.profiler.curNode=a.profiler.profileTrees[0],a.profiler.curNode._stats.abortProfilerForFrame=!0);a.profiler.curNode._stats.abortProfilerForFrame||void 0!==a.profiler.curNode._stats.lastTick&&a.profiler.curNode.updateElapsed();var b=a.profiler.profileTrees[0];a.profiler.profileTrees[0]=
a.profiler.profileTrees[1];a.profiler.profileTrees[1]=b;a.profiler.curNode=a.profiler.profileTrees[0];a.profiler.curNode.clear();a.profiler.curNode.storeTick();++a.profiler.curNode._stats.calls;a.profiler.curNode._stats.abortProfilerForFrame=!1;b._stats.built=!0};f.displayStats=l;for(f=0;f<a.profiler.profileTrees.length;++f)a.profiler.profileTrees[f]=new b("ROOT",void 0);a.profiler.curNode=a.profiler.profileTrees[0];a.profiler.displayInfo.color=a.profiler.displayInfo.color||a.graphics.white;a.profiler.displayInfo.highlightColor=
a.profiler.displayInfo.highlightColor||a.graphics.yellow;a.input.registerEventHandler(m);a.profiler.usingRatProfiler=!0}else a.console.log("No Profiler"),f.pushPerfMark=c,f.popPerfMark=c;else f.pushPerfMark=c,f.popPerfMark=c};a.profiler.beginFrame=function(){if(a.system.debugDrawFramerateGraph&&a.graphics&&n.length){for(var b=a.graphics.frameIndex-a.system.FPS_RECORD_SIZE,d=n.length,c=n.length-1;0<=c;--c)if(n[c].frame<b)d=c;else break;d<n.length&&n.splice(d)}};a.profiler.endFrame=function(){};a.profiler.push=
function(b){p={name:b,last:p};a.profiler.pushPerfMark(b)};a.profiler.pop=function(){var b=p.name;p=p.last;a.profiler.popPerfMark(b)};a.profiler.perf=function(b,d,c){a.profiler.pushPerfMark(b);d=c?d.call(c):d();a.profiler.popPerfMark(b);return d}});
rat.modules.add("rat.utils.r_utils",[{name:"rat.math.r_math",processBefore:!0},"rat.debug.r_console","rat.os.r_system","rat.os.r_user",{name:"rat.utils.r_utils_test",platform:"unitTest"}],function(a){function c(){}a.utils.inheritClassFrom=function(b,d){if(void 0===d){a.console.logError("Error inheriting from undefined...");var e=b.toString();e=e.substring(0,1E3);a.console.log(e)}c.prototype=d.prototype;b.prototype=new c;b.prototype.constructor=b;b.prototype.parentClass=d;b.prototype.parentConstructor=
d;b.prototype.parent=d.prototype;b.prototype.parentPrototype=d.prototype;return b};a.utils.extendClassWith=function(b,d){a.utils.extendObject(b.prototype,[d.prototype],!0)};a.utils.loadXMLDoc=function(b){var d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");d.open("GET",a.system.fixPath(b),!1);d.send();return d.responseXML};a.utils.loadJSONObject=function(b){var d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");d.open("GET",a.system.fixPath(b),
!1);d.send();return JSON.parse(d.responseText)};a.utils.loadJSONObjectAsync=function(b,d){var c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onload=function(e){if(4===c.readyState&&(200===c.status||0===c.status&&""===c.statusText)){e=!0;try{var f=JSON.parse(c.responseText)}catch(k){e=!1;var h=k}d(e,f,h)}else a.console.log("error loading "+b+" : "+c.statusText),d(!1,null)};c.open("GET",a.system.fixPath(b),!0);c.send()};a.utils.restGetJSONAsync=function(b,d){var c=
window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onload=function(e){if(4===c.readyState&&(200===c.status||0===c.status&&""===c.statusText)){e=!0;try{var f=JSON.parse(c.responseText)}catch(k){e=!1;var h=k}d(e,f,h)}else a.console.log("error reading rest json "+b+" : "+c.statusText),d(!1,null)};c.open("GET",b,!0);c.setRequestHeader("Content-type","application/json");c.send()};a.utils.loadCSS=function(a,d){if(!document.getElementById(d)){var b=document.createElement("link");
b.setAttribute("id",d);b.setAttribute("rel","stylesheet");b.setAttribute("type","text/css");b.setAttribute("href",a);b.setAttribute("media","all");document.getElementsByTagName("head")[0].appendChild(b)}};a.utils.unloadCSS=function(a){(a=document.getElementById(a))&&a.parentNode.removeChild(a)};a.utils.isCSSLoaded=function(a){return!!document.getElementById(a)};a.utils.copyObject=function(b,d,c){if("object"!==typeof b||null===b)return b;d=d||!1;c=c||!1;var e=Array.isArray(b)?[]:{};var g;for(g in b){var h=
b[g];void 0!==h&&(c||b.hasOwnProperty(g))&&(e[g]=d&&"object"===typeof h?a.utils.copyObject(h,!0,c):h)}return e};a.utils.deepCopy=function(b){return a.utils.copyObject(b,!0)};a.utils.extendObject=function(b,d,c,f){c=c||!1;!1===Array.isArray(d)&&(d=[d]);for(var e,h,k=0,l=d.length;k!==l;++k)if(h=d[k],void 0!==h&&h!==b)if(void 0===b||null===b)b=a.utils.copyObject(h,c);else for(var m in h)e=h[m],void 0!==e&&(void 0===b[m]||null===b[m]&&f?b[m]="object"===typeof e&&c?a.utils.copyObject(e,!0):e:"object"===
typeof b[m]&&"object"===typeof e?a.utils.extendObject(b[m],[e],c,f):f&&(b[m]=e));return b};a.utils.mergeObject=function(b,d){if(void 0===d||d===b)return b;if(void 0===b||null===b)return a.utils.copyObject(d,!0);for(var c in d){var f=function(b){return"object"===typeof b?a.utils.copyObject(b,!0):b};if(d.hasOwnProperty(c)){var g=d[c];void 0!==g&&(null===g?delete b[c]:void 0===b[c]||null===b[c]?b[c]=f(g):typeof b[c]!==typeof g||Array.isArray(g)?b[c]=a.utils.copyObject(g,!0):"object"===typeof b[c]&&"object"===
typeof g?a.utils.mergeObject(b[c],g):b[c]=f(g))}}return b};a.utils.deepSet=function(b,d,c){if("object"===typeof b&&null!==b)for(var e in b)b.hasOwnProperty(e)&&("object"===typeof b[e]?a.utils.deepSet(b[e],d,c):e===d&&(b[e]=c))};a.utils.searchArrayFor=function(a,d){for(var b=0;b<a.length;++b)if(d(a[b]))return b;return-1};a.utils.addProp=function(b,d,c,f,g){g=a.utils.extendObject(g||{},{enumerable:!0,configurable:!1});c&&(g.set=c);f&&(g.get=f);Object.defineProperty(b||{},d,g);return b};a.utils.objectToString=
function(b,d,c,f,g,h){function e(){for(var a=0;a<f;a++)c+=h}function l(b,d){if("undefined"!==typeof b)if(e(),""!==d&&(c+=""+d+" : "),Array.isArray(b)){c+="[\n";f++;for(d=0;d<b.length;d++)l(b[d],"");f--;e();c+="],\n"}else null===b?c+="null,\n":"function"===typeof b?c+="/*function*/,\n":"object"===typeof b?f>=g?c+="{...},\n":(c+="{\n",c=a.utils.objectToString(b,"",c,f,g-1,h),e(),c+="},\n"):c="string"===typeof b?c+("'"+b.toString()+"',\n"):"undefined"===typeof b?c+"x_x_undefined,\n":c+(b.toString()+
",\n")}c=c||"";f||(f=0);g=void 0!==g?g:10;h=void 0!==h?h:"  ";""!==d&&(e(),c+=d+"{\n");f++;for(var m in b)Object.prototype.hasOwnProperty.call(b,m)&&l(b[m],m);f--;""!==d&&(e(),c+="};\n");return c};a.utils.get=function(a,d){d=d.split(".");for(var b=0,c=d.length;b<c;b++){var g=d[b];if("]"===g.substring(g.length-1)){var h=g.indexOf("["),k=g.substring(h+1,g.length-1);k=parseInt(k,10);isNaN(k)&&(k=0);g=g.substring(0,h);a=a[g];g=k}a=a[g];if("undefined"===typeof a)break}return a};a.utils.set=function(a,
d,c){d=d.split(".");for(var b,e=0,h=d.length;e<h;e++){b=d[e];var k=b.indexOf("[");if(0<=k){var l=b.indexOf("]"),m=b.substring(0,k);b=b.substring(k+1,l);b=parseInt(b);if("undefined"===typeof a[m]||null===a[m])a[m]=[];a=a[m]}if(e===h-1)break;m=a[b];if("undefined"===typeof m||null===m)m=a[b]={};a=m}a[b]=c};a.utils.interpolate=function(a,d,c){return d*c+(1-c)*a};a.utils.interp=a.utils.interpolate;a.utils.interpolateClamped=function(a,d,c){0>c&&(c=0);1<c&&(c=1);return d*c+(1-c)*a};a.utils.interpolatePos=
function(a,d,c){return{x:d.x*c+(1-c)*a.x,y:d.y*c+(1-c)*a.y}};a.utils.limit=function(a,d,c){return a<d?d:a>c?c:a};a.utils.clamp=a.utils.limit;a.utils.randomizeList=function(a,d){d||(d=Math);for(var b=0;b<a.length;b++){var c=Math.floor(d.random()*a.length),g=a[b];a[b]=a[c];a[c]=g}return a};a.utils.randomInList=function(b,d,c){return b[a.utils.randomIndexInList(b,d,c)]};a.utils.randomIndexInList=function(a,d,c){c||(c=Math);if(void 0===d)return Math.floor(c.random()*a.length);!1===Array.isArray(d)&&(d=
[d]);d.sort(function(a,b){return b-a});a=a.length-d.length;c=Math.floor(c.random()*a);for(a=0;a!==d.length;++a)d[a]<=c&&++c;return c};a.utils.randomInRange=function(a,d){return Math.random()*(d-a)+a};a.utils.randomIntInRange=function(a,d){return Math.round(Math.random()*(d-a))+a};a.utils.parseBoolean=function(a){return"true"==a||"TRUE"===a||"1"===a||"yes"===a?!0:!1};a.utils.applyNamedFlags=function(a,d){var b=0;if(!a||!d)return 0;strList=a.split(" ");for(a=0;a<strList.length;a++)d[strList[a]]&&(b|=
d[strList[a]]);return b};a.utils.getNamedFlags=function(a,d,c){c=c||{};for(var b in d)0!==(a&d[b])&&(c[b]=!0);return c};a.utils.collectNamedFlags=function(a,d,c){if(!a)return{};c=c||{};strList=a.split(" ");for(a=0;a<strList.length;a++)if(!d||d[strList[a]])c[strList[a]]=!0;return c};a.utils.makeID=function(a){for(var b="",c=0;c<a;c++)b+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".charAt(Math.floor(62*Math.random()));return b};a.utils.makeUniqueID=function(){return a.utils.encodeID((new Date).getTime())+
"_"+a.utils.makeID(5)};a.utils.encodeID=function(a){var b="";do{var c=a%62;a=Math.floor(a/62);b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".charAt(c)+b}while(a);return b};a.utils.getWindowSize=function(){var a=window,d=document,c=d.documentElement;!c&&d.getDocumentElement&&(c=d.getDocumentElement());c||(c=d.getElementsByTagName("body")[0]);d=c.clientWidth||a.innerWidth;a=c.clientHeight||a.innerHeight;return{x:d,y:a,w:d,h:a}};a.utils.loadScripts=function(b,d,c){d||(d=void 0);Array.isArray(b)||
(b=[b]);var e=!0;c&&void 0!==c.async&&(e=c.async||!1);var g=c=a.utils.scripts.length,h;for(h=0;h<b.length;h++)0<=a.utils.scriptIndex(b[h])?a.console.logWarning("warning:  already loaded script "+b[h]):a.utils.scripts[g++]={filename:b[h],state:"none",type:"script",clientCallback:d};for(h=c;h<g;h++)a.utils.loadScriptWithCallback(a.utils.scripts[h].filename,e,a.utils.dynamicLoadCompleteCallback)};a.utils.scripts=[];a.utils.scriptsLoadedCount=0;a.utils.loadJSON=function(b,d,c){a.utils.getResource(b,function(a){c&&
a&&(a=a.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,"$1"));a=a?JSON.parse(a):{};d(a)},"json")};a.utils.loadXML=function(b,d){a.utils.getResource(b,d,"xml")};a.utils.getResource=function(b,d,c){a.utils.scripts[a.utils.scripts.length]={filename:b,state:"none",type:c};var e=new XMLHttpRequest;e.onreadystatechange=function(){4===e.readyState&&(a.utils.dynamicLoadCompleteCallback(b),d(e.responseText))};e.open("GET",a.system.fixPath(b),!0);try{e.send()}catch(g){}};a.utils.scriptIndex=function(b){for(var d=
0;d<a.utils.scripts.length;d++)if(a.utils.scripts[d].filename===b)return d;return-1};a.utils.dynamicLoadCompleteCallback=function(b){var d=a.utils.scriptIndex(b);0<=d&&(d=a.utils.scripts[d],"done"!==d.state&&(d.state="done",a.utils.scriptsLoadedCount++,d.clientCallback&&d.clientCallback(b)))};a.utils.allScriptsAreLoaded=function(){return a.utils.scriptsLoadedCount===a.utils.scripts.length?!0:!1};a.utils.launchSystemHelpUI=function(b){a.system.has.xbox&&(a.console.log("Launching system help ui for the Xbox"),
(b=a.user.getUser(b))&&window.Windows.Xbox.ApplicationModel.Help.show(b.rawData))};a.utils.stripPath=function(a){var b=a.lastIndexOf("/"),c=a.lastIndexOf("\\");c>b&&(b=c);return 0>b?a:a.substring(b+1)};a.utils.stripExtension=function(a){dotPos=a.lastIndexOf(".");return 0<=dotPos?a.substring(0,dotPos):a};a.utils.getBaseFilename=function(b){return a.utils.stripExtension(a.utils.stripPath(b))};a.utils.getPath=function(a,d){void 0===d&&(d=!0);var b=a.lastIndexOf("/"),c=a.lastIndexOf("\\");c>b&&(b=c);
if(0>b)return"";d&&b++;return a.substring(0,b)};a.utils.cleanPath=function(a){for(;0<=a.indexOf("\\");)a=a.replace("\\","/");for(;0<=a.indexOf("//");)a=a.replace("//","/");for(var b=!0,c=0;b;){b=!1;var f=a.indexOf("/../",c),g=a.indexOf("/./",c);if(0<=f&&(0>g||f<=g)){b=!0;c=f+3;var h=a.substring(0,f).lastIndexOf("/");0<=h&&(a=a.substring(0,h)+a.substring(f+3))}!b&&0<=g&&(b=!0,c=g+2,a.splice(g,2))}return a};a.utils.addDefaultExtension=function(a,d){if(!d)return a;dotPos=a.lastIndexOf(".");0>dotPos&&
(dotPos=a.length,"."!==d[0]&&(a+="."),a+=d);return a};a.utils.secondsToText=function(a,d){var b="",c=a/3600|0;a-=3600*c;var g=a/60|0;a=a-60*g|0;0<c&&(b+=c+":");if(0<g||0<c||d)b+=(10>g?"0"+g:""+g)+":";return b+(10>a?"0"+a:""+a)};a.utils.secondsToPrettyTime=function(b,d){function c(a,b){b.key=a;if(!(0>b.at)){for(b.len=0;useFormat.charAt(b.at+b.len)===a;)++b.len;for(b.out=""+b.value;b.out.length<b.len;)b.out="0"+b.out;m.push(b)}}d=(void 0===d?"DD:HH:MM:SS.FF":d)||"DD:HH:MM:SS.FFF";useFormat=d.toLowerCase();
var f={},g={},h={},k={},l={};f.value=a.math.floor(b/86400);b-=86400*f.value;g.value=a.math.floor(b/3600);b-=3600*g.value;h.value=a.math.floor(b/60);b-=60*h.value;k.value=a.math.floor(b);b-=k.value;l.value=a.math.floor(1E3*b);f.at=useFormat.indexOf("d");g.at=useFormat.indexOf("h");h.at=useFormat.indexOf("m");k.at=useFormat.indexOf("s");l.at=useFormat.indexOf("f");0>f.at&&(g.value+=24*f.value);0>g.at&&(h.value+=60*g.value);0>h.at&&(k.value+=60*h.value);0>k.at&&(l.value+=1E3*k.value);var m=[];c("d",
f);c("h",g);c("m",h);c("s",k);c("f",l);if(!m.length)return"";0<=l.at&&l.len<l.out.length&&(l.out=l.out.substring(0,l.out.length));m=m.sort(function(a,b){return a.at-b.at});g=d;for(b=m.length-1;0<=b;--b)d=m[b],f=g.substring(0,d.at),g=g.substring(d.at+d.len),g=f+d.out+g;return g};a.utils.dateToTimeText=function(a,d,c){var b=a.getHours(),e=a.getMinutes();a=a.getSeconds();var h="";d||(12<=b?(b-=12,h=" pm"):h=" am");d=10>b?"0"+b:""+b;d=10>e?d+(":0"+e):d+(":"+e);c&&(d=10>a?d+(":0"+a):d+(":"+a));return d+
h};a.utils.checkSum=function(a){for(var b=305419896,c=a.length,f=0;f<c;f++)b+=a.charCodeAt(f)*(f+1);return b&4294967295};a.utils.safeJSONParse=function(a,d,c){try{var b=JSON.parse(a)||{};var e=!0}catch(k){var h=k;b={};e=!1}e&&d?d(b):!e&&c&&c(h);return b}});
rat.modules.add("rat.math.r_math",[],function(a){a.math={};a.math.PI=Math.PI;a.math.PI2=2*Math.PI;a.math.TAU=2*Math.PI;a.math.HALFPI=Math.PI/2;a.math.E=Math.E;a.math.MAX_NUMBER=Number.MAX_VALUE;a.math.MIN_NUMBER=Number.MIN_VALUE;a.math.DegreesToRadians=a.math.PI/180;a.math.RadiansToDegrees=180/a.math.PI;a.math.abs=Math.abs;a.math.min=Math.min;a.math.max=Math.max;a.math.ceil=Math.ceil;a.math.floor=Math.floor;a.math.round=Math.round;a.math.cos=Math.cos;a.math.sin=Math.sin;a.math.tan=Math.tan;a.math.acos=
Math.acos;a.math.asin=Math.asin;a.math.atan=Math.atan;a.math.atan2=Math.atan2;a.math.random=Math.random;a.math.sqrt=Math.sqrt;a.math.log=Math.log;a.math.exp=Math.exp;a.math.pow=Math.pow;a.math.randomRange=function(c,b){return a.math.random()*(b-c)+c};a.math.clamp=function(a,b,d){return a<b?b:a>d?d:a};a.math.interp=function(a,b,d){return b*d+a*(1-d)};a.math.signOf=function(a){return 0<a?1:1>a?-1:0};a.math.randomVariance=function(c){return c?2*c*a.math.random()-c:0};a.math.findCircleCenterFromTwoPoints=
function(a,b,d,e,f,g,h){var c=d-a,l=e-b,m=Math.sqrt(c*c+l*l);f=Math.sqrt(f*f-m*m*.25);var n=l,p=-c;0>n*g-p*h&&(n=-l,p=c);return{x:.5*(d+a)+f*n/m,y:.5*(e+b)+f*p/m}};a.math.findAngleOnCircle=function(c,b,d,e){return a.math.atan2(b-e,c-d)};a.math.findArcOnCircle=function(c,b,d,e,f,g,h){var k=0<(f-c)*(e-b)-(g-b)*(e-c);c=a.math.findAngleOnCircle(c,b,f,g);d=a.math.findAngleOnCircle(d,e,f,g);return{type:"arc",center:{x:f,y:g},radius:h,startAngle:c,endAngle:d,anticlockwise:k}};a.math.findArcFromTwoPoints=
function(c,b,d,e,f,g,h){g=a.math.findCircleCenterFromTwoPoints(c,b,d,e,f,g,h);return a.math.findArcOnCircle(c,b,d,e,g.x,g.y,f)};a.math.findPerpendicularBisector=function(a,b,d,e){var c=e-b,g=.5*(d+a);if(0===c)return{a:1,b:0,c:g};a=-(d-a)/c;return{a:-a,b:1,c:-a*g+.5*(e+b)}};a.math.findCircleFromThreePoints=function(c,b,d,e,f,g){d=a.math.findPerpendicularBisector(c,b,d,e);g=a.math.findPerpendicularBisector(c,b,f,g);0===d.b?f=d:0===g.b?f=g:(f=-d.b/g.b,f={a:d.a+g.a*f,c:d.c+g.c*f});if(0===f.a)return!1;
f=f.c/f.a;d=0!==d.b?(d.c-d.a*f)/d.b:(g.c-g.a*f)/g.b;c-=f;b-=d;b=a.math.sqrt(c*c+b*b);return{center:{x:f,y:d},radius:b}};a.math.findArcFromThreePoints=function(c,b,d,e,f,g){return(d=a.math.findCircleFromThreePoints(c,b,d,e,f,g))?a.math.findArcOnCircle(c,b,f,g,d.center.x,d.center.y,d.radius):{type:"seg",point1:{x:c,y:b},point2:{x:f,y:g}}}});
rat.modules.add("rat.math.r_vector",[{name:"rat.math.r_math",processBefore:!0}],function(a){a.Vector=function(a,b){void 0!==a&&void 0!==a.x&&(b=a.y,a=a.x);this.x=a||0;this.y=b||0};a.Vector.prototype.copy=function(){var c=new a.Vector;c.x=this.x;c.y=this.y;return c};a.Vector.prototype.set=function(a,b){void 0!==a.x&&(b=a.y,a=a.x);this.x=a;this.y=b};a.Vector.prototype.copyFrom=function(a){this.x=a.x;this.y=a.y};a.Vector.prototype.length=function(){return a.math.sqrt(this.x*this.x+this.y*this.y)};a.Vector.prototype.lengthSq=
function(){return this.x*this.x+this.y*this.y};a.Vector.prototype.distanceSqFrom=function(a){var b=a.x-this.x;a=a.y-this.y;return b*b+a*a};a.Vector.prototype.distanceFrom=function(c){return a.math.sqrt(this.distanceSqFrom(c))};a.Vector.prototype.deltaTo=function(c,b){b=b||new a.Vector;b.set(c.x-this.x,c.y-this.y);return b};a.Vector.prototype.normalize=function(){var a=this.length();this.x/=a;this.y/=a};a.Vector.prototype.scale=function(a){this.x*=a;this.y*=a};a.Vector.prototype.setLength=function(a){this.normalize();
this.scale(a)};a.Vector.prototype.add=function(a){this.x+=a.x;this.y+=a.y};a.Vector.prototype.addScaled=function(a,b){this.x+=a.x*b;this.y+=a.y*b};a.Vector.prototype.subtract=function(a){this.x-=a.x;this.y-=a.y};a.Vector.prototype.setFromAngle=function(c){var b=a.math.cos(c);c=a.math.sin(c);this.x=b;this.y=c};a.Vector.dot=function(a,b){return a.x*b.x+a.y*b.y};a.Vector.cross=function(a,b){return a.x*b.y-a.y*b.x};a.Vector.prototype.toString=function(){return"("+this.x+", "+this.y+")"};a.Vector.prototype.limitToRect=
function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);this.x>a.x+a.w&&(this.x=a.x+a.w);this.y>a.y+a.h&&(this.y=a.y+a.h)};a.Angle=function(a){this.angle=a||0};a.Angle.prototype.copy=function(){var c=new a.Angle;c.angle=this.angle;return c};a.Angle.prototype.setFromVector=function(c){this.angle=a.math.atan2(c.y,c.x);return this};a.Angle.prototype.setFromSourceTarget=function(c,b){this.angle=a.math.atan2(b.y-c.y,b.x-c.x);return this};a.Angle.prototype.rotateVectorInPlace=function(c){var b=a.math.cos(this.angle),
d=a.math.sin(this.angle),e=c.x*d+c.y*b;c.x=c.x*b-c.y*d;c.y=e;return c};a.Angle.prototype.rotateVector=function(c,b){b?(b.x=c.x,b.y=c.y):b=new a.Vector(c);return this.rotateVectorInPlace(b)};a.Position=function(c,b,d){this.pos=new a.Vector(c,b);this.rot=new a.Angle(d)}});
rat.modules.add("rat.math.r_matrix",[{name:"rat.math.r_math",processBefore:!0}],function(a){var c=a.math,b=[[],[],[]];a.Matrix=function(a){this.m=[[],[],[]];a&&a.m?this.set(a.m):a?this.set(a):this.loadIdent()};a.Matrix.prototype.loadIdent=function(){this.m[0][0]=1;this.m[0][1]=0;this.m[0][2]=0;this.m[1][0]=0;this.m[1][1]=1;this.m[1][2]=0;this.m[2][0]=0;this.m[2][1]=0;this.m[2][2]=1};a.Matrix.prototype.translateSelf=function(a,b){var d=this.m;d[0][2]=d[0][0]*a+d[0][1]*b+d[0][2];d[1][2]=d[1][0]*a+d[1][1]*
b+d[1][2];d[2][2]=d[2][0]*a+d[2][1]*b+d[2][2]};a.Matrix.prototype.rotateSelf=function(a){var b=c.cos(a);a=c.sin(a);var d=-a,g=this.m,h=g[0][0]*d+g[0][1]*b,k=g[1][0]*b+g[1][1]*a,l=g[1][0]*d+g[1][1]*b,m=g[2][0]*b+g[2][1]*a;d=g[2][0]*d+g[2][1]*b;g[0][0]=g[0][0]*b+g[0][1]*a;g[0][1]=h;g[1][0]=k;g[1][1]=l;g[2][0]=m;g[2][1]=d};a.Matrix.prototype.scaleSelf=function(a,b){var d=this.m;d[0][0]*=a;d[0][1]*=b;d[1][0]*=a;d[1][1]*=b;d[2][0]*=a;d[2][1]*=b};a.Matrix.prototype.multSelf=function(a){a.m&&(a=a.m);var d=
this.m;b[0][0]=d[0][0]*a[0][0]+d[0][1]*a[1][0]+d[0][2]*a[2][0];b[0][1]=d[0][0]*a[0][1]+d[0][1]*a[1][1]+d[0][2]*a[2][1];b[0][2]=d[0][0]*a[0][2]+d[0][1]*a[1][2]+d[0][2]*a[2][2];b[1][0]=d[1][0]*a[0][0]+d[1][1]*a[1][0]+d[1][2]*a[2][0];b[1][1]=d[1][0]*a[0][1]+d[1][1]*a[1][1]+d[1][2]*a[2][1];b[1][2]=d[1][0]*a[0][2]+d[1][1]*a[1][2]+d[1][2]*a[2][2];b[2][0]=d[2][0]*a[0][0]+d[2][1]*a[1][0]+d[2][2]*a[2][0];b[2][1]=d[2][0]*a[0][1]+d[2][1]*a[1][1]+d[2][2]*a[2][1];b[2][2]=d[2][0]*a[0][2]+d[2][1]*a[1][2]+d[2][2]*
a[2][2];a=this.m;this.m=b;b=a};a.Matrix.prototype.inverseSelf=function(){var a=this.m,c=a[0][0]*a[1][1]*a[2][2]-a[0][0]*a[1][2]*a[2][1]-a[0][1]*a[1][0]*a[2][2]+a[0][1]*a[1][2]*a[2][0]+a[0][2]*a[1][0]*a[2][1]-a[0][2]*a[1][1]*a[2][0];if(0===c)return!1;c=1/c;b[0][0]=c*(a[1][1]*a[2][2]-a[1][2]*a[2][1]);b[0][1]=c*(a[0][2]*a[2][1]-a[0][1]*a[2][2]);b[0][2]=c*(a[0][1]*a[1][2]-a[0][2]*a[1][1]);b[1][0]=c*(a[1][2]*a[2][0]-a[1][0]*a[2][2]);b[1][1]=c*(a[0][0]*a[2][2]-a[0][2]*a[2][0]);b[1][2]=c*(a[0][2]*a[1][0]-
a[0][0]*a[1][2]);b[2][0]=c*(a[1][0]*a[2][1]-a[1][1]*a[2][0]);b[2][1]=c*(a[0][1]*a[2][0]-a[0][0]*a[2][1]);b[2][2]=c*(a[0][0]*a[1][1]-a[0][1]*a[1][0]);a=this.m;this.m=b;b=a;return!0};a.Matrix.prototype.set=function(a){a.m&&(a=a.m);var b=this.m;b[0][0]=a[0][0];b[0][1]=a[0][1];b[0][2]=a[0][2];b[1][0]=a[1][0];b[1][1]=a[1][1];b[1][2]=a[1][2];b[2][0]=a[2][0];b[2][1]=a[2][1];b[2][2]=a[2][2]};a.Matrix.prototype.transformPointSelf=function(a){var b=this.m,d=a.x,c=a.y;a.x=b[0][0]*d+(b[0][1]*c+b[0][2]);a.y=b[1][0]*
d+(b[1][1]*c+b[1][2]);return a};a.Matrix.prototype.transformPoint=function(b,c){c?(c.x=b.x,c.y=b.y):c=new a.Vector(b);return this.transformPointSelf(c)};a.Matrix.matMult=function(b,c,f){f?f.set(b):f=new a.Matrix(b);f.multSelf(c);return f};a.Matrix.prototype.inverse=function(b){b?b.set(this):b=new a.Matrix(this);b.inverseSelf();return b}});
rat.modules.add("rat.graphics.r_graphics",[{name:"rat.math.r_math",processBefore:!0},"rat.graphics.r_color","rat.os.r_system","rat.os.r_events","rat.debug.r_console","rat.debug.r_profiler","rat.math.r_matrix","rat.utils.r_utils","rat.utils.r_shapes","rat.graphics.r_draw"],function(a){function c(){if(a.system.has.windows&&a.system.has.winJS){var b=window.Windows.UI.ViewManagement.ApplicationViewState;switch(a.graphics.winJSAppView.value){case b.fullScreenLandscape:a.graphics.viewState="fullscreen";
break;case b.filled:a.graphics.viewState="filled";break;case b.snapped:a.graphics.viewState="snapped";break;case b.fullscreenPortrait:a.graphics.viewState="fullscreenPortrait";break;default:a.graphics.viewState="unknown"}a.graphics.viewState=a.graphics.winJSAppView.value}else a.graphics.viewState="fullscreen"}function b(){var b={x:a.graphics.SCREEN_WIDTH,y:a.graphics.SCREEN_HEIGHT};if(e.x!==b.x||e.y!==b.y)a.events.fire("rat_screen_resize",b,e),e.x=b.x,e.y=b.y}var d=a.math,e={x:0,y:0};a.graphics={SCREEN_WIDTH:760,
SCREEN_HEIGHT:600,globalScale:{x:1,y:1},outerScale:1,globalTranslate:null,autoTargetSize:{x:0,y:0},autoResizeCanvas:!0,autoFillOnResize:!1,autoCenterCanvas:!1,autoScaleWithDevicePixelRatio:!1,canvasPixelRatio:1,autoClearCanvas:!1,autoClearColor:"#000",frameIndex:0,ctx:null,frameStats:{totalElementsDrawn:0},cursorPos:{x:-1,y:-1},minAutoScale:1E-7,mTransform:void 0,mStateStack:[],viewState:"fullscreen"};var f=!1;a.graphics.setContext=function(b){a.graphics.ctx=b};a.graphics.getContext=function(b){var d=
a.graphics;if(b&&d.contexts[b]){var c=d.contexts[b];d.contextStack.push({activeContextID:d.activeContextID,canvas:d.canvas,ctx:d.ctx,SCREEN_WIDTH:d.SCREEN_WIDTH,SCREEN_HEIGHT:d.SCREEN_HEIGHT});d.activeContextID=b;c.canvas&&(d.canvas=c.canvas);c.ctx&&(d.ctx=c.ctx);c.SCREEN_WIDTH&&(d.SCREEN_WIDTH=c.SCREEN_WIDTH);c.SCREEN_HEIGHT&&(d.SCREEN_HEIGHT=c.SCREEN_HEIGHT)}return d.ctx};a.graphics.getContextProperties=function(b){return a.graphics.contexts[b]};a.graphics.doneWithContext=function(b){var d=a.graphics;
b&&d.contexts[b]&&(d.activeContextID!==b&&a.console.logOnce("Warning - this graphics context was not on the top of the stack: "+b),(b=d.contextStack.pop())?(d.activeContextID=b.activeContextID,d.canvas=b.canvas,d.ctx=b.ctx,d.SCREEN_WIDTH=b.SCREEN_WIDTH,d.SCREEN_HEIGHT=b.SCREEN_HEIGHT):a.console.logError("unexpected empty context stack"))};a.graphics.registerContext=function(b,d){a.graphics.contexts[b]=d};a.graphics.init=function(d,e){e=e||{};f=!!e.ignoreRatTransform;e=a.graphics;e.activeContextID=
"default";e.contexts={};e.contextStack=[];d=d||"canvas";e.mTransform=new a.Matrix;e.canvas=document.getElementById(d);a.system.has.Wraith&&"PS4"===Wraith.w_onPlatform&&(e.canvas.style={});e.ctx=e.canvas.getContext("2d");e.SCREEN_WIDTH=e.canvas.width;e.SCREEN_HEIGHT=e.canvas.height;e.winJSAppView=void 0;a.system.has.windows&&a.system.has.winJS&&(e.winJSAppView=window.Windows.UI.ViewManagement.ApplicationView);c();a.addOSEventListener(window,"resize",e.resizeCallback);b()};a.graphics.resizeCallback=
function(b){c();a.events.fire("before_resize",b);a.graphics.callAutoScale&&a.graphics.autoScaleCallback();a.events.fire("resize",b)};a.graphics.setAutoClear=function(b,d){a.graphics.autoClearCanvas=b;typeof("undefined"!==d)&&(a.graphics.autoClearColor=d)};a.graphics.clearCanvas=function(){var b=a.graphics.getContext();""===a.graphics.autoClearColor||a.graphics.Video&&0<a.graphics.Video.numberOfActiveBGVideos?b.clearRect(0,0,a.graphics.SCREEN_WIDTH,a.graphics.SCREEN_HEIGHT):(b.fillStyle=a.graphics.autoClearColor,
b.fillRect(0,0,a.graphics.SCREEN_WIDTH,a.graphics.SCREEN_HEIGHT))};a.graphics.beginFrame=function(){a.graphics.frameIndex++;a.graphics.frameStats.totalElementsDrawn=0;a.profiler&&a.profiler.beginFrame&&a.profiler.beginFrame();a.graphics.Image&&a.graphics.Image.beginFrame&&a.graphics.Image.beginFrame()};a.graphics.endFrame=function(){a.profiler&&a.profiler.endFrame&&a.profiler.endFrame()};a.graphics.setGlobalScale=function(d,c){a.graphics.globalScale.x=d||1;a.graphics.globalScale.y=c||1;a.graphics.SCREEN_WIDTH=
(a.graphics.canvas.width+.5)/a.graphics.globalScale.x|0;a.graphics.SCREEN_HEIGHT=(a.graphics.canvas.height+.5)/a.graphics.globalScale.y|0;b()};a.graphics.clearGlobalScale=function(){a.graphics.globalScale.x=1;a.graphics.globalScale.y=1;a.graphics.SCREEN_WIDTH=a.graphics.canvas.width;a.graphics.SCREEN_HEIGHT=a.graphics.canvas.height;b()};a.graphics.setGlobalTranslate=function(b,d){a.graphics.globalTranslate={x:b,y:d}};a.graphics.clearGlobalTranslate=function(){a.graphics.globalTranslate={x:0,y:0}};
a.graphics.hasGlobalScale=function(){var b=a.graphics.globalScale;return b.x&&b.y&&(1!==b.x||1!==b.y)};a.graphics.counterGlobalScale=function(b){a.graphics.hasGlobalScale()&&a.graphics.scale(1/a.graphics.globalScale.x,1/a.graphics.globalScale.y,b)};a.graphics.counterGlobalTranslate=function(b){a.graphics.globalTranslate&&a.graphics.translate(-a.graphics.globalTranslate.x,-a.graphics.globalTranslate.y,b)};a.graphics.autoScaleCallback=function(){if(a.graphics.canvas){var b=a.utils.getWindowSize(),c=
1;if(a.graphics.autoResizeCanvas){c=b.w/a.graphics.autoTargetSize.w;var e=b.h/a.graphics.autoTargetSize.h;e<c&&(c=e);c<a.graphics.minAutoScale&&(c=a.graphics.minAutoScale);!a.graphics.allowAutoUpscale&&1<c&&(c=1);e=d.floor(a.graphics.autoTargetSize.w*c);var f=d.floor(a.graphics.autoTargetSize.h*c),m=b.w-e,n=b.h-f;a.graphics.autoFillOnResize&&(e=b.w,f=b.h);a.graphics.autoScaleWithDevicePixelRatio&&!a.graphics.allowAutoUpscale&&a.console.logWarning("WARNING: autoScaleWithDevicePixelRatio = true yet allowAutoUpscale = false.");
if(a.graphics.autoScaleWithDevicePixelRatio){var p=a.graphics.canvas.getContext("2d"),r=window.devicePixelRatio||1;p=p.webkitBackingStorePixelRatio||p.mozBackingStorePixelRatio||p.msBackingStorePixelRatio||p.oBackingStorePixelRatio||p.backingStorePixelRatio||1;if(a.system.has.windows&&Windows&&Windows.Graphics&&Windows.Graphics.Display){var w=Windows.Graphics.Display.DisplayInformation?Windows.Graphics.Display.DisplayInformation.getForCurrentView():Windows.Graphics.Display.DisplayProperties;w&&(p=
100,r=w.resolutionScale)}var q=w=r/p;a.graphics.canvas.style.width=""+e+"px";a.graphics.canvas.style.height=""+f+"px";var t=a.graphics.resizeCanvasPixelLimit;if(t&&(e*w|0)*(f*w|0)>t){var v=e/f;q=Math.sqrt(t*v);t=q/v;q=(q|0)/e;t=(t|0)/f;t<q&&(q=t)}e=e*q|0;f=f*q|0;c*=q;a.graphics.canvasPixelRatio=q;1!==w&&(a.console.log("device pixel ratio "+w+" : "+r+" / "+p),q!==w&&a.console.log("   using ratio : "+q))}a.graphics.canvas.width=e;a.graphics.canvas.height=f}a.graphics.autoCenterCanvas&&(e=d.floor(m/
2),n=d.floor(n/2),a.graphics.canvas.style["margin-left"]=""+e+"px",a.graphics.canvas.style["margin-top"]=""+n+"px");a.graphics.autoScaleCanvasStyleToWindow?(n=b.w/a.graphics.canvas.width,e=b.h/a.graphics.canvas.height,e<n&&(n=e),a.graphics.outerScale=n,e=a.graphics.canvas.width*n|0,n=a.graphics.canvas.height*n|0,a.graphics.canvas.style.width=""+e+"px",a.graphics.canvas.style.height=""+n+"px"):a.graphics.outerScale=1;a.graphics.setGlobalScale(c,c);a.graphics.autoResizeCanvas&&!a.graphics.autoFillOnResize&&
a.graphics.autoTargetSize&&(a.graphics.SCREEN_WIDTH=a.graphics.autoTargetSize.w,a.graphics.SCREEN_HEIGHT=a.graphics.autoTargetSize.h)}};a.graphics.setAutoScaleFromIdeal=function(b,d,c,e){"undefined"===typeof c?c={autoResizeCanvas:!0,allowAutoUpscale:!0,autoFillOnResize:!1}:"object"!==typeof c&&(c={autoResizeCanvas:!!c,allowAutoUpscale:!!e});a.graphics.autoTargetSize.w=b;a.graphics.autoTargetSize.h=d;void 0!==c.autoResizeCanvas&&(a.graphics.autoResizeCanvas=c.autoResizeCanvas);void 0!==c.allowAutoUpscale&&
(a.graphics.allowAutoUpscale=c.allowAutoUpscale);void 0!==c.autoFillOnResize&&(a.graphics.autoFillOnResize=c.autoFillOnResize);void 0!==c.autoScaleCanvasStyleToWindow&&(a.graphics.autoScaleCanvasStyleToWindow=c.autoScaleCanvasStyleToWindow);void 0!==c.autoScaleWithDevicePixelRatio&&(a.graphics.autoScaleWithDevicePixelRatio=c.autoScaleWithDevicePixelRatio);void 0!==c.resizeCanvasPixelLimit&&(a.graphics.resizeCanvasPixelLimit=c.resizeCanvasPixelLimit);a.graphics.callAutoScale=!0;a.graphics.autoScaleCallback()};
a.graphics.rotate=function(b,d){d=d||a.graphics.ctx;f||a.graphics.mTransform.rotateSelf(b);d.rotate(b)};a.graphics.scale=function(b,d,c){void 0===d&&(d=b);c=c||a.graphics.ctx;f||a.graphics.mTransform.scaleSelf(b,d);c.scale(b,d)};a.graphics.translate=function(b,d,c){c=c||a.graphics.ctx;f||a.graphics.mTransform.translateSelf(b,d);c.translate(b,d)};a.graphics.transform=function(b,d,c,e,m,n,p){Array.isArray(b.m)&&(b=b.m);Array.isArray(b)&&(p=e,d=b[1][0],c=b[0][1],e=b[1][1],m=b[0][2],n=b[1][2],b=b[0][0]);
p=p||a.graphics.ctx;f||a.graphics.mTransform.multSelf([[b,d,m],[c,e,n],[0,0,1]]);p.transform(b,d,c,e,m,n)};a.graphics.setTransform=function(b,d,c,e,f,n,p){a.graphics.resetTransform();a.graphics.transform(b,d,c,e,f,n,p)};a.graphics.resetTransform=function(b){b=b||a.graphics.ctx;f||a.graphics.mTransform.loadIdent();b.setTransform(1,0,0,1,0,0)};a.graphics.save=function(b){var d=a.graphics.ctx;b=b||{};b.ignoreRatMat=void 0===b.ignoreRatMat?f:f||b.ignoreRatMat||!1;d.save();d={ignoreRatMat:f,transform:void 0};
(f=b.ignoreRatMat)?a.graphics.mStateStack.push(d):(d.transform=a.graphics.mTransform.m,a.graphics.mStateStack.push(d),b=a.graphics.mTransform.m,b=[[b[0][0],b[0][1],b[0][2]],[b[1][0],b[1][1],b[1][2]],[b[2][0],b[2][1],b[2][2]]],a.graphics.mTransform.m=b)};a.graphics.restore=function(){a.graphics.ctx.restore();var b=a.graphics.mStateStack.pop();f=b.ignoreRatMat;b.transform&&(a.graphics.mTransform.m=b.transform)};a.graphics.getTransform=function(){return a.graphics.mTransform};a.graphics.transformPoint=
function(b,d){return a.graphics.mTransform.transformPoint(b,d)};a.graphics.pushPerfMark=function(b,d){d||(d=a.graphics.ctx);d.pushPerfMark&&d.pushPerfMark(b)};a.graphics.popPerfMark=function(b){b||(b=a.graphics.ctx);b.popPerfMark&&b.popPerfMark()};a.graphics.setImageSmoothing=function(b,d){var c=!1;d||(d=a.graphics.ctx);void 0!==d.imageSmoothingEnabled?(c=d.imageSmoothingEnabled,d.imageSmoothingEnabled=b):(void 0!==d.mozImageSmoothingEnabled?c=d.mozImageSmoothingEnabled:void 0!==d.webkitImageSmoothingEnabled?
c=d.webkitImageSmoothingEnabled:void 0!==d.msImageSmoothingEnabled&&(c=d.msImageSmoothingEnabled),d.mozImageSmoothingEnabled=b,d.webkitImageSmoothingEnabled=b,d.msImageSmoothingEnabled=b);return c};a.graphics.setupMatrixForRendering=function(){a.graphics.globalTranslate&&a.graphics.translate(a.graphics.globalTranslate.x,a.graphics.globalTranslate.y);a.graphics.hasGlobalScale()&&a.graphics.scale(a.graphics.globalScale.x,a.graphics.globalScale.y)}});
rat.modules.add("rat.debug.r_trackvalue",["rat.os.r_system","rat.math.r_math","rat.graphics.r_graphics","rat.utils.r_utils",{name:"rat.debug.r_console",processBefore:!0}],function(a){a.trackValue={entries:[],state:{show:!1},frame:0};a.console.registerCommand("track",function(b,c){"clear"!==c[0]&&"none"!==c[0]&&c[0]?a.trackValue.track(c[0]):a.trackValue.clear()},["trackvalue"]);a.console.registerCommand("untrack",function(b,c){a.trackValue.unTrack(c[0])});a.console.registerCommand("cleartrack",function(b,
c){a.trackValue.clear()},["notrack","trackclear"]);a.console.registerCommand("showtrack",function(b,c){a.trackValue.show(c[0])},["trackshow"]);a.console.registerCommand("hidetrack",function(b,c){a.trackValue.show(!1)},["trackhide"]);var c=a.system.getLocalStorage();if(c&&(c=c.getItem("rat_debugTrackValue"))&&((c=JSON.parse(c))&&c.state&&(a.trackValue.state=c.state),c&&c.entries))for(a.trackValue.entries=c.entries,c=a.trackValue.entries.length-1;0<=c;c--){var b=a.trackValue.entries[c];b.decimalPlaces||
(b.decimalPlaces=0)}a.trackValue.writeActiveState=function(){a.system.localStorageObject&&a.system.localStorageObject.setItem("rat_debugTrackValue",JSON.stringify({state:a.trackValue.state,entries:a.trackValue.entries}))};a.trackValue.findEntry=function(b){for(var d=a.trackValue.entries.length-1;0<=d;d--)if(a.trackValue.entries[d].expression===b)return d;return-1};a.trackValue.show=function(b){a.trackValue.state.show=void 0===b?!a.trackValue.state.show:!!b;a.trackValue.writeActiveState()};a.trackValue.draw=
function(){if(a.trackValue.state.show){a.trackValue.update(.01);var b=a.graphics.ctx,c=a.console.config.logLineHeight,f=a.trackValue,g=f.entries.length*c+10,h=(a.graphics.SCREEN_WIDTH-400)/2,k=a.graphics.SCREEN_HEIGHT-40-g;b.fillStyle=a.console.config.bgColor.toString();b.fillRect(h,k,400,g);g=k+5;k=h+10;h=h+175+25;b.textAlign="right";b.textBaseline="top";for(var l=f.entries.length-1;0<=l;l--){var m=f.entries[l];b.font=""+a.console.config.textSize+"px Arial";b.fillStyle=a.console.config.textColor;
b.fillText(m.displayName,k+175,g,175);b.fillText(m.displayValue,h+175,g,175);g+=c}}};a.trackValue.update=function(b){b=a.trackValue.frame%9;for(var d=a.trackValue.entries.length-1;0<=d;d--)if(d%9===b){var c=a.trackValue.entries[d];try{var g=eval(c.expression)}catch(k){}if("number"===typeof g){g=Math.floor(1E3*g)/1E3;var h=g|0;g=""+g;h=g.length-(""+h).length-1;h>c.decimalPlaces&&(c.decimalPlaces=h);if(0<c.decimalPlaces&&h<c.decimalPlaces)for(0>h&&(g+=".",h++);h<c.decimalPlaces;)g+="0",h++}c.displayValue=
""+g}a.trackValue.frame++};a.trackValue.track=function(b){if(b&&"string"===typeof b)if(-1<a.trackValue.findEntry(b))a.trackValue.unTrack(b);else{var d={expression:b,decimalPlaces:0,displayName:"",displayValue:"-"},c=b.slice(-15);c.length<b.length&&(c="\u2026"+c);d.displayName=c;a.trackValue.entries.push(d);a.trackValue.show(!0);return!0}};a.trackValue.unTrack=function(b){b=a.trackValue.findEntry(b);0>b||(a.trackValue.entries.splice(b,1),0>=a.trackValue.entries.length&&a.trackValue.show(!1),a.trackValue.writeActiveState())};
a.trackValue.clear=function(b){a.trackValue.entries=[];a.trackValue.show(!1)}});
rat.modules.add("rat.input.r_input",["rat.debug.r_console","rat.os.r_system","rat.math.r_math","rat.utils.r_utils","rat.graphics.r_graphics","rat.input.r_voice","rat.input.r_keyboard",{name:"rat.input.r_input_xbo",platform:"xbox"},{name:"rat.input.r_input_le",platform:"xboxLE"}],function(a){function c(a,b){a.lastButtons|=b.lastButtons;a.newButtons|=b.newButtons;a.rawButtons|=b.rawButtons;a.leftStick.x+=b.leftStick.x;a.leftStick.y+=b.leftStick.y;a.rightStick.x+=b.rightStick.x;a.rightStick.y+=b.rightStick.y;
b.leftTrigger>a.leftTrigger&&(a.leftTrigger=b.leftTrigger);b.rightTrigger>a.rightTrigger&&(a.rightTrigger=b.rightTrigger)}function b(b){b.x=a.math.clamp(b.x,-1,1);b.y=a.math.clamp(b.y,-1,1);var d=a.math.sqrt(b.x*b.x+b.y*b.y);1<d&&(b.x/=d,b.y/=d)}function d(b){var d="mousedown";"touchmove"===b.type?d="mousemove":"touchstart"===b.type?d="mousedown":"touchend"===b.type&&(d="mouseup");b.preventDefault();for(var c=0;c!==b.changedTouches.length;++c){var e=a.input.setTouchPositionOnEvent(b.changedTouches[c],
b);a.input.mouseToRatEvent(e,d,!0)}}function e(b){if(a.input.customUIEventTranslations)for(var d=0;d<a.input.customUIEventTranslations.length;d++){var c=a.input.customUIEventTranslations[d];if(b===c.which)return c.result}if(b===a.keys.leftArrow)return"left";if(b===a.keys.upArrow)return"up";if(b===a.keys.rightArrow)return"right";if(b===a.keys.downArrow)return"down";if(b===a.keys.enter)return"enter";if(b===a.keys.esc||b===a.keys.backspace)return"back";if(b===a.keys.leftSys||b===a.keys.rightSys)return"menu";
if(b===a.keys.selectKey)return"view";if(a.system.has.xbox&&a.input.translateGamePadKeys){d=window.WinJS.Utilities.Key;if(b===d.gamepadDPadLeft||b===d.gamepadLeftThumbstickLeft)return"left";if(b===d.gamepadDPadUp||b===d.gamepadLeftThumbstickUp)return"up";if(b===d.gamepadDPadRight||b===d.gamepadLeftThumbstickRight)return"right";if(b===d.gamepadDPadDown||b===d.gamepadLeftThumbstickDown)return"down";if(b===d.gamepadA)return"enter";if(b===d.gamepadB)return"back"}return null}a.input={};var f=!1;a.input.useLastUIInputType=
!1;a.input.lastUIInputType="mouse";a.input.mouseInDocument=!0;a.input.mouseInCanvas=!0;a.input.triggerMouseLeaveOnDocument=!0;a.input.triggerMouseLeaveOnCanvas=!1;a.input.allowRepeatEvents={buttons:!1,directions:!0};a.input.standardPreventDefaultOnEvents=!1;a.input.allowedControllers=[];a.input.activeControllerID=0;a.input.controllers=[];a.input.controllers.getByID=function(b){for(var d=0;d<a.input.controllers.length;++d)if(a.input.controllers[d].id===b)return a.input.controllers[d]};a.input.gamepadKeyFakeEnabled=
!1;a.input.BUTTON_UP=1;a.input.BUTTON_DOWN=2;a.input.BUTTON_LEFT=4;a.input.BUTTON_RIGHT=8;a.input.BUTTON_START=16;a.input.BUTTON_SELECT=32;a.input.BUTTON_A=256;a.input.BUTTON_B=512;a.input.BUTTON_C=1024;a.input.BUTTON_D=2048;a.input.BUTTON_X=a.input.BUTTON_C;a.input.BUTTON_Y=a.input.BUTTON_D;a.input.BUTTON_LT=4096;a.input.BUTTON_LB=8192;a.input.BUTTON_RT=16384;a.input.BUTTON_RB=32768;a.input.BUTTON_DPAD_UP=65536;a.input.BUTTON_DPAD_DOWN=131072;a.input.BUTTON_DPAD_LEFT=262144;a.input.BUTTON_DPAD_RIGHT=
524288;a.input.BUTTON_LEFT_STICK=1048576;a.input.BUTTON_RIGHT_STICK=2097152;a.input.BUTTON_LSTICK_UP=16777216;a.input.BUTTON_LSTICK_DOWN=33554432;a.input.BUTTON_LSTICK_LEFT=67108864;a.input.BUTTON_LSTICK_RIGHT=134217728;a.input.BUTTON_RSTICK_UP=268435456;a.input.BUTTON_RSTICK_DOWN=536870912;a.input.BUTTON_RSTICK_LEFT=1073741824;a.input.BUTTON_RSTICK_RIGHT=2147483648;a.input.BUTTON_COUNT=32;a.input.GAMEPAD_CONTROLLER_MAPPING={BUTTON_A:0,BUTTON_B:1,BUTTON_C:2,BUTTON_X:2,BUTTON_D:3,BUTTON_Y:3,BUTTON_LB:4,
BUTTON_RB:5,BUTTON_LT:6,BUTTON_RT:7,BUTTON_SELECT:8,BUTTON_START:9,BUTTON_LEFT_STICK:10,BUTTON_RIGHT_STICK:11,BUTTON_DPAD_UP:12,BUTTON_DPAD_DOWN:13,BUTTON_DPAD_LEFT:14,BUTTON_DPAD_RIGHT:15,leftStick:{x:-1,y:-2},rightStick:{x:-3,y:-4},leftTrigger:6,rightTrigger:7};a.input.ControllerChangeType={REMOVED:0,ADDED:1,UPDATED:2};a.input.init=function(){var b=a.input,d=a.system.has;b.controllers.pollingForced=!1;b.controllers.pollingAllowed=!1;if(d.xbox)a.input.initXbox();else if(!d.xboxLE)if(d.gamepadAPI){b.controllers.pollingAllowed=
!0;d.gamepadAPIEvent?(window.addEventListener("gamepadconnected",b.onSysControllerAdded),window.addEventListener("gamepaddisconnected",b.onSysControllerRemoved)):b.controllers.pollingForced=!0;var c=navigator,e=c.getGamepads||c.mozGetGamepads||c.webkitGetGamepads||function(){return c.gamepads||c.mozGamepads||c.webkitGamepads||[]},g=e;a.system.has.chromeBrowser&&(g=function(){for(var a=e.call(this),b=[],d=0;d<a.length;++d){var c=a[d];if(null!=c){var f={},g;for(g in c)f[g]=c[g];f.id+=f.index;b.push(f)}else b.push(null)}return b});
var h=function(a,b){return a?b?b.index-a.index:1:-1};b.controllers.getSystemControllers=function(){var b=g.call(c);if(!1===Array.isArray(b)){for(var d=[],e=b.length-1;0<=e;--e)d.unshift(b[e]);b=d}a.input.gamepadKeyFakeEnabled&&!a.console.state.consoleActive&&b.push(a.input.buildGamepadKeyFake());a.system.has.Wraith||(b=b.sort(h));return b}}else b.controllers.pollingAllowed=!0,f=b.controllers.pollingForced=!0,b.controllers.getSystemControllers=function(){var b=[];a.input.gamepadKeyFakeEnabled&&b.push(a.input.buildGamepadKeyFake());
return b}};a.input.setMouseHandler=function(b){a.input.mouseHandler=b};a.input.update=function(b){var d=a.input;d.controllers.pollingAllowed&&(d.controllers.pollingForced||0<d.controllers.length)&&d.updateControllers(b);a.input.keyboard.update(b)};a.input.debounceButtons=function(a){a.newButtons=a.rawButtons&~a.lastButtons;a.lastButtons=a.rawButtons};a.input.getControllerByID=function(b){for(var d,c=0;c<a.input.controllers.length;c++)if(d=a.input.controllers[c],d.id===b)return d};a.input.getActiveController=
function(){if(0>=a.input.controllers.length)return null;var b;if(0!==a.input.activeControllerID)for(b=0;b<a.input.controllers.length;b++)if(a.input.controllers[b].id===a.input.activeControllerID)return a.input.controllers[b];var d=void 0;for(b=0;b<a.input.controllers.length;b++)if(!d||d.index>a.input.controllers[b].index)d=a.input.controllers[b];return d};a.input.getCombinedControllers=function(d){if(0>=a.input.controllers.length)return null;var e=new a.input.Controller({},"COMBINED",-1,!0,0);d&&
0!==d.length||(d=a.input.allowedControllers);if(d&&0<d.length)for(var f=0;f<d.length;f++){var g=a.input.controllers.getByID(d[f]);c(e,g)}else if(0===a.input.allowedControllers.length||0===a.input.activeControllerID)for(d=0;d<a.input.controllers.length;d++)c(e,a.input.controllers[d]);b(e.leftStick);b(e.rightStick);return e};a.input.getActiveControllerID=function(){var b=a.input.getActiveController();return b?b.id:null};a.input.setActiveControllerID=function(b){if(b=b||0)for(var d=0;d<a.input.controllers.length;d++){if(a.input.controllers[d].id===
b)return a.console.log("Setting active controller to "+b),a.input.activeControllerID=b,!0}else return a.console.log("Cleared active controller"),a.input.activeControllerID=b,!0;a.console.logWarning("WARNING! Attempting to set active controller ID for controller "+b+" which cannot be found in the system");a.input.activeControllerID=0;return!1};a.input.getActiveControllerRawButtons=function(){var b=0,d=a.input.getActiveController();d&&(b=d.rawButtons);return b};a.input.controllerIDAllowed=function(b){if(0===
a.input.allowedControllers.length)return!0;for(var d=0;d<a.input.allowedControllers.length;d++)if(a.input.allowedControllers[d]===b)return!0;return!1};a.input.getRealMousePosition=function(b){var d=new a.Vector;"mouseleave"===b.type||"mouseout"===b.type?(d.x=-1,d.y=-1):(b.pageX||b.pageY?(d.x=b.pageX,d.y=b.pageY):(d.x=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,d.y=b.clientY+document.body.scrollTop+document.documentElement.scrollTop),d.x-=a.graphics.canvas.offsetLeft,d.y-=
a.graphics.canvas.offsetTop,a.graphics.globalTranslate&&(d.x-=a.graphics.globalTranslate.x,d.y-=a.graphics.globalTranslate.y),a.graphics.hasGlobalScale()&&(d.x/=a.graphics.globalScale.x/a.graphics.canvasPixelRatio,d.y/=a.graphics.globalScale.y/a.graphics.canvasPixelRatio),d.x/=a.graphics.outerScale,d.y/=a.graphics.outerScale);a.mousePos.x=d.x;a.mousePos.y=d.y;a.graphics.cursorPos.x=d.x;a.graphics.cursorPos.y=d.y;return d};a.input.getEventWhich=function(b){if(a.system.has.xbox)switch(b.which){case 222:return 220;
case 223:return 192;case 192:return 222}return b.which||0};a.input.Event=function(b,d){this.sysEvent=b;d=d||{};b=b||{};if(d.translatedFrom){var c=d.translatedFrom.sysEvent;d.translatedFrom.sysEvent=void 0;a.utils.extendObject(this,[d.translatedFrom],!1);d.translatedFrom.sysEvent=c;this.translatedFrom=d.translatedFrom;void 0!==d.which&&(this.which=d.which)}this.eventType=d.type||"";void 0===this.controllerID&&(this.controllerID=b.deviceSessionId||b.controllerID||d.defaultControllerID||0);void 0===
this.index&&(this.index=d.index||0);void 0===this.which&&(this.which=d.which,void 0===this.which&&(this.which=a.input.getEventWhich(b)));void 0===this.repeat&&(this.repeat=d.repeat||!1);this.eventID=a.input.Event.nextID++};a.input.Event.nextID=1;a.input.checkAndDispatchControllerEvents=function(b,d){if(a.input.controllerIDAllowed(b.id)){var c=void 0,e;b.rawButtons!==b.lastButtons||0===b.rawButtons?b.repeatTimer.fullReset():b.repeatTimer.elapsed(d);if(b.newButtons)for(e=0;e<a.input.BUTTON_COUNT;e++)if(d=
1<<e,0!==(b.newButtons&d)){var f=d.toString(16);"00000000".substr(8-f.length-1);c=c||new a.input.Event({controllerID:b.id},{index:b.index});c.eventType="buttondown";c.which=d;a.input.dispatchEvent(c)}if(b.rawButtons!==b.lastButtons)for(e=0;e<a.input.BUTTON_COUNT;e++){d=1<<e;var g=0!==(b.rawButtons&d);f=0!==(b.lastButtons&d);!0===f&&!1===g&&(c=c||new a.input.Event({controllerID:b.id},{index:b.index}),c.eventType="buttonup",c.which=d,a.input.dispatchEvent(c))}f=0>=b.repeatTimer.buttons&&a.input.allowRepeatEvents.buttons;
var k=0>=b.repeatTimer.directions&&a.input.allowRepeatEvents.directions;if(f||k)for(d={},f&&(d.buttons=!0),k&&(d.directions=!0),b.repeatTimer.repeatReset(d),c&&(c.repeat=!0),e=0;e<a.input.BUTTON_COUNT;e++)if(d=1<<e,g=0!==(b.rawButtons&d))g=0!==(d&(a.input.BUTTON_UP|a.input.BUTTON_DOWN|a.input.BUTTON_LEFT|a.input.BUTTON_RIGHT)),g&&!k||!g&&!f||(c||(c=new a.input.Event({controllerID:b.id},{index:b.index}),c.repeat=!0),c.eventType="buttondown",c.which=d,a.input.dispatchEvent(c))}};var g=[];a.input.registerEventHandler=
function(a,b){a&&g.push({func:a,thisObj:b})};a.input.insertEventHandler=function(a,b){a&&g.unshift({func:a,thisObj:b})};a.input.unRegisterEventHandler=function(a,b){if(a)for(var d=0;d!==g.length;++d)if(g[d].func===a&&g[d].thisObj===b){g.splice(d,1);break}};a.input.dispatchEvent=function(b){for(var d,c=!1,e=-1;e!==g.length;++e){if(-1===e)if(a.console.state.consoleAllowed)d={func:a.console.handleEvent};else continue;else d=g[e];if(d=d.func.call(d.thisObj,b))return!0;void 0!==d&&(c=!0)}if("ui"!==b.eventType&&
(b=a.input.translateToUIEvent(b)))return a.input.dispatchEvent(b);if(c)return!1};a.input.standardizeKeyEvent=function(a){null===a.which&&(a.which=a.charCode?a.charCode:a.keyCode?a.keyCode:0)};a.input.charCodeFromEvent=function(a){return String.fromCharCode(a.which).toLowerCase()};a.input.mouseToRatEvent=function(b,d,c){c=c||!1;var e=a.getRealMousePosition(b);"mousedown"===d&&a.audio&&(a.audio.suppressSound=!1);d=new a.input.Event(b,{type:d,defaultControllerID:"mouse"});d.pos=e;d.isFromTouch=c;d.pointerID=
void 0!==b.pointerId?b.pointerId:-1;c&&(c=12,a.graphics.hasGlobalScale()&&(c/=a.graphics.globalScale.x/a.graphics.canvasPixelRatio),(e=b.webkitRadiusX)&&1!==e||(e=c),d.touchRadiusX=e,(b=b.webkitRadiusY)&&1!==b||(b=c),d.touchRadiusY=b);b=!1;a.input.mouseHandler&&(b=a.input.mouseHandler(d));b||(b=a.input.dispatchEvent(d));d.handled=b;return d};a.input.mouseLeaveAll=function(b){a.input.mouseToRatEvent(b,"mousemove",!1)};a.input.onMouseMove=function(b){if(!a.input.appBar||a.input.appBar.hidden){var d=
"touch"===b.pointerType||2===b.pointerType||3===b.pointerType;a.input.lastUIInputType=d?"touch":"mouse";a.input.mouseInDocument=!0;b=a.input.mouseToRatEvent(b,"mousemove",d);a.input.handlePreventDefault(b,b.handled)}};a.input.onMouseDown=function(b){if(!a.input.appBar||a.input.appBar.hidden){a.system.kong&&a.system.kong.focus();window.mixer&&!a.system.hasFocus&&(a.console.log(">> rinput mixer focus"),a.graphics.canvas.focus());var d="touch"===b.pointerType||2===b.pointerType||3===b.pointerType;a.input.lastUIInputType=
d?"touch":"mouse";a.input.mouseInDocument=!0;b=a.input.mouseToRatEvent(b,"mousedown",d);a.input.handlePreventDefault(b,b.handled)}};a.input.onMouseUp=function(b){if(!a.input.appBar||a.input.appBar.hidden)b=a.input.mouseToRatEvent(b,"mouseup","touch"===b.pointerType||2===b.pointerType||3===b.pointerType),a.input.mouseInDocument=!0,a.input.handlePreventDefault(b,b.handled)};a.input.onMouseWheel=function(b){var d=window.event||b;d=d.wheelDelta?d.wheelDelta/120:d.deltaY?-d.deltaY/3:void 0!==d.detail?
-d.detail:0;b=new a.input.Event(b,{type:"mousewheel",defaultControllerID:"mouse"});b.wheelDelta=d;b.pos={x:a.mousePos.x,y:a.mousePos.y};a.input.dispatchEvent(b)};a.input.onKeyPress=function(b){b.char=b.char||String.fromCharCode(b.keyCode||b.charCode);if(b.char){b=new a.input.Event(b,{type:"keypress",defaultControllerID:"keyboard"});var d=a.input.dispatchEvent(b);a.input.handlePreventDefault(b,d)}};a.input.onKeyDown=function(b){a.input.keyboard.isKeyDown(a.input.getEventWhich(b));a.input.keyboard.handleKeyDown(b);
var d=new a.input.Event(b,{type:"keydown",defaultControllerID:"keyboard"}),c=a.input.dispatchEvent(d);b.deviceSessionId&&a.system.has.xboxLE&&(b=a.input.getControllerInfo(b.deviceSessionId))&&a.input.handleGamepadDownEvent(d,b);a.input.handlePreventDefault(d,c)};a.input.onKeyUp=function(b){a.input.keyboard.handleKeyUp(b);var d=new a.input.Event(b,{type:"keyup",defaultControllerID:"keyboard"}),c=a.input.dispatchEvent(d);b.deviceSessionId&&a.system.has.xboxLE&&(b=a.input.getControllerInfo(b.deviceSessionId))&&
a.input.handleGamepadUpEvent(d,b);a.input.handlePreventDefault(d,c)};a.input.onContextMenu=function(b){b=a.input.mouseToRatEvent(b,"contextmenu",!1);a.input.handlePreventDefault(b,b.handled)};a.input.getControllerInfo=function(b){var d;a.system.has.xbox?d=a.input.getXboxControllerInfo(b):a.system.has.xboxLE&&(d={id:3735928559+b,user:{}});if(!d)return null;b=-1;for(var c=0;c<a.input.controllers.length;c++)if(a.input.controllers[c].id===d.id){b=c;break}0>b&&(d=a.input.buildRatControllerObject("xle",
{type:"gamepad",id:d.id,user:d.user,rawButtons:0,newButtons:0,lastButtons:0}),a.input.controllers.push(d),b=a.input.controllers.length-1);return a.input.controllers[b]};a.input.setControllerInfoByIndex=function(b,d){a.system.has.xboxLE&&("string"===typeof b&&(b=parseInt(b)),b=a.input.buildRatControllerObject("xle",{type:"gamepad",id:b,user:{},rawButtons:0,newButtons:0,lastButtons:0}),a.input.controllers[d]=b)};a.input.clearAllControllerButtons=function(){for(var b,d=0;d<a.input.controllers.length;d++)b=
a.input.controllers[d],b.rawButtons=0,b.newButtons=0,b.lastButtons=0,b.repeatTimer.fullReset()};a.input.setTouchPositionOnEvent=function(b,d){var c=a.utils.copyObject(d,!1,!0);if(void 0!==b.pageX||void 0!==b.pageY)c.pageX=b.pageX,c.pageY=b.pageY;void 0!==b.identifier?c.pointerId=b.identifier:void 0!==d.pointerId&&(c.pointerId=d.pointerId);return c};a.input.autoHandleEvents=function(){a.addOSKeyEventListener(window,"keydown",a.input.onKeyDown,!1);a.addOSKeyEventListener(window,"keyup",a.input.onKeyUp,
!1);a.addOSKeyEventListener(window,"keypress",a.input.onKeyPress,!1);navigator.msPointerEnabled?(a.addOSEventListener(window,"MSPointerMove",a.input.onMouseMove,!1),a.addOSEventListener(window,"MSPointerDown",a.input.onMouseDown,!1),a.addOSEventListener(window,"MSPointerUp",a.input.onMouseUp,!1)):window.PointerEvent||"undefined"!==typeof Windows?(a.addOSEventListener(window,"pointermove",a.input.onMouseMove,!1),a.addOSEventListener(window,"pointerdown",a.input.onMouseDown,!1),a.addOSEventListener(window,
"pointerup",a.input.onMouseUp,!1)):(a.addOSEventListener(window,"mousemove",a.input.onMouseMove,!1),a.addOSEventListener(window,"mousedown",a.input.onMouseDown,!1),a.addOSEventListener(window,"mouseup",a.input.onMouseUp,!1),document.body&&(document.addEventListener("touchstart",d,{passive:!1}),document.addEventListener("touchmove",d,{passive:!1}),document.addEventListener("touchend",d,{passive:!1})));a.addOSEventListener(window,"contextmenu",a.input.onContextMenu,!1);a.addOSEventListener(document,
"mouseenter",function(b){a.input.mouseInDocument=!0});a.addOSEventListener(document,"mouseleave",function(b){a.input.mouseInDocument=!1;a.input.triggerMouseLeaveOnDocument&&a.input.mouseLeaveAll(b)});var b=a.graphics.canvas;b&&(console.log("registering mouse enter/leave on canvas"),a.addOSEventListener(b,"mouseenter",function(b){a.input.mouseInCanvas=!0}),a.addOSEventListener(b,"mouseleave",function(b){a.input.mouseInCanvas=!1;a.input.triggerMouseLeaveOnCanvas&&a.input.mouseLeaveAll(b)}));a.system.has.firefoxBrowser?
a.addOSEventListener(window,"wheel",a.input.onMouseWheel,!1):a.addOSEventListener(window,"mousewheel",a.input.onMouseWheel,!1)};a.input.translateGamePadKeys=void 0;a.input.translateToUIEvent=function(b){var d=0,c="ui";if("keydown"===b.eventType||"keyup"===b.eventType){if(d=e(b.which))a.input.lastUIInputType="keyboard";"keyup"===b.eventType&&(c="ui_up")}else if("buttondown"!==b.eventType&&"buttonup"!==b.eventType||"GAMEPAD_KEYFAKE"===b.controllerID)"voice"===b.eventType&&(d=b.which,d=d===a.voice.commands.Back?
"back":d===a.voice.commands.Menu?"menu":d===a.voice.commands.view?"view":null)&&(a.input.lastUIInputType="voice");else{d=b.which;if(d=d===a.input.BUTTON_LEFT?"left":d===a.input.BUTTON_UP?"up":d===a.input.BUTTON_RIGHT?"right":d===a.input.BUTTON_DOWN?"down":d===a.input.BUTTON_A?"enter":d===a.input.BUTTON_B?"back":d===a.input.BUTTON_START?"menu":d===a.input.BUTTON_SELECT?"view":null)a.input.lastUIInputType="controller";"buttonup"===b.eventType&&(c="ui_up")}return d?new a.input.Event(b.sysEvent,{translatedFrom:b,
type:c,which:d}):null};a.input.getControllerDirection=function(b){var d={x:0,y:0};b&&(b.rawButtons&a.input.BUTTON_LEFT?--d.x:d.x=b.rawButtons&a.input.BUTTON_RIGHT?d.x+1:d.x+b.leftStick.x,b.rawButtons&a.input.BUTTON_UP?--d.y:d.y=b.rawButtons&a.input.BUTTON_DOWN?d.y+1:d.y+b.leftStick.y);return d};a.input.keyToDirection=function(b){return b===a.keys.leftArrow?{x:-1,y:0}:b===a.keys.rightArrow?{x:1,y:0}:b===a.keys.upArrow?{x:0,y:-1}:b===a.keys.downArrow?{x:0,y:1}:null};a.input.uiInputToDirection=function(a){return"left"===
a?{x:-1,y:0}:"right"===a?{x:1,y:0}:"up"===a?{x:0,y:-1}:"down"===a?{x:0,y:1}:null};a.input.getButtonValue=function(a){return"object"===typeof a?a.value:a};a.input.buildRatControllerObject=function(b,d){var c=a.input,e=a.input;switch(b){case "gamepadAPI":var f=d.axes;b=d.buttons.concat();for(var g=0;g<f.length;g++)b[-(g+1)]=f[g];f=c.GAMEPAD_CONTROLLER_MAPPING;void 0===d.connected&&(d.connected=!0);d=new c.Controller(d,d.id,d.index,d.connected,d.timestamp);d.rawButtons=(a.input.getButtonValue(b[f.BUTTON_A])?
e.BUTTON_A:0)|(a.input.getButtonValue(b[f.BUTTON_B])?e.BUTTON_B:0)|(a.input.getButtonValue(b[f.BUTTON_C])?e.BUTTON_C:0)|(a.input.getButtonValue(b[f.BUTTON_D])?e.BUTTON_D:0)|(a.input.getButtonValue(b[f.BUTTON_LB])?e.BUTTON_LB:0)|(a.input.getButtonValue(b[f.BUTTON_RB])?e.BUTTON_RB:0)|(a.input.getButtonValue(b[f.BUTTON_SELECT])?e.BUTTON_SELECT:0)|(a.input.getButtonValue(b[f.BUTTON_START])?e.BUTTON_START:0)|(a.input.getButtonValue(b[f.BUTTON_LEFT_STICK])?e.BUTTON_LEFT_STICK:0)|(a.input.getButtonValue(b[f.BUTTON_RIGHT_STICK])?
e.BUTTON_RIGHT_STICK:0)|(a.input.getButtonValue(b[f.BUTTON_DPAD_UP])?e.BUTTON_DPAD_UP:0)|(a.input.getButtonValue(b[f.BUTTON_DPAD_DOWN])?e.BUTTON_DPAD_DOWN:0)|(a.input.getButtonValue(b[f.BUTTON_DPAD_LEFT])?e.BUTTON_DPAD_LEFT:0)|(a.input.getButtonValue(b[f.BUTTON_DPAD_RIGHT])?e.BUTTON_DPAD_RIGHT:0);d.leftStick.x=b[f.leftStick.x]||0;d.leftStick.y=b[f.leftStick.y]||0;d.rightStick.x=b[f.rightStick.x]||0;d.rightStick.y=b[f.rightStick.y]||0;d.leftTrigger=b[f.leftTrigger]||0;d.rightTrigger=b[f.rightTrigger]||
0;return d;case "xle":return a.input.buildXboxLEControllerObject(b,d);case "xbox":return a.input.buildXboxControllerObject(b,d);default:return new c.Controller(d,0,-1,!1,0)}};a.input.buildGamepadKeyFake=function(){var b={id:"GAMEPAD_KEYFAKE",index:4,axes:[],buttons:[a.input.keyboard.isKeyDown(a.keys.a)|a.input.keyboard.isKeyDown(a.keys.enter),a.input.keyboard.isKeyDown(a.keys.b)|a.input.keyboard.isKeyDown(a.keys.esc),a.input.keyboard.isKeyDown(a.keys.x),a.input.keyboard.isKeyDown(a.keys.y),a.input.keyboard.isKeyDown(a.keys.leftBracket),
a.input.keyboard.isKeyDown(a.keys.rightBracket),a.input.keyboard.isKeyDown(a.keys.l)|a.input.keyboard.isKeyDown(a.keys.semicolon),a.input.keyboard.isKeyDown(a.keys.r)|a.input.keyboard.isKeyDown(a.keys.singleQuote),0,0,0,0,a.input.keyboard.isKeyDown(a.keys.i),a.input.keyboard.isKeyDown(a.keys.k),a.input.keyboard.isKeyDown(a.keys.j),a.input.keyboard.isKeyDown(a.keys.l)]};a.input.keyboard.isKeyDown(a.keys.upArrow)?b.axes[1]=-1:a.input.keyboard.isKeyDown(a.keys.downArrow)&&(b.axes[1]=1);a.input.keyboard.isKeyDown(a.keys.leftArrow)?
b.axes[0]=-1:a.input.keyboard.isKeyDown(a.keys.rightArrow)&&(b.axes[0]=1);return b};a.input.onSysControllerAdded=function(b){var d=a.input;if(a.system.has.xbox)return null;b=d.buildRatControllerObject("gamepadAPI",b.gamepad);return d.onControllerChange(d.ControllerChangeType.ADDED,b)};a.input.onSysControllerRemoved=function(b){var d=a.input;if(a.system.has.xbox)return null;b=d.buildRatControllerObject("gamepadAPI",b.gamepad);return d.onControllerChange(d.ControllerChangeType.REMOVED,b)};a.input.onControllerChange=
function(b,d){for(var c=a.input,e=-1,f=c.controllers,g=f.length-1;0<=g;--g)if(f[g].id===d.id){e=g;break}if(b===c.ControllerChangeType.REMOVED){if(-1===e)return d;d.rawButtons=0;d.leftStick.x=0;d.leftStick.y=0;d.rightStick.x=0;d.rightStick.y=0;d.connected=!1;d.leftTrigger=0;d.rightTrigger=0;d.repeatTimer.fullReset()}else b===c.ControllerChangeType.ADDED&&(d.connected=!0);-1===e?(d.lastButtons=0,f.push(d)):(d.repeatTimer=f[e].repeatTimer,d.lastButtons=f[e].lastButtons,f[e]=d);return d};a.input.updateControllers=
function(b){var d=a.input,c=d.controllers,e=d.thresholds;if(d.controllers.getSystemControllers){var g=d.controllers.getSystemControllers(),h,k;if(d.controllers.pollingForced&&(a.system.has.gamepadAPI||f)){var q="gamepadAPI";a.system.has.xbox&&(q="xbox");for(h=g.length-1;0<=h;--h)if(g[h]){var t=d.buildRatControllerObject(q,g[h]);for(k=c.length-1;0<=k;--k)if(c[k].id===t.id){var v=!0;break}k=t.connected?v?d.ControllerChangeType.UPDATED:d.ControllerChangeType.ADDED:d.ControllerChangeType.REMOVED;d.onControllerChange(k,
t)}}}for(h=c.length-1;0<=h;--h)g=c[h],g.leftStick.y<=-e.PRESSED&&(g.rawButtons|=d.BUTTON_LSTICK_UP),g.leftStick.y>=e.PRESSED&&(g.rawButtons|=d.BUTTON_LSTICK_DOWN),g.leftStick.x<=-e.PRESSED&&(g.rawButtons|=d.BUTTON_LSTICK_LEFT),g.leftStick.x>=e.PRESSED&&(g.rawButtons|=d.BUTTON_LSTICK_RIGHT),g.rightStick.y<=-e.PRESSED&&(g.rawButtons|=d.BUTTON_RSTICK_UP),g.rightStick.y>=e.PRESSED&&(g.rawButtons|=d.BUTTON_RSTICK_DOWN),g.rightStick.x<=-e.PRESSED&&(g.rawButtons|=d.BUTTON_RSTICK_LEFT),g.rightStick.x>=e.PRESSED&&
(g.rawButtons|=d.BUTTON_RSTICK_RIGHT),0!==(g.rawButtons&(d.BUTTON_DPAD_UP|d.BUTTON_LSTICK_UP))&&(g.rawButtons|=d.BUTTON_UP),0!==(g.rawButtons&(d.BUTTON_DPAD_DOWN|d.BUTTON_LSTICK_DOWN))&&(g.rawButtons|=d.BUTTON_DOWN),0!==(g.rawButtons&(d.BUTTON_DPAD_LEFT|d.BUTTON_LSTICK_LEFT))&&(g.rawButtons|=d.BUTTON_LEFT),0!==(g.rawButtons&(d.BUTTON_DPAD_RIGHT|d.BUTTON_LSTICK_RIGHT))&&(g.rawButtons|=d.BUTTON_RIGHT),a.input.getButtonValue(g.leftTrigger)>=e.PRESSED&&(g.rawButtons|=d.BUTTON_LT),a.input.getButtonValue(g.rightTrigger)>=
e.PRESSED&&(g.rawButtons|=d.BUTTON_RT),g.newButtons=g.rawButtons&~g.lastButtons,d.checkAndDispatchControllerEvents(g,b),g.lastButtons=g.rawButtons,g.connected||(c.splice(h,1),a.console.log("Controller "+g.id+" removed"))};a.input.setOneAllowedController=function(b){"keyboard"!==b&&"mouse"!==b&&(a.console.log("Allowing only controller "+b),a.input.allowedControllers=[b])};a.input.allowAllControllers=function(){a.input.allowedControllers=[]};a.input.setAllowRepeatEvents=function(b){!0===b||!1===b?(a.input.allowRepeatEvents.buttons=
b,a.input.allowRepeatEvents.directions=b):(void 0!==b.buttons&&(a.input.allowRepeatEvents.buttons=!!b.buttons),void 0!==b.directions&&(a.input.allowRepeatEvents.directions=!!b.directions))};var h=function(a,b){this.defaults={rate:a,delay:b};this.directions=this.buttons=0;this.fullReset()};h.prototype.fullReset=function(){this.buttons=this.defaults.delay.buttons;this.directions=this.defaults.delay.directions};h.prototype.repeatReset=function(a){void 0===a&&(a={buttons:!0,directions:!0});a.buttons&&
(this.buttons=this.defaults.rate.buttons);a.directions&&(this.directions=this.defaults.rate.directions)};h.prototype.elapsed=function(a){this.buttons-=a;this.directions-=a;0>this.buttons&&(this.buttons=0);0>this.directions&&(this.directions=0)};a.input.Controller=function(b,d,c,e,f){this.rawData=b||{};this.id=d;this.index=c;this.connected=e;this.timestamp=f;this.rawButtons=0;this.leftStick={x:0,y:0};this.rightStick={x:0,y:0};this.lastButtons=this.newButtons=this.rightTrigger=this.leftTrigger=0;this.repeatTimer=
new h(a.input.Controller.repeatRate,a.input.Controller.repeatDelay)};a.input.Controller.repeatRate={buttons:.2,directions:.2};a.input.Controller.repeatDelay={buttons:.5,directions:.5};a.input.thresholds={LOW:.2,NORM:.5,HIGH:.8,PRESSED:.7};a.getRealMousePosition=a.input.getRealMousePosition;a.standardizeKeyEvent=a.input.standardizeKeyEvent;a.charCodeFromEvent=a.input.charCodeFromEvent;a.autoHandleEvents=a.input.autoHandleEvents;a.keys={leftArrow:37,upArrow:38,rightArrow:39,downArrow:40,enter:13,esc:27,
backspace:8,insert:45,del:46,space:32,home:36,end:35," ":32,tab:9,pageUp:33,pageDown:34,period:190,semicolon:186,singleQuote:222,comma:188,shift:16,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,numPad0:96,numPad1:97,numPad2:98,numPad3:99,numPad4:100,numPad5:101,numPad6:102,numPad7:103,numPad8:104,numPad9:105,asterisk:106,numPadForwardSlash:111,numPadPlus:107,numPadMinus:109,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,
y:89,z:90,"~":192,tilde:192,"`":192,backTick:192,"-":189,"=":187,leftSys:91,rightSys:92,ctrlKey:17,selectKey:93,"/":191,forwardSlash:191,"\\":220,backslash:220,leftBracket:219,rightBracket:221,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123};a.input.keyCodeToNumber=function(b){return b>=a.keys["0"]&&b<=a.keys["9"]?b-a.keys["0"]:b>=a.keys.numPad0&&b<=a.keys.numPad9?b-a.keys.numPad0:-1};a.input.handlePreventDefault=function(b,d){var c=a.input.standardPreventDefaultOnEvents;
void 0!==d&&(c=d?!0:!1);void 0!==b.allowBrowserDefault&&(c=!b.allowBrowserDefault);!1===b.sysEvent.cancelable&&(c=!1);c&&!a.system.has.QUnit&&b.sysEvent&&b.sysEvent.preventDefault&&b.sysEvent.preventDefault()};a.input.setStandardPreventFlag=function(b){a.input.standardPreventDefaultOnEvents=b}});
rat.modules.add("rat.os.r_user",[{name:"rat.utils.r_messenger",processBefore:!0},{name:"rat.os.r_user_uwp",platform:"xbox"},{name:"rat.os.r_user_uwp",platform:"windows"},{name:"rat.os.r_user_wraith",platform:"Wraith"},{name:"rat.os.r_user_kong",platform:"kong"},"rat.debug.r_console"],function(a){var c=function(a,b){this.rawData=a;b&&(this.id=b.id,this.gamerTag=b.gamerTag,this.isSignedIn=b.isSignedIn||!1,this.userImageSource=b.userImageSource,this.friendsList=b.friendsList)},b=function(){this.list=
[];this.byId={};this.length=0};b.prototype.addUser=function(a){this.list.push(a);this.length=this.list.length;return this.byId[a.id]=a};b.prototype.add=function(a,b){a=new c(a,b);return this.addUser(a)};b.prototype.at=function(a){return this.list[a]};a.user=a.user||{};a.user.supported=a.user.supported||!1;a.user.messages=new a.Messenger;var d={ActiveUserChanged:"activeUserChanged",SignIn:"signIn",SignOut:"signOut",InfoChange:"infoChange",SigninUIClosed:"signinUIClosed",ControllerBindingChanged:"controllerBindingChanged",
FriendsInfoAvailable:"friendsInfoAvailable",AchievementInfoAvailable:"achievementInfoAvailable"};a.user.messageType=d;a.user.SigninUIOps={NoGuests:"",AllowGuests:"allowGuests",AllowOnlyDistinctControllerTypes:"allowOnlyDistinctControllerTypes"};var e=void 0,f=void 0;a.user._internal={UserList:b,User:c,isSigninUIShowing:!1};a.user.userIDFromControllerID=function(b){return"keyboard"===b||"mouse"===b?a.user.getUsers().at(0).id:0};a.user.controllerIDFromUserID=function(a){return 0};a.user.getUsers=function(){return f};
a.user.requestFriendsInfo=function(a){};a.user.showSigninUI=void 0;a.user.isSigninUIShowing=function(){return a.user._internal.isSigninUIShowing};a.user.getUser=function(b){return a.user.getUsers().byId[b]};a.user.clearActiveUser=function(b){a.user.setActiveUser(void 0,b)};a.user.setActiveUser=function(b,c){c=c||{};void 0!==b&&void 0!==b.id&&(b=b.id);var f;if((f=void 0!==b?void 0===e||e.id!==b:void 0!==e)||c.force)c=e,e=void 0!==b?a.user.getUser(b):void 0,f&&a.user.messages.broadcast(d.ActiveUserChanged,
e,c)};a.user.getActiveUser=function(){return e};a.user.getActiveUserID=function(){return(a.user.getActiveUser()||{}).id||0};a.user.getActiveUserName=function(){return(a.user.getActiveUser()||{}).gamerTag||""};a.user.getActiveUserImageSource=function(){return(a.user.getActiveUser()||{}).userImageSource||void 0};a.user.init=function(){f=new b;addFakeUser=function(){var b={id:-1,gamerTag:"Player 1",isGuest:!1,isSignedIn:!0,userImageSource:null,friendsList:null},d=f.add(b,b);a.user.setActiveUser(d);a.user.messages.broadcast(a.user.messageType.InfoChange,
d);window.setTimeout(function(){d.userImageSource="https://upload.wikimedia.org/wikipedia/commons/3/38/%22Cabeza_de_mujer%22.JPG";a.user.messages.broadcast(a.user.messageType.InfoChange,d)},1E3)};addFakeUser()}});
rat.modules.add("rat.debug.r_argus",["rat.os.r_system","rat.math.r_math","rat.graphics.r_graphics","rat.utils.r_utils",{name:"rat.debug.r_console",processBefore:!0}],function(a){var c={enabled:!1,paused:!1,reason:"uninitialized",projectName:"rat",serverAddress:null,serverPort:2529,userName:null,time:0,screenCapCount:0,lastScreenDate:null},b=10;a.debug=a.debug||{};a.debug.argus=c;c.updateInterval=500;c.init=function(b,d,g){c.reason="";b&&(c.projectName=b);g||(g={});this.opts=g;(b=g.platforms)?Array.isArray(b)||
(b=[b]):b="chromeBrowser IEBrowser firefoxBrowser Wraith uwpXbox !xboxLE".split(" ");c.sessionID=a.utils.makeUniqueID();if(window.app&&window.app.release)return c.reason="release build";if("file:"!==location.protocol&&"ms-appx:"!==location.protocol)return c.reason="we don't run in "+location.protocol+" protocol, currently.";g=!1;for(var e=0;e<b.length;e++){var f=b[e],l=!1;"!"===f.charAt(0)&&(l=!0,f=f.substring(1));if(a.system.has[f]&&(g=!0,l))return c.reason="platform "+f+" is in exclusion list."}if(!g)return c.reason=
"current platform not in specified/default list";if(!a.system.has.localStorage)return c.reason="we need localstorage to track timing correctly";d&&(c.serverAddress=d);return c.serverAddress?c.enable():(a.console.log("rat.debug.argus: no server address. Consider using console 'argus server x.x.x' command."),c.reason="no server address provided yet")};c.useCaptureCanvas=function(a){c.opts.captureCanvas=a};c.enable=function(b){void 0===b&&(b=!0);b&&!c.serverAddress&&(a.console.log("can't enable argus without serveraddress."),
c.reason="no server address provided yet",b=!1);b?(c.enabled=!0,c.intervalID||(c.intervalID=window.setInterval(c.update,c.updateInterval))):(c.enabled=!1,c.intervalID&&(window.clearInterval(c.intervalID),c.intervalID=0));return c.enabled};c.update=function(){if(c.enabled&&!c.paused){c.time+=c.updateInterval/1E3;var b=!1;c.getNextAutoScreenTime().doItNow&&(b=!0);a.console.state.consoleActive&&(b=!1);b&&c.doScreenCap()}};c.getNextAutoScreenTime=function(){var a={doItNow:!1,timeAhead:-1,reason:""};if(null===
c.lastScreenDate)a.doItNow=!0,a.timeAhead=0;else if(1<=c.screenCapCount)a.timeAhead=-1,a.reason="only one per session";else{var d=new Date(c.lastScreenDate.getTime()+72E5);a.timeAhead=(d-new Date)/1E3;0>=a.timeAhead&&(a.timeAhead=0,a.doItNow=!0)}c.time<b&&(d=b-c.time,a.timeAhead<d&&(a.timeAhead=d,a.doItNow=!1));return a};c.scheduleImmediateScreen=function(){c.lastScreenDate=null};c.doScreenCap=function(){if(c.serverAddress&&c.enabled){var b=c.opts.captureCanvas;b||(b=a.graphics.canvas);if(b){if(c.opts.captureScale)var d=
{w:b.width*c.opts.captureScale|0,h:b.height*c.opts.captureScale|0};else c.opts.captureSize&&(d=c.opts.captureSize);if(d){var g=document.createElement("canvas");g.width=d.w;g.height=d.h;newCtx=g.getContext("2d");"undefined"!==typeof c.opts.captureSmoothing&&a.graphics.setImageSmoothing(c.opts.captureSmoothing,newCtx);d=g.width/b.width;var h=g.height/b.height;h<d&&(d=h);newCtx.scale(d,d);newCtx.drawImage(b,0,0);b=g}c.lastScreenDate=new Date;b=b.toDataURL("image/jpeg",c.opts.captureQuality||.75);g=b.length;
524288<g?a.console.log("argus screencap skipped because it's too large: "+g):(c.sendThisScreen(b),a.console.log("argus screencap "+c.screenCapCount+" at "+c.time+", len: "+g),c.screenCapCount++,c.writeSettings())}}else a.console.log("argus disabled - no screencap.")};c.sendThisScreen=function(b){var d="http://"+c.serverAddress+":"+c.serverPort+"/screenpost/",e=new XMLHttpRequest;e.onreadystatechange=function(){4==e.readyState&&200!==e.status&&a.console.log("argus xmlhttp.status error: "+e.status)};
e.open("POST",d,!0);b=b.replace(/ /g,"+");b="sessionid="+c.sessionID+"&projectid="+c.projectName+"&imageid="+c.screenCapCount+"&data="+b;e.setRequestHeader("Content-type","application/x-www-form-urlencoded");e.send(b)};a.console.registerCommand("argus",function(d,f){if(1>f.length||"help"===f[0])1>f.length&&(f=c.enabled?"on":"off",c.enabled||(f+=" ("+c.reason+")"),a.console.log("argus status: "+f),a.console.log("      server: "+c.serverAddress)),a.console.logNewlines("argus commands:\n  argus server <serveraddress>\n  argus screencap\n  argus user username\n  and more...");
else if("server"===f[0]&&f[1]){c.serverAddress=f[1];if("0"===f[1]||"false"===f[1])c.serverAddress=null;c.enable();a.console.log("argus enabled: "+c.enabled);c.writeSettings()}else"enable"===f[0]?(d=!0,f[1]&&"false"===f[1]&&(d=!1),c.enable(d),a.console.log("argus enabled: "+c.enabled)):"user"!==f[0]&&"username"!==f[0]||!f[1]?"screencap"===f[0]||"screen"===f[0]||"cap"===f[0]?(a.console.activate(!1),b=0,c.scheduleImmediateScreen()):"time"===f[0]||"last"===f[0]||"next"===f[0]?(f="(none)",c.lastScreenDate&&
(f=c.lastScreenDate.toTimeString()),c.enabled?c.lastScreenDate?(d=c.getNextAutoScreenTime(),nextScreenTime=0<=d.timeAhead?"+"+a.utils.secondsToText(d.timeAhead)+"s":"none ("+d.reason+")"):nextScreenTime="next opportunity":nextScreenTime="none (disabled)",c.paused&&(nextScreenTime+=" (paused)"),a.console.log("  last screen: "+f),a.console.log("  next auto screen: "+nextScreenTime)):"pause"===f[0]||"unpause"===f[0]?(d=!c.paused,"unpause"===f[0]&&(d=!1),c.paused=d,a.console.log("  paused: "+c.paused)):
"clear"===f[0]&&c.clearSettings():(c.userName=f[1],a.console.log("argus user: "+c.userName),c.writeSettings())});var d=a.system.getLocalStorage();d&&(d=d.getItem("rat_debugArgus"))&&(d=JSON.parse(d))&&(d.serverAddress&&(c.serverAddress=d.serverAddress),d.userName&&(c.userName=d.userName),d.lastScreenDate&&(c.lastScreenDate=new Date(d.lastScreenDate)));c.writeSettings=function(){if(a.system.localStorageObject){var b={serverAddress:c.serverAddress,userName:c.userName};c.lastScreenDate&&(b.lastScreenDate=
c.lastScreenDate.toString());a.system.localStorageObject.setItem("rat_debugArgus",JSON.stringify(b))}};c.clearSettings=function(){c.serverAddress=null;c.userName=null;c.enabled=!1;c.reason="disabled through command";c.lastScreenDate=null;a.system.localStorageObject.removeItem("rat_debugArgus")}});
rat.modules.add("rat.debug.r_show_set",["rat.os.r_system",{name:"rat.debug.r_console",processBefore:!0}],function(a){a.debug.showSet={};a.debug.showSet.configure=function(c,b,d){function e(e,g){if(1>g.length||"none"===g[0])a.console.log("showSet: clearing "+e),c[e]={},b&&b();else{var f=g[0].toLowerCase();if("bounds"===f||"collis"===f)f="collision";d&&d[f]&&(f=d[f]);c[e][f]=void 0!==g[1]?g[1]:!c[e][f];b&&b();a.console.log("showSet: toggle "+e+" "+f+" (now: "+c[e][f]+")")}}a.getGlobalApp();if(!c)if(window.app&&
window.app.settings&&window.app.settings.debug)a.console.logWarning("Warning: no args to showSet.configure is deprecated."),c=window.app.settings.debug;else{a.console.log("Error configuring rat.debug.showSet: no setTarget object.");return}a.debug.showSet.setTarget=c;c.show||(c.show={});c.set||(c.set={});!b&&window.app&&window.app.writeSettings&&(b=window.app.writeSettings);a.debug.showSet.settingWriteFunction=b;a.debug.showSet.setter=e;a.console.registerCommand("set",function(a,b){e(a,b)});a.console.registerCommand("show",
function(a,b){e(a,b)})};a.debug.showSet.set=function(c,b){a.debug.showSet.setter("set",[c,b])};a.debug.showSet.show=function(c){a.debug.showSet.setter("show",[c])}});
rat.modules.add("rat.storage.r_storage",[{name:"rat.utils.r_utils",processBefore:!0},{name:"rat.debug.r_console",processBefore:!0},{name:"rat.storage.r_storage_xbo",platform:"xbox"},{name:"rat.storage.r_storage_firebase"},"rat.os.r_system","rat.os.r_user"],function(a){function c(){if(a.user)return a.user.getActiveUserID()||void 0}a.storage={storageObjects:{byUser:{},byType:{}}};a.storage.clear=function(){function b(a){var b=a.values,d;for(d in b)b.hasOwnProperty(d)&&a.values.remove(d)}void 0!==window.Windows&&
(b(window.Windows.Storage.ApplicationData.current.localSettings),b(window.Windows.Storage.ApplicationData.current.roamingSettings));a.system.has.xbox&&a.storage.XboxOne&&a.storage.XboxOne.clear();var d=a.system.getLocalStorage();d&&(d.clear?d.clear():a.system.has.Wraith&&a.console.log('To clear user settings under wraith, use the wraith cheat "resetPrefs"'));a.system.has.cookies&&document.cookie&&(document.cookie="FakeStorage=; expires=Thu, 01 Jan 1970 00:00:00 UTC")};a.storage.getStorage=function(b,
d){d=void 0!==d&&void 0!==d.id?d.id:d||"";var c=a.storage.storageObjects.byType;d&&(a.storage.storageObjects.byUser[d]=a.storage.storageObjects.byUser[d]||{},c=a.storage.storageObjects.byUser[d]);if(c&&c[b])return c[b];a.system.has.xbox&&a.storage.XboxOne&&a.storage.XboxOne.typeNeedsXbox(b)?c[b]=a.storage.XboxOne.getStorage(b,d):a.system.has.realWindows8?b===a.storage.permanentLocal?c[b]=new a.Win8AppStorage("",!0):b===a.storage.permanentRoaming?c[b]=new a.Win8AppStorage("",!1):b===a.storage.suspendLocal&&
(c[b]=new a.Win8SessionStorage("")):(d=a.system.has.localStorage?a.LocalStore:a.system.has.cookies&&void 0!=document.cookie?a.LocalCookieStore:a.FakeStore,b===a.storage.permanentLocal?c[b]=new d(""):b===a.storage.suspendLocal&&(c[b]=new d("_sus_")));return c[b]};a.storage.permanentLocal=1;a.storage.permanentRoaming=2;a.storage.permanentServer=3;a.storage.suspendLocal=4;a.console.registerCommand("clearStorage",function(b,d){a.storage.clear()},["clearstore"]);a.BasicStorage=function(a){this.prefix=
a||"";this._onReady=[];this.defaultData=void 0};a.BasicStorage.prototype.onReady=function(a,d){a&&(this.hasData()?a.call(d):this._onReady.push({func:a,ctx:d}))};a.BasicStorage.prototype._fireOnReady=function(){var a=this._onReady;this._onReady=[];for(var d,c,f=0;f!==a.length;++f)d=a[f].func,c=a[f].ctx,d.call(c)};a.BasicStorage.prototype.setPrefix=function(a){this.prefix=a||""};a.BasicStorage.prototype.setObject=function(a,d){this.setItem(a,JSON.stringify(d))};a.BasicStorage.prototype.getObject=function(a){a=
this.getItem(a);return"{"===a?{}:"string"!==typeof a||""===a?a:JSON.parse(a)};a.BasicStorage.prototype.save=function(a,d){if(this.hasData())this._internalSave?this._internalSave(a,d):a&&a.call(d);else this.onReady(this.save.bind(this,a,d),void 0)};a.BasicStorage.prototype.hasData=function(){return!0};a.BasicStorage.prototype.setDefaults=function(a){this.defaultData=a};a.BasicStorage.prototype.setItem=function(b,d){"string"!==typeof d&&(d=JSON.stringify(d));"save"===b?a.console.logError("ERROR! You cannot save items to local storage with the key 'save'.  That keyword is reserved!"):
this.hasData()?this._internalSetItem(b,d):(a.console.logWarning("WARNING: Setting item on storage object that is not ready.  Set delayed..."),this.onReady(this.setItem.bind(this,b,d),void 0))};a.BasicStorage.prototype._internalSetItem=void 0;a.BasicStorage.prototype._internalGetItem=void 0;a.BasicStorage.prototype.getItem=function(b){if(this.hasData())if("save"===b)a.console.logError("ERROR! You cannot load items from local storage with the key 'save'.  That keyword is reserved!");else{var d=this._internalGetItem(b);
void 0===d&&this.defaultData&&void 0!==this.defaultData[b]&&(d=this.defaultData.key);return d}else a.console.logError("ERROR! Attempting to ready storage when it is not ready!")};a.FakeStore=function(b){a.FakeStore.prototype.parentConstructor.call(this,b);this.data={}};a.utils.inheritClassFrom(a.FakeStore,a.BasicStorage);a.FakeStore.prototype._internalSetItem=function(a,d){this.data[this.prefix+a]=d};a.FakeStore.prototype._internalGetItem=function(a){return this.data[this.prefix+a]};a.FakeStore.prototype.remove=
function(a){this.data[this.prefix+a]=null};a.LocalStore=function(b){a.LocalStore.prototype.parentConstructor.call(this,b);this._fireOnReady()};a.utils.inheritClassFrom(a.LocalStore,a.BasicStorage);a.LocalStore.prototype._internalSetItem=function(b,d){a.system.has.localStorage&&a.system.localStorageObject.setItem(this.prefix+b,d,c())};a.LocalStore.prototype._internalGetItem=function(b){var d=null;a.system.has.localStorage&&(d=a.system.localStorageObject.getItem(this.prefix+b,c()));return d};a.LocalStore.prototype.remove=
function(b){a.system.has.localStorage&&a.system.localStorageObject.removeItem(this.prefix+b,c())};a.LocalStore.prototype.hasData=function(){return a.system.localStorageObject&&a.system.localStorageObject.hasData?a.system.localStorageObject.hasData(c()):!0};a.LocalStore.prototype._internalSave=function(b,d){if(a.system.localStorageObject&&a.system.localStorageObject.save&&"function"===typeof a.system.localStorageObject.save){a.console.log("Saving storage.");var e=a.system.localStorageObject.save(c());
a.console.log("...Done")}b&&b.call(d);return e};a.LocalCookieStore=function(b){a.LocalCookieStore.prototype.parentConstructor.call(this,b);this.cookieData={};b=(document.cookie||"").split(";");for(var d=0;d<b.length;++d){var c=b[d].trim(),f=c.indexOf("=");if(-1!=f){var g=c.substr(0,f).trim();c=c.substr(f+1).trim()}else g=c,c="{}";if("FakeStorage"==g){try{this.cookieData=JSON.parse(c)}catch(h){a.console.log("WARNING: Unable to parse save data from cookie data"),this.cookieData={}}break}}this._fireOnReady()};
a.utils.inheritClassFrom(a.LocalCookieStore,a.BasicStorage);a.LocalCookieStore.prototype._internalSetItem=function(a,d){0<this.prefix.length&&(a=this.prefix+a);this.cookieData[this.prefix+a]=d;this._internalSave()};a.LocalCookieStore.prototype._internalGetItem=function(a){0<this.prefix.length&&(a=this.prefix+a);return this.cookieData[a]};a.LocalCookieStore.prototype.remove=function(a){0<this.prefix.length&&(a=this.prefix+a);delete this.cookieData[a];this._internalSave()};a.LocalCookieStore.prototype.hasData=
function(){return!0};a.LocalCookieStore.prototype._internalSave=function(b,d){a.console.log("Saving storage.");document.cookie="FakeStorage=; expires=Thu, 01 Jan 1970 00:00:00 UTC";document.cookie="FakeStorage="+JSON.stringify(this.cookieData)+";";a.console.log("...Done");b&&b.call(d)};a.Win8SessionStorage=function(b){a.Win8SessionStorage.prototype.parentConstructor.call(this,b)};a.utils.inheritClassFrom(a.Win8SessionStorage,a.BasicStorage);a.Win8SessionStorage.prototype.getSessionStateObj=function(){return window.WinJS&&
window.WinJS.Application?window.WinJS.Application.sessionState:{}};a.Win8SessionStorage.prototype._internalSetItem=function(a,d){this.getSessionStateObj()[this.prefix+a]=d};a.Win8SessionStorage.prototype._internalGetItem=function(a){return this.getSessionStateObj()[this.prefix+a]};a.Win8SessionStorage.prototype.remove=function(a){this.getSessionStateObj()[this.prefix+a]=null};a.Win8AppStorage=function(b,d){a.Win8AppStorage.prototype.parentConstructor.call(this,b);this.settings=d?window.Windows.Storage.ApplicationData.current.localSettings:
window.Windows.Storage.ApplicationData.current.roamingSettings};a.utils.inheritClassFrom(a.Win8AppStorage,a.BasicStorage);a.Win8AppStorage.prototype._internalSetItem=function(a,d){this.settings.values[this.prefix+a]=d};a.Win8AppStorage.prototype._internalGetItem=function(a){return this.settings.values[this.prefix+a]};a.Win8AppStorage.prototype.remove=function(a){this.settings.values.remove(this.prefix+a)}});
rat.modules.add("rat.utils.r_string",["rat.debug.r_console","rat.os.r_system","rat.utils.r_utils"],function(a){a.string={currentStatus:"uninit",currentLanguage:"english",currentLocale:"en-US",stringData:{},tokenReplacements:{},supportedLanguages:[],callback:void 0,defaultLanguage:"key"};a.string.hasLanguage={};a.string.useXMLFile=!!window.DOMParser;a.string.fireDoneCallback=function(){a.string.callback&&(a.string.callback(),a.string.callback=void 0)};var c=0;a.string.init=function(b,d){if("uninit"!==
a.string.currentStatus)a.console.log("rat.string.init called twice   This is NOT allowed");else if(a.string.callback=d,!1===Array.isArray(b)&&(b=b?[b]:[]),c=b.length,0<b.length)for(a.string.currentStatus="requested",a.system.has.xboxLE&&(Maple.addEventListener(ORMMA_EVENT_RESPONSE,a.string.processUrlCallback),Maple.addEventListener(ORMMA_EVENT_ERROR,a.string.processUrlError)),d=0;d!==b.length;++d){var e=b[d],f=e.lastIndexOf(".");-1!==f&&(e=e.slice(0,f));e=a.string.useXMLFile?e+".xml":e+".json";a.console.log("Loading string file "+
e);a.system.has.xboxLE?Maple.request(adParams._projectBase+e,"proxy","GET"):a.string.useXMLFile?a.utils.loadXML(e,a.string.loadData):a.utils.loadJSON(e,a.string.loadData)}else a.string.currentStatus="complete",a.string.fireDoneCallback()};a.string.processUrlCallback=function(b,d){"requested"===a.string.currentStatus&&(a.string.loadData(d),0>=c&&(Maple.removeEventListener(ORMMA_EVENT_RESPONSE,a.string.processUrlCallback),Maple.removeEventListener(ORMMA_EVENT_ERROR,a.string.processUrlError)))};a.string.processUrlError=
function(b,d){"requested"===a.string.currentStatus&&(c=0,a.string.currentStatus="error",Maple.removeEventListener(ORMMA_EVENT_RESPONSE,a.string.processUrlCallback),Maple.removeEventListener(ORMMA_EVENT_ERROR,a.string.processUrlError),a.string.fireDoneCallback())};a.string.isReady=function(){return"complete"===a.string.currentStatus||"error"===a.string.currentStatus?!0:!1};a.string.getUserLocale=function(){var b="en-US";if(a.system.has.windows&&a.system.has.winJS){var d=window.Windows.System.UserProfile.GlobalizationPreferences.languages;
1<=d.length&&(b=d)}else null!=window.navigator.userLanguage?b=window.navigator.userLanguage:null!=window.navigator.languages?(d=window.navigator.languages,1<=d.length&&(b=d)):null!=window.navigator.language?b=window.navigator.language:null!=window.navigator.browserLanguage?b=window.navigator.browserLanguage:null!=window.navigator.systemLanguage&&(b=window.navigator.systemLanguage);if(Array.isArray(b)){for(d=0;d<b.length;d++)if(!0===a.string.isKnownLocale(b[d]))return b[d];return"en-US"}return!0===
a.string.isKnownLocale(b)?b:"en-US"};a.string.setDefaultLanguage=function(b){b=b.toLowerCase();b.match("^(([a-zA-Z]{2})|([a-zA-Z]{2}-[a-zA-Z]{2,3}))$")&&(b=a.string.convertLocaleToLanguage(b));!1===a.string.isKnownLanguage(b)&&(a.console.logWarning("Tried to set an unknown language: "+b+" as the default. Using english instead."),b="english");a.string.defaultLanguage=b};a.string.selectLanguage=function(){var b=a.string.getUserLocale();a.string.setLocale(b);a.console.log("Using locale: "+a.string.currentLocale+
", with language: "+a.string.currentLanguage)};a.string.isKnownLanguage=function(b){return"??"===a.string.getLanguageCodeFromLanguage(b)?!1:!0};a.string.setLocale=function(b){!0===a.string.isKnownLocale(b)?a.string.currentLocale=b:a.string.currentLocale="en-US";a.string.currentLanguage=a.string.convertLocaleToLanguage(a.string.currentLocale)};a.string.isKnownLocale=function(b){return"??"===a.string.getLanguageFromLanguageCode(b)?!1:!0};a.string.getLocale=function(){return a.string.currentLocale};
a.string.getLanguage=function(){return a.string.currentLanguage};a.string.getString=function(b,d){b=a.string.getStringNoReplaceTokens(b,void 0===d?null:d);d=a.string.getTokensFromString(b);if(null!=d&&0<d.length){for(var c=[],f=0;f<d.length;f++){var g=d[f],h=a.string.tokenReplacements[g];null!=h&&c.push({key:g,value:h})}b=a.string.replaceTokens(b,c)}return b};a.string.getStringNoReplaceTokens=function(b,d){d=void 0===d?null:d;var c=a.string.currentLanguage,f=a.string.defaultLanguage;null!=d&&(d=d.toLowerCase(),
a.string.isKnownLanguage(d)&&(c=d));a.string.stringData[c]||(c=f);if((d=a.string.stringData[c])&&d[b])return stringText=d[b].split("\\n").join("\n");if("key"!==f){if((f=a.string.stringData[f])&&f[b])return f[b]}else if(null!=a.string.stringData.key[b]&&a.string.stringData.key[b]!==b)return a.string.stringData.key[b];return a.string.getLanguageCodeFromLanguage(c)+"_"+b};a.string.getStringReplaceTokens=function(b,d,c){c=void 0===c?null:c;d=d||[];!1===Array.isArray(d)&&(d=[d]);b=a.string.getStringNoReplaceTokens(b,
c);return b=a.string.replaceTokens(b,d)};a.string.getTokensFromString=function(a){tokens=[];for(var b=0;b<a.length;){var c=a.indexOf("{",b);b=a.indexOf("}",b+1);if(-1===c||-1===b)break;c=a.substring(c,b+1);-1===tokens.indexOf(c)&&tokens.push(c);b+=1}return tokens};a.string.replaceTokens=function(b,d){d=d||[];!1===Array.isArray(d)&&(d=[d]);for(var c,f=0;f<d.length;++f){var g=d[f];c=void 0!==g.value?g.value:g;g.localize&&(c=a.string.getString(c));b=void 0!==g.key?b.split(g.key).join(c):b.split("{"+
f+"}").join(c)}return b};a.string.loadData=function(b){if("requested"===a.string.currentStatus){if(a.string.useXMLFile)b=a.string.parseXMLString(b),a.string.loadParsedData(b);else{b=(b=(b=(b=b?b.Workbook:void 0)?b.Worksheet:b)?b.Table||b[0].Table:b)?b.Row:b;if(!b){a.console.log("FAILED to process string JSON file.  Bad format");return}for(var d=0;d<b.length;++d){var e=b[d].Cell;if(0===d)for(var f=0;f<e.length;++f){var g=(e[f].Data||e[f]["ss:Data"])["#text"].toLowerCase();a.string.hasLanguage[g]||
(a.string.supportedLanguages.push(g),a.string.stringData[g]=a.string.stringData[g]||{},a.string.hasLanguage=!0)}else if(e.length&&1!==e.length&&(e[0].Data||e[0]["ss:Data"])&&(e[1].Data||e[1]["ss:Data"]))for(f=e[0].Data||e[0]["ss:Data"],g=0;g<e.length;++g){var h=e[g].Data||e[g]["ss:Data"],k=a.string.stringData[a.string.supportedLanguages[g]];h&&(k[f["#text"]]=h["#text"])}}}--c;0>=c&&(a.string.currentStatus="complete",a.string.fireDoneCallback())}};a.string.loadParsedData=function(b){for(var d=0;d<
b.languages.length;d++){var c=b.languages[d];"key"===c||a.string.isKnownLanguage(c)?a.string.hasLanguage[c]||(a.string.supportedLanguages.push(c),a.string.stringData[c]=a.string.stringData[c]||{},a.string.hasLanguage[c]=!0):a.console.logError("Attempted to add a language not recognized by Rat: "+c)}a.string.setStrings(b.stringSets)};a.string.parseXMLString=function(a){var b={languages:[],stringSets:[]},c=(new DOMParser).parseFromString(a,"text/xml");a=c.getElementsByTagName("Row");var f=c.getElementsByTagName("table:table-row");
c=c.getElementsByTagName("table-row");a=0<a.length?a:0<f.length?f:c;for(f=0;f<a.length;++f){c=a[f].getElementsByTagName("Cell");var g=a[f].getElementsByTagName("table:table-cell"),h=a[f].getElementsByTagName("table-cell");c=0<c.length?c:0<g.length?g:h;if(0===f)for(g=0;g<c.length;++g)h=c[g].textContent.toLowerCase(),b.languages.push(h);else if(""!==c[0].textContent){g={};for(var k=h=0;k<c.length;++k){var l=c[k],m=b.languages[h++],n=l.textContent.trim();g[m]=n;l=l.getAttribute("table:number-columns-repeated");
if(null!=l&&(l=parseInt(l,10),1<l))for(m=1;m<l;m++){var p=b.languages[h++];g[p]=n}}b.stringSets.push(g)}}return b};a.string.setString=function(b){if(null==b.key)a.console.logError("Missing KEY in newStringData");else{for(var d=b.key,c=$jscomp.makeIterator(Object.keys(a.string.stringData)),f=c.next();!f.done;f=c.next())f=f.value,a.string.stringData[f]=a.string.stringData[f]||{},a.string.stringData[f][d]=void 0;a.string.stringData.key[d]=d;b=$jscomp.makeIterator(Object.entries(b));for(c=b.next();!c.done;c=
b.next())f=$jscomp.makeIterator(c.value),c=f.next().value,f=f.next().value,"key"!==c&&(a.string.isKnownLanguage(c)?(a.string.hasLanguage[c]||(a.string.supportedLanguages.push(c),a.string.hasLanguage[c]=!0,a.string.stringData[c]=a.string.stringData[c]||{}),a.string.stringData[c][d]=f):a.console.logError("Attempted to add a language not recognized by Rat: "+KEY))}};a.string.setStrings=function(b){for(var d=0;d<b.length;d++)a.string.setString(b[d])};a.string.addStringWithKey=function(b,d){var c={};switch(typeof d){case "object":if(Array.isArray(d)){console.logError("Arrays not accepted in method: rat.string.addStringWithKey");
return}c.key=b;b=$jscomp.makeIterator(Object.entries(d));for(d=b.next();!d.done;d=b.next()){var f=$jscomp.makeIterator(d.value);d=f.next().value;f=f.next().value;"key"!==d&&0!=a.string.isKnownLanguage(d)&&(c[d]=f)}break;case "string":c={key:b,english:d};break;case "number":c={key:b,english:""+d};break;default:a.console.logWarning("Cannot add unkown stringData type for: "+d);return}a.string.setString(c)};a.string.setKeyString=function(b,d){null!=a.string.stringData.key&&null!=a.string.stringData.key[b]&&
(a.string.stringData.key[b]=d)};a.string.setAutoTokenReplacement=function(b,d){a.string.tokenReplacements[b]=d};a.string.getLanguageCodeFromLanguage=function(a){switch(a){case "english":return"en";case "french":return"fr";case "italian":return"it";case "german":return"de";case "spanish":return"es";case "portuguese":return"pt";case "japanese":return"ja";case "korean":return"ko";case "simplified chinese":return"cs";case "traditional chinese":return"ct";default:return"??"}};a.string.getLanguageFromLanguageCode=
function(a){switch(a.substring(0,2)){case "en":return"english";case "fr":return"french";case "it":return"italian";case "de":return"german";case "es":return"spanish";case "pt":return"portuguese";case "ja":return"japanese";case "ko":return"korean";case "zh":return"zh-CN"===a||"zh-SG"===a||"zh-Hans"===a?"simplified chinese":"traditional chinese";default:return"??"}};a.string.convertLocaleToLanguage=function(b){var d=a.string.getLanguageFromLanguageCode(b);return"??"===d?(a.console.logWarning("Unknown language from locale: "+
b+". Using english instead."),"english"):d};a.strings=a.string});
rat.modules.add("rat.audio.r_audio_howler",[{name:"rat.os.r_system",processBefore:!0},{name:"rat.audio.r_audio",processBefore:!0},{name:"rat.utils.r_utils",processBefore:!0},"rat.debug.r_console"],function(a){var c=a.utils.copyObject(a.audio,!1),b=a.audio.RatSound;b.prototype.isPlaying=function(){return this.a.playing()};b.prototype.isPaused=function(){return!this.a.playing()};b.prototype.getCurrentTime=function(){return this.a.seek()};b.prototype.setCurrentTime=function(a){return this.a.seek(a)};
b.prototype.getDuration=function(){return this.a.duration()};b.prototype.play=function(){this.a.play()};b.prototype.stop=function(){this.a.stop()};b.prototype.pause=function(){this.a.pause()};b.prototype.unload=function(){this.a.unload()};b.prototype.isLooping=function(){return this.a.loop()};b.prototype.setLooping=function(a){this.a.loop(a)};b.prototype.getVolume=function(){return this.a.volume()};b.prototype.setVolume=function(a){this.a.volume(a)};a.audio.init=function(){c.init()};a.audio.makeSound=
function(b,c){if(!window.Howl)return a.console.logError("You need to add howler.js to your project somewhere"),null;var d=new Howl({src:[b]}),e=new a.audio.RatSound(d);e.src=b;a.audio._setSoundGroup(e,c.group);a.audio._setSoundInitialVolume(e,c.volume);var h=e.soundVolume*a.audio.globalVolume;a.audio.log("set volume for "+b+" to "+h);d.volume(h);c.loop&&d.loop(!0);return e};a.audio.getSoundInfo=function(b){var d=a.audio.sounds[b];if(d&&d[0])return d=d[0],{id:b,duration:d.a.duration(),source:d.src,
volume:d.a.volume(),currentPos:d.a.seek(),readyState:d.a.state(),errorCode:"none"};a.audio.log("Requested info for nonexistent sound"+b,0,soundID);return null};a.audio.isSoundLoaded=function(b){var d=a.audio.sounds[b];return d&&d[0]?"loaded"===d[0].a.state():(a.audio.log("Tried to check if nonexistent audio ("+b+") is loaded",0),null)}});
rat.modules.add("rat.live.r_telemetry_manager",["rat.storage.r_storage","rat.live.r_telemetry_playfab"],function(a){a.live||(a.live={});a.live.telemetryManager={sessionGuid:null,telemetryTarget:null,userID:"testID",sessionID:null,username:null,groupID:null,sessionStartTime:0,queue:[]};var c=a.live.telemetryManager;c.Platforms={PlayFab:"playfab",Elasticsearch:"elasticsearch"};c.init=function(b){null==b?console.warn("no settings passed into telemetryManager.init"):(null==c.telemetryTarget&&(null==b.telemetryPlatform||
b.telemetryPlatform==c.Platforms.PlayFab?c.telemetryTarget=new a.live.TelemetryPlayFab(b):b.telemetryPlatform==c.Platforms.Elasticsearch&&(c.telemetryTarget=new a.live.TelemetryElasticsearch(b))),c.refreshSessionData())};c.setupParticipantExperienceData=function(a){null!=a&&(c.sessionID=a.sessionID,c.userID=a.userID,c.refreshSessionData(),c.updateParticipantExperienceData(a))};c.refreshSessionData=function(){c.sessionID=c.sessionID?c.sessionID:Date.now()+"-"+c.userID;c.sessionGuid=c.userID+":"+Date.now()+
":"+c.sessionID};c.updateParticipantExperienceData=function(a){null!=a&&(c.username=a.username,c.groupID=a.groupID)};c.send=function(a,d){c.telemetryTarget&&c.telemetryTarget.send(c.sessionGuid,a,d)};c.queue=function(a,d){d=void 0===d?!1:d;c.queue.push({data:a,callback:callback});d&&c.telemetryTarget.sendBatch()};c.sendBatch=function(){for(;1<=c.queue.length;){var a=c.queue.shift();c.telemetryTarget.send(c.sessionGuid,massage.data,a.callback)}};c.addScript=function(a,d,e){c.telemetryTarget&&c.telemetryTarget.setScript(a,
d,e)}});rat.modules.add("rat.live.r_telemetry_data",["rat.live.r_telemetry_manager"],function(a){a.live||(a.live={});a.live.TelemetryData=function(c,b,d){this.dataGroup=c?c:"default";this.id=a.live.telemetryManager.sessionGuid;this.isUpdate=d?d:!1;this.dict=b?b:{};this.scripts=[]};a.live.TelemetryData.prototype.set=function(a,b){this.dict[a]=b};a.live.TelemetryData.prototype.remove=function(a){delete this.dict[a]}});
rat.modules.add("rat.graphics.r_color",[{name:"rat.graphics.r_graphics",processBefore:!0}],function(a){function c(a,b,c){a=(a%1+1)%1;1<b&&(b=1);1<c&&(c=1);var d=6*a|0,e=6*a-d;a=c*(1-b);var f=c*(1-b*e);b=c*(1-b*(1-e));switch(d){case 0:return[c,b,a];case 1:return[f,c,a];case 2:return[a,c,b];case 3:return[a,f,c];case 4:return[b,a,c];case 5:return[c,a,f]}}var b=a.math;a.graphics.Color=function(b,c,f,g){"undefined"===typeof b?(this.b=this.g=this.r=255,this.a=1):"string"===typeof b?this.copyFrom(a.graphics.Color.makeFromStyleString(b)):
(void 0!==b.r?(this.r=b.r,this.g=b.g,this.b=b.b,this.a=void 0===b.a?1:b.a):(this.r=b,this.g=c,this.b=f,this.a=void 0===g?1:g),this.applyLimits())};a.graphics.Color.prototype.mult=function(b,c,f,g,h){void 0!==b.r&&(h=c,g=b.a,f=b.b,c=b.g,b=b.r);b=b/255*this.r;c=c/255*this.g;f=f/255*this.b;g*=this.a;h?h.set(b,c,f,g):h=new a.graphics.Color(b,c,f,g);h.applyLimits();return h};a.graphics.Color.prototype.scale=function(a){this.r*=a;this.g*=a;this.b*=a;this.applyLimits();return this};a.graphics.Color.prototype.shift=
function(a){this.r+=a;this.g+=a;this.b+=a;this.applyLimits();return this};a.graphics.Color.prototype.applyLimits=function(){this.r=0>this.r?0:255<this.r?255:this.r|0;this.g=0>this.g?0:255<this.g?255:this.g|0;this.b=0>this.b?0:255<this.b?255:this.b|0;0>this.a?this.a=0:1<this.a&&(this.a=1)};a.graphics.Color.prototype.toString=function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"};a.graphics.Color.prototype.toHexString=function(){var a=this.r.toString(16);a.length%2&&(a="0"+a);var b=this.g.toString(16);
b.length%2&&(b="0"+b);var c=this.b.toString(16);c.length%2&&(c="0"+c);return"#"+a+b+c};a.graphics.Color.prototype.setWhite=function(){this.b=this.g=this.r=255;this.a=1};a.graphics.Color.prototype.setRandom=function(a){a||(a=b);this.r=(200*a.random()|0)+54;this.g=(200*a.random()|0)+54;this.b=(200*a.random()|0)+54;this.a=1};a.graphics.Color.randomColor=function(b){var d=new a.graphics.Color;d.setRandom(b);return d};a.graphics.Color.prototype.copy=function(){return new a.graphics.Color(this.r,this.g,
this.b,this.a)};a.graphics.Color.prototype.set=function(a,b,c,g){void 0===g&&(g=1);this.r=a;this.g=b;this.b=c;this.a=g};a.graphics.Color.prototype.copyFrom=function(a){this.set(a.r,a.g,a.b,a.a)};a.graphics.Color.prototype.equal=function(a){return this.r===a.r&&this.g===a.g&&this.b===a.b&&this.a===a.a?!0:!1};a.graphics.Color.prototype.distanceSq=function(a){var b=this.r-a.r,d=this.g-a.g;a=this.b-a.b;return b*b+d*d+a*a};a.graphics.Color.prototype.luminance=function(){return.2126*this.r/255+.7152*this.g/
255+.0722*this.b/255};a.graphics.Color.luminanceRGB=function(a,b,c){return.2126*a/255+.7152*b/255+.0722*c/255};a.graphics.Color.prototype.luminancePerceived=function(){return.299*this.r/255+.587*this.g/255+.114*this.b/255};a.graphics.Color.luminancePerceivedRGB=function(a,b,c){return.299*a/255+.587*b/255+.114*c/255};a.graphics.Color.prototype.luminancePerceived2=function(){return Math.sqrt(.299*this.r*this.r/65025+.587*this.g*this.g/65025+.114*this.b*this.b/65025)};a.graphics.Color.prototype.matchLuminanceTo=
function(a){a=a.luminancePerceived();for(var b=0;20>b;b++){var d=this.luminancePerceived();0>a-d?(this.r-=10,this.g-=10,this.b-=10):(this.r+=10,this.g+=10,this.b+=10);this.applyLimits()}};a.graphics.Color.interp=function(b,c,f,g){var d=1-f,e=c.r*f+d*b.r,l=c.g*f+d*b.g,m=c.b*f+d*b.b;b=c.a*f+d*b.a;e=0>e?0:255<e?255:e|0;l=0>l?0:255<l?255:l|0;m=0>m?0:255<m?255:m|0;b=0>b?0:1<b?1:b;g?(g.r=e,g.g=l,g.b=m,g.a=b):g=new a.graphics.Color(e,l,m,b);return g};a.graphics.Color.prototype.randomVariance=function(d,
c){var e=this.r,g=this.g,h=this.b,k=this.a;d.r&&(e+=2*d.r*b.random()-d.r,e=0>e?0:255<e?255:e|0);d.g&&(g+=2*d.g*b.random()-d.g,g=0>g?0:255<g?255:g|0);d.b&&(h+=2*d.b*b.random()-d.b,h=0>h?0:255<h?255:h|0);d.a&&(k+=2*d.a*b.random()-d.a,k=0>k?0:1<k?1:k);c?(c.r=e,c.g=g,c.b=h,c.a=k):c=new a.graphics.Color(e,g,h,k);return c};a.graphics.makeColorFromHSV=function(b,e,f){b=c(b,e,f);b=new a.graphics.Color(255*b[0],255*b[1],255*b[2]);b.applyLimits();return b};a.graphics.getHSVFromColor=function(a){var b=a.r,d=
a.g;a=a.b;b/=255;d/=255;a/=255;var c=Math.max(b,d,a),h=Math.min(b,d,a),k=c-h;if(c==h)var l=0;else{switch(c){case b:l=(d-a)/k+(d<a?6:0);break;case d:l=(a-b)/k+2;break;case a:l=(b-d)/k+4}l/=6}return[l,0==c?0:k/c,c]};a.graphics.transparent=new a.graphics.Color(0,0,0,0);a.graphics.black=new a.graphics.Color(0,0,0);a.graphics.white=new a.graphics.Color(255,255,255);a.graphics.gray=new a.graphics.Color(128,128,128);a.graphics.lightGray=new a.graphics.Color(190,190,190);a.graphics.darkGray=new a.graphics.Color(64,
64,64);a.graphics.red=new a.graphics.Color(255,0,0);a.graphics.green=new a.graphics.Color(0,255,0);a.graphics.blue=new a.graphics.Color(0,0,255);a.graphics.yellow=new a.graphics.Color(255,255,0);a.graphics.cyan=new a.graphics.Color(0,255,255);a.graphics.violet=new a.graphics.Color(255,0,255);a.graphics.magenta=a.graphics.violet;a.graphics.lightRed=new a.graphics.Color(255,128,128);a.graphics.darkRed=new a.graphics.Color(128,0,0);a.graphics.lightGreen=new a.graphics.Color(128,255,128);a.graphics.darkGreen=
new a.graphics.Color(0,128,0);a.graphics.lightBlue=new a.graphics.Color(128,128,256);a.graphics.darkBlue=new a.graphics.Color(0,0,128);a.graphics.darkYellow=new a.graphics.Color(128,128,0);a.graphics.darkCyan=new a.graphics.Color(0,128,128);a.graphics.darkViolet=new a.graphics.Color(128,0,128);a.graphics.darkMagenta=a.graphics.darkViolet;a.graphics.lightYellow=new a.graphics.Color(255,255,128);a.graphics.lightCyan=new a.graphics.Color(128,255,255);a.graphics.lightViolet=new a.graphics.Color(255,128,
255);a.graphics.lightMagenta=a.graphics.lightViolet;a.graphics.orange=new a.graphics.Color(255,128,0);a.graphics.brown=new a.graphics.Color(128,96,0);a.graphics.darkBrown=new a.graphics.Color(96,64,0);a.graphics.Color.makeFromStyleString=function(b){var d,c;var g=d=c=255;var h=1;if("rgb"===b.substring(0,3)){var k=b.indexOf("(");k&&(b=b.substring(k+1),c=b.indexOf(","),g=parseInt(b.substring(0,c),10),b=b.substring(c+1),c=b.indexOf(","),d=parseInt(b.substring(0,c),10),b=b.substring(c+1),c=b.indexOf(","),
0>c?c=b.indexOf(")"):h=parseFloat(b.substring(c+1)),c=parseInt(b.substring(0,c),10))}else{if(a.graphics.Color.isStandard(b))return a.graphics.Color.standard(b);"#"===b.charAt(0)&&(b=b.substring(1,7));g=parseInt(b.substring(0,2),16);d=parseInt(b.substring(2,4),16);c=parseInt(b.substring(4,6),16)}return new a.graphics.Color(g,d,c,h)};a.graphics.Color.makeFromHexString=a.graphics.Color.makeFromStyleString;a.graphics.Color.standardColorTable={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",
aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",
darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",
hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",
linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",
palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",
tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};a.graphics.Color.isStandard=function(b){b=b.toLowerCase();var d=a.graphics.Color.standardColorTable;return d[b]?d[b]:null};a.graphics.Color.standard=function(b){var d=a.graphics.Color.standardColorTable;b=b.toLowerCase();return d[b]?a.graphics.Color.makeFromHexString(d[b]):a.graphics.gray};a.graphics.fixColorStyle=
function(a){return"string"===typeof a&&"0"<=a.charAt(0)&&"9">=a.charAt(0)?"#"+a:a}});
rat.modules.add("rat.utils.r_shapes",["rat.math.r_math","rat.math.r_vector"],function(a){a.shapes={};a.shapes.Circle=function(c,b,d){var e=0;void 0!==c.x&&(b=c.y,e=void 0!==c.squaredRadius?c.squaredRadius:c.r*c.r||0,d=void 0!==c.r?c.r:a.math.sqrt(e),c=c.x);this.center={x:c||0,y:b||0};this.radius=d||0;this.squaredRadius=e};a.shapes.Rect=function(a,b,d,e){void 0===a?this.h=this.w=this.y=this.x=0:void 0!==a.x?(this.x=a.x,this.y=a.y,this.w=a.w,this.h=a.h):(this.x=a,this.y=b,this.w=d,this.h=e)};a.shapes.Rect.prototype.copy=
function(){var c=new a.shapes.Rect;c.x=this.x;c.y=this.y;c.w=this.w;c.h=this.h;return c};a.shapes.Rect.prototype.expandToInclude=function(a){a.x<this.x&&(this.x=a.x);a.y<this.y&&(this.y=a.y);a.x+a.w>this.x+this.w&&(this.w=a.x+a.w-this.x);a.y+a.h>this.y+this.h&&(this.h=a.y+a.h-this.y)};a.shapes.Rect.prototype.getCenter=function(c){c=c||new a.Vector;c.x=this.x+this.w/2;c.y=this.y+this.h/2;return c};a.shapes.Rect.prototype.calcEdges=function(){this.l=this.x;this.t=this.y;this.r=this.x+this.w;this.b=
this.y+this.h;return this};a.shapes.Rect.prototype.isPointInRect=function(a,b){void 0!=a.x&&(b=a.y,a=a.x);return a>=this.l&&a<=this.r&&b>=this.t&&b<=this.b}});
rat.modules.add("rat.graphics.r_draw",[{name:"rat.math.r_math",processBefore:!0},{name:"rat.graphics.r_graphics",processBefore:!0},"rat.graphics.r_color","rat.os.r_system","rat.os.r_events","rat.debug.r_console","rat.debug.r_profiler","rat.math.r_matrix","rat.utils.r_utils","rat.utils.r_shapes"],function(a){a.graphics.drawLine=function(c,b,d,e,f){var g={x:0,y:0},h={x:0,y:0};void 0!==c.x?(g=c,void 0!==b.x?(h=b,f=d):(h.x=b,h.y=d,f=e)):(g.x=c,g.y=b,void 0!==d.x?(h=d,f=e):(h.x=d,h.y=e));c=a.graphics.ctx;
f&&(f.color&&(c.strokeStyle=f.color.toString()),void 0!==f.lineWidth&&(c.lineWidth=f.lineWidth));c.beginPath();c.moveTo(g.x,g.y);c.lineTo(h.x,h.y);c.stroke()};a.graphics.drawText=function(c,b,d,e){b=b||0;d=d||0;e?a.graphics.ctx.fillText(c,b,d,e):a.graphics.ctx.fillText(c,b,d)};a.graphics.drawTextArc=function(c,b,d,e,f,g){g=g||{};if(!f){var h=a.graphics.ctx.measureText(c);void 0!==h.width&&(h=h.width);f=a.math.min(h/e);g.angleScale&&(f*=g.angleScale)}var k=a.graphics.ctx;g.stroke&&g.lineWidth&&(k.lineWidth=
g.lineWidth);h=c.length;k.save();k.translate(b,d);k.rotate(-1*f/2);k.rotate(f/h*-1/2);for(d=0;d<h;d++)k.rotate(f/h),k.save(),k.translate(0,-1*e),b=c[d],g.stroke?k.strokeText(b,0,0):k.fillText(b,0,0),k.restore();k.restore()};a.graphics.drawCircle=function(c,b,d,e){var f=a.graphics.ctx;f.beginPath();void 0!==c.center?(e=b,d=c.radius,b=c.center.y,c=c.center.x):void 0!==c.x&&(void 0!==c.r?(e=b,d=c.r):(e=d,d=b),b=c.y,c=c.x);void 0!==e&&(e.color&&(e.fill?f.fillStyle=e.color.toString():f.strokeStyle=e.color.toString()),
e.fill||void 0===e.lineWidth||(f.lineWidth=e.lineWidth));f.arc(c,b,d,0,a.math.PI2,!0);f.closePath();e&&e.fill?f.fill():f.stroke()};a.graphics.drawRect=function(c,b){b=b||{};b.fill?(b.color&&(a.graphics.ctx.fillStyle=b.color.toString()),a.graphics.ctx.fillRect(c.x,c.y,c.w,c.h)):(b.lineWidth&&(a.graphics.ctx.lineWidth=b.lineWidth),b.color&&(a.graphics.ctx.strokeStyle=b.color.toString()),a.graphics.ctx.strokeRect(c.x,c.y,c.w,c.h))};a.graphics.drawShapeList=function(c){if(c&&!(0>=c.length))for(var b,
d=0;d!==c.length;++d){b=c[d];switch(b.type){case "circle":a.graphics.drawCircle(b);break;case "rect":a.graphics.drawRect(b);break;default:a.console.log("Unable able to identify shape for drawing\n")}a.graphics.drawShapeList(b.children)}};a.graphics.drawFillbar=function(c,b,d,e,f,g,h,k,l,m){f=f*d/g;g=a.graphics.getContext();g.fillStyle=h.toString();g.fillRect(c,b,d,e);g.fillStyle=k.toString();g.fillRect(c,b,f,e);g.lineWidth=m||1;g.strokeStyle=l.toString();g.strokeRect(c,b,d,e)};a.graphics.draw_fillbar=
a.graphics.drawFillbar;a.graphics.makePolygonShape=function(c,b,d,e,f){"undefined"===typeof f&&(f=3);"undefined"===typeof e&&(e=0);var g=2*Math.PI/f;a.graphics.ctx.beginPath();for(var h=0;h<f;h++){var k=Math.cos(e+h*g)*d,l=Math.sin(e+h*g)*d;0===h?a.graphics.ctx.moveTo(c+k,b+l):a.graphics.ctx.lineTo(c+k,b+l)}a.graphics.ctx.closePath()};a.graphics.fillPolygon=function(c,b,d,e,f){a.graphics.makePolygonShape(c,b,d,e,f);a.graphics.ctx.fill()};a.graphics.strokePolygon=function(c,b,d,e,f){a.graphics.makePolygonShape(c,
b,d,e,f);a.graphics.ctx.stroke()};a.graphics.radialClip=function(a,b,d,e,f,g,h){a.beginPath();a.moveTo(b,d);a.arc(b,d,e,f,g,h);a.closePath();a.clip()};a.graphics.roundRect=function(c,b){var d=Math.PI,e=a.graphics.ctx;e.beginPath();var f=c.x+b,g=c.y+b;e.arc(f,g,b,d,1.501*d);f=c.x+c.w-b;e.lineTo(f,c.y);e.arc(f,g,b,1.499*d,2*d);g=c.y+c.h-b;e.lineTo(c.x+c.w,g);e.arc(f,g,b,0,.501*d);f=c.x+b;e.lineTo(f,c.y+c.h);e.arc(f,g,b,.499*d,d);e.closePath()};a.graphics.drawMiniArrow=function(c,b,d){var e=a.graphics.ctx;
e.strokeStyle=d;e.lineWidth=3;e.beginPath();e.moveTo(c-2,b);e.lineTo(c+7,b);e.closePath();e.stroke();e.beginPath();e.lineWidth=2;e.moveTo(c+4,b-3);e.lineTo(c+8,b);e.lineTo(c+4,b+3);e.closePath();e.stroke()};a.graphics.drawArrow=function(c,b,d,e,f,g,h){var k=a.graphics.ctx;d-=c;var l=e-b;e=Math.atan2(l,d);d=Math.sqrt(d*d+l*l)/4;a.graphics.save();a.graphics.translate(c,b);a.graphics.rotate(e);k.beginPath();k.moveTo(-d,-d);k.lineTo(-d,d);k.lineTo(d,d);k.lineTo(d,2*d);k.lineTo(3*d,0);k.lineTo(d,-2*d);
k.lineTo(d,-d);k.closePath();k.fillStyle=f;k.fill();k.lineWidth=h;k.strokeStyle=g;k.stroke();a.graphics.restore()};a.graphics.drawPlus=function(){var c=a.graphics.ctx;c.fillStyle="#70B070";c.fillRect(-7,-3,14,6);c.fillRect(-3,-7,6,14)};a.graphics.drawMinus=function(){var c=a.graphics.ctx;c.fillStyle="#C07070";c.fillRect(-7,-3,14,6)};a.graphics.drawParallelogram=function(c,b,d,e,f,g,h){"undefined"===typeof h&&(h=1);if(0!==h){var k=a.graphics.ctx;f=Math.tan(f)*e;var l=c+f*(1-h);h=b+(1-h)*e;k.beginPath();
k.moveTo(l,h);k.lineTo(l+d,h);k.lineTo(c+d+f,b+e);k.lineTo(c+f,b+e);k.closePath();k.fillStyle=g;k.fill()}};a.graphics.drawSegmentOrArc=function(c,b,d){b.toString()&&(b=b.toString());d=d||1;var e=a.graphics.ctx;e.beginPath();"arc"===c.type?e.arc(c.center.x,c.center.y,c.radius,c.startAngle,c.endAngle,c.anticlockwise):(e.moveTo(c.point1.x,c.point1.y),e.lineTo(c.point2.x,c.point2.y),e.closePath());e.lineWidth=d;e.strokeStyle=b;e.stroke()};a.graphics.drawArc=function(c,b,d,e,f,g){var h=a.graphics.ctx;
g=g||{};g.fill?h.fillStyle=g.color.toString():h.strokeStyle=g.color.toString();g.fill||void 0===g.lineWidth||(h.lineWidth=g.lineWidth);h.beginPath();h.moveTo(c,b);h.arc(c,b,d,e,f,!0);h.closePath();g.fill?h.fill():h.stroke()}});
rat.modules.add("rat.input.r_voice",[{name:"rat.os.r_system",processBefore:!0},{name:"rat.input.r_voice_xbo",platform:"xbox"}],function(a){a.voice={commands:{Play:"play",Pause:"pause",Stop:"stop",Record:"record",FastForward:"fastForward",Rewind:"rewind",Next:"next",Previous:"previous",ChannelUp:"channelUp",ChannelDown:"channelDown",Back:"back",View:"view",Menu:"menu"},callbacks:{},enabled:{}};var c=void 0;a.voice.registerCB=function(b,d,c){(b=a.voice.callbacks[b])&&b.push({func:d,ctx:c})};a.voice.unregisterCB=
function(b,d,e){if(b=a.voice.callbacks[b])for(var f,g=0;g!==b.length;++g)if(f=b[g],f.func===d&&f.ctx===e){c&&c.index>=g&&--c.index;b.splice(g,1);break}};a.voice.fireCB=function(b,d){var e=a.voice.callbacks[b];if(e){var f=c;c={index:0};var g=!1;for(c.index=0;c.index!==e.length;++c.index){g=e[c.index].func;var h=e[c.index].ctx;if(g=g.call(h,b))break}c=f;!g&&a.input&&(b=new a.input.Event(d,{type:"voice",defaultControllerID:"voice",which:b}),a.input.dispatchEvent(b));return g}};a.voice.enableCommand=
function(b,d){d=void 0===d?!0:!!d;a.voice.enabled[b]=d;a.voice._internalEnabledCommand&&a.voice._internalEnabledCommand(b,d)};a.voice.resetCommands=function(){for(var b in a.voice.commands)a.voice.callbacks[a.voice.commands[b]]=[],a.voice.enableCommand(a.voice.commands[b],!1)}});
rat.modules.add("rat.input.r_keyboard",[{name:"rat.input.r_input",processBefore:!0}],function(a){a.input.keyboard={MAX_KEY_CODE:256,KEY_SLOTS:8,rawKeys:[0,0,0,0,0,0,0,0],newKeys:[0,0,0,0,0,0,0,0],lastKeys:[0,0,0,0,0,0,0,0],update:function(c){c=a.input.keyboard;for(var b=0;b<c.KEY_SLOTS;b++)c.newKeys[b]=c.rawKeys[b]&~c.lastKeys[b],c.lastKeys[b]=c.rawKeys[b]},handleKeyDown:function(c){c=a.input.getEventWhich(c);var b=a.math.floor(c/32);a.input.keyboard.rawKeys[b]|=1<<c-32*b},handleKeyUp:function(c){c=
a.input.getEventWhich(c);var b=a.math.floor(c/32);a.input.keyboard.rawKeys[b]&=~(1<<c-32*b)},isKeyDown:function(c){var b=a.math.floor(c/32);return a.input.keyboard.rawKeys[b]&1<<c-32*b?!0:!1},isKeyNewlyDown:function(c){var b=a.math.floor(c/32);return a.input.keyboard.newKeys[b]&1<<c-32*b?!0:!1},isArrowKey:function(c){return c===a.keys.leftArrow||c===a.keys.upArrow||c===a.keys.rightArrow||c===a.keys.downArrow}}});
rat.modules.add("rat.utils.r_messenger",[],function(a){a.Messenger=function(){this.handlers=[]};a.Messenger.remove="REMOVE";a.Messenger.prototype.broadcast=function(c){var b=this.handlers[c];if(b){var d=[],e;Array.prototype.splice.call(arguments,0,1);for(e in b)if(b.hasOwnProperty(e)){var f=b[e];f.apply(this,arguments)===a.Messenger.remove&&d.push(f)}for(e=0;e!==d.length;++e)this.stopListening(c,d[e])}};a.Messenger.prototype.listen=function(a,b){"function"===typeof b&&(this.handlers[a]=this.handlers[a]||
[],-1===this.handlers[a].indexOf(b)&&this.handlers[a].push(b))};a.Messenger.prototype.stopListening=function(a,b){"function"===typeof b&&(b=this.handlers[a].indexOf(b),-1!==b&&this.handlers[a].splice(b,1))}});
rat.modules.add("rat.storage.r_storage_firebase",[{name:"rat.storage.r_storage",processBefore:!0},"rat.debug.r_console"],function(a){a.FirebaseStorage=function(c,b,d){a.FirebaseStorage.prototype.parentConstructor.call(this,b);this.ref=null;"undefined"!==typeof Firebase&&(b&&""!==b&&(c+="/"+b),this.ref=new Firebase(c));if(this.ref){var e=this;this.data=void 0;this.ref.once("value",function(a){e.data=a.val();e._fireOnReady()})}else a.console.logWarning("WARNING!  Attempting to use Firebase storage without Firebase")};
a.utils.inheritClassFrom(a.FirebaseStorage,a.BasicStorage);a.FirebaseStorage.prototype._internalSetItem=function(a,b){if(this.ref){var d=this.ref;a&&""!==a&&(d=d.child(a));d.set(b)}};a.FirebaseStorage.prototype._internalGetItem=function(a){return this.hasData()?a&&""!==a?this.data[a]:this.data:null};a.FirebaseStorage.prototype.remove=function(a){var b=this.ref;a&&""!==a&&(b=b.child(a));b.remove();this.data=null};a.FirebaseStorage.prototype.hasData=function(){return"undefined"===typeof this.data?!1:
!0}});
rat.modules.add("rat.audio.r_audio",["rat.debug.r_console","rat.os.r_system"],function(a){RatSound=function(a){this.a=a};RatSound.prototype.isPlaying=function(){return!!(this.a&&0<this.a.currentTime&&!this.a.paused&&!this.a.ended&&2<this.a.readyState)};RatSound.prototype.isPaused=function(){return this.a.paused};RatSound.prototype.getCurrentTime=function(){return this.a.currentTime};RatSound.prototype.setCurrentTime=function(a){this.a.currentTime=a};RatSound.prototype.getDuration=function(){return this.a.duration};RatSound.prototype.play=
function(){var c=this.a.play();void 0!==c&&c.then(function(){}).catch(function(b){a.console.logWarning("play promise rejected : "+b);return-1})};RatSound.prototype.stop=function(){this.a.stop()};RatSound.prototype.pause=function(){this.a.pause()};RatSound.prototype.unload=function(){this.a.removeAttribute("src")};RatSound.prototype.isLooping=function(){return this.a.loop};RatSound.prototype.setLooping=function(a){this.a.loop=a};RatSound.prototype.getVolume=function(){return this.a.volume};RatSound.prototype.setVolume=
function(a){this.a.volume=a};a.audio={RatSound:RatSound,initialized:!1,soundOn:!0,suppressSound:!1,globalVolume:1,defaultGroup:"sfx",groups:{sfx:{volume:1,enabled:!0}},defaultExt:"",toLoadCount:0,loadedCount:0,sounds:{},dukTapeSound:null,trackLog:!0,logHistory:"",logHistoryCount:0,logHistoryMax:0,initialDebug:!1,showVerboseLevel:0,verboseLevelNormal:0,verboseLevelError:0,verboseLevelInit:1,verboseLevelHigh:2,log:function(c,b,d){d||(d=c);b||(b=1);a.audio.showVerboseLevel>=b&&a.console.logOnce("| r_audio: "+
c,d);a.audio.logHistoryCount<a.audio.logHistoryMax&&(a.audio.logHistoryCount++,a.audio.logHistory+=c+"\n")},audioConstructor:function(){return new window.Audio},init:function(c){c="undefined"===typeof c?a.audio:c;a.audio.initialDebug&&!a.audio.showVerboseLevel&&(a.audio.showVerboseLevel=1);a.audio.log("Init");c.iOSBrowser=a.system.has.iOSBrowser;c.PS4Browser=a.system.has.PS4Browser;var b=c.audioConstructor();if(b.canPlayType){c.canPlay={};c.canPlay.mp3=!!b.canPlayType("audio/mpeg");c.canPlay.m4a=
!!b.canPlayType('audio/mp4; codecs="mp4a.40.5"');c.canPlay.ogg=!!b.canPlayType('audio/ogg; codecs="vorbis"');c.canPlay.xma=!!b.canPlayType("audio/xma2;");c.canPlay.wav=!0;c.PS4Browser&&(c.canPlay.m4a=!0);c.initialDebug&&a.audio.log("can play: mp3("+c.canPlay.mp3+") m4a("+c.canPlay.m4a+") ogg("+c.canPlay.ogg+") xma("+c.canPlay.xma+") wav("+c.canPlay.wav+") \n");if(c.canPlay.m4a)var d="m4a";else c.canPlay.mp3?d="mp3":c.canPlay.ogg?d="ogg":c.canPlay.xma?d="xma":c.canPlay.wav?d="wav":(c.log("Unable to find supported audio file format.  Defaulting to .m4a"),
d="m4a");c.initialDebug&&c.log("load using ."+d);c.defaultExt=d}else c.canPlay={m4a:!0},c.defaultExt="m4a";c.dukTapeSound=b;c.initialized=!0},loadSounds:function(c){a.audio.sounds=a.audio._loadSoundList(c,a.audio.makeSound,a.audio.sounds)},loadSound:function(c){a.audio.loadSounds([c])},makeSound:function(c,b){var d=a.audio.audioConstructor(),e=new RatSound(d);a.audio.doSingleLoad(e,c,b);a.audio._setSoundGroup(e,b.group);a.audio._setSoundInitialVolume(e,b.volume);var f=e.soundVolume*a.audio.globalVolume;
a.audio.log("set volume for "+c+" to "+f);d.volume=f;b.loop&&(d.loop=!0);return e},_setSoundGroup:function(c,b){c.group=b||a.audio.defaultGroup;a.audio.groups[c.group]||(a.audio.groups[c.group]={volume:1,enabled:!0})},_setSoundInitialVolume:function(c,b){var d=1;void 0!==b&&(d=b);void 0!==a.audio.groups[c.group].volume&&(d*=a.audio.groups[c.group].volume);c.soundVolume=d;c.origVolume=d},_loadSoundList:function(c,b,d){a.audio.initialized||errorLog("!!NOT INITIALIZED before loadSounds",0);d=d||{};for(var e=
{},f=0;f<c.length;f++){var g=c[f];Array.isArray(g)||(g=[c[f]]);var h=g[0].count-1;if(0<h)for(var k=g[0].count=0;k<h;k++)g.push(g[0]);h=[];for(k=0;k<g.length;k++){var l=g[k];"string"===typeof l&&(l={resource:m,volume:1});var m=l.resource;l.id||(l.id=a.utils.getBaseFilename(m));l.group||(l.group=r);if("data:"!==m.substring(0,5)){var n=m.lastIndexOf(".");0<n?(extString=m.substring(n+1,m.length),a.audio.canPlay[extString]||(m=m.substring(0,n)+"."+a.audio.defaultExt)):m=m+"."+a.audio.defaultExt;m=a.system.fixPath(m)}a.audio.toLoadCount++;
n=b(m,l);h[k]=n;if(0===k){var p=l.id;var r=l.group}}e[p]&&a.audio.log("ERROR: "+p+" redefined!",a.audio.verboseLevelError,p);d[p]&&(a.audio.log("replacing sound "+p,a.audio.verboseLevelError,p),a.audio.releaseSound(p));d[p]=h}return d},releaseSound:function(c){var b=a.audio.sounds[c];if(b){for(var d=0;d<b.length;d++)b[d].unload();delete a.audio.sounds[c]}},loadSoundsWithData:function(c,b){function d(a,b){for(var c=0;c<a.length;c++){var e=a[c];if(Array.isArray(e))d(e,b);else for(var f=0;f!=b.length;++f){var l=
b[f];if(l.id===e.resource){e.resource=l.resource;break}}}}d(c,b);a.audio.loadSounds(c)},doSingleLoad:function(c,b,d){function e(b){a.audio.log("on_load, src "+this.src+", dur "+this.duration+", error : "+(this.error?this.error.code:"none")+", ready : "+this.readyState,2);this.removeEventListener("canplaythrough",e,!1);this.removeEventListener("error",f,!1);b=this.ratSound;b.ratLoaded||(b.ratLoaded=!0,a.audio.loadedCount++,a.audio.log(a.audio.loadedCount+"/"+a.audio.toLoadCount+" loaded: "+this.src))}
function f(b){a.audio.log("on_error, src "+this.src+", dur "+this.duration+", error : "+(this.error?this.error.code:"none")+", ready : "+this.readyState,0);e.call(this,b)}var g=c.a;g.ratSound=c;a.audio.log("triggering load "+d.id+" : "+b,2);g.preload="auto";g.addEventListener("canplaythrough",e,!1);g.addEventListener("error",f,!1);g.src=b;g.load()},selectVariant:function(c){if(!a.audio.sounds[c])return a.audio.log("tried to play nonexistent sound "+c,0,c),null;var b=a.audio.sounds[c];if(0>=b.length)return a.audio.log("tried to play from empty list "+
c,0,c),null;c=Math.random()*b.length|0;for(var d,e=-1,f=0;f<b.length;f++){var g=b[(c+f)%b.length],h=g.isPaused(),k=g.getCurrentTime();h=!h&&0<k?.5:1;h>e&&(e=h,d=g)}return d},getSoundGroup:function(c){return a.audio.sounds[c][0].group},playSound:function(c){if(!a.audio.soundOn||a.audio.suppressSound)return null;a.audio.log("play "+c);if(c=a.audio.selectVariant(c)){var b=a.audio.groups[c.group];if(!b||b.enabled)c.isPaused()?c.play():(b=c.getCurrentTime(),0<b&&.1>b||(a.system.has.Wraith&&c.stop(),c.play()))}},
pauseSound:function(c){if(a.audio.sounds[c]){c=a.audio.sounds[c];for(var b=0;b<c.length;b++){var d=c[b];d.a&&d.isPlaying()&&d.pause()}}else a.audio.log("tried to pause nonexistent sound "+c,0,c)},resetSound:function(c){if(a.audio.sounds[c]){c=a.audio.sounds[c];for(var b=0;b<c.length;b++){var d=c[b];d.a&&0!==d.getCurrentTime()&&d.setCurrentTime(0)}}else a.audio.log("tried to reset nonexistent sound "+c,0,c)},stopSound:function(c){a.audio.pauseSound(c);a.audio.resetSound(c)},seekSound:function(c,b,
d){if(a.audio.sounds[c]){"undefined"===typeof d&&(d=!1);c=a.audio.sounds[c];for(var e=0;e<c.length;e++){var f=c[e];if(f&&f.a){var g=f.getDuration(),h=b;d&&(h*=g);f.setCurrentTime(h)}}}else a.audio.log("tried to reset nonexistent sound "+c,0,c)},setSoundLooping:function(c,b){b=!!b;if(a.audio.sounds[c]){c=a.audio.sounds[c];for(var d=0;d<c.length;d++){var e=c[d];e&&e.a&&e.isLooping()!==b&&e.setLooping(b)}}else a.audio.log("tried to call setSoundLooping nonexistent sound "+c,0,c)},getSoundLooping:function(c){return a.audio.sounds[c][0].isLooping()},
getSoundVolume:function(c){if(a.audio.sounds[c])return a.audio.sounds[c][0].soundVolume;a.audio.log("tried to get volume for nonexistent sound "+c,0,c)},setSoundVolume:function(c,b){if(a.audio.sounds[c]){c=a.audio.sounds[c];for(var d=0;d<c.length;d++){var e=c[d];e&&e.a&&(e.soundVolume=b,e.setVolume(b*a.audio.groups[e.group].volume*a.audio.globalVolume))}}else a.audio.log("tried to set volume for nonexistent sound "+c,0,c)},setGroupVolume:function(c,b){if(!a.audio.groups[c])a.audio.log("tried to set vol for nonexistent group "+
c,0);else if(b!==a.audio.groups[c].volume){a.audio.groups[c].volume=b;for(var d in a.audio.sounds){variants=a.audio.sounds[d];for(var e=0;e<variants.length;++e)(ratSound=variants[e])&&ratSound.a&&ratSound.group===c&&ratSound.setVolume(ratSound.soundVolume*b*a.audio.globalVolume)}}},setGlobalVolume:function(c){if(c!==a.audio.globalVolume){a.audio.globalVolume=c;for(var b in a.audio.sounds){c=a.audio.sounds[b];for(var d=0;d<c.length;++d){var e=c[d];e.setVolume(e.soundVolume*a.audio.groups[e.group].volume*
a.audio.globalVolume)}}}},enableGroup:function(c,b){b=!!b;if(a.audio.groups[c]&&(a.audio.groups[c].enabled=b,!b))for(var d in a.audio.sounds)a.audio.sounds[d][0].group===c&&a.audio.stopSound(d)},muteGroup:function(c,b){void 0===b&&(b=!0);a.audio.enableGroup(c,!b)},fadeSound:function(c,b,d,e){e||(e=1);c=a.audio.sounds[c];for(var f=0;f<c.length;++f){var g=c[f],h=b;if(void 0===b||0>b)h=g.soundVolume;var k=d;if(void 0===d||0>d)k=g.origVolume;g.fade={startVolume:h,endVolume:k,time:e,startTime:e};g.soundVolume=
h;g.setVolume(h*a.audio.groups[g.group].volume*a.audio.globalVolume)}},fadeSoundTo:function(c,b,d){a.audio.fadeSound(c,-1,b,d)},unFadeSound:function(c,b){a.audio.fadeSound(c,-1,-1,b)},fadeGroup:function(c,b,d,e){e||(e=1);c=a.audio.groups[c];if(void 0===b||0>b)b=c.volume;c.fade={startVolume:b,endVolume:d,time:e,startTime:e}},fadeGroupTo:function(c,b,d){a.audio.fadeGroup(c,-1,b,d)},getSoundCurrentTime:function(c){return(c=a.audio.sounds[c])&&c[0]?c[0].getCurrentTime():0},isSoundLoaded:function(c){var b=
a.audio.sounds[c];if(!b||!b[0])return a.audio.log("Tried to check if nonexistent audio ("+c+") is loaded",0),null;c=b[0];if(c.a.error)return"error";b=c.a.buffered;return 1===b.length&&0===b.start(0)&&b.end(0)===c.a.duration},isSoundPlaying:function(c){c=a.audio.sounds[c];if(!c)return!1;for(var b=0;b<c.length;b++){var d=c[b];if(d&&d.isPlaying())return!0}return!1},update:function(c){function b(b){var d=b.fade;d.time-=c;var e=1-d.time/d.startTime;1<e&&(e=1,b.fade=null);return a.utils.interp(d.startVolume,
d.endVolume,e)}for(var d in a.audio.groups)if(a.audio.groups.hasOwnProperty(d)){var e=a.audio.groups[d];if(e.fade){var f=b(e);e.volume=f}}for(d in a.audio.sounds)if(a.audio.sounds.hasOwnProperty(d))for(var g=a.audio.sounds[d],h=0;h<g.length;++h){var k=g[h];e=a.audio.groups[k.group];k.fade&&(f=b(k),k.soundVolume=f,k.setVolume(f*e.volume*a.audio.globalVolume));e.fade&&k.setVolume(k.soundVolume*a.audio.groups[k.group].volume*a.audio.globalVolume)}},isCacheLoaded:function(){return!0},getSoundCount:function(){var c=
0,b;for(b in a.audio.sounds)a.audio.sounds.hasOwnProperty(b)&&c++;return c},getSoundIDByIndex:function(c){var b=0,d;for(d in a.audio.sounds)if(a.audio.sounds.hasOwnProperty(d)){if(b===c)return d;b++}return"error"},getSoundInfo:function(c){var b=a.audio.sounds[c];if(b&&b[0])return b=b[0],c={id:c,duration:b.a.duration,source:b.a.src,volume:b.a.volume,currentPos:b.a.currentTime,readyState:b.a.readyState,errorCode:"none"},b.a.error&&(c.errorCode=b.a.error.code),c;a.audio.log("Requested info for nonexistent sound"+
c,0,soundID);return null},whatIsMissing:function(){var c=0,b=0,d;for(d in a.audio.sounds)if(a.audio.sounds.hasOwnProperty(d))for(var e=0;e<a.audio.sounds[d].length;e++)a.audio.sounds[d][e].ratLoaded||(a.console.log("Missing: "+d+" (variant "+e+")"),b++),c++;a.console.log("missing "+b+" of "+c)}}});
rat.modules.add("rat.live.r_telemetry_playfab",[],function(a){a.live||(a.live={});a.live.TelemetryPlayFab=function(a){this.scripts={};a.playfabTitleID&&(PlayFab.settings.titleId=a.playfabTitleID,PlayFabClientSDK.LoginWithCustomID({TitleId:PlayFab.settings.titleId,CustomId:a.titleName,CreateAccount:!0},null==a.loginCallback?this.LoginCallback:a.loginCallback))};a.live.TelemetryPlayFab.prototype.LoginCallback=function(c,b){null!==c?a.console.log("Logged into PlayFab"):null!==b&&a.console.log("Error logging into PlayFab")};
a.live.TelemetryPlayFab.prototype.send=function(a,b,d){var c=this;return $jscomp.executeAsyncGenerator(function(){function e(e,f,l){for(;;)switch(g){case 0:b.set("sessionID",a),k=c.setupScripts(b),h={Body:k,EventName:b.dataGroup},PlayFabClientSDK.WritePlayerEvent(h,d),g=-1;default:return{value:void 0,done:!0}}}var g=0,h,k,l={next:function(a){return e(0,a,void 0)},throw:function(a){return e(1,void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();l[Symbol.iterator]=
function(){return this};return l}())};a.live.TelemetryPlayFab.prototype.setScript=function(a,b,d){this.scripts[a]={name:b,script:d}};a.live.TelemetryPlayFab.prototype.setupScripts=function(a){return a.dict}});
rat.modules.add("rat.ui.r_ui",[{name:"rat.os.r_events",processBefore:!0},{name:"rat.graphics.r_offscreen",processBefore:!0},{name:"rat.debug.r_console",processBefore:!0},"rat.os.r_system","rat.math.r_vector","rat.graphics.r_graphics","rat.utils.r_shapes","rat.ui.r_ui_animator","rat.ui.r_ui_tooltip","rat.math.r_math","rat.utils.r_collision2d","rat.ui.r_ui_textbox","rat.ui.r_ui_edittext","rat.ui.r_ui_data","rat.utils.r_eventmap"],function(a){a.ui={};a.ui.nextElementID=1;a.ui.mouseMoveCallCount=0;a.ui.updateCallCount=
0;a.ui.debugOffscreens=!1;a.console.registerCommand("debugOffscreens",function(){a.ui.debugOffscreens=!a.ui.debugOffscreens},["debugOffscreen","showOffscreens"]);a.ui.allowOffscreens=a.Offscreen.allowOffscreens;a.ui.Element=function(b){void 0===this.id&&(this.id=a.ui.nextElementID++,this.place=new a.Position(0,0,0),this.center=new a.Vector(0,0),this.color=new a.graphics.Color,this.size=new a.Vector(0,0),this.scale=new a.Vector(1,1),this.opacity=1,this.tempRect=new a.shapes.Rect,this.contentOffset=
new a.Vector(0,0),this.contentSize=new a.Vector(0,0),this.contentScale=new a.Vector(1,1),this.contentScaleMin=new a.Vector(.1,.1),this.contentScaleMax=new a.Vector(10,10),this.flags=0,this.flags|=a.ui.Element.enabledFlag,this.flags|=a.ui.Element.visibleFlag,this.flags|=a.ui.Element.adjustForScaleFlag,this.flags|=a.ui.Element.tracksMouseFlag,this.name="ui-"+this.id,this.commandInfo=this.command=0,this.callbackInfo=this.callback=null,this.events={},this.frameWidth=0,this.frameColor=new a.graphics.Color(0,
0,0),this.frameOutset=0,this.offscreen=null,this.useOffscreen=!1,this.needsUpdate=this.isDirty=!0,b?b.appendSubElement(this):this.parent=null,this.toolTip=null)};a.ui.Element.prototype.elementType="element";a.ui.Element.highlightedFlag=1;a.ui.Element.enabledFlag=2;a.ui.Element.pressedFlag=4;a.ui.Element.toggledFlag=8;a.ui.Element.visibleFlag=16;a.ui.Element.clipFlag=32;a.ui.Element.targetableFlag=64;a.ui.Element.targetedFlag=128;a.ui.Element.mouseInFlag=256;a.ui.Element.trackingMouseDownFlag=512;
a.ui.Element.tracksMouseFlag=1024;a.ui.Element.handleAllMouseInMe=2048;a.ui.Element.autoSizeAfterLoadFlag=4096;a.ui.Element.autoCenterAfterLoadFlag=8192;a.ui.Element.autoScaleAfterLoadFlag=16384;a.ui.Element.adjustForScaleFlag=65536;a.ui.Element.unSmoothFlag=131072;a.ui.Element.drawTiledFlag=1048576;a.ui.Element.prototype.flagsThatDirtyMe=a.ui.Element.visibleFlag;a.ui.Element.prototype.flagsThatDirtyParent=0;a.ui.Element.prototype.appendSubElement_unsafe=function(a){this.subElements?this.subElements.push(a):
this.subElements=[a];a.parent=this;a.toolTip&&a.toolTipScreenWasAssumed&&(a.toolTipScreen=a.getTopParent());this.setDirty(!0);this.setNeedsUpdate(!0)};a.ui.Element.prototype.appendSubElement=function(b){this.findSubElementByID(b.id,!1)&&a.console.logWarningOnce("WARNING: appending subelement with duplicate ID:  "+b.id,"dupID");this.appendSubElement_unsafe(b)};a.ui.Element.prototype.insertSubElement=function(b,d){this.findSubElementByID(b.id)&&a.console.logWarningOnce("WARNING: appending subelement with duplicate ID:  "+
b.id,"dupID");void 0===d&&(d=0);this.subElements?this.subElements.splice(d,0,b):this.subElements=[b];b.parent=this;this.setDirty(!0)};a.ui.Element.prototype.insertSubElementBefore=function(b,d){var c=this.getSubElementIndex(d);0>c&&(a.console.logErrorOnce("ERROR: attempting insert before element not in tree: "+d.id,"noBeforeElem"),c=0);this.insertSubElement(b,c)};a.ui.Element.prototype.replaceSubElement=function(b,d){var c=this.getSubElementIndex(b);0>c?a.console.logErrorOnce("ERROR: replaceSubElement failed to find: "+
b.id,"noReplaceElem"):(d.parent=this,d.setPos(b.getPos()),d.setSize(b.getSize()),this.subElements[c]=d,this.setDirty(!0))};a.ui.Element.prototype.moveSubElementToFront=function(a){var b=this.getSubElementIndex(a);0<=b&&(this.subElements.splice(b,1),this.subElements.push(a),this.setDirty(!0))};a.ui.Element.prototype.getParent=function(){return this.parent};a.ui.Element.prototype.getTopParent=function(){for(var a=this;a.parent;)a=a.parent;return a};a.ui.Element.prototype.removeSubElementByID=function(a){if(this.subElements){var b;
for(b=0;b<this.subElements.length;b++)if(this.subElements[b].id===a)return this.subElements.splice(b,1),this.setDirty(!0),!0;for(b=0;b<this.subElements.length;b++)if(this.subElements[b].removeSubElementByID(a))return this.setDirty(!0),!0}return!1};a.ui.Element.prototype.removeSubElement=function(a){return this.removeSubElementByID(a.id)};a.ui.Element.prototype.removeFromParent=function(){"undefined"!==typeof this.parent&&this.parent.removeSubElement(this)};a.ui.Element.prototype.detachAllChildren=
function(){var a=this.subElements||[];this.subElements=void 0;for(var d=0;d!==a.length;++d)a[d].parent=null;this.setDirty(!0);return a};a.ui.Element.prototype.removeAllSubElements=function(a){if(this.subElements)for(var b=0;b<this.subElements.length;b++)this.subElements[b].removeAllSubElements(!0);a&&this.killMyAnimators();this.subElements=[];this.setDirty(!0)};a.ui.Element.prototype.killMyAnimators=function(){a.ui.killAnimatorsForElement(this)};a.ui.Element.prototype.findSubElementByID=function(a,
d){void 0===d&&(d=!0);var b;if(this.subElements)for(var c=0;c!==this.subElements.length;++c)if(b=this.subElements[c])if(b.id===a||d&&(b=this.subElements[c].findSubElementByID(a,d)))return b};a.ui.Element.prototype.getSubElement=function(a){return!this.subElements||this.subElements.length<a?null:this.subElements[a]};a.ui.Element.prototype.getSubElementIndex=function(a){if(this.subElements)for(var b=0;b<this.subElements.length;++b)if(this.subElements[b]===a)return b;return-1};a.ui.Element.prototype.getSubElementCount=
function(a){return this.subElements?this.subElements.length:0};a.ui.Element.prototype.dumpTree=function(b,d){"undefined"===typeof b&&(b=0);var c=this.isVisible();d||(d={lines:[],totalCount:0,hiddenCount:0,updateCount:0,parentHidden:!1});d.totalCount++;var f=d.totalCount;this.needsUpdate&&d.updateCount++;c&&!d.parentHidden||d.hiddenCount++;var g=d.lines.length;d.lines.push("");if(this.subElements){var h=d.parentHidden;c||(d.parentHidden=!0);this.useOffscreen&&(d.parentHidden=!0);for(k=0;k<this.subElements.length;k++)this.subElements[k].dumpTree(b+
1,d);d.parentHidden=h}h="";var k;for(k=0;k<b;k++)h+="._";b=this.getBounds();b.x=""+a.math.floor(100*b.x)/100;b.y=""+a.math.floor(100*b.y)/100;b.w=""+a.math.floor(100*b.w)/100;b.h=""+a.math.floor(100*b.h)/100;k="";this.xuiElemType&&(k=" "+this.xuiElemType);var l="";d.totalCount>f&&(l=" subCount: "+(d.totalCount-f));c=c?"vis":"!vis";this.useOffscreen&&(c="Offscreen");d.parentHidden&&(c="("+c+")");d.lines[g]=h+this.id+": "+this.elementType+" :"+this.name+k+" : "+c+" : "+(this.needsUpdate?"upd":"!upd")+
" : "+b.x+", "+b.y+" ("+b.w+" x "+b.h+")"+l;return d};a.ui.Element.prototype.setColor=function(b){"string"===typeof b&&(b=new a.graphics.Color(b));this.color=b};a.ui.Element.prototype.getColor=function(){return this.color?this.color.copy():null};a.ui.Element.prototype.setSize=function(a,d){void 0!==a.h&&(d=a.h,a=a.w);if(this.size.x!==a||this.size.y!==d)this.size.x=a,this.size.y=d,this.boundsChanged()};a.ui.Element.prototype.setWidth=function(a){this.size.x!==a&&(this.size.x=a,this.boundsChanged())};
a.ui.Element.prototype.setHeight=function(a){this.size.y!==a&&(this.size.y=a,this.boundsChanged())};a.ui.Element.prototype.setBounds=function(a,d,c,f){void 0!==a.x?(this.place.pos.x=a.x,this.place.pos.y=a.y,this.size.x=a.w,this.size.y=a.h):(this.place.pos.x=a,this.place.pos.y=d,this.size.x=c,this.size.y=f);this.boundsChanged()};a.ui.Element.prototype.getSize=function(){var a={};a.x=this.size.x;a.y=this.size.y;a.w=this.size.x;a.h=this.size.y;return a};a.ui.Element.prototype.getWidth=function(){return this.size.x};
a.ui.Element.prototype.getHeight=function(){return this.size.y};a.ui.Element.prototype.setContentSize=function(a,d){this.contentSize.x=a;this.contentSize.y=d};a.ui.Element.prototype.setContentSizeFromSubElements=function(){var a=this.calculateContentBounds();this.setContentSize(a.w,a.h)};a.ui.Element.prototype.calculateContentBounds=function(){for(var a=9999,d=-9999,c=9999,f=-9999,g=0;this.subElements&&g<this.subElements.length;g++){var h=this.subElements[g];h.getBounds(h.tempRect);var k=h.place.pos,
l=Math.cos(h.place.rot.angle),m=Math.sin(h.place.rot.angle),n=function(b,e){var g=k.x+b*l-e*m;b=k.y+b*m+e*l;g<a&&(a=g);g>d&&(d=g);b<c&&(c=b);b>f&&(f=b)};n(0,0);n(h.size.x*h.scale.x,0);n(h.size.x*h.scale.x,h.size.y*h.scale.y);n(0,h.size.y*h.scale.y)}return{x:a,y:c,w:d-a,h:f-c}};a.ui.Element.prototype.setBoundsFromContent=function(a){var b=this.calculateContentBounds(),c=b.x-a,f=b.y-a;this.setPos(this.place.pos.x+c,this.place.pos.y+f);for(var g=0;this.subElements&&g<this.subElements.length;g++){var h=
this.subElements[g];h.setPos(h.place.pos.x-c,h.place.pos.y-f)}this.setSize(b.w+2*a,b.h+2*a)};a.ui.Element.prototype.getContentSize=function(){return this.contentSize.copy()};a.ui.Element.prototype.setPos=function(a,d){void 0!=a.x&&(d=a.y,a=a.x);if(this.place.pos.x!==a||this.place.pos.y!==d)this.place.pos.x=a,this.place.pos.y=d,this.boundsChanged()};a.ui.Element.prototype.getPos=function(){return this.place.pos};a.ui.Element.prototype.getPosX=function(){return this.place.pos.x};a.ui.Element.prototype.getPosY=
function(){return this.place.pos.y};a.ui.Element.prototype.setPosX=function(a){this.place.pos.x!==a&&(this.place.pos.x=a,this.boundsChanged())};a.ui.Element.prototype.setPosY=function(a){this.place.pos.y!==a&&(this.place.pos.y=a,this.boundsChanged())};a.ui.Element.prototype.setScale=function(a,d){void 0===d&&(d=a);this.scale.x=a;this.scale.y=d;this.parent&&this.parent.setDirty(!0)};a.ui.Element.prototype.getScale=function(){return this.scale};a.ui.Element.prototype.setRotation=function(a){this.place.rot.angle=
a;this.parent&&this.parent.setDirty(!0)};a.ui.Element.prototype.getRotation=function(){return this.place.rot.angle};a.ui.Element.prototype.setOpacity=function(a){this.opacity=a;this.parent&&this.parent.setDirty(!0)};a.ui.Element.prototype.getOpacity=function(){return this.opacity};a.ui.Element.prototype.setOpacityRecursive=function(b){this.applyRecursively(a.ui.Element.prototype.setOpacity,b)};a.ui.Element.prototype.setID=function(a){this.id=a};a.ui.Element.prototype.setFrame=function(b,d,c){this.frameWidth=
b;"undefined"!==typeof d?"string"===typeof d?this.frameColor.copyFrom(a.graphics.Color.makeFromStyleString(d)):this.frameColor.copyFrom(d):void 0===d&&this.frameColor.copyFrom(a.graphics.white);"undefined"!==typeof c&&(this.frameOutset=c);this.parent&&this.parent.setDirty(!0)};a.ui.Element.prototype.setFrameRandom=function(a){this.frameWidth=a;this.frameColor.setRandom();this.parent&&this.parent.setDirty(!0)};a.ui.Element.prototype.getGlobalPos=function(a,d){void 0===a&&(d=a=0);void 0!==a.x&&(d=a.y,
a=a.x);var b=this;do a-=b.center.x,d-=b.center.y,a*=b.scale.x,d*=b.scale.y,a+=b.place.pos.x,d+=b.place.pos.y,b.parent&&(a*=b.parent.contentScale.x,d*=b.parent.contentScale.y,a+=b.parent.contentOffset.x,d+=b.parent.contentOffset.y),b=b.parent;while(b);return{x:a,y:d}};a.ui.Element.prototype.getGlobalContentPos=function(a,d){"undefined"===typeof a&&(d=a=0);a*=this.contentScale.x;d*=this.contentScale.y;a+=this.contentOffset.x;d+=this.contentOffset.y;return this.getGlobalPos(a,d)};a.ui.Element.prototype.parentToLocalPos=
function(b,d){b=new a.Vector(b,d);b.x-=this.place.pos.x;b.y-=this.place.pos.y;b.x/=this.scale.x;b.y/=this.scale.y;return b};a.ui.Element.prototype.parentToLocalContentPos=function(a,d){a=this.parentToLocalPos(a,d);a.x-=this.contentOffset.x;a.y-=this.contentOffset.y;a.x/=this.contentScale.x;a.y/=this.contentScale.y;return a};a.ui.Element.prototype.globalToLocalPos=function(a,d){a||(a=0);d||(a=0);a=this.parent?this.parent.globalToLocalPos(a,d):{x:a,y:d};a.x-=this.place.pos.x;a.y-=this.place.pos.y;a.x/=
this.scale.x;a.y/=this.scale.y;return a};a.ui.Element.prototype.applyRecursively=function(a,d){var b=a.call(this,d);if(b)return b;if(this.subElements)for(var c=0;c<this.subElements.length;c++)if(b=this.subElements[c].applyRecursively(a,d))return b;return!1};a.ui.Element.prototype.callForSubElements=function(a,d){if(this.subElements)for(var b=0,c=this.subElements.length;b!==c;++b){var g=a.call(this.subElements[b],d);if(g)return g}return!1};a.ui.Element.prototype.callForSubElementsWithPos=function(a,
d,c,f){if(this.subElements){d=this.parentToLocalContentPos(d.x,d.y);d.x+=this.center.x;d.y+=this.center.y;for(var b=this.subElements.length-1;0<=b;b--){var e=a.call(this.subElements[b],d,c,f);if(e)return e}}return!1};a.ui.Element.prototype.update=function(b){a.ui.updateCallCount++;var d=!1;if(this.updateSelf){var c=this.updateSelf(b);if(void 0===c||!0===c)d=!0}if(this.subElements)for(var f=this.subElements.length-1;0<=f;--f)if(c=this.subElements[f],c.needsUpdate&&(c=c.update(b),void 0===c||!0===c))d=
!0;this.toolTip&&(d=!0,this.updateToolTip(b));this.updateSelfPost&&(c=this.updateSelfPost(b),void 0===c||!0===c)&&(d=!0);d||(this.needsUpdate=!1);return this.needsUpdate};a.ui.Element.prototype.setNeedsUpdate=function(a){void 0===a&&(a=!0);if(this.needsUpdate=a)for(a=this.parent;a;)a.needsUpdate=!0,a=a.parent};a.ui.Element.prototype.autoCenter=function(a,d){a||void 0===a?(this.center.x=this.size.x/2,this.center.y=this.size.y/2,d&&(this.place.pos.x+=this.size.x/2,this.place.pos.y+=this.size.y/2)):
this.center.x=this.center.y=0};a.ui.Element.prototype.setCenter=function(a,d){this.center.x=a;this.center.y=d;this.parent&&this.parent.setDirty(!0)};a.ui.Element.prototype.centerAt=function(a,d){this.setPos(a-this.scale.x*this.size.x/2,d-this.scale.y*this.size.y/2)};a.ui.Element.prototype.getCenterPos=function(){return{x:this.scale.x*this.size.x/2-this.center.x,y:this.scale.y*this.size.y/2-this.center.x}};a.ui.Element.prototype.centerInParent=function(){this.parent&&(this.place.pos.x=(this.parent.size.x-
this.scale.x*this.size.x)/2,this.place.pos.y=(this.parent.size.y-this.scale.y*this.size.y)/2,this.parent.setDirty(!0))};a.ui.Element.prototype.centerInParentHorizontally=function(){this.parent&&(this.place.pos.x=(this.parent.size.x-this.size.x)/2,this.parent.setDirty(!0))};a.ui.Element.prototype.centerInParentVertically=function(){this.parent&&(this.place.pos.y=(this.parent.size.y-this.size.y)/2,this.parent.setDirty(!0))};a.ui.Element.prototype.fitToParentSize=function(){this.parent&&this.setBounds(0,
0,this.parent.size.x,this.parent.size.y)};a.ui.Element.prototype.autoSizeToParent=a.ui.Element.prototype.fitToParentSize;a.ui.Element.prototype.sizeToParent=a.ui.Element.prototype.fitToParentSize;a.ui.Element.prototype.autoSizeToContent=function(){this.size.x=this.contentSize.x;this.size.y=this.contentSize.y;this.boundsChanged()};a.ui.Element.prototype.insetBounds=function(a){this.place.pos.x+=a;this.place.pos.y+=a;this.size.x-=2*a;this.size.y-=2*a;this.boundsChanged()};a.ui.Element.prototype.getBounds=
function(b){b=b||new a.shapes.Rect;b.x=this.place.pos.x-this.center.x*this.scale.x;b.y=this.place.pos.y-this.center.y*this.scale.y;b.w=this.size.x*this.scale.x;b.h=this.size.y*this.scale.y;return b};a.ui.Element.prototype.getLocalBounds=function(){return new a.shapes.Rect(0-this.center.x,0-this.center.y,this.size.x,this.size.y)};a.ui.Element.prototype.getMyLocalBounds=a.ui.Element.prototype.getLocalBounds;a.ui.Element.prototype.getGlobalBounds=function(){var b=this.getGlobalPos(),d=this.getGlobalPos(this.size.x,
this.size.y);return new a.shapes.Rect(b.x,b.y,d.x-b.x,d.y-b.y)};a.ui.Element.prototype.adjustBoundsForPointer=function(a,d){if(d&&d.isFromTouch){var b=d.touchRadiusX;d=d.touchRadiusY;a.x-=b;a.y-=d;a.w+=2*b;a.h+=2*d}return a};a.ui.Element.prototype.findSubElementByPoint=function(b,d,c){var e=this.parentToLocalContentPos(b.x,b.y);e.x+=this.center.x;e.y+=this.center.y;var g=null;if(this.subElements)for(var h=this.subElements.length-1;0<=h;h--){var k=this.subElements[h];if((k.flags&d)===d&&(g=k.findSubElementByPoint(e,
d)))break}if(g)return g;d=this.getBounds(this.tempRect);c&&this.adjustBoundsForPointer(d,c);return a.collision2D.pointInsideRect(b,d)?this:null};a.ui.Element.prototype.mouseEnter=function(b){0!==(this.flags&a.ui.Element.enabledFlag)&&(b=this.flags,this.flags|=a.ui.Element.mouseInFlag,this.flags&a.ui.Element.trackingMouseDownFlag?this.flags|=a.ui.Element.pressedFlag:(this.flags|=a.ui.Element.highlightedFlag,!this.focusSound||!a.audio||b&a.ui.Element.highlightedFlag||a.audio.playSound(this.focusSound)),
this.checkFlagsChanged(b))};a.ui.Element.prototype.mouseLeave=function(b){0!==(this.flags&a.ui.Element.enabledFlag)&&(b=this.flags,this.flags&=~a.ui.Element.mouseInFlag,0===(this.flags&a.ui.Element.trackingMouseDownFlag)&&(this.flags&=~a.ui.Element.highlightedFlag),this.flags&=~a.ui.Element.pressedFlag,this.checkFlagsChanged(b))};a.ui.Element.prototype.mouseDown=function(b,d){if(0===(this.flags&a.ui.Element.enabledFlag)||0===(this.flags&a.ui.Element.tracksMouseFlag))return!1;b=this.flags;this.flags|=
a.ui.Element.trackingMouseDownFlag;this.flags|=a.ui.Element.pressedFlag;this.targetMe(d);this.checkFlagsChanged(b);return!1};a.ui.Element.prototype.mouseUp=function(b,d){if(0===(this.flags&a.ui.Element.enabledFlag))return!1;var c=this.flags;this.flags&=~a.ui.Element.trackingMouseDownFlag;this.flags&=~a.ui.Element.pressedFlag;d.isFromTouch&&(this.flags&=~a.ui.Element.highlightedFlag,this.flags&=~a.ui.Element.mouseInFlag);var f=!1;c&a.ui.Element.trackingMouseDownFlag&&(f=this.getLocalBounds(),this.adjustBoundsForPointer(f,
d),a.collision2D.pointInsideRect(b,f)?(f=this.trigger(d))&&a.eventMap.fireEvent("uiTriggered",this):(this.flags&=~a.ui.Element.highlightedFlag,f=!1));this.checkFlagsChanged(c);return f};a.ui.Element.prototype.handleMouseMove=function(b,d,c){if(!this.isVisible())return!1;a.ui.mouseMoveCallCount++;"undefined"===typeof d&&(d=!1);var e=!1,g=this.getBounds(this.tempRect);this.adjustBoundsForPointer(g,c);g=a.collision2D.pointInsideRect(b,g);!d&&g&&0===(this.flags&a.ui.Element.mouseInFlag)&&this.mouseEnter(c);
(d||!g&&this.flags&a.ui.Element.mouseInFlag)&&this.mouseLeave(c);g||0===(this.flags&a.ui.Element.clipFlag)||(d=!0);this.mousePos=b=this.parentToLocalContentPos(b.x,b.y);if(this.mouseMove){var h=this.mouseMove(b,c);h&&(e=!0)}b.x+=this.center.x;b.y+=this.center.y;if(this.subElements)for(g=this.subElements.length-1;0<=g;g--)h=this.subElements[g],h.flags&a.ui.Element.tracksMouseFlag&&(h=h.handleMouseMove(b,d,c))&&(e=!0);if(e)return e};a.ui.Element.prototype.handlePositionalEvent=function(b,d,c,f){if(!this.isVisible())return!1;
var e=this.getBounds(this.tempRect);this.adjustBoundsForPointer(e,d);e=a.collision2D.pointInsideRect(b,e);var h=!1;if(this.subElements&&(e||0===(this.flags&a.ui.Element.clipFlag))){var k=this.parentToLocalContentPos(b.x,b.y);k.x+=this.center.x;k.y+=this.center.y;for(var l=this.subElements.length-1;0<=l;l--)if(c(this.subElements[l],k,d))return!0}e&&!h&&(b=this.parentToLocalPos(b.x,b.y),h=f(this,b,d));return h};a.ui.Element.prototype.handleMouseDown=function(b,d){if(!this.isVisible())return!1;var c=
this.getBounds(this.tempRect);this.adjustBoundsForPointer(c,d);c=a.collision2D.pointInsideRect(b,c);var f=!1;if(c||0===(this.flags&a.ui.Element.clipFlag))f=this.callForSubElementsWithPos(a.ui.Element.prototype.handleMouseDown,b,d);c&&(!f||this.flags&a.ui.Element.handleAllMouseInMe)&&(b=this.parentToLocalPos(b.x,b.y),f=this.mouseDown(b,d));return f};a.ui.Element.prototype.handleMouseUp=function(b,d){if(!this.isVisible||!this.isVisible())return!1;var c=this.parentToLocalPos(b.x,b.y);(c=this.mouseUp(c,
d))||(c=this.callForSubElementsWithPos(a.ui.Element.prototype.handleMouseUp,b,d));return c};a.ui.Element.prototype.handleContextMenu=function(a,d){return this.handlePositionalEvent(a,d,function(a,b,d){return a.handleContextMenu(b,d)},function(a,b,d){return a.contextMenuEvent?a.contextMenuEvent(b,d):!1})};a.ui.Element.prototype.handleMouseWheel=function(a,d){return this.handlePositionalEvent(a,d,function(a,b,d){return a.handleMouseWheel(b,d)},function(a,b,d){return a.mouseWheelEvent?a.mouseWheelEvent(b,
d):!1})};a.ui.Element.prototype.handleKeyDown=function(a){return this.keyDown?this.keyDown(a):!1};a.ui.Element.prototype.handleKeyUp=function(a){return this.keyUp?this.keyUp(a):!1};a.ui.Element.prototype.handleKeyPress=function(a){return this.keyPress?this.keyPress(a):!1};a.ui.Element.prototype.handleButtonDown=function(a){return!1};a.ui.Element.prototype.handleButtonUp=function(a){return!1};a.ui.Element.prototype.handleEvent=function(b){a.ui.mouseMoveCallCount=0;var d=!1;"keydown"===b.eventType?
d=this.handleKeyDown(b):"keyup"===b.eventType?d=this.handleKeyUp(b):"keypress"===b.eventType?d=this.handleKeyPress(b):"mousedown"===b.eventType?d=this.handleMouseDown(b.pos,b):"mouseup"===b.eventType?d=this.handleMouseUp(b.pos,b):"mousemove"===b.eventType?d=this.handleMouseMove(b.pos,!1,b):"contextmenu"===b.eventType?d=this.handleContextMenu(b.pos,b):"mousewheel"===b.eventType?d=this.handleMouseWheel(b.pos,b):"buttondown"===b.eventType?d=this.handleButtonDown(b):"buttonup"===b.eventType?d=this.handleButtonUp(b):
"ui"===b.eventType?d=this.handleUIInput(b):"ui_up"===b.eventType&&(d=this.handleUIUpInput(b));if(d)return d;this.parent&&(d=this.parent.handleEvent(b));return d};a.ui.Element.prototype.handleUIInput=function(a){return!1};a.ui.Element.prototype.handleUIUpInput=function(a){return!1};a.ui.Element.prototype.targetMe=function(a){if(this.isTargetable()&&this.isEnabled()&&this.isVisible()){for(var b=this;b.parent&&!b.inputMap;)b=b.parent;if(b.setCurrentTarget)return b.setCurrentTarget(this,a),!0}return!1};
a.ui.Element.prototype.focus=function(b){if(this.isTargetable()&&this.isEnabled()&&this.isVisible()){var d=this.isHighlighted();this.setHighlighted(!0);if(!d&&this.events.onFocus)this.events.onFocus(this);!d&&!b&&this.focusSound&&a.audio&&a.audio.playSound(this.focusSound);this.setTargeted(!0);return!0}return!1};a.ui.Element.prototype.blur=function(){if(this.isTargetable()&&this.isEnabled()&&this.isVisible()){var a=this.isHighlighted();this.setHighlighted(!1);if(a&&this.events.onBlur)this.events.onBlur(this);
this.setTargeted(!1)}return!0};a.ui.Element.prototype.press=function(b){this.trigger(b)&&a.eventMap.fireEvent("uiTriggered",this)};a.ui.Element.prototype.trigger=function(b){var d=a.telemetry,c=this.telemetryName||this.name,f=!1;0!==this.command&&(d&&c&&d.recordUI("UI com",c),a.dispatchCommand(this.command,this.commandInfo)&&(f=!0));this.callback&&(d&&c&&d.recordUI("UI cb",c),(b=this.callback(this,this.callbackInfo,b))||void 0===b)&&(f=!0);f&&this.clickSound&&a.audio&&a.audio.playSound(this.clickSound);
return f};a.ui.Element.prototype.setCommand=function(a,d){this.command=a;this.commandInfo=d};a.ui.Element.prototype.setCallback=function(a,d){this.callback=a;"undefined"!==typeof d&&(this.callbackInfo=d)};a.ui.Element.prototype.setFlagsChangedCallback=function(a,d){this.flagsChangedCallback=a;"undefined"!==typeof d&&(this.callbackInfo=d)};a.ui.Element.prototype.setCallbackInfo=function(a){this.callbackInfo=a};a.ui.Element.prototype.setFlag=function(a,d){var b=this.flags;"undefined"===typeof d&&(d=
!0);this.flags=d?this.flags|a:this.flags&~a;this.checkFlagsChanged(b)};a.ui.Element.prototype.clearFlag=function(a){this.setFlag(a,!1)};a.ui.Element.prototype.clearAfterLoadFlags=function(){this.setFlag(a.ui.Element.autoScaleAfterLoadFlag|a.ui.Element.autoSizeAfterLoadFlag|a.ui.Element.autoCenterAfterLoadFlag,!1)};a.ui.Element.prototype.setVisible=function(b){this.setFlag(a.ui.Element.visibleFlag,b)};a.ui.Element.prototype.isVisible=function(){return 0!==(this.flags&a.ui.Element.visibleFlag)};a.ui.Element.prototype.setHighlighted=
function(b){this.setFlag(a.ui.Element.highlightedFlag,b)};a.ui.Element.prototype.isHighlighted=function(b){return 0!==(this.flags&a.ui.Element.highlightedFlag)};a.ui.Element.prototype.setEnabled=function(b){var d=this.flags;"undefined"===typeof b&&(b=!0);b?this.flags|=a.ui.Element.enabledFlag:(this.flags&=~a.ui.Element.enabledFlag,this.flags&=~a.ui.Element.highlightedFlag,this.flags&=~a.ui.Element.pressedFlag,this.flags&=~a.ui.Element.mouseInFlag,this.flags&=~a.ui.Element.trackingMouseDownFlag);this.checkFlagsChanged(d)};
a.ui.Element.prototype.isEnabled=function(){return 0!==(this.flags&a.ui.Element.enabledFlag)};a.ui.Element.prototype.setToggled=function(b){this.setFlag(a.ui.Element.toggledFlag,b)};a.ui.Element.prototype.isToggled=function(){return 0!==(this.flags&a.ui.Element.toggledFlag)};a.ui.Element.prototype.setClipped=function(b){this.setFlag(a.ui.Element.clipFlag,b)};a.ui.Element.prototype.setClip=a.ui.Element.prototype.setClipped;a.ui.Element.prototype.isClipped=function(b){return 0!==(this.flags&a.ui.Element.clipFlag)};
a.ui.Element.prototype.isPressed=function(){return 0!==(this.flags&a.ui.Element.pressedFlag)};a.ui.Element.prototype.setTracksMouse=function(b){this.setFlag(a.ui.Element.tracksMouseFlag,b)};a.ui.Element.prototype.isTargetable=function(){return 0!==(this.flags&a.ui.Element.targetableFlag)};a.ui.Element.prototype.setTargetable=function(b){this.setFlag(a.ui.Element.targetableFlag,b)};a.ui.Element.prototype.canBeTarget=a.ui.Element.prototype.isTargetable;a.ui.Element.prototype.isTargeted=function(){return 0!==
(this.flags&a.ui.Element.targetedFlag)};a.ui.Element.prototype.setTargeted=function(b){this.setFlag(a.ui.Element.targetedFlag,b)};a.ui.Element.prototype.setAdjustForScale=function(b){this.setFlag(a.ui.Element.adjustForScaleFlag,b)};a.ui.Element.prototype.scroll=function(a,d){this.contentOffset.x+=a;this.contentOffset.y+=d;this.viewChanged&&this.viewChanged()};a.ui.Element.prototype.setContentOffset=function(a,d){void 0!==a&&(this.contentOffset.x=a);void 0!==d&&(this.contentOffset.y=d);this.viewChanged&&
this.viewChanged()};a.ui.Element.prototype.getContentOffset=function(){return this.contentOffset.copy()};a.ui.Element.prototype.getScroll=a.ui.Element.prototype.getContentOffset;a.ui.Element.prototype.getTargetContentOffset=function(){var b=a.ui.getAnimatorsForElement(this,a.ui.Animator.scroller);return b&&0<b.length?b[0].endValue:this.contentOffset.copy()};a.ui.Element.prototype.pointIsInView=function(a,d,c){d||(d=0);c||(c=0);var b=this.contentOffset,e=this.contentScale;return 0>(a.x-d)*e.x+b.x||
0>(a.y-c)*e.y+b.y||(a.x+d)*e.x+b.x>this.size.x||(a.y+c)*e.y+b.y>this.size.y?!1:!0};a.ui.Element.prototype.scrollToShow=function(a,d,c,f){f||(f=this.contentOffset);var b=this.contentScale,e=this.size.x-(a.x+d)*b.x;d=-(a.x-d)*b.x;f.x>e?f.x=e:f.x<d&&(f.x=d);e=this.size.y-(a.y+c)*b.y;a=-(a.y-c)*b.y;f.y>e?f.y=e:f.y<a&&(f.y=a);this.clampScroll(f)};a.ui.Element.prototype.animateScrollToShow=function(a,d,c,f){var b=this.contentOffset.copy();this.scrollToShow(a,d,c,b);this.animateScroll(b,f)};a.ui.Element.prototype.animateScrollToShowElement=
function(a,c,e,f){"undefined"===typeof c&&(c=0);"undefined"===typeof e&&(e=0);"undefined"===typeof f&&(f=0);a=a.getBounds(this.tempRect);this.animateScrollToShow({x:a.x+a.w/2,y:a.y+a.h/2},a.w/2+c,a.h/2+e,f)};a.ui.Element.prototype.scrollToCenter=function(a,c){c||(c=this.contentOffset);c.x=this.size.x/2-a.x*this.contentScale.x;c.y=this.size.y/2-a.y*this.contentScale.y;this.clampScroll(c);this.viewChanged&&this.viewChanged()};a.ui.Element.prototype.animateScrollToCenter=function(a,c){var b=this.contentOffset.copy();
this.scrollToCenter(a,b);this.animateScroll(b,c)};a.ui.Element.prototype.scrollToCenterContent=function(a){a||(a=this.contentOffset);a.x=this.size.x/2-this.contentSize.x/2*this.contentScale.x;a.y=this.size.y/2-this.contentSize.y/2*this.contentScale.y};a.ui.Element.prototype.animateScroll=function(b,c){var d=a.ui.killAnimatorsForElement(this,a.ui.Animator.scroller),f=new a.ui.Animator(a.ui.Animator.scroller,this);f.setTimer(c);f.setStartEndVectors({x:this.contentOffset.x,y:this.contentOffset.y},{x:b.x,
y:b.y});f.setAutoDie();d&&f.setInterpFilter(a.ui.Animator.filterEaseOut)};a.ui.Element.prototype.clampScroll=function(a){a||(a=this.contentOffset);if(!(0>=this.contentSize.x||0>=this.contentSize.y)){var b=-(this.contentSize.x*this.contentScale.x-this.size.x),c=-(this.contentSize.y*this.contentScale.y-this.size.y);a.x<b&&(a.x=b);a.y<c&&(a.y=c);0<a.x&&(a.x=0);0<a.y&&(a.y=0)}};a.ui.Element.prototype.setContentScale=function(a,c){void 0!==a&&(this.contentScale.x=a);void 0!==c&&(this.contentScale.y=c);
this.setDirty(!0);this.viewChanged&&this.viewChanged()};a.ui.Element.prototype.stepZoom=function(a){this.contentScale.x+=a;this.contentScale.y+=a;this.clampContentScale();this.setDirty(!0);this.viewChanged&&this.viewChanged()};a.ui.Element.prototype.clampContentScale=function(){this.contentScale.x=(100*(this.contentScale.x+.001)|0)/100;this.contentScale.y=(100*(this.contentScale.y+.001)|0)/100;this.contentScale.x<this.contentScaleMin.x&&(this.contentScale.x=this.contentScaleMin.x);this.contentScale.y<
this.contentScaleMin.y&&(this.contentScale.y=this.contentScaleMin.y);this.contentScale.x>this.contentScaleMax.x&&(this.contentScale.x=this.contentScaleMax.x);this.contentScale.y>this.contentScaleMax.y&&(this.contentScale.y=this.contentScaleMax.y)};a.ui.Element.prototype.setContentScaleLimits=function(a,c){this.contentScaleMin.x=this.contentScaleMin.y=a;this.contentScaleMax.x=this.contentScaleMax.y=c};a.ui.Element.prototype.drawTiled=function(a,c){};a.ui.Element.prototype.setContextID=function(a){this.contextID=
a};a.ui.Element.prototype.draw=function(b){if(this.isVisible()){void 0===b&&(b=!1);if(this.preDraw&&(res=this.preDraw(b))&&res.abortDraw)return;this.useOffscreen&&(!this.offscreen||this.isDirty||this.checkDirty&&this.checkDirty())&&this.renderOffscreen();var c=a.graphics.getContext(this.contextID);b||(a.graphics.save(),this.applyTransformation?this.applyTransformation(c):(a.graphics.translate(this.place.pos.x,this.place.pos.y),this.place.rot.angle&&a.graphics.rotate(this.place.rot.angle),1===this.scale.x&&
1===this.scale.y||a.graphics.scale(this.scale.x,this.scale.y)),a.graphics.frameStats.totalElementsDrawn++,1>this.opacity&&(c.globalAlpha=this.opacity));var e;this.flags&a.ui.Element.unSmoothFlag&&(e=a.graphics.setImageSmoothing(!1));0<this.frameWidth&&(c.strokeStyle=this.frameColor.toString(),c.lineWidth=this.frameWidth,c.strokeRect(-this.center.x-this.frameOutset,-this.center.y-this.frameOutset,this.size.x+2*this.frameOutset,this.size.y+2*this.frameOutset));!b&&this.flags&a.ui.Element.clipFlag&&
(c.beginPath(),c.rect(0,0,this.size.x,this.size.y),c.clip());if(!b&&this.useOffscreen&&this.offscreen)this.offscreen.render(c,-this.center.x,-this.center.y);else{this.events.beforeDraw&&this.events.beforeDraw(this,c);this.drawSelfPre&&this.drawSelfPre(this,c);this.drawSelf(c);if(this.events.onDrawSelf)this.events.onDrawSelf(this,c);if(this.subElements){var f=this.contentOffset.x,g=this.contentOffset.y;this.ignoreCenter||(f-=this.center.x,g-=this.center.y);0===f&&0===g||a.graphics.translate(f,g);1===
this.contentScale.x&&1===this.contentScale.y||a.graphics.scale(this.contentScale.x,this.contentScale.y);if(this.events.onPreDrawChildren)this.events.onPreDrawChildren(this,c);this.drawSubElements();if(this.events.onDrawChildren)this.events.onDrawChildren(this,c);1===this.contentScale.x&&1===this.contentScale.y||a.graphics.scale(1/this.contentScale.x,1/this.contentScale.y);0===f&&0===g||a.graphics.translate(-f,-g)}this.drawSelfPost&&this.drawSelfPost(this,c);this.events.afterDraw&&this.events.afterDraw(this,
c)}this.flags&a.ui.Element.unSmoothFlag&&a.graphics.setImageSmoothing(e);a.graphics.doneWithContext(this.contextID);this.postDraw&&this.postDraw(b,c);b||a.graphics.restore()}};a.ui.Element.prototype.drawSelf=function(a){};a.ui.Element.prototype.drawSubElements=function(){if(this.subElements){var b=this.tempRect;b.x=-this.contentOffset.x;b.y=-this.contentOffset.y;b.w=this.size.x/this.contentScale.x;b.h=this.size.y/this.contentScale.y;for(var c=0;c<this.subElements.length;c++){var e=this.subElements[c];
if(e.flags&a.ui.Element.visibleFlag){var f=!0;if(0!==(this.flags&a.ui.Element.clipFlag)&&0===e.place.rot.angle){var g=e.getBounds(this.tempRect);a.collision2D.rectOverlapsRect(g,b)||(f=!1)}f&&e.draw()}}}};a.ui.Element.prototype.makeBackground=function(b){var c=new a.ui.Shape(a.ui.squareShape);c.setColor(b);this.insertSubElement(c);c.autoSizeToParent();return this.elementBackground=c};a.ui.Element.prototype.setBackground=a.ui.Element.prototype.makeBackground;a.ui.Element.prototype.setBackgroundFrame=
function(a,c){this.elementBackground&&this.elementBackground.setFrame(a,c)};a.ui.Element.prototype.boundsChanged=function(){this.toolTip&&this.positionToolTip(this.toolTipPlacement,this.toolTipPlacementOffset,this.toolTipPlacementFromMouse);this.setDirty(!0)};a.ui.Element.prototype.flagsChanged=function(a){};a.ui.Element.prototype.checkFlagsChanged=function(a){a!==this.flags&&(this.flagsChanged(a),0!==((a^this.flags)&this.flagsThatDirtyMe)&&this.setDirty(!0),0!==((a^this.flags)&this.flagsThatDirtyParent)&&
this.parent&&this.parent.setDirty(!0,!0),this.flagsChangedCallback&&this.flagsChangedCallback(a,this.callbackInfo))};a.ui.Element.prototype.frameAllRandom=function(){this.applyRecursively(a.ui.Element.prototype.setFrameRandom,1)};var c=["before_","on_","after_"];a.ui.Element.prototype.fireCustomTrigger=function(a,d){for(var b,f=0;f!==c.length&&(b=c[f]+a,!this[b]||(b=this[b](this,a,d),void 0===b||b));++f);};a.ui.Element.prototype.setUseOffscreen=function(b){a.ui.allowOffscreens&&(this.useOffscreen!==
b&&this.setDirty(!0),this.useOffscreen=b)};a.ui.Element.prototype.setDirty=function(a,c){if(this.isVisible()||c)void 0===a&&(a=!0),(this.isDirty=a)&&this.parent&&this.parent.setDirty(!0,c)};a.ui.Element.prototype.setDirtyRecursive=function(a){this.setDirty(a);this.applyRecursively(function(a){this.isDirty=a},a)};a.ui.Element.prototype.renderOffscreen=function(){var b=this.size.x,c=this.size.y;this.offscreenSize&&(b=this.offscreenSize.x||b,c=this.offscreenSize.y||c);if(this.offscreen){var e=this.offscreen;
e.setSize(b,c,!0)}else this.offscreen=e=new a.Offscreen(b,c);b=e.getContext();c=a.graphics.getContext();a.graphics.setContext(b);this.useOffscreen=!1;this.ignoreCenter=!0;this.draw(!0);a.ui.debugOffscreens&&e.applyDebugOverlay();this.ignoreCenter=!1;this.useOffscreen=!0;a.graphics.setContext(c);this.isDirty=!1;this.applyRecursively(function(a){this.isDirty=!1})};a.ui.Element.editProperties=[{label:"basic",props:[{propName:"type",type:"string"},{propName:"id",type:"string"},{propName:"name",type:"string"}]},
{label:"location",props:[{label:"pos",propName:"bounds",type:"xyvector",valueType:"float"},{label:"size",propName:"bounds",type:"whvector",valueType:"float"},{propName:"autoCenter",type:"boolean",tipText:"anchor from center"},{propName:"rotation",type:"float",tipText:"rotation around anchor, in radians"}]},{label:"appearance",defaultClosed:!0,props:[{propName:"color",type:"color",tipText:"content color, used depending on type"},{propName:"frameSize",type:"float"},{propName:"frameColor",type:"color"},
{propName:"frameOutset",type:"float",tipText:"expand or shrink frame (in pixels)"}]},{label:"flags",defaultClosed:!0,props:[{propName:"visible",type:"boolean"},{propName:"enabled",type:"boolean"},{propName:"toggled",type:"boolean"},{propName:"clip",type:"boolean"},{propName:"autoSizeAfterLoad",type:"boolean"},{propName:"autoScaleAfterLoad",type:"boolean"},{propName:"unSmooth",type:"boolean"},{propName:"drawTiled",type:"boolean"},{propName:"useOffscreen",type:"boolean"}]}];a.ui.Element.setupFromData=
function(b,c,e){b.setBounds(a.ui.data.calcBounds(c,e));void 0===c.rotation&&void 0===c.rot||b.setRotation(c.rotation||c.rot);void 0!==c.autoCenter&&b.autoCenter(c.autoCenter);c.frame&&b.setFrame(c.frame.size,a.graphics.fixColorStyle(c.frame.color),c.frame.outset);void 0!==c.frameSize&&b.setFrame(c.frameSize,a.graphics.fixColorStyle(c.frameColor),c.frameOutset);void 0!==c.id&&b.setID(c.id);c.color&&b.setColor(new a.graphics.Color(c.color));void 0!==c.visible&&b.setVisible(!!c.visible);void 0!==c.highlighted&&
b.setHighlighted(!!c.highlighted);void 0!==c.enabled&&b.setEnabled(!!c.enabled);void 0!==c.toggled&&b.setToggled(!!c.toggled);void 0!==c.clip&&b.setClip(!!c.clip);void 0!==c.autoSizeAfterLoad&&b.setFlag(a.ui.Element.autoSizeAfterLoadFlag,!!c.autoSizeAfterLoad);void 0!==c.autoScaleAfterLoad&&b.setFlag(a.ui.Element.autoScaleAfterLoadFlag,!!c.autoScaleAfterLoad);void 0!==c.drawTiled&&b.setFlag(a.ui.Element.drawTiledFlag,!!c.drawTiled);void 0!==c.unSmooth&&b.setFlag(a.ui.Element.unSmoothFlag,!!c.unSmooth);
c.contentSize&&c.contentSize.x&&b.setContentSize(c.contentSize.x,c.contentSize.y);c.contentOffset&&b.setContentOffset(c.contentOffset.x,c.contentOffset.y);c.contentScale&&b.setContentScale(c.contentScale.x,c.contentScale.y);c.callback&&b.setCallback(c.callback,c.callbackInfo);c.onFocus&&(b.events.onFocus=c.onFocus);c.onBlur&&(b.events.onBlur=c.onBlur);c.beforeDraw&&(b.events.beforeDraw=c.beforeDraw);c.onDrawSelf&&(b.events.onDrawSelf=c.onDrawSelf);c.onPreDrawChildren&&(b.events.onPreDrawChildren=
c.onPreDrawChildren);c.onDrawChildren&&(b.events.onDrawChildren=c.onDrawChildren);c.afterDraw&&(b.events.afterDraw=c.afterDraw);void 0!==c.useOffscreen&&b.setUseOffscreen(c.useOffscreen)}});
rat.modules.add("rat.ui.r_screen",[{name:"rat.utils.r_utils",processBefore:!0},{name:"rat.ui.r_ui",processBefore:!0},{name:"rat.graphics.r_graphics",processBefore:!0},"rat.ui.r_ui_shape","rat.ui.r_screenmanager","rat.input.r_input","rat.input.r_inputmap"],function(a){function c(){if(this.isTargetable()&&this.isEnabled()&&this.isVisible()){var a={globalPos:this.getGlobalPos(),rect:this.getBounds(this.tempRect),el:this};a.pos={x:a.globalPos.x+a.rect.w/2,y:a.globalPos.y+a.rect.h/2};e.push(a)}}function b(a,
b,c,d,l,m){var f=0,g=-1;d=1/d;for(var h=0;h!==e.length;++h)if(!c||h!==a){var k=e[h].pos,q=k.x-b.x;k=k.y-b.y;var t=(0>k?-k:k)*d,v=(0>q?-k:q)*d;if("right"===l&&0<q&&q>t||"left"===l&&0>q&&-q>t||"down"===l&&0<k&&k>v||"up"===l&&0>k&&-k>v)if("right"===l||"left"===l?q/=m:k/=m,q=q*q+k*k,0>g||q<f)g=h,f=q}return g}function d(a,c,d,k,l,m,n,p){var f=b(a,c,!0,k,d,l);0>f&&(m||n)&&(c={x:c.x,y:c.y},"right"===d&&m&&(c.x-=p.size.x),"left"===d&&m&&(c.x+=p.size.x),"down"===d&&n&&(c.y-=p.size.y),"up"===d&&n&&(c.y+=p.size.y),
f=b(a,c,!1,k,d,l));return 0<=f?e[f].el:null}a.ui.Screen=function(b){a.ui.Screen.prototype.parentConstructor.call(this);this.setBounds(0,0,a.graphics.SCREEN_WIDTH,a.graphics.SCREEN_HEIGHT);this.name="<screen>"+this.id};a.utils.inheritClassFrom(a.ui.Screen,a.ui.Element);a.ui.Screen.prototype.modal=!1;a.ui.Screen.prototype.inputMap=null;a.ui.Screen.prototype.targets=null;a.ui.Screen.prototype.allowClickAway=!1;a.ui.Screen.prototype.allowClickBodyClose=!1;a.ui.Screen.prototype.allowBackClose=!1;a.ui.Screen.prototype.userCloseCallback=
null;a.ui.Screen.prototype.closeSound=null;a.ui.Screen.prototype.isDeactivated=!0;a.ui.Screen.prototype.isOverlay=!0;a.ui.Screen.prototype.isSuspended=!0;a.ui.Screen.prototype.savedTarget=void 0;a.ui.Screen.prototype.elementType="screen";a.utils.addProp(a.ui.Screen.prototype,"fullOpaque",function(a){this.setOverlay(!a)},function(){return!this.isOverlay});a.ui.Screen.prototype.destroy=function(){};a.ui.Screen.prototype.setOverlay=function(a){this.isOverlay=a};a.ui.Screen.prototype.deactivate=function(a){a=
!0===a?{allowOnlySuspend:!0}:a||{};this.isSuspended||(this.isSuspended=!0,this.screenSuspend&&this.screenSuspend());a.allowOnlySuspend&&this.screenSuspend||this.isDeactivated||(this.isDeactivated=!0,this.screenDeactivate&&this.screenDeactivate())};a.ui.Screen.prototype.activate=function(){this.isDeactivated&&(this.isDeactivated=!1,this.screenActivate&&this.screenActivate());this.isSuspended&&(this.isSuspended=!1,this.screenResume&&this.screenResume())};a.ui.Screen.prototype.setModal=function(a){this.modal=
a};a.ui.Screen.prototype.isModal=function(){return this.modal};a.ui.Screen.prototype.setAllowClickAway=function(a,b){this.allowClickAway=a;b&&(this.userCloseCallback=b)};a.ui.Screen.prototype.setAllowClickBodyClose=function(a,b){this.allowClickBodyClose=a;b&&(this.userCloseCallback=b)};a.ui.Screen.prototype.setAllowBackClose=function(a,b){this.allowBackClose=a;b&&(this.userCloseCallback=b)};a.ui.Screen.prototype.expandToDisplay=function(){this.setPos(0,0);this.setSize(a.graphics.SCREEN_WIDTH,a.graphics.SCREEN_HEIGHT)};
a.ui.Screen.prototype.centerInDisplay=function(){var b=this.getSize();this.setPos(Math.floor((a.graphics.SCREEN_WIDTH-b.w)/2),Math.floor((a.graphics.SCREEN_HEIGHT-b.h)/2))};a.ui.Screen.prototype.centerHighInDisplay=function(){var b=this.getSize();this.setPos(Math.floor((a.graphics.SCREEN_WIDTH-b.w)/2),Math.floor((a.graphics.SCREEN_HEIGHT-b.h)/3))};a.ui.Screen.prototype.limitToSafeArea=function(b){void 0===b&&(b=.03*a.graphics.SCREEN_WIDTH|0);var c=a.graphics.SCREEN_WIDTH,d=a.graphics.SCREEN_HEIGHT,
e=this.place.pos,f=this.getSize();e.x<b&&(e.x=b);e.y<b&&(e.y=b);e.x+f.w>c-b&&(e.x=c-b-f.w);e.y+f.h>d-b&&(e.y=d-b-f.h);this.boundsChanged()};a.ui.Screen.prototype.setCurrentTarget=function(a,b){null===a?this.clearCurrentTarget():this.inputMap?this.inputMap.focusByButton(a,!0):(this.targets||(this.targets=[]),(b=this.targets[0])&&b!==a&&(b.Blur?b.Blur():b.blur&&b.blur()),(this.targets[0]=a)&&a!==b&&a.focus())};a.ui.Screen.prototype.clearCurrentTarget=function(a){this.inputMap?this.inputMap.unFocusCurrent():
this.targets=null};a.ui.Screen.prototype.getCurrentTarget=function(a){a=a||0;return this.inputMap?this.inputMap.getTarget():this.targets&&this.targets[a]?this.targets[a]:null};a.ui.Screen.prototype.saveCurrentTarget=function(){this.inputMap&&(this.savedTarget=this.inputMap.getCurrentFocusedButton())};a.ui.Screen.prototype.restoreSavedTarget=function(){this.inputMap&&this.savedTarget&&this.inputMap.focusByButton(this.savedTarget,!0)};a.ui.Screen.prototype.handleUserClose=function(b,c){var d=this.closeSound||
this.clickAwaySound;d&&a.audio&&a.audio.playSound(d);if(this.userCloseCallback&&(b=this.userCloseCallback.call(this,b,c),void 0!==b&&!1===b))return;a.screenManager.popScreen()};a.ui.Screen.prototype.handleUIInput=function(a){var b;if(b=this.inputMap&&"ui"===a.eventType)b=a.which,b="up"===b||"down"===b||"left"===b||"right"===b||"enter"===b?!0:!1;return b?("enter"===a.which&&(a.which="select"),this.inputMap.handleDirection(a.which,a)):"back"===a.which&&this.allowBackClose?(this.handleUserClose("back",
a),!0):!1};a.ui.Screen.prototype.handleKeyDown=function(b){return b.which===a.keys.tab&&this.inputMap?this.inputMap.handleTab(b):a.ui.Screen.prototype.parentPrototype.handleKeyDown.call(this,b)};var e;a.ui.Screen.prototype.autoBuildInputMap=function(b,g,h,k){this.inputMap=null;if(!this.subElements)return null;void 0===b&&(b=!0);void 0===g&&(g=!0);void 0===h&&(h=1);void 0===k&&(k=2);e=[];this.applyRecursively(c,e);if(0>=e.length)return null;for(var f=[],m=0;m<e.length;m++){var n=e[m],p={currObj:n.el},
r=n.pos;p.up=d(m,r,"up",h,k,b,g,this);p.down=d(m,r,"down",h,k,b,g,this);p.left=d(m,r,"left",h,k,b,g,this);p.right=d(m,r,"right",h,k,b,g,this);f.push(p);n.mapEntry=p}b=-1;!a.input.useLastUIInputType||"keyboard"!==a.input.lastUIInputType&&"controller"!==a.input.lastUIInputType||(b=0);e.sort(function(a,b){return a.pos.y<b.pos.y?-1:a.pos.y>b.pos.y?1:a.pos.x<b.pos.x?-1:1});for(m=0;m<e.length;m++)e[m].mapEntry.tabOrder=m;this.inputMap=new a.InputMap(f,b);e=void 0;return this.inputMap}});
rat.modules.add("rat.ui.r_screenmanager",[{name:"rat.os.r_events",processBefore:!0},{name:"rat.input.r_input",processBefore:!0},"rat.debug.r_console","rat.debug.r_profiler","rat.graphics.r_graphics","rat.ui.r_screen","rat.ui.r_ui_textbox","rat.ui.r_ui_button","rat.utils.r_collision2d","rat.utils.r_shapes","rat.math.r_math"],function(a){a.OK_COMMAND=-100;a.CANCEL_COMMAND=-99;a.screenManager={screenStack:[],regScreens:{},setUIRoot:function(c){a.screenManager.popAllScreens();c&&a.screenManager.pushScreen(c)},
getTopScreen:function(){return 0<a.screenManager.screenStack.length?a.screenManager.screenStack[a.screenManager.screenStack.length-1]:null},pushScreen:function(c){if(c){var b=a.screenManager.getTopScreen();b&&b.saveCurrentTarget();if(!c.isOverlay)for(var d,e=a.screenManager.screenStack.length-1;0<=e;--e){d=a.screenManager.screenStack[e];if(d.isSuspended)break;d.deactivate({allowOnlySuspend:!0})}else if(c.isModal())for(e=a.screenManager.screenStack.length-1;0<=e;--e)d=a.screenManager.screenStack[e],
d.applyRecursively(function(a){this.toolTip&&(this.toolTip.timer=0);this.mouseLeave()});a.screenManager.screenStack.push(c);c.activate();c.movedToForeground&&c.movedToForeground();b&&b.movedToBackground&&b.movedToBackground()}},insertScreen:function(c){a.screenManager.screenStack.length?(c.deactivate({allowOnlySuspend:!0}),a.screenManager.screenStack.unshift(c)):a.screenManager.pushScreen(c)},removeScreen:function(c){for(var b=0;b<a.screenManager.screenStack.length;++b)if(a.screenManager.screenStack[b].id===
c.id)return b===a.screenManager.screenStack.length-1?a.screenManager.popScreen():a.screenManager.removeScreenAtIndex(b)},getScreenIndex:function(c){for(var b=0;b<a.screenManager.screenStack.length;++b)if(a.screenManager.screenStack[b].id===c.id)return b;return-1},isTopScreen:function(c){return 1>a.screenManager.screenStack.length?!1:a.screenManager.screenStack[a.screenManager.screenStack.length-1].id===c.id?!0:!1},removeScreenAtIndex:function(c){if(!(0>c||c>=a.screenManager.screenStack.length)){var b=
a.screenManager.screenStack[c];a.screenManager.screenStack.splice(c,1);b.deactivate();b.destroy();return b}},popScreen:function(){for(var c=a.screenManager.removeScreenAtIndex(a.screenManager.screenStack.length-1),b,d=a.screenManager.screenStack.length-1;0<=d;--d)if(b=a.screenManager.screenStack[d])if(b.activate(),!b.isOverlay)break;b=a.screenManager.getTopScreen();!b||"controller"!==a.input.lastUIInputType&&"keyboard"!==a.input.lastUIInputType||b.restoreSavedTarget();b&&b.movedToForeground&&b.movedToForeground();
return c},popAllScreens:function(){for(var c=a.screenManager.screenStack.length-1;0<=c;--c)a.screenManager.screenStack[c].deactivate(),a.screenManager.screenStack[c].destroy();a.screenManager.screenStack=[]},registerScreen:function(c,b){a.screenManager.regScreens[c]={creator:b}},setTooltipContextID:function(c){a.screenManager.tooltipContextID=c},switchToScreen:function(c,b,d){d=d||[];var e=a.screenManager.regScreens[c];if(!e)return a.console.logError("ERROR: no such registered screen: "+c),null;d=
e.creator.apply(void 0,d);if(!d)return a.console.logError("Error: screen creator failed "+c),null;d._screenTag=c;b||a.screenManager.popScreen();a.screenManager.pushScreen(d);return d},doConfirmDialog:function(c){var b=c.width,d=c.height;"undefined"===typeof b&&(b=420);"undefined"===typeof d&&(d=200);"undefined"===typeof c.title&&(c.title="");"undefined"===typeof c.body&&(c.body="");"undefined"===typeof c.yesText&&(c.yesText="Yes");"undefined"===typeof c.yesCommand&&(c.yesCommand=a.OK_COMMAND);"undefined"===
typeof c.noText&&(c.noText="");"undefined"===typeof c.noCommand&&(c.noCommand=a.CANCEL_COMMAND);"undefined"===typeof c.userData&&(c.userData=null);c.bgColor||(c.bgColor={r:80,g:80,b:80});c.frameColor||(c.frameColor={r:120,g:120,b:120});c.pos||(c.pos={x:a.graphics.SCREEN_WIDTH/2-b,y:a.graphics.SCREEN_WIDTH/3-d/2});c.titleFont||(c.titleFont=c.font);c.bodyFont||(c.bodyFont=c.font);c.buttonFont||(c.buttonFont=c.font);c.titleFont||(c.titleFont={font:"Impact",size:14});c.bodyFont||(c.titleFont={font:"Arial",
size:12});var e=new a.ui.Screen;e.setModal(!0);e.setPos(c.pos.x,c.pos.y);e.setSize(b,d);e.setBackground(new a.graphics.Color(c.bgColor.r,c.bgColor.g,c.bgColor.b));e.setFrame(4,new a.graphics.Color(120,120,120));""!==c.title&&(b=new a.ui.TextBox(c.title),b.setFont(c.titleFont.font||c.titleFont),b.setFontSize(c.titleFont.size||14),b.setPos(0,0),b.setSize(e.size.x,14),b.setAlign(a.ui.TextBox.alignCenter),b.setColor(new a.graphics.Color(250,250,220)),e.appendSubElement(b));""!==c.body&&(b=new a.ui.TextBox(c.body),
b.setFont(c.bodyFont.font||c.bodyFont),b.setFontSize(c.bodyFont.size||12),b.setPos(0,40),b.setSize(e.size.x,14),b.setAlign(a.ui.TextBox.alignCenter),b.setColor(new a.graphics.Color(190,190,190)),e.appendSubElement(b));d=2*e.size.y/3-30;""!==c.yesText&&(b=a.ui.makeCheapButton(null,new a.graphics.Color(150,200,150)),b.setTextValue(c.yesText),b.setSize(70,30),b.setPos(50,d),b.setCommand(c.yesCommand,c.userData),e.appendSubElement(b));""!==c.noText&&(b=a.ui.makeCheapButton(null,new a.graphics.Color(150,
200,150)),b.setTextValue(c.noText),b.setSize(70,30),b.setPos(e.size.x-30-70,d),b.setCommand(c.noCommand,c.userData),e.appendSubElement(b));a.screenManager.pushScreen(e);e.handleCommand=function(b,c){a.screenManager.popScreen();return!1};return e},dispatchEvent:function(c){for(var b=!1,d=a.screenManager.screenStack.length-1;0<=d;d--){if(d>a.screenManager.screenStack.length-1)return!0;var e=a.screenManager.screenStack[d];if("undefined"===typeof e){console.log("bogus screen at "+d);return}var f=e.modal;
if(e.isSuspended&&!e.forceScreenActive)break;b=null;"mousedown"!==c.eventType&&"mouseup"!==c.eventType&&"mousemove"!==c.eventType&&"contextmenu"!==c.eventType&&"touchstart"!==c.eventType&&"touchend"!==c.eventType&&"mousewheel"!==c.eventType&&"touchmove"!==c.eventType&&(e.inputMap&&(b=e.inputMap.getTargetForEvent(c)),!b&&e.targets&&(b=e.targets[0]));if(b=b?b.handleEvent(c):e.handleEvent(c))break;if(f){if("mousedown"===c.eventType||"touchstart"===c.eventType){d=a.collision2D.pointInRect(c.pos,e.getBounds());
var g;e.allowClickAway&&!d?g="clickAway":e.allowClickBodyClose&&d&&(g="clickBody");g&&(e.handleUserClose(g,c),b=!0)}break}}return b},updateScreens:function(){a.ui.updateCallCount=0;for(var c,b=a.screenManager.screenStack.length-1;0<=b;--b)if(c=a.screenManager.screenStack[b]){if(c.isSuspended&&!c.forceScreenActive)break;a.profiler.pushPerfMark(c._screenTag||"???");a.screenManager.screenStack[b].update(a.deltaTime);a.profiler.popPerfMark(c._screenTag||"???")}},drawScreens:function(){var c,b=a.screenManager.screenStack;
for(c=0;c<b.length;c++){var d=b[c];if(!d.isSuspended||d.forceScreenActive)a.profiler.pushPerfMark(d._screenTag||"???"),d.draw(),c===b.length-1&&a.screenManager.drawTooltips(d),a.profiler.popPerfMark(d._screenTag||"???")}},drawTooltips:function(c){if(c.activeToolTip&&c.isVisible()){if(a.screenManager.tooltipContextID){var b=a.graphics.getContext(a.screenManager.tooltipContextID);b.clearRect(0,0,a.graphics.SCREEN_WIDTH,a.graphics.SCREEN_HEIGHT);"visible"!==b.canvas.style.visibility&&(b.canvas.style.visibility=
"visible")}else a.graphics.getContext();b=new a.shapes.Rect(0,0,a.graphics.SCREEN_WIDTH-c.activeToolTip.size.x,a.graphics.SCREEN_HEIGHT-c.activeToolTip.size.y);c.activeToolTip.place.pos.limitToRect(b);c.activeToolTip.setVisible(!0);c.activeToolTip.draw();c.activeToolTip=null;a.screenManager.tooltipContextID&&a.graphics.doneWithContext(a.screenManager.tooltipContextID)}else a.screenManager.tooltipContextID&&(c=a.graphics.getContextProperties(a.screenManager.tooltipContextID),"visible"==c.canvas.style.visibility&&
(c.canvas.style.visibility="hidden"))},makeTooltipContext:function(c){if(a.system.has.IEBrowser&&10>=a.system.has.IEVersion)return a.console.logWarning("Warning: we don't currently support tooltipcontext in IE<11"),null;var b=document.createElement("canvas");b.id="tooltip_layer";document.body.appendChild(b);var d=b.getContext("2d");b.width=c.width;b.height=c.height;b.style.position="fixed";b.style.visibility="hidden";b.style["pointer-events"]="none";c={canvas:b,ctx:d};a.graphics.registerContext("tooltip_layer",
c);a.screenManager.setTooltipContextID("tooltip_layer");return c},updateTooltipContext:function(){if(a.screenManager.tooltipContextID){var c=a.graphics.getContextProperties(a.screenManager.tooltipContextID);if(c){var b=a.graphics.canvas;c.canvas.width=b.width;c.canvas.height=b.height;c.canvas.style.left=b.style.left;c.canvas.style.top=b.style.top;c.canvas.style.width=b.style.width;c.canvas.style.height=b.style.height;c.ctx.strokeStyle="#00FFFF";c.ctx.lineWidth=8;c.ctx.strokeRect(0,0,c.canvas.width,
c.canvas.height)}}},onWindowResize:function(){for(var c,b=a.screenManager.screenStack.length-1;0<=b;--b){c=a.screenManager.screenStack[b];if(c.isSuspended&&!c.forceScreenActive)break;if(c.onWindowResize)c.onWindowResize()}},centerAllScreens:function(){for(var c,b=a.screenManager.screenStack.length-1;0<=b;--b)c=a.screenManager.screenStack[b],c.centerInDisplay()}};a.addEventListener("resize",a.screenManager.onWindowResize);a.input.registerEventHandler(a.screenManager.dispatchEvent)});
rat.modules.add("rat.graphics.r_particle",[{name:"rat.math.r_math",processBefore:!0},{name:"rat.math.r_vector",processBefore:!0},"rat.debug.r_console","rat.debug.r_profiler","rat.graphics.r_graphics","rat.graphics.r_image"],function(a){var c=a.math,b=c.randomVariance,d=new a.Vector;a.particle={systems:[],stateCaching:{enabled:!0,minObjectCount:0,createPerFrame:0}};a.particle.System=function(a){this.options=a;this.emitters=[]};a.particle.System.prototype.onRemoveEmitter=void 0;a.particle.System.prototype.onAddEmitter=
void 0;a.particle.System.prototype.emitterConstructor=void 0;a.particle.System.infinite=-1;a.particle.System.statusDead=0;a.particle.System.statusActive=1;a.particle.System.statusAlive=1;a.particle.System.emitTypeUnknown=0;a.particle.System.emitTypeSingle=1;a.particle.System.emitTypeBurst=2;a.particle.System.emitTypeStream=3;a.particle.System.killParticles=!0;a.particle.System.RENDER_UNKNOWN=0;a.particle.System.RENDER_DOT=1;a.particle.System.RENDER_TRIANGLE=2;a.particle.System.RENDER_BOX=3;a.particle.System.RENDER_SPRITE=
4;a.particle.System.RENDER_TEXT=5;a.particle.System.RENDER_CUSTOM=10;a.particle.System.prototype.newEmitter=function(){var b=new (this.emitterConstructor||a.particle.Emitter);this.emitters.push(b);this.options&&this.options.trackBounds&&(b.trackBounds=this.options.trackBounds);if(this.onAddEmitter)this.onAddEmitter(b);return b};a.particle.System.prototype.getEmitterCount=function(){return this.emitters.length};a.particle.System.prototype.killAllEmitters=function(a){void 0===a&&(a=!0);for(var b=this.emitters.length-
1;0<=b;b--)this.emitters[b].die(a)};a.particle.System.prototype.killAllParticles=function(){for(var a=this.emitters.length-1;0<=a;a--)this.emitters[a].killAllParticles()};a.particle.System.prototype.moveEmitterToTop=function(a){for(var b=this.emitters.length-1;0<=b;b--)if(this.emitters[b]===a){this.emitters.splice(b,1);this.emitters.push(a);break}};a.particle.System.prototype.removeEmitter=function(a){for(var b=this.emitters.length-1;0<=b;b--)if(this.emitters[b]===a){if(this.onRemoveEmitter)this.onRemoveEmitter(this.emitters[b]);
this.emitters.splice(b,1);break}};a.particle.System.prototype.appendEmitter=function(a){this.emitters.push(a);if(this.onAddEmitter)this.onAddEmitter(a)};a.particle.System.prototype.update=function(b){a.profiler.pushPerfMark("PSystem:Update");for(var c=this.emitters.length-1;0<=c;c--)if(this.emitters[c].update(b)===a.particle.System.statusDead){this.emitters[c].destroy();if(this.onRemoveEmitter)this.onRemoveEmitter(this.emitters[c]);this.emitters.splice(c,1)}a.profiler.popPerfMark("PSystem:Update")};
a.particle.System.prototype.draw=function(b){a.profiler.pushPerfMark("PSystem:draw");b=b&&b.ctx?b.ctx:a.graphics.getContext();var c=a.graphics.getContext();a.graphics.setContext(b);a.graphics.save({ignoreRatMat:!0});for(var d=0;d<this.emitters.length;d++){var e=this.emitters[d];e.flags&a.particle.Emitter.fVisible&&e.draw(b)}a.graphics.restore();a.graphics.setContext(c);a.profiler.popPerfMark("PSystem:draw")};a.particle.System.prototype.applyBoundsToRectList=function(a){for(var b=0;b<this.emitters.length;b++){var c=
this.emitters[b];c.trackBounds&&0<c.bounds.w&&0<c.bounds.h&&a.add(c.bounds)}};a.particle.System.prototype.applyToDirtyRects=a.particle.System.prototype.applyBoundsToRectList;a.particle.Emitter=function(){this.pos=new a.Vector(100,100);this.angle=new a.Angle;this.startState=a.particle.State.create();this.startVariance=a.particle.State.create();this.asset=[];this.stateSets=[];this.stateSets[0]={state:this.startState,variance:this.startVariance};this.endState=this.startState;this.startState.color.a=
1;this.startState.color.r=255;this.startState.color.g=255;this.startState.color.b=255;this.startState.ageLimit=1;this.prevBounds={x:this.pos.x,y:this.pos.y,w:0,h:0};this.bounds={x:this.pos.x,y:this.pos.y,w:0,h:0};this.trackBounds=!1;this.particles=[]};a.particle.Emitter.fAutoDie=1;a.particle.Emitter.fAutoDieAfterAgeLimit=4;a.particle.Emitter.fRadialStartVelocity=8;a.particle.Emitter.fRadialStartOffset=16;a.particle.Emitter.fEmitting=256;a.particle.Emitter.fEmitImmediately=512;a.particle.Emitter.fVisible=
1024;a.particle.Emitter.fStroke=2048;a.particle.Emitter.fGlobalVelocity=4096;a.particle.Emitter.fGlobalOffset=8192;a.particle.Emitter.fKillParticleAfterAnimation=16384;a.particle.Emitter.prototype.flags=a.particle.Emitter.fEmitting|a.particle.Emitter.fVisible;a.particle.Emitter.prototype.emitType=a.particle.System.emitTypeStream;a.particle.Emitter.prototype.renderType=a.particle.System.RENDER_UNKNOWN;a.particle.Emitter.prototype.rate=10;a.particle.Emitter.prototype.burstCount=1;a.particle.Emitter.prototype.burstAmount=
0;a.particle.Emitter.prototype.emitCounter=0;a.particle.Emitter.prototype.status=a.particle.System.statusActive;a.particle.Emitter.prototype.ageLimit=a.particle.System.infinite;a.particle.Emitter.prototype.age=0;a.particle.Emitter.prototype.font="";a.particle.Emitter.prototype.fontSize=0;a.particle.Emitter.prototype.createEvent=null;a.particle.Emitter.prototype.updateEvent=null;a.particle.Emitter.prototype.deathEvent=null;a.particle.Emitter.prototype.customDraw=null;a.particle.Emitter.prototype.isReadyForUse=
!1;a.particle.Emitter.prototype.setFlag=function(a){this.flags|=a};a.particle.Emitter.prototype.clearFlag=function(a){this.flags&=~a};a.particle.Emitter.prototype.isFlag=function(a){return 0!==(this.flags&a)};a.particle.Emitter.prototype.startEmitting=function(){this.setFlag(a.particle.Emitter.fEmitting)};a.particle.Emitter.prototype.stopEmitting=function(){this.clearFlag(a.particle.Emitter.fEmitting)};a.particle.Emitter.prototype.isEmitting=function(){return this.isFlag(a.particle.Emitter.fEmitting)};
a.particle.Emitter.prototype.killAllParticles=function(){if(a.particle.stateCaching.enabled)for(var b=0,c=this.particles.length;b!==c;b++)this.particles[b].destroy&&this.particles[b].destroy();this.particles=[]};a.particle.Emitter.prototype.die=function(b){this.stopEmitting();this.setFlag(a.particle.Emitter.fAutoDie);b&&this.killAllParticles()};a.particle.Emitter.prototype.setVisible=function(b){b?this.setFlag(a.particle.Emitter.fVisible):this.clearFlag(a.particle.Emitter.fVisible)};a.particle.Emitter.prototype.addState=
function(b,c){var d=this.stateSets[this.stateSets.length-1].state.copy();d.keyTime=b;d.keyFlags=c;b={state:d,variance:a.particle.State.create()};this.stateSets.push(b);return b};a.particle.Emitter.prototype.getInitState=function(){return this.stateSets[0]};a.particle.Emitter.prototype.initEndState=function(a,b){a=this.addState(a,b);this.endState=a.state;this.endVariance=a.variance;return a};a.particle.Emitter.prototype.setupStandardBurst=function(b){this.emitType=a.particle.System.emitTypeBurst;this.rate=
1;this.emitCounter=1/this.rate+1E-4;this.burstCount=1;this.burstAmount=b};a.particle.Emitter.prototype.getParticleCount=function(){return this.particles.length};a.particle.Emitter.prototype.readyForUse=function(){var b;for(b=0;b<this.stateSets.length;b++){var c=this.stateSets[b].state;"undefined"===typeof c.keyTime&&(c.keyTime=b/(this.stateSets.length-1));"undefined"===typeof c.keyFlags&&(c.keyFlags=0);"object"!==typeof c.angle&&(c.angle=new a.Angle(c.angle))}"object"!==typeof this.angle&&(this.angle=
new a.Angle(this.angle));for(b=0;b<this.stateSets.length-1;b++)c=this.stateSets[b].state,c.keyTimeLength=this.stateSets[b+1].state.keyTime-c.keyTime;this.stateSets[this.stateSets.length-1].state.keyTimeLength=0;1===this.stateSets.length&&(this.stateSets[this.stateSets.length-1].state.keyTimeLength=1);this.isFlag(a.particle.Emitter.fEmitImmediately)&&(this.emitCounter=1/this.rate+1E-4);this.isReadyForUse=!0};a.particle.Emitter.prototype.update=function(b){if(this.renderType===a.particle.System.RENDER_UNKNOWN)return a.particle.System.statusDead;
a.profiler.pushPerfMark("Emitter.update");this.isReadyForUse||this.readyForUse();var c;this.trackBounds&&(this.prevBounds=this.bounds,this.bounds={x:this.pos.x,y:this.pos.y,w:0,h:0});if(0<this.rate&&this.isEmitting()&&(this.emitCounter+=b,this.emitCounter>1/this.rate)){a.profiler.pushPerfMark("Emitting");this.emitCounter-=1/this.rate;if(this.emitType===a.particle.System.emitTypeStream)this.spawnNewParticle();else if(this.emitType===a.particle.System.emitTypeBurst&&0<this.burstCount){for(c=0;c<this.burstAmount;c++)this.spawnNewParticle();
this.burstCount--;0>=this.burstCount&&(this.rate=0,this.stopEmitting())}a.profiler.popPerfMark("Emitting")}a.profiler.pushPerfMark("p.update");for(c=this.particles.length-1;0<=c;c--){var d=this.particles[c];d.update(b,this)===a.particle.System.statusDead?(this.deathEvent&&this.deathEvent(this,d),this.particles[c].destroy&&this.particles[c].destroy(),this.particles.splice(c,1)):this.trackBounds&&this.addToBounds(d.state.pos.x-.75*d.state.size,d.state.pos.y-.75*d.state.size,1.5*d.state.size,1.5*d.state.size)}a.profiler.popPerfMark("p.update");
a.profiler.pushPerfMark("statusUpdate");this.age+=b;0<this.ageLimit&&this.age>this.ageLimit&&(this.stopEmitting(),this.flags&a.particle.Emitter.fAutoDieAfterAgeLimit&&(this.flags|=a.particle.Emitter.fAutoDie));if(this.flags&a.particle.Emitter.fAutoDie){if(0>=this.particles.length)var e=a.particle.System.statusDead}else e=a.particle.System.statusActive;a.profiler.popPerfMark("statusUpdate");a.profiler.popPerfMark("Emitter.update");return e};a.particle.Emitter.prototype.destroy=function(){if(this.onDestroy)this.onDestroy(this);
this.killAllParticles();if(a.particle.stateCaching.enabled){for(var b=0,c=this.stateSets.length;b!==c;++b)a.particle.State.destroy(this.stateSets[b].state),a.particle.State.destroy(this.stateSets[b].variance);this.stateSets=[];this.isReadyForUse=!1}};a.particle.Emitter.prototype.spawnNewParticle=function(){function e(e,f,g,h,k){e.x=g.x;e.y=g.y;g=d;f.flags&a.particle.Emitter.fRadialStartOffset?(p=c.random()*c.PI2,g.setFromAngle(p),g.scale(h.offset.x+b(k.offset.x))):(g.x=h.offset.x+b(k.offset.x),g.y=
h.offset.y+b(k.offset.y));f.isFlag(a.particle.Emitter.fGlobalOffset)||(g=f.angle.rotateVector(g));e.x+=g.x;e.y+=g.y}a.profiler.pushPerfMark("spawnNewParticle");var f=new a.particle.One;var g=this.stateSets;a.profiler.pushPerfMark("setupStates");for(var h=0,k=g.length;h!==k;++h){var l=a.particle.State.create();var m=g[h].state;var n=g[h].variance;l.keyTime=m.keyTime;l.keyTimeLength=m.keyTimeLength;l.size=m.size;l.grow=m.grow;l.roll=m.roll;l.friction=m.friction;l.color.r=m.color.r;l.color.g=m.color.g;
l.color.b=m.color.b;l.color.a=m.color.a;e(l.pos,this,m.pos,m,n);n.size&&(l.size+=2*n.size*c.random()-n.size);n.grow&&(l.grow+=2*n.grow*c.random()-n.grow);n.roll&&(l.roll+=2*n.roll*c.random()-n.roll);n.friction&&(l.friction+=2*n.friction*c.random()-n.friction);n.color.r&&(l.color.r+=2*n.color.r*c.random()-n.color.r,l.color.r=0>l.color.r?0:255<l.color.r?255:l.color.r|0);n.color.g&&(l.color.g+=2*n.color.g*c.random()-n.color.g,l.color.g=0>l.color.g?0:255<l.color.g?255:l.color.g|0);n.color.b&&(l.color.b+=
2*n.color.b*c.random()-n.color.b,l.color.b=0>l.color.b?0:255<l.color.b?255:l.color.b|0);n.color.a&&(l.color.a+=2*n.color.a*c.random()-n.color.a,l.color.a=0>l.color.a?0:1<l.color.a?1:l.color.a);f.states[h]=l}a.profiler.popPerfMark("setupStates");a.profiler.pushPerfMark("initialState");f.state.size=f.states[0].size;f.state.grow=f.states[0].grow;f.state.color.a=f.states[0].color.a;f.state.color.r=f.states[0].color.r;f.state.color.g=f.states[0].color.g;f.state.color.b=f.states[0].color.b;f.state.friction=
f.states[0].friction;f.state.roll=f.states[0].roll;e(f.state.pos,this,this.pos,this.startState,this.startVariance);f.state.posCalculated.x=f.state.pos.x;f.state.posCalculated.y=f.state.pos.y;f.state.angle.angle=this.angle.angle;f.state.angle.angle+=this.startState.angle.angle+b(this.startVariance.angle.angle);if(this.flags&a.particle.Emitter.fRadialStartVelocity){var p=c.random()*c.PI2;f.state.vel=new a.Vector;f.state.vel.setFromAngle(p);f.state.vel.scale(this.startState.vel.x+b(this.startVariance.vel.x))}else f.state.vel=
new a.Vector(this.startState.vel.x+b(this.startVariance.vel.x),this.startState.vel.y+b(this.startVariance.vel.y));f.state.accel=new a.Vector(this.startState.accel.x+b(this.startVariance.accel.x),this.startState.accel.y+b(this.startVariance.accel.y));this.isFlag(a.particle.Emitter.fGlobalVelocity)||(f.state.vel=this.angle.rotateVector(f.state.vel));f.ageLimit=this.startState.ageLimit+b(this.startVariance.ageLimit);a.profiler.popPerfMark("initialState");f.asset=null;this.renderType===a.particle.System.RENDER_SPRITE?
(g=this.asset,this.assetSpawnFunction&&(g=this.assetSpawnFunction(this)),Array.isArray(g)&&(g=g[c.random()*g.length|0]),f.setImageAsset(g)):this.renderType===a.particle.System.RENDER_TEXT&&(g=this.asset,Array.isArray(this.asset)&&(g=this.asset[c.random()*this.asset.length|0]),f.text=g);if(this.createEvent&&(a.profiler.pushPerfMark("createEvent"),g=this.createEvent(this,f),a.profiler.popPerfMark("createEvent"),!1===g)){a.profiler.popPerfMark("spawnNewParticle");return}this.trackBounds&&this.addToBounds(f.state.pos.x-
.75*f.state.size,f.state.pos.y-.75*f.state.size,1.5*f.state.size,1.5*f.state.size);this.particles.push(f);a.profiler.popPerfMark("spawnNewParticle");return f};a.particle.Emitter.prototype.addToBounds=function(a,b,c,d){a<this.bounds.x&&(this.bounds.w+=this.bounds.x-a,this.bounds.x=a);b<this.bounds.y&&(this.bounds.h+=this.bounds.y-b,this.bounds.y=b);a+c>this.bounds.x+this.bounds.w&&(this.bounds.w=a+c-this.bounds.x);b+d>this.bounds.y+this.bounds.h&&(this.bounds.h=b+d-this.bounds.y)};a.particle.Emitter.prototype.spawn=
function(a){"undefined"===typeof a&&(a=1);for(var b=0;b<a;b++)this.spawnNewParticle()};a.particle.Emitter.prototype.draw=function(b){a.profiler.pushPerfMark("Emitter.Draw");this.preDraw&&this.preDraw(b,this);var d=!1;this.renderType===a.particle.System.RENDER_TEXT&&(b.textBaseline="middle",b.textAlign="center",this.flags&a.particle.Emitter.fStroke&&(d=!0));a.profiler.pushPerfMark("particle.Draw");for(var e=0;e<this.particles.length;e++){var h=this.particles[e],k=h.state;b.save();b.translate(k.pos.x,
k.pos.y);k.angle.angle&&b.rotate(k.angle.angle);if(this.renderType===a.particle.System.RENDER_BOX){var l=k.size;b.fillStyle=k.color.toString();b.fillRect(-l/2,-l/2,l,l)}else if(this.renderType===a.particle.System.RENDER_TRIANGLE){l=k.size/2;var m=c.PI2/3;b.fillStyle=k.color.toString();b.beginPath();b.moveTo(l,0);b.lineTo(c.cos(m)*l,c.sin(m)*l);b.lineTo(c.cos(2*m)*l,c.sin(2*m)*l);b.closePath();b.fill()}else if(this.renderType===a.particle.System.RENDER_DOT)b.fillStyle=k.color.toString(),b.beginPath(),
l=k.size/2,b.arc(0,0,l,0,1.9999*c.PI,!1),b.closePath(),b.fill();else if(this.renderType===a.particle.System.RENDER_SPRITE){if(h.asset)if(b.globalAlpha=k.color.a,l=k.size*h.scaleWidth,k=k.size*h.scaleHeight,h.asset.isImageRef){var n=h.asset.image,p=h.asset.frame;m=h.asset.flags;var r=!!n.frames,w=n.getImageFrame(r?0:p),q=0,t=0;w&&(r?(n=n.frames[p],q=l/n.origSize.w,t=k/n.origSize.h,p=n.box.w*q,r=n.box.h*t,q*=n.trimRect.x,t*=n.trimRect.y,m&a.graphics.Image.centeredX&&(q-=l/2),m&a.graphics.Image.centeredY&&
(t-=k/2),b.drawImage(w,n.drawBox.x,n.drawBox.y,n.drawBox.w,n.drawBox.h,q,t,p,r)):(m&a.graphics.Image.centeredX&&(q=-l/2),m&a.graphics.Image.centeredY&&(t=-k/2),b.drawImage(w,q,t,l,k)))}else b.drawImage(h.asset,0,0,h.asset.width,h.asset.height,-l/2,-k/2,l,k)}else this.renderType===a.particle.System.RENDER_TEXT?(b.font=(k.size*this.fontSize|0)+"px "+this.font,d&&(b.strokeStyle="rgba("+(k.color.r>>3)+","+(k.color.g>>3)+","+(k.color.b>>3)+","+k.color.a+")",b.lineWidth=12,b.strokeText(h.text,0,0)),b.fillStyle=
k.color.toString(),b.fillText(h.text,0,0)):this.renderType!==a.particle.System.RENDER_CUSTOM&&a.console.logError("Error:  Unknown particle render type");this.customDraw&&this.customDraw(b,h,this);b.restore()}a.profiler.popPerfMark("particle.Draw");this.postDraw&&this.postDraw(b,this);a.profiler.popPerfMark("Emitter.Draw")};a.particle.Emitter.prototype.setAdditive=function(){this.preDraw=a.particle.Emitter.preDrawAdditive;this.postDraw=a.particle.Emitter.postDrawAdditive};a.particle.Emitter.preDrawAdditive=
function(a,b){b.oldOperation=a.globalCompositeOperation;a.globalCompositeOperation="lighter"};a.particle.Emitter.postDrawAdditive=function(a,b){a.globalCompositeOperation=b.oldOperation};a.particle.State=function(){this.pos=new a.Vector;this.offset=new a.Vector;this.angle=new a.Angle;this.vel=new a.Vector;this.accel=new a.Vector;this.color=new a.graphics.Color(0,0,0,0);this.protoObject=a.particle.State.prototype};a.particle.State.prototype.size=0;a.particle.State.prototype.grow=0;a.particle.State.prototype.roll=
0;a.particle.State.prototype.ageLimit=0;a.particle.State.prototype.friction=0;a.particle.State.prototype.nextInCache=void 0;a.particle.State.prototype.reset=function(){this.size=this.protoObject.size;this.grow=this.protoObject.grow;this.roll=this.protoObject.roll;this.ageLimit=this.protoObject.ageLimit;this.friction=this.protoObject.friction;this.keyFlags=this.keyTime=this.nextInCache=void 0;this.pos.x=0;this.pos.y=0;this.offset.x=0;this.offset.y=0;this.angle.angle=0;this.vel.x=0;this.vel.y=0;this.accel.x=
0;this.accel.y=0;this.color.r=0;this.color.g=0;this.color.b=0;this.color.a=0};a.particle.State.prototype.copy=function(){var b=a.particle.State.create();b.size=this.size;b.grow=this.grow;b.roll=this.roll;b.ageLimit=this.ageLimit;b.friction=this.friction;b.keyTime=this.keyTime;b.keyFlags=this.keyFlags;b.pos.x=this.pos.x;b.pos.y=this.pos.y;b.offset.x=this.offset.x;b.offset.y=this.offset.y;b.angle.angle=this.angle.angle;b.vel.x=this.vel.x;b.vel.y=this.vel.y;b.accel.x=this.accel.x;b.accel.y=this.accel.y;
b.color.r=this.color.r;b.color.g=this.color.g;b.color.b=this.color.b;b.color.a=this.color.a;return b};a.particle.State.cache=void 0;a.particle.State.cacheSize=0;a.particle.State.count=0;a.particle.State.create=function(){if(a.particle.State.cache){var b=a.particle.State.cache;a.particle.State.cache=b.nextInCache;--a.particle.State.cacheSize;b.reset();return b}++a.particle.State.count;return new a.particle.State};a.particle.State.destroy=function(b){b&&(b.nextInCache=a.particle.State.cache,a.particle.State.cache=
b,++a.particle.State.cacheSize)};a.particle.State.FillCache=function(b){b=a.particle.stateCaching.minObjectCount-a.particle.State.count;if(0<b){for(var d=c.min(b,a.particle.stateCaching.createPerFrame),e=d;0<e;--e)a.particle.State.destroy(new a.particle.State),++a.particle.State.count;b-=d}0>=b&&a.cycleUpdate&&a.cycleUpdate.removeUpdater(a.particle.State.FillCache)};a.particle.One=function(){this.state=a.particle.State.create();this.states=[];this.ageLimit=this.age=0;this.pos=this.state.pos;this.state.posCalculated=
new a.Vector;this.curKeyIndex=0};a.particle.One.prototype.copy=function(){var b=new a.particle.One;for(c in this)b[c]=this[c];b.pos=this.pos.copy();b.state=this.state.copy();var c=this.states.length;b.states=[];for(var d=0;d<c;d++)b.states[d]=this.states[d].copy();return b};a.particle.One.prototype.update=function(b,c){var e=a.particle.System.statusActive,f=this.age/this.ageLimit;var k=this.states.length-1;for(var l=this.curKeyIndex+1;l<k;l++)f>=this.states[l].keyTime&&(this.curKeyIndex=l);l=this.curKeyIndex;
var m=l+1;m>k?(m=l,k=0):(k=(f-this.states[l].keyTime)/this.states[l].keyTimeLength,k=0>k?0:1<k?1:k);l=this.states[l];var n=this.states[m];m=this.state;m.size+=m.grow*b;0>m.size&&(m.size=0);var p=m.vel,r=m.friction;0<r&&(r=1-r*b,p.x*=r,p.y*=r);r=m.accel;p.x+=r.x*b;p.y+=r.y*b;r=m.posCalculated;r.x+=p.x*b;r.y+=p.y*b;c.posInterp?(c.posInterp(l.pos,n.pos,d,k,f),m.pos.x=a.utils.interpolate(r.x,d.x,f),m.pos.y=a.utils.interpolate(r.y,d.y,f)):(m.pos.x=r.x,m.pos.y=r.y);m.angle.angle+=m.roll*b;this.asset&&this.asset.isImageRef&&
(this.asset.update(b),c.flags&a.particle.Emitter.fKillParticleAfterAnimation&&this.asset.animOneShot&&(k=this.asset.getAnimCompletion(),1<=k&&(e=a.particle.System.statusDead)));c=1-k;n.color.r!==l.color.r?(f=n.color.r*k+c*l.color.r,m.color.r=0>f?0:255<f?255:f|0):m.color.r=n.color.r;n.color.g!==l.color.g?(f=n.color.g*k+c*l.color.g,m.color.g=0>f?0:255<f?255:f|0):m.color.g=n.color.g;n.color.b!==l.color.b?(f=n.color.b*k+c*l.color.b,m.color.b=0>f?0:255<f?255:f|0):m.color.b=n.color.b;n.color.a!==l.color.a?
(k=n.color.a*k+c*l.color.a,m.color.a=0>k?0:1<k?1:k):m.color.a=n.color.a;this.age+=b;this.age>=this.ageLimit&&(e=a.particle.System.statusDead);return e};a.particle.One.prototype.setImageAsset=function(b,c){b.isImageRef?(this.asset=new a.graphics.ImageRef(b),b=b.getSize(),this.scaleWidth=1,this.scaleHeight=b.h/b.w):0<b.width&&0<b.height&&(this.asset=b,this.scaleWidth=1,this.scaleHeight=b.width/b.height)};a.particle.One.prototype.destroy=function(){a.particle.State.destroy(this.state);this.state=void 0;
for(var b=0,c=this.states.length;b!==c;++b)a.particle.State.destroy(this.states[b]);this.states=[]};a.particle.createSystem=function(b){b=new a.particle.System(b);return a.particle.systems[a.particle.systems.length]=b};a.particle.removeSystem=function(b){for(var c=a.particle.systems.length,d=0;d<c;d++)if(a.particle.systems[d]===b){a.particle.systems.splice(d,1);break}};a.particle.getSystemCount=function(){return a.particle.systems.length};a.particle.getAllEmitterCount=function(){for(var b=0,c=a.particle.systems.length,
d=0;d<c;d++){var h=a.particle.systems[d].getEmitterCount();b+=h}return b};a.particle.getAllParticleCount=function(){for(var b=a.particle.systems.length,c=0,d=0;d<b;d++)for(var h=a.particle.systems[d].getEmitterCount(),k=0;k<h;k++)c+=a.particle.systems[d].emitters[k].getParticleCount();return c};a.particle.init=function(b){a.particle.stateCaching.enabled?(0>=a.particle.stateCaching.createPerFrame&&(a.particle.stateCaching.createPerFrame=a.particle.stateCaching.minObjectCount,a.particle.State.FillCache(0),
a.particle.stateCaching.createPerFrame=0),a.cycleUpdate&&a.cycleUpdate.addUpdater(a.particle.State.FillCache)):(a.particle.stateCaching.minObjectCount=0,a.particle.stateCaching.createPerFrame=0)}});
rat.modules.add("rat.ui.r_ui_fillbar",[{name:"rat.utils.r_utils",processBefore:!0},{name:"rat.ui.r_ui",processBefore:!0},{name:"rat.ui.r_ui_fill",processBefore:!0},"rat.debug.r_console","rat.ui.r_ui_data","rat.graphics.r_graphics","rat.math.r_math","rat.ui.r_ui_data"],function(a){a.ui.FillBar=function(c){a.ui.FillBar.prototype.parentConstructor.call(this,c);this.fillStyle="fill";this.fillShape="rectangle";this.minColor=a.graphics.red;this.maxColor=a.graphics.green;this.backColor=a.graphics.black;
this.borderColor=a.graphics.blue};a.utils.inheritClassFrom(a.ui.FillBar,a.ui.Fill);a.ui.FillBar.prototype.elementType="fillBar";a.ui.FillBar.prototype.setColors=function(c,b,d){this.backColor=c;this.minColor=b.min||b;this.maxColor=b.max||b;this.borderColor=d;"string"===typeof this.backColor&&(this.backColor=new a.graphics.Color(this.backColor));"string"===typeof this.minColor&&(this.minColor=new a.graphics.Color(this.minColor));"string"===typeof this.maxColor&&(this.maxColor=new a.graphics.Color(this.maxColor));
"string"===typeof this.borderColor&&(this.borderColor=new a.graphics.Color(this.borderColor));this.setDirty(!0)};a.ui.FillBar.prototype.drawSelf=function(){var c=a.graphics.ctx;c.save();var b=this.fillRatio;0>b?b=0:1<b&&(b=1);var d=new a.graphics.Color;this.minColor.r!==this.maxColor.r||this.minColor.g!==this.maxColor.g||this.minColor.b!==this.maxColor.b||this.minColor.a!==this.maxColor.a?a.graphics.Color.interp(this.minColor,this.maxColor,b,d):d=this.minColor;var e=this.getWidth();var f=this.getHeight();
var g=-a.math.HALFPI,h=g+a.math.PI2*b,k=this.size.x/2+this.center.x,l=this.size.y/2+this.center.y;"circle"===this.fillShape?(b=e<f?e:f,c.fillStyle=this.backColor.toString(),c.beginPath(),c.arc(0,0,b,0,a.math.PI2,!1),"radialFill"===this.fillStyle?(c.fillStyle=d.toString(),c.beginPath(),c.moveTo(k,l),c.arc(k,l,b,g,h,!1),c.closePath(),c.fill()):"radialStroke"===this.fillStyle?(c.strokeStyle=d.toString(),c.lineWidth=this.lineWidth,c.beginPath(),c.arc(k,l,b,g,h,!1),c.stroke()):a.console.log("rat.ui.fillBar does not support fillStyle "+
this.fillStyle+" with shape "+this.fillShape),this.borderColor&&this.lineWidth&&(c.strokeStyle=this.borderColor.toString(),c.lineWidth=this.lineWidth,c.beginPath(),c.arc(k,l,b,g,h,!1),c.stroke())):(c.translate(-this.center.x,-this.center.y),this.flipX&&(c.translate(this.size.x,0),c.scale(-1,1)),c.fillStyle=this.backColor.toString(),c.fillRect(0,0,e,f),"radialFill"===this.fillStyle?(c.beginPath(),c.rect(0,0,e,f),c.clip(),b=2*(e>f?e:f),c.beginPath(),c.moveTo(k,l),c.arc(k,l,b,g,h,!1),c.closePath(),c.fillStyle=
d.toString(),c.fill()):"radialStroke"===this.fillStyle?a.console.log("rat.ui.fillBar does not support fillStyle "+this.fillStyle+" with shape "+this.fillShape):"fill"===this.fillStyle?(c.fillStyle=d.toString(),c.fillRect(0,0,e*b,f)):(c.strokeStyle=d.toString(),c.lineWidth=this.lineWidth,c.strokeRect(0,0,e*b,f)),this.borderColor&&(c.strokeStyle=this.borderColor.toString(),c.lineWidth=this.lineWidth,c.strokeRect(0,0,this.getWidth(),this.getHeight())));c.restore()};a.ui.FillBar.setupFromData=function(c,
b,d){b.colors=b.colors||{};a.ui.data.callParentSetupFromData(a.ui.FillBar,c,b,d);d=new a.graphics.Color(b.colors.background||a.graphics.black);var e=new a.graphics.Color(b.colors.minBody||b.colors.body||c.color||a.graphics.red),f=new a.graphics.Color(b.colors.maxBody||b.colors.body||c.color||a.graphics.green);b=new a.graphics.Color(b.colors.border||(b.border?b.border.color:void 0)||a.graphics.blue);c.setColors(d,{min:e,max:f},b)}});
rat.modules.add("rat.ui.r_ui_bubblebox",[{name:"rat.utils.r_utils",processBefore:!0},{name:"rat.ui.r_ui",processBefore:!0},"rat.math.r_vector","rat.graphics.r_image","rat.debug.r_console","rat.graphics.r_graphics"],function(a){a.ui.BubbleBox_TILE=0;a.ui.BubbleBox_STRETCH=1;drawTypeNames={stretch:a.ui.BubbleBox_STRETCH,tile:a.ui.BubbleBox_TILE};a.ui.BubbleBox_defaultDrawType=a.ui.BubbleBox_TILE;a.ui.BubbleBox=function(c,b,d){if("string"===typeof c||Array.isArray(c))d=b,b=c,c=null;a.ui.BubbleBox.prototype.parentConstructor.call(this,
c);this.blockSize=new a.Vector(4,4);this.resource=b;if(void 0!==b){this.imageRef=new a.graphics.ImageRef(b);var e=this;this.imageRef.setOnLoad(function(a){a=e.imageRef.getSize();e.updateWithNewImageSize(a.w,a.h)})}c=b;Array.isArray(c)&&(c=c[0]);this.name="<bbx>"+c+this.id;void 0!==d?(drawTypeNames[d]&&(d=drawTypeNames[d]),this.drawType=d):this.drawType=a.ui.BubbleBox_defaultDrawType};a.utils.inheritClassFrom(a.ui.BubbleBox,a.ui.Element);a.ui.BubbleBox.prototype.elementType="bubbleBox";a.ui.BubbleBox.prototype.setTileCounts=
function(a,b){this.forceTilesWide=a;this.forceTilesHigh=b};a.ui.BubbleBox.prototype.updateWithNewImageSize=function(c,b){var d=4;c/3===a.math.floor(c/3)&&(d=3);this.forceTilesWide&&(d=this.forceTilesWide);var e=d;b===c/d&&(e=1);this.forceTilesHigh&&(e=this.forceTilesHigh);this.blockSize=new a.Vector(c/d|0,b/e|0);this.blockRows=e;1===e&&(this.blockSize.y=b);this.setDirty(!0)};a.ui.BubbleBox.prototype.useImageRef=function(a){this.imageRef=a;var b=this;this.imageRef.setOnLoad(function(c){c=a.getSize();
b.updateWithNewImageSize(c.w,c.h);1>=a.getFrameCount()?b.setNeedsUpdate(!1):b.setNeedsUpdate(!0)});this.setDirty(!0)};a.ui.BubbleBox.prototype.getImageRef=function(){return this.imageRef};a.ui.BubbleBox.prototype.updateSelf=function(c){a.ui.Sprite.prototype.updateSelf.call(this,c)};a.ui.BubbleBox.prototype.drawSelf=function(c){if(this.imageRef&&null!==this.imageRef.getImageFrame(0)){var b=!1,d=a.math.floor(this.size.x),e=a.math.floor(this.size.y);if(this.flags&a.ui.Element.adjustForScaleFlag&&(1!==
a.graphics.mTransform.m[0][0]||1!==a.graphics.mTransform.m[1][1])){b=!0;var f=a.graphics.transformPoint({x:0,y:0});e=a.graphics.transformPoint({x:this.size.x,y:this.size.y});a.graphics.save();c.setTransform(1,0,0,1,0,0);d=a.math.floor(e.x-f.x);e=a.math.floor(e.y-f.y);f.x=a.math.floor(f.x);f.y=a.math.floor(f.y);c.translate(f.x,f.y);1===this.blockRows&&(c.scale(1,e/this.size.y),e=this.size.y)}this.imageRef.drawAsBubble(c,-this.center.x,-this.center.y,d,e,this.blockSize.x,this.blockSize.y,this.forceRows,
this.drawType===a.ui.BubbleBox_STRETCH);b&&a.graphics.restore()}};a.ui.BubbleBox_setDefaultDrawType=function(c){drawTypeNames[c]&&(c=drawTypeNames[c]);a.ui.BubbleBox_defaultDrawType=c===a.ui.BubbleBox_STRETCH?a.ui.BubbleBox_STRETCH:a.ui.BubbleBox_TILE}});
rat.modules.add("rat.ui.r_ui_listbox",[{name:"rat.ui.r_ui",processBefore:!0},{name:"rat.ui.r_ui_scrollview",processBefore:!0},{name:"rat.utils.r_utils",processBefore:!0},"rat.debug.r_console"],function(a){a.ui.ListBox=function(c){a.ui.ListBox.prototype.parentConstructor.call(this,c);this.setClip(!0);this.orientation="vertical";this.itemList=[];this.nextPos=0;this.wheelAffects="y";this.supportZoom(!1)};a.utils.inheritClassFrom(a.ui.ListBox,a.ui.ScrollView);a.ui.ListBox.prototype.elementType="ListBox";
a.ui.ListBox.prototype.setUserData=function(a){this.userData=a};a.ui.ListBox.prototype.setOrientation=function(a){this.orientation=a};a.ui.ListBox.prototype.addItem=function(a){this.itemList.push(a);a.setPos(0,this.nextPos);var b=a.getSize();this.contentSize.y+=b.y;b.x>this.contentSize.x&&(this.contentSize.x=b.x);this.nextPos+=b.y;this.appendSubElement(a)};a.ui.ListBox.prototype.getItem=function(a){return this.itemList[a]};a.ui.ListBox.prototype.buildFromListText=function(c,b){for(var d=this,e=0;e<
c.length;e++){var f=b.listColorStates;f=f?a.ui.Button.copyStates(f):a.ui.Button.createStandardColorStates(b.listColor||a.graphics.gray,0);f=a.ui.makeCheapButtonWithColors(null,f);f.setCallback(function(a,c){b.selectCallback&&b.selectCallback(c,d.userData)},e);b.fontName&&f.setFont(b.fontName);f.setSize(this.size.x,b.fontHeight);f.checkAndMakeTextBox().setAlignment("left");f.setTextValue(c[e]);this.addItem(f)}};a.ui.ListBox.editProperties=[{label:"list box",props:[{propName:"orientation",type:"string",
defValue:"horizontal"}]}];a.ui.ListBox.setupFromData=function(c,b,d){a.ui.data.callParentSetupFromData(a.ui.ListBox,c,b,d)}});
rat.modules.add("rat.ui.r_ui_edittext",[{name:"rat.ui.r_ui_textbox",processBefore:!0},"rat.os.r_clipboard"],function(a){a.ui.EditText=function(c,b){this.config={};this.config.enters=[{action:"toggleActive"},{ctrlKey:!0,action:"insertCR"}];this.config.maxLength=-1;this.supportPan=!0;this.pan={x:20,y:0};a.ui.EditText.prototype.parentConstructor.call(this,c,b);this.setTracksMouse(!0);this.setTargetable(!0);this.editFrameLook={normalColor:new a.graphics.Color(180,180,180),highlightColor:new a.graphics.Color(255,
255,180),activeColor:new a.graphics.Color(255,255,255),lineWidth:2};this.editFillLook={activeColor:new a.graphics.Color(20,20,20,.2)};this.editSelectionLook={normalColor:new a.graphics.Color(200,200,180,.2),activeColor:new a.graphics.Color(255,255,180,.8),caratColor:new a.graphics.Color(255,255,255),caratWidth:2,caratBlinkSpeed:2};this.timer=0;this.active=!1;this.overrideMaxWidth(-1);c=0;this.value?c=this.value.length:this.value="";this.setCursorPos(c)};a.utils.inheritClassFrom(a.ui.EditText,a.ui.TextBox);
a.ui.EditText.prototype.elementType="editText";a.ui.EditText.prototype.flagsThatDirtyMe=a.ui.Element.highlightedFlag|a.ui.Element.enabledFlag;a.ui.EditText.prototype.setEnterHandling=function(a){"string"===typeof a?a={action:a}:"function"===typeof a&&(a={action:a});a||(a=[]);Array.isArray(a)||(a=[a]);this.config.enters=a};a.ui.EditText.prototype.setMaxTextLength=function(a){this.config.maxLength=a};a.ui.EditText.prototype.setTextValue=function(c){a.ui.EditText.prototype.parentPrototype.setTextValue.call(this,
c);var b=0;c&&(b=c.length);this.setCursorPos(b)};a.ui.EditText.prototype.textChanged=function(){0<this.config.maxLength&&this.value.length>this.config.maxLength&&(this.value=this.value.substring(0,this.config.maxLength));this.textChangeCallback&&this.textChangeCallback(this,this.value);a.ui.EditText.prototype.parentPrototype.textChanged.call(this);this.updatePan()};a.ui.EditText.prototype.setCursorPos=function(a){this.selectionRight=this.selectionLeft=this.selectionEnd=this.selectionAnchor=this.cursorPos=
a;this.timer=0;this.setDirty(!0);this.updatePan()};a.ui.EditText.prototype.selectAll=function(){this.cursorPos=this.value.length;this.selectionLeft=this.selectionAnchor=0;this.selectionRight=this.selectionEnd=this.value.length;this.timer=0;this.setDirty(!0);this.updatePan()};a.ui.EditText.prototype.updateSelectionLeftRight=function(){this.selectionAnchor<this.selectionEnd?(this.selectionLeft=this.selectionAnchor,this.selectionRight=this.selectionEnd):(this.selectionLeft=this.selectionEnd,this.selectionRight=
this.selectionAnchor)};a.ui.EditText.prototype.updatePan=function(){if(0===this.cursorPos)this.pan.x=0;else{a.graphics.ctx.font=this.fontDescriptor;var c=this.value.substring(0,this.cursorPos);c=a.graphics.ctx.measureText(c).width;if(this.pan.x<c-4&&this.pan.x+this.size.x>c+4)var b=this.pan.x+this.size.x+4>this.textWidth?this.textWidth-this.size.x+4:this.pan.x;else b=c-this.size.x+4,this.pan.x>b&&(b=c-4);this.pan.x=b;0>this.pan.x&&(this.pan.x=0)}};a.ui.EditText.prototype.setActive=function(a){a!=
this.active&&this.setDirty(!0);(this.active=a)?this.timer=0:this.caratBlinkOn=!1};a.ui.EditText.prototype.drawFrame=function(c){var b=this.editFrameLook;c.lineWidth=b.lineWidth;var d=0,e=0!==(this.flags&a.ui.Element.targetedFlag),f=this.flags&a.ui.Element.enabledFlag&&this.flags&a.ui.Element.highlightedFlag;c.strokeStyle=this.active?b.activeColor.toString():f?b.highlightColor.toString():b.normalColor.toString();if(f||e)c.lineWidth=b.lineWidth+1,d=1;c.strokeRect(-this.center.x-d,-this.center.y-d,this.size.x+
2*d,this.size.y+2*d)};a.ui.EditText.prototype.drawSelf=function(){var c=a.graphics.getContext();this.active&&(c.fillStyle=this.editFillLook.activeColor.toString(),c.fillRect(-this.center.x,-this.center.y,this.size.x,this.size.y));this.drawFrame(c);var b=!1;this.supportPan&&(b=!0,c.save(),c.beginPath(),c.rect(1-this.center.x,1-this.center.y,this.size.x-2,this.size.y-2),c.clip(),c.translate(-this.pan.x,-this.pan.y));a.ui.EditText.prototype.parentPrototype.drawSelf.call(this);var d=this.editSelectionLook,
e=this.setupAlignX(c,this.textWidth);if(this.selectionAnchor!==this.selectionEnd){var f=-this.center.y+2,g=this.size.y-4,h=e,k=this.value.substring(0,this.selectionAnchor);k=a.graphics.ctx.measureText(k);h+=k.width;var l=e+1;k=this.value.substring(0,this.selectionEnd);k=a.graphics.ctx.measureText(k);l+=k.width;c.fillStyle=this.active?d.activeColor.toString():d.normalColor.toString();c.fillRect(h,f,l-h,g)}f=this.caratBlinkOn;this.active&&f&&(h=e+1,f=-this.center.y+2,e=d.caratWidth,g=this.size.y-4,
k=this.value.substring(0,this.cursorPos),k=a.graphics.ctx.measureText(k),k=k.width,c.fillStyle=d.caratColor.toString(),c.fillRect(h+k,f,e,g));b&&c.restore()};a.ui.EditText.prototype.updateSelf=function(a){this.active&&(this.timer+=a,a=this.caratBlinkOn,this.caratBlinkOn=1>this.timer*this.editSelectionLook.caratBlinkSpeed*2%2,a!=this.caratBlinkOn&&this.setDirty(!0))};a.ui.EditText.prototype.keyDown=function(c){if(c.which>=a.keys.f1&&c.which<=a.keys.f12)return!1;if(c.which===a.keys.esc)return this.active?
(this.setActive(!1),!0):!1;if(c.which===a.keys.enter)for(var b=0;b<this.config.enters.length;b++){var d=this.config.enters[b];if(!!c.sysEvent.ctrlKey===!!d.ctrlKey&&!!c.sysEvent.shiftKey===!!d.shiftKey&&!!c.sysEvent.altKey===!!d.altKey)return"function"===typeof d.action?d.action(this,this.value,c):"toggleActive"===d.action?this.active?this.setActive(!1):this.setActive(!0):"insertCR"===d.action&&this.insertText("\n"),!0}if(this.active){var e=this;b=function(a){var b=e.value.slice(0,a);a=e.value.slice(a+
1,e.value.length);e.value=b+a;e.textChanged()};d=function(a){a=e.value.slice(0,e.selectionLeft);var b=e.value.slice(e.selectionRight,e.value.length);e.value=a+b;e.textChanged()};var f=c.sysEvent.shiftKey,g=!1,h=!1,k=this.cursorPos;if(c.which===a.keys.c&&c.sysEvent.ctrlKey)return(c=e.value.slice(e.selectionLeft,e.selectionRight))&&0<c.length&&(a.clipboard.store("text",c),console.log("copy "+c)),!0;if(c.which===a.keys.v&&c.sysEvent.ctrlKey){if(c=a.clipboard.retrieve("text"))console.log("paste "+c),
this.insertText(c);return!0}if(c.which===a.keys.x&&c.sysEvent.ctrlKey)return(c=e.value.slice(e.selectionLeft,e.selectionRight))&&0<c.length&&(a.clipboard.store("text",c),console.log("cut "+c),this.insertText("")),!0;c.which===a.keys.backspace?(c.sysEvent.preventDefault(),this.selectionEnd!=this.selectionAnchor?(d(),k=this.selectionLeft):0<this.cursorPos&&(b(this.cursorPos-1),k=this.cursorPos-1),f=!1,g=!0):c.which===a.keys.del?(this.selectionEnd!=this.selectionAnchor?(d(),k=this.selectionLeft):this.cursorPos<
this.value.length&&b(this.cursorPos),f=!1,g=!0):c.which===a.keys.leftArrow?(k=f||this.selectionEnd==this.selectionAnchor?this.cursorPos-1:this.selectionLeft,g=!0):c.which===a.keys.rightArrow?(k=f||this.selectionEnd==this.selectionAnchor?this.cursorPos+1:this.selectionRight,g=!0):c.which===a.keys.home?(k=0,g=!0):c.which===a.keys.end?(k=this.value.length,g=!0):c.which===a.keys.a&&c.sysEvent.ctrlKey&&(this.selectionAnchor=0,this.selectionEnd=k=this.value.length,h=g=!0);if(g)return k=Math.max(k,0),k=
Math.min(k,this.value.length),h||(this.selectionEnd=f?k:this.selectionAnchor=k),this.updateSelectionLeftRight(),this.cursorPos=k,this.updatePan(),this.timer=0,this.setDirty(!0),!0}else if(c.which===a.keys.backspace||c.which===a.keys.del)return c.sysEvent.preventDefault(),this.setTextValue(""),!0;return!1};a.ui.EditText.prototype.keyPress=function(a){if(!this.active)return!1;a=a.sysEvent.char;if(32>a.charCodeAt(0))return!1;"\n"!==a&&"\t"!==a&&this.insertText(a);return!0};a.ui.EditText.prototype.insertText=
function(a){var b=this.value.slice(0,this.selectionLeft),c=this.value.slice(this.selectionRight,this.value.length);this.value=b+a+c;this.textChanged();this.setCursorPos(this.selectionLeft+a.length)};a.ui.EditText.prototype.blur=function(){this.setActive(!1);return a.ui.EditText.prototype.parentPrototype.blur.call(this)};a.ui.EditText.prototype.handleTabbedTo=function(a){this.setActive(!0);this.selectAll()};a.ui.EditText.prototype.pointToCharIndex=function(c){a.graphics.ctx.font=this.fontDescriptor;
for(var b=this.value.length,d=0,e=1;e<=this.value.length;e++){var f=this.value.substring(0,e);f=a.graphics.ctx.measureText(f);if(c.x+this.center.x+this.pan.x<d+(f.width-d)/2){b=e-1;break}d=f.width}return b};a.ui.EditText.prototype.mouseDown=function(c,b){a.ui.EditText.prototype.parentPrototype.mouseDown.call(this,c,b);this.active?(c=this.pointToCharIndex(c),b.sysEvent.shiftKey?(this.selectionEnd=c,this.updateSelectionLeftRight()):this.selectionEnd=this.selectionAnchor=this.selectionLeft=this.selectionRight=
c,this.cursorPos=c):(this.setActive(!0),this.config.selectAllOnClickActivate?this.selectAll():(c=this.pointToCharIndex(c),this.setCursorPos(c)));this.trackingClick=!0;this.timer=0;this.setDirty(!0);return!0};a.ui.EditText.prototype.mouseUp=function(c,b){a.ui.EditText.prototype.parentPrototype.mouseUp.call(this,c,b);return this.trackingClick?(this.trackingClick=!1,!0):!1};a.ui.EditText.prototype.mouseMove=function(a,b){return this.trackingClick?(a=this.pointToCharIndex(a),a!=this.selectionEnd&&this.setDirty(!0),
this.cursorPos=this.selectionEnd=a,this.updateSelectionLeftRight(),this.updatePan(),!0):!1};a.ui.EditText.prototype.trigger=function(){this.active||(this.setActive(!0),this.selectAll());return a.ui.EditText.prototype.parentPrototype.trigger.call(this)};a.ui.EditText.setupFromData=function(c,b,d){a.ui.data.callParentSetupFromData(a.ui.EditText,c,b,d)}});
rat.modules.add("rat.ui.r_ui_domedittext",[{name:"rat.ui.r_ui_textbox",processBefore:!0},"rat.os.r_clipboard"],function(a){a.ui.DOMEditText=function(b,c,e){e=e||{};a.ui.DOMEditText.prototype.parentConstructor.call(this,b);this.setTracksMouse(!1);this.setTargetable(!0);this.makeDOMObject(b,c,e)};a.utils.inheritClassFrom(a.ui.DOMEditText,a.ui.TextBox);a.ui.DOMEditText.prototype.elementType="domEditText";a.ui.DOMEditText.prototype.letSlashThrough=!1;var c=a.ui.TextBox.prototype;a.ui.DOMEditText.prototype.flagsThatDirtyMe=
a.ui.Element.highlightedFlag|a.ui.Element.enabledFlag;a.ui.DOMEditText.prototype.makeDOMObject=function(b,c,e){var d=this;this.editDiv=c;b=e.class||"textarea";var g="textarea"===b?document.createElement(b):document.createElement("input");g.setAttribute("type","text");this.domEditBox=g;e.className&&(g.className=e.className);g.style.position="absolute";g.style.resize="none";g.style.display="block";this.updateDOMPlacement({x:0,y:0,w:100,h:20});g.addEventListener("keydown",function(b){b.keyCode!==a.keys.leftArrow&&
b.keyCode!==a.keys.upArrow&&b.keyCode!==a.keys.rightArrow&&b.keyCode!==a.keys.downArrow||b.stopPropagation();b.keyCode===a.keys.tab&&b.preventDefault();d.letSlashThrough||b.keyCode!==a.keys.forwardSlash||b.stopPropagation();b.keyCode===a.keys.backspace&&b.stopPropagation()},!1);g.addEventListener("input",function(a){d.textChangeCallback&&d.textChangeCallback(d,g.value)},!1);g.addEventListener("focus",function(a){d.focusCallback&&d.focusCallback(a)},!1);g.addEventListener("blur",function(a){d.blurCallback&&
d.blurCallback(a)},!1);c.appendChild(g)};a.ui.DOMEditText.prototype.getDOMElement=function(){return this.domEditBox};a.ui.DOMEditText.prototype.allowTooltip=function(){return"visible"!==this.editDiv.style.visibility?!1:!0};a.ui.DOMEditText.prototype.updateDOMPlacement=function(a){a||(a={x:this.place.pos.x,y:this.place.pos.y,w:this.size.x,h:this.size.y});var b=this.domEditBox,c=this.parent.getGlobalPos(a.x,a.y);b.style.top=""+(c.y|0)+"px";b.style.left=""+(c.x|0)+"px";b.style.width=""+a.w+"px";b.style.height=
""+a.h+"px"};a.ui.DOMEditText.prototype.setFocusCallback=function(a){this.focusCallback=a};a.ui.DOMEditText.prototype.setBlurCallback=function(a){this.blurCallback=a};a.ui.DOMEditText.prototype.setTextChangeCallback=function(a){this.textChangeCallback=a};a.ui.DOMEditText.prototype.targetMe=function(a){if("mousemove"!==a.eventType)return c.targetMe.call(this,a)};a.ui.DOMEditText.prototype.boundsChanged=function(){this.updateDOMPlacement();return c.boundsChanged.call(this)};a.ui.DOMEditText.prototype.setTextValue=
function(a){c.setTextValue.call(this,a);this.domEditBox.value=a};a.ui.DOMEditText.prototype.getTextValue=function(){return this.domEditBox.value};a.ui.DOMEditText.prototype.selectAll=function(){};a.ui.DOMEditText.prototype.drawSelf=function(){};a.ui.DOMEditText.prototype.updateSelf=function(a){};a.ui.DOMEditText.prototype.blur=function(){this.domEditBox.blur();return c.blur.call(this)};a.ui.DOMEditText.prototype.trigger=function(){return c.trigger.call(this)}});
rat.modules.add("rat.graphics.r_offscreen",[{name:"rat.graphics.r_graphics",processBefore:!0},{name:"rat.graphics.r_color",processBefore:!0},"rat.debug.r_console","rat.os.r_system","rat.graphics.r_rectlist"],function(a){a.Offscreen=function(c,b){this.canvas=document.createElement("canvas");this.canvas.width=this.width=c;this.canvas.height=this.height=b;this.ctx=this.canvas.getContext("2d");a.ui&&!a.ui.allowOffscreens&&a.console.logWarning("WARNING!  You're trying to use an OffscreenImage() object, but offscreens are not allowed by this host!")};
a.Offscreen.allowOffscreens=!a.system.has.Wraith;a.Offscreen.prototype.enableDirtyRects=function(){this.dirtyRects||(this.dirtyRects=new a.RectList,this.dirtyRects.snapEven=!0)};a.Offscreen.prototype.setSize=function(a,b,d){if(d||this.width!==a||this.height!==b)this.canvas.width=this.width=a,this.canvas.height=this.height=b};a.Offscreen.prototype.getContext=function(){return this.ctx};a.Offscreen.prototype.getCanvas=function(){return this.canvas};a.Offscreen.prototype.render=function(c,b,d,e,f){c||
(c=a.graphics.getContext());b||(b=0);d||(d=0);e||(e=this.canvas.width);f||(f=this.canvas.height);c.drawImage(this.canvas,b,d,e,f)};a.Offscreen.prototype.eraseDirty=function(){this.dirtyRects&&this.dirtyRects.eraseList(this.ctx)};a.Offscreen.prototype.clear=function(a,b,d){this.canvas.width=this.canvas.width;this.dirtyRects&&this.dirtyRects.clear()};a.Offscreen.prototype.erase=function(){10!==a.system.has.IEVersion||a.Offscreen.warnedAboutIE10||(a.console.logWarning("Warning:  This clearRect() call will fail in IE10 if you're using fancy clipping."),
a.Offscreen.warnedAboutIE10=!0);this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)};a.Offscreen.prototype.clipAndEraseDirty=function(){10===a.system.has.IEVersion?(this.eraseDirty(),this.clipToDirty()):(this.clipToDirty(),this.erase())};a.Offscreen.prototype.clipToDirty=function(){this.dirtyRects.clipToList(this.ctx)};a.Offscreen.prototype.unclip=function(){this.dirtyRects.unclip(this.ctx)};a.Offscreen.prototype.dirtyToPath=function(a,b){a||(a=this.ctx);b||(b=this.dirtyRects.list);this.dirtyRects.listToPath(a,
b)};a.Offscreen.debugColors=[a.graphics.orange,a.graphics.darkGreen,a.graphics.cyan,a.graphics.blue,a.graphics.violet];a.Offscreen.prototype.applyDebugOverlay=function(){if(!a.Offscreen.checkerImages){a.Offscreen.checkerImages=[];for(var c=a.Offscreen.debugColors,b=0;b<c.length;b++){var d=c[b];a.Offscreen.checkerImages[b]=document.createElement("canvas");a.Offscreen.checkerImages[b].width=32;a.Offscreen.checkerImages[b].height=32;var e=a.Offscreen.checkerImages[b].getContext("2d");e.fillStyle="#FFFFFF";
e.fillRect(0,0,32,32);e.fillStyle=d.toString();e.fillRect(0,0,16,16);e.fillRect(16,16,16,16)}}this.debugOffscreenCycle||(this.debugOffscreenCycle=0);c=a.Offscreen.debugColors.length;e=this.ctx;this.pat=e.createPattern(a.Offscreen.checkerImages[this.debugOffscreenCycle],"repeat");b=e.globalAlpha;e.globalAlpha=.3;e.fillStyle=this.pat;e.fillRect(0,0,this.width,this.height);this.debugOffscreenCycle=(this.debugOffscreenCycle+1)%c;e.globalAlpha=b}});
rat.modules.add("rat.ui.r_ui_animator",[{name:"rat.ui.r_ui",processBefore:!0},"rat.debug.r_console","rat.math.r_vector","rat.utils.r_utils"],function(a){a.ui.animators=[];a.ui.Animator=function(b,c,e,f){"boolean"===typeof e&&3===arguments.length&&(f=e,e=void 0);this.id=e;this.type=b;this.relative=!!f;this.target=c;this.startValue=new a.Vector(0,0);this.endValue=new a.Vector(0,0);this.paused=!1;this.time=this.startTime=-1;this.delay=0;this.interpFilter=a.ui.Animator.filterEaseInOut;this.flags=0;this.setAutoDie(!0);
this.speed=1;this.continuousVal=0;this.continuousSign=1;this.doneCallback=this.delayCallback=null;this.target?(this.targetStartState={x:this.target.place.pos.x,y:this.target.place.pos.y,cx:this.target.contentOffset.x,cy:this.target.contentOffset.y,sx:this.target.scale.x,sy:this.target.scale.y,w:this.target.size.x,h:this.target.size.y,r:this.target.place.rot.angle,opacity:this.target.opacity,visible:this.target.isVisible()?1:0},a.ui.Animator.list[b]&&(this.custom=a.ui.Animator.list[b]),this.custom&&
this.custom.init&&this.custom.init(this),a.ui.animators.push(this)):a.console.log("No target input for animator! Bad juju! Not adding it to the animator list")};a.ui.Animator.mover="mover";a.ui.Animator.rotator="rotator";a.ui.Animator.rotater=a.ui.Animator.rotator;a.ui.Animator.scaler="scaler";a.ui.Animator.resizer="resizer";a.ui.Animator.fader="fader";a.ui.Animator.scroller="scroller";a.ui.Animator.visible="visible";a.ui.Animator.list={};a.ui.Animator.floater="floater";a.ui.Animator.list.floater=
{propPath:"place.pos",init:function(b){b.interpFilter=a.ui.Animator.filterLinear},update:function(b,c,e){c=Math.sin(c*Math.PI*2);e=a.utils.interpolate(b.startValue.x,b.endValue.x,c);c=a.utils.interpolate(b.startValue.y,b.endValue.y,c);b.relative&&(e+=b.targetStartState.x,c+=b.targetStartState.y);b.target.place.pos.x=e;b.target.place.pos.y=c;b.target.parent&&b.target.parent.setDirty(!0)},resetTargetState:function(a){var b=a.targetStartState;a.target.setPos(b.x,b.y)}};a.ui.Animator.wobbler="wobbler";
a.ui.Animator.list.wobbler={propPath:"place.rot.angle",init:function(b){b.interpFilter=a.ui.Animator.filterLinear},update:function(a,c,e){c=a.startValue.x+Math.random()*(a.endValue.x-a.startValue.x);a.relative&&(c+=a.targetStartState.r);a.target.place.rot.angle=c;a.target.parent&&a.target.parent.setDirty(!0)},resetTargetState:function(a){a.target.setRotation(a.targetStartState.r)}};a.ui.Animator.autoDieFlag=1;a.ui.Animator.autoRemoveTargetFlag=2;a.ui.Animator.prototype.setAutoDie=function(b){this.flags=
b||void 0===b?this.flags|a.ui.Animator.autoDieFlag:this.flags&~a.ui.Animator.autoDieFlag};a.ui.Animator.prototype.setAutoRemoveTarget=function(b){this.flags=b||void 0===b?this.flags|a.ui.Animator.autoRemoveTargetFlag:this.flags&~a.ui.Animator.autoRemoveTargetFlag};a.ui.Animator.prototype.setDoneCallback=function(a){this.doneCallback=a};a.ui.Animator.prototype.setDelayDoneCallback=function(a){this.delayCallback=a};a.ui.Animator.prototype.setTimer=function(a){this.time=this.startTime=a};a.ui.Animator.prototype.setInfiniteTimer=
function(){this.setTimer(-1)};a.ui.Animator.prototype.setDelay=function(a){this.delay=a};a.ui.Animator.prototype.setPaused=function(a){void 0===a&&(a=!0);this.paused=a};a.ui.Animator.prototype.setSpeed=function(a){this.speed=a};a.ui.Animator.prototype.setStartEnd=function(a,c){this.startValue.x=a;this.startValue.y=a;this.endValue.x=c;this.endValue.y=c;this.update(0)};a.ui.Animator.prototype.setStartEndVectors=function(a,c){a?(this.startValue.x=a.x,this.startValue.y=a.y):(a=this.getCurrentValueForType(),
this.startValue.x=a.x,this.startValue.y=a.y);this.endValue.x=c.x;this.endValue.y=c.y;this.update(0)};a.ui.Animator.filterNone=function(a){return 0};a.ui.Animator.filterLinear=function(a){return a};a.ui.Animator.filterEaseInOut=function(a){return a*a*(3-2*a)};a.ui.Animator.filterEaseIn=function(a){return a*a};a.ui.Animator.filterEaseOut=function(a){return a*(2-a)};a.ui.Animator.filterEaseThereAndBack=function(b){return.5>b?a.ui.Animator.filterEaseInOut(2*b):1-a.ui.Animator.filterEaseInOut(2*(b-.5))};
a.ui.Animator.filterEaseInElastic=function(a){return a};a.ui.Animator.filterEaseOutElastic=function(a){return 0>=a?0:1<=a?1:Math.pow(2,-10*a)*Math.sin(2*(a-.4/(2*Math.PI)*1.5707)*Math.PI/.4)+1};a.ui.Animator.prototype.setInterpFilter=function(a){this.interpFilter=a};a.ui.Animator.prototype.clearInterpFilter=function(){this.setInterpFilter(null)};a.ui.Animator.prototype.update=function(b){if(!this.target||this.paused)return!1;if(0<this.delay){this.delay-=b;if(0<this.delay)return!1;0<this.time&&(this.time+=
this.delay,0>this.time&&(this.time=0));this.delayCallback&&this.delayCallback(this.target,this)}var c=!1,e=null;0>this.time?this.type===a.ui.Animator.rotator?this.target.place.rot.angle+=this.speed*b:this.custom?(this.continuousVal+=this.speed*b,e=this.continuousVal%1):(this.continuousVal+=this.continuousSign*this.speed*b,1<this.continuousVal?(this.continuousVal=1,this.continuousSign=-this.continuousSign):0>this.continuousVal&&(this.continuousVal=0,this.continuousSign=-this.continuousSign),e=this.continuousVal):
(this.time-=b,0>this.time&&(this.time=0,c=!0),e=0>=this.startTime?1:1-this.time/this.startTime);null!==e&&(void 0!==this.interpFilter&&(e=this.interpFilter(e)),this.custom&&this.custom.update?this.custom.update(this,e,b):(b=a.utils.interpolate(this.startValue.x,this.endValue.x,e),e=a.utils.interpolate(this.startValue.y,this.endValue.y,e),this.type===a.ui.Animator.mover?(this.relative&&(b+=this.targetStartState.x,e+=this.targetStartState.y),this.target.place.pos.x=b,this.target.place.pos.y=e,this.target.parent&&
this.target.parent.setDirty(!0)):this.type===a.ui.Animator.rotator?(this.relative&&(b+=this.targetStartState.r),this.target.place.rot.angle=b,this.target.parent&&this.target.parent.setDirty(!0)):this.type===a.ui.Animator.scaler?(this.relative&&(b+=this.targetStartState.sx,e+=this.targetStartState.sy),this.target.setScale(b,e)):this.type===a.ui.Animator.resizer?(this.relative&&(b+=this.targetStartState.w,e+=this.targetStartState.h),this.target.setSize(b,e)):this.type===a.ui.Animator.fader?(this.relative&&
(b+=this.targetStartState.opacity),this.target.setOpacityRecursive(b)):this.type===a.ui.Animator.scroller?(this.relative&&(b+=this.targetStartState.cx,e+=this.targetStartState.cy),this.target.contentOffset.x=b,this.target.contentOffset.y=e,this.target.viewChanged&&this.target.viewChanged()):this.type===a.ui.Animator.visible&&this.target.setVisible(!!b)));c&&this.doneCallback&&this.doneCallback(this.target,this);c&&this.flags&a.ui.Animator.autoRemoveTargetFlag&&this.target.removeFromParent();return c&&
this.flags&a.ui.Animator.autoDieFlag?!0:!1};a.ui.Animator.prototype.getCurrentValueForType=function(){return this.type===a.ui.Animator.mover?this.target.place.pos:this.type===a.ui.Animator.rotator?this.target.place.rot.angle:this.type===a.ui.Animator.scaler?this.target.scale:this.type===a.ui.Animator.resizer?this.target.size:this.type===a.ui.Animator.fader?this.target.opacity:this.type===a.ui.Animator.scroller?this.target.contentOffset:this.type===a.ui.Animator.visible?this.target.isVisible()?1:0:
this.custom&&this.custom.propPath?a.utils.get(this.target,this.custom.propPath):null};a.ui.Animator.prototype.die=function(a){this.target=null};a.ui.Animator.prototype.getElapsed=function(a){return this.startTime-this.time};a.ui.Animator.prototype.finish=function(){0>this.time||(this.delay=0,this.update(this.time+1E-4))};a.ui.Animator.prototype.resetTargetState=function(){var b=this.targetStartState;switch(this.type){case a.ui.Animator.mover:this.target.setPos(b.x,b.y);break;case a.ui.Animator.rotator:this.target.setRotation(b.r);
break;case a.ui.Animator.scaler:this.target.setScale(b.sx,b.sy);break;case a.ui.Animator.resizer:this.target.setSize(b.w,b.h);break;case a.ui.Animator.fader:this.target.setOpacity(b.opacity);break;case a.ui.Animator.scroller:this.target.setContentOffset(b.cx,b.cy);break;case a.ui.Animator.visible:this.target.setVisible(b.visible);break;default:this.custom&&this.custom.resetTargetState&&this.custom.resetTargetState(this)}};var c=0;a.ui.updateAnimators=function(b){++c;for(var d=a.ui.animators.length-
1;0<=d;d--)a.ui.animators[d].update(b)&&a.ui.animators.splice(d,1);--c};a.ui.resetStateStateForAllAnimatorsForElement=function(b,c){for(var d=a.ui.animators.length-1;0<=d;d--){var f=a.ui.animators[d];f.target?f.target!==b||void 0!==c&&f.type!==c||f.resetTargetState():(a.console.log("JS FAILURE: animator is missing target! check that on construction all objects have a target!\n"),a.ui.animators.splice(d,1))}};a.ui.finishAnimatorsForElement=function(b,d,e){for(var f=a.ui.animators.length-1;0<=f;f--){var g=
a.ui.animators[f];g.target?g.target!==b||void 0!==d&&g.type!==d||(g.finish(),e&&!c&&a.ui.animators.splice(f,1)):(a.console.log("JS FAILURE: animator is missing target! check that on construction all objects have a target!\n"),a.ui.animators.splice(f,1))}};a.ui.killAnimatorsForElement=function(b,c){for(var d=0,f=a.ui.animators.length-1;0<=f;f--){var g=a.ui.animators[f];if(!g.target)a.console.log("JS FAILURE: animator is missing target! check that on construction all objects have a target!\n"),a.ui.animators.splice(f,
1);else if(void 0===c||g.type===c)if(null===b||g.target===b)a.ui.animators.splice(f,1),d++}return d};a.ui.Element.prototype.killAllAnimators=function(b){return a.ui.killAnimatorsForElement(this,b)};a.ui.killAllAnimators=function(b){return a.ui.killAnimatorsForElement(null,b)};a.ui.getAnimatorsForElement=function(b,c,e){for(var d=[],g=a.ui.animators.length-1;0<=g;g--){var h=a.ui.animators[g];h.target!==b||void 0!==c&&h.type!==c||void 0!==e&&h.id!==e||d.push(h)}return d};a.ui.elementHasAnimator=function(b,
c,e){for(var d=a.ui.animators.length-1;0<=d;d--){var g=a.ui.animators[d];if(!(g.target!==b||void 0!==c&&g.type!==c||void 0!==e&&g.id!==e))return!0}return!1};a.ui.killAnimators=function(){a.ui.animators=[]};a.ui.Element.prototype.slideInFrom=function(b,c,e){c=c||1;b=b||"left";var d=this.getPos().copy(),g=this.getPos().copy();"left"===b&&(g.x=-this.getWidth()-20);"right"===b&&(g.x=a.graphics.SCREEN_WIDTH+20);"top"===b&&(g.y=-this.getHeight()-20);"bottom"===b&&(g.y=a.graphics.SCREEN_HEIGHT+20);b=new a.ui.Animator(a.ui.Animator.mover,
this);b.setTimer(c);e?b.setStartEndVectors(d,g):b.setStartEndVectors(g,d);return b};a.ui.Element.prototype.slideOutTo=function(a,c){return this.slideInFrom(a,c,!0)};a.ui.Element.prototype.slideTo=function(b,c){c=c||1;b={x:b.x,y:b.y};var d=this.getPos().copy(),f=new a.ui.Animator(a.ui.Animator.mover,this);f.setTimer(c);f.setStartEndVectors(d,b);return f}});
rat.modules.add("rat.ui.r_ui_tooltip",[{name:"rat.ui.r_ui",processBefore:!0},"rat.utils.r_shapes","rat.ui.r_ui_textbox"],function(a){a.ui.TOOL_TIP_TIME=.5;a.ui.Element.prototype.updateToolTip=function(c){this.toolTip&&(("touch"===a.input.lastUIInputType&&this.flags&a.ui.Element.pressedFlag||"mouse"===a.input.lastUIInputType&&this.flags&a.ui.Element.mouseInFlag)&&this.flags&a.ui.Element.visibleFlag&&(!this.allowTooltip||this.allowTooltip())?(this.toolTip.timer+=c,this.toolTip.timer>a.ui.TOOL_TIP_TIME&&
(this.toolTipPlacementFromMouse&&this.positionToolTip(this.toolTipPlacement,this.toolTipPlacementOffset,this.toolTipPlacementFromMouse),c=this.getGlobalPos(this.toolTipOffset.x,this.toolTipOffset.y),this.toolTip.setPos(c.x,c.y),this.toolTipScreen.activeToolTip=this.toolTip)):(this.toolTip.setVisible(!1),this.toolTip.timer=0))};a.ui.Element.prototype.setTextToolTip=function(c,b,d,e){d||(d=a.graphics.black);b||(b=a.graphics.white);var f=new a.ui.Shape(a.ui.squareShape);f.setSize(200,20);f.setColor(d);
f.setFrame(1,b);d=new a.ui.TextBox(c);d.setFont("calibri");d.setTextValue(c);d.setColor(b);this.sizeTextToolTip(15,f,d);f.appendSubElement(d);this.setToolTip(f,e,"rightHigh",{x:6,y:0});return{container:f,textBox:d}};a.ui.Element.prototype.addTextToolTip=a.ui.Element.prototype.setTextToolTip;a.ui.Element.prototype.sizeTextToolTip=function(a,b,d){b||(b=this.toolTip);d||(d=b.subElements[0]);d.setWidth(1E3);d.setFontSize(a);d.setPos(7,2);b.setSize(d.contentSize.x+14,d.contentSize.y+4+2);d.autoSizeToContent()};
a.ui.Element.prototype.positionToolTip=function(a,b,d){var c=this.toolTip;if(c){"undefined"===typeof b&&(b={x:0,y:0});var f=c.getSize(),g=this.getSize();d&&(g.x=g.y=16);if("none"===a||""===a)var h=f=0;else"top"===a?(h=(g.x-f.x)/2,f=-f.y):"topLeft"===a?(h=-f.x,f=-f.y):"topRight"===a?(h=g.x,f=-f.y):"bottom"===a?(h=(g.x-f.x)/2,f=g.y):"bottomLeft"===a?(h=-f.x,f=g.y):"bottomRight"===a?(h=g.x,f=g.y):(h=g.x,f=g.y/3-f.y/2);d&&this.mousePos&&(h+=this.mousePos.x,f+=this.mousePos.y);c.setPos(h+b.x,f+b.y);this.toolTipPlacement=
a;this.toolTipPlacementOffset={x:b.x,y:b.y};this.toolTipPlacementFromMouse=d;this.toolTipOffset=c.getPos().copy()}};a.ui.Element.prototype.setToolTip=function(a,b,d,e,f){"undefined"===typeof e&&(e={x:0,y:0});this.toolTip=a;this.positionToolTip(d,e,f);a.setVisible(!1);a.timer=0;b||(b=this.getTopParent(),this.toolTipScreenWasAssumed=!0);this.toolTipScreen=b;this.setTracksMouse(!0)};a.ui.Element.prototype.getToolTip=function(){return this.toolTip}});
rat.modules.add("rat.utils.r_collision2d",["rat.graphics.r_graphics","rat.debug.r_console","rat.math.r_math","rat.utils.r_shapes"],function(a){function c(b,d){switch(b.type){case "circle":case "Circle":var e=new a.shapes.Circle(b);e.type="circle";var f=e.center,g=e.radius;if(void 0===d.left||d.left>f.x-g)d.left=f.x-g;if(void 0===d.right||d.right<f.x+g)d.right=f.x+g;if(void 0===d.top||d.top>f.y-g)d.top=f.y-g;if(void 0===d.bottom||d.bottom<f.y+g)d.bottom=f.y+g;break;case "rect":case "Rect":case "box":case "Box":e=
new a.shapes.Rect(b);e.type="rect";if(void 0===d.left||d.left>e.x)d.left=e.x;if(void 0===d.right||d.right<e.x+e.w)d.right=e.x+e.w;if(void 0===d.top||d.top>e.y)d.top=e.y;if(void 0===d.bottom||d.bottom<e.y+e.h)d.bottom=e.y+e.h;break;default:a.console.logError("ERROR: Un-supported shape found in bounding shape data: "+b.type);return}e.type=b.type;b.name&&(e.name=b.name);e.children=[];if(b.children)for(f=0,g=b.children.length;f!==g;++f)e.children.push(c(b.children[f],d));return e}a.collision2D={};a.collision2D.pointInRect=
function(a,c){return!(a.x<c.x||a.y<c.y||a.x>c.x+c.w||a.y>c.y+c.h)};a.collision2D.pointInsideRect=function(a,c){return!(a.x<c.x||a.y<c.y||a.x>=c.x+c.w||a.y>=c.y+c.h)};a.collision2D.limitPointToSpace=function(a,c,e,f,g){a.x<c&&(a.x=c);a.y<e&&(a.y=e);a.x>c+f&&(a.x=c+f);a.y>e+g&&(a.y=e+g)};a.collision2D.rectOverlapsRect=function(a,c){return!(a.y+a.h<c.y||a.y>c.y+c.h||a.x+a.w<c.x||a.x>c.x+c.w)};a.collision2D.circlesCollide_Offset=function(b,c,e,f){if(b&&e){var d=b.radius+e.radius,h=e.center.x+f.x-(b.center.x+
c.x);b=e.center.y+f.y-(b.center.y+c.y);h=a.math.sqrt(h*h+b*b);if(!(h>d))return{dist:h,radii:d}}};a.collision2D.circlesCollide=function(b,c){if(b&&c){var d=b.radius+c.radius,f=c.center.x-b.center.x;b=c.center.y-b.center.y;f=a.math.sqrt(f*f+b*b);if(!(f>d))return{dist:f,radii:d}}};a.collision2D.rectsCollide_Offset=function(a,c,e,f){var b=a.x+c.x;c=a.y+c.y;var d=e.x+f.x;f=e.y+f.y;return!(c+a.h<f||c>f+e.h||b+a.w<d||b>d+e.w)};a.collision2D.rectsCollide=a.collision2D.rectOverlapsRect;a.collision2D.circlesAndRectCollide_Offset=
function(a,c,e,f){var b=0;var d=a.squaredRadius?a.squaredRadius:a.radius*a.radius;var k=a.center.y+c.x;a=a.center.y+c.y;c=e.x+f.x;f=e.y+f.y;var l=c+e.w;e=f+e.h;k<c?(k-=c,b+=k*k):k>l&&(k-=l,b+=k*k);a<f?(k=a-f,b+=k*k):a>e&&(k=a-e,b+=k*k);if(b<=d)return{}};a.collision2D.circlesAndRectCollide=function(a,c){var b=0;var d=a.squaredRadius?a.squaredRadius:a.radius*a.radius;a=a.center;var g=c.x+c.w;var h=c.y+c.h;a.x<c.x?(g=a.x-c.x,b+=g*g):a.x>g&&(g=a.x-g,b+=g*g);a.y<c.y?(g=a.y-c.y,b+=g*g):a.y>h&&(g=a.y-h,
b+=g*g);if(b<=d)return{}};a.collision2D.shapesCollide=function(b,c,e,f){switch(b.type){case "circle":switch(e.type){case "circle":return a.collision2D.circlesCollide_Offset(b,c,e,f);case "rect":return a.collision2D.circlesAndRectCollide_Offset(b,c,e,f)}break;case "rect":switch(e.type){case "circle":return a.collision2D.circlesAndRectCollide_Offset(e,f,b,c);case "rect":return a.collision2D.rectsCollide_Offset(b,c,e,f)}}};a.collision2D.shapeAndShapeListCollide=function(b,c,e,f){for(var d,h,k=b.children&&
b.children.length,l,m=0,n=e.length;m!==n;++m)if(h=e[m],d=a.collision2D.shapesCollide(b,c,h,f)){l=h.children&&h.children.length;if(!k&&!l)return d;if(k&&!l){if(d=a.collision2D.shapeAndShapeListCollide(h,f,b.children,c))return d}else if(d=a.collision2D.shapeAndShapeListCollide(b,c,h.children,f))if(!k||(d=a.collision2D.shapeListsCollide(b.children,c,h.children,f)))return d}};a.collision2D.shapeListsCollide=function(b,c,e,f){for(var d,h=0,k=b.length;h!==k;++h)if(d=a.collision2D.shapeAndShapeListCollide(b[h],
c,e,f))return d};a.collision2D.BoundingShapesCollide=function(b,c,e,f){var d=a.collision2D.circlesCollide_Offset(b.mBounding,c,e.mBounding,f);return d?a.collision2D.shapeListsCollide(b.mShapes,c,e.mShapes,f):d};a.collision2D.BoundingShape=function(b){!1===Array.isArray(b)&&(b=[b]);this.mLimits={left:void 0,right:void 0,top:void 0,bottom:void 0};this.mShapes=[];for(var d=0,e=b.length;d!==e;++d)this.mShapes.push(c(b[d],this.mLimits));this.mLimits.left=this.mLimits.left||0;this.mLimits.right=this.mLimits.right||
0;this.mLimits.top=this.mLimits.top||0;this.mLimits.bottom=this.mLimits.bottom||0;this.mSize={x:this.mLimits.right-this.mLimits.left,y:this.mLimits.bottom-this.mLimits.top};b=this.mSize.x/2;d=this.mSize.y/2;this.mBounding=new a.shapes.Circle({x:this.mLimits.left+b,y:this.mLimits.top+d,squaredRadius:b*b+d*d})};a.collision2D.BoundingShape.prototype.debugDraw=function(b,c,e){a.graphics.save();var d=a.graphics.ctx;c=c.toString();d.strokeStyle=c;d.lineWidth=1;a.graphics.translate(b.x,b.y);b=this.mLimits;
c=this.mSize;a.graphics.ctx.strokeRect(b.left,b.top,c.x,c.y);a.graphics.drawCircle(this.mBounding);c=e.toString();d.strokeStyle=c;a.graphics.drawShapeList(this.mShapes);a.graphics.restore()};a.collision2D.pointToLine=function(a,c,e){var b={onLine:!1},d=c.x-e.x,h=c.y-e.y;d=((a.x-c.x)*(e.x-c.x)+(a.y-c.y)*(e.y-c.y))/(d*d+h*h);h={};h.x=c.x+d*(e.x-c.x);h.y=c.y+d*(e.y-c.y);b.closePoint=h;c=a.x-h.x;a=a.y-h.y;b.distanceSquared=c*c+a*a;b.onLine=0<=d&&1>=d;return b}});
rat.modules.add("rat.ui.r_ui_textbox",[{name:"rat.ui.r_ui",processBefore:!0},{name:"rat.utils.r_utils",processBefore:!0},"rat.graphics.r_graphics","rat.utils.r_wordwrap","rat.debug.r_console","rat.ui.r_ui_data"],function(a){a.ui.TextBox=function(c,b){if("string"!==typeof c){var d=c;c=b}a.ui.TextBox.prototype.parentConstructor.call(this,d);this.value=void 0===c?"":c;this.font="Calibri";this.fontStyle="";this.fontSize=15;this.fontLineSpacing=2;this.fontLineHeight=16;this.fontDescriptor="15px Calibri";
this.strokeWidth=-1;this.strokeColor=null;this.textShadowEnabled=!1;this.textShadowColor=new a.graphics.Color(0,0,0,.5);this.textShadowOffset={x:1,y:1};this.textShadowBlur=0;this.forceWrap=this.autoWrap=!1;this.stopLength=-1;this.drawnLengthTotal=0;this.size.x=100;this.maxWidth=this.size.x;this.overriddenMaxWidth=!1;this.size.y=this.fontLineHeight;this.fitParams={tryCount:4,squishPerTry:.1};this.textInset={x:0,y:0};this.rawTextWidth=this.textHeight=this.textWidth=0;this.align=a.ui.TextBox.alignLeft;
this.baseline=a.ui.TextBox.baselineMiddle;this.name="<txt>"+this.id+"("+this.value+")";this.textChanged();this.setTracksMouse(!1)};a.utils.inheritClassFrom(a.ui.TextBox,a.ui.Element);a.ui.TextBox.prototype.elementType="textBox";a.ui.TextBox.alignLeft=0;a.ui.TextBox.alignCenter=1;a.ui.TextBox.alignRight=2;a.ui.TextBox.baselineTop=0;a.ui.TextBox.baselineMiddle=1;a.ui.TextBox.baselineBottom=2;a.ui.TextBox.specialCharacter="\u2121";a.ui.TextBox.specialPushColorCode="\u2193";a.ui.TextBox.specialPopColorCode=
"\u2191";a.ui.TextBox.specialImageCode="\u263a";a.ui.TextBox.specialDraws=null;a.ui.TextBox.fontHeightOverrides={};a.ui.TextBox.prototype.setTextValue=function(a){var b=this.value;this.value=""+a;this.name="<txt>"+this.id+"("+this.value+")";b!==this.value&&this.textChanged()};a.ui.TextBox.prototype.getTextValue=function(a){var b=this.value;b&&a&&(b=b.trim());return b};a.ui.TextBox.prototype.translateAndSetTextValue=function(c){a.string&&(c=a.string.getString(c));c!==this.value&&(this.value=c,this.textChanged())};
a.ui.TextBox.prototype.setSpecialDraw=function(a){var b=a.code,c=this;a.measure=function(d,f){a.measureFunc?(d.code=b,d.data=a,d.segment=d.segment||{},d.textBox=c,a.measureFunc(d,f)):f.consumeCharacters=f.width=0};this.specialDraws||(this.specialDraws={});this.specialDraws[b]=a;this.textChanged()};a.ui.TextBox.prototype.enableDefaultSpecialFormatting=function(){var c={colorStack:[]},b=this.value;this.value="";this.setSpecialDraw({code:a.ui.TextBox.specialPushColorCode,measureFunc:function(a,b){b.consumeCharacters=
3;b.width=0;if(a.segment){b=a.string.charCodeAt(a.stringPos);var c=a.string.charCodeAt(a.stringPos+1),d=a.string.charCodeAt(a.stringPos+2);a.segment.fillStyle="rgb("+b+","+c+","+d+")"}},preDrawFunc:function(a,b){a.data.myData.colorStack=[]},drawFunc:function(a,b){a.data.myData.colorStack.push(a.ctx.fillStyle);a.ctx.fillStyle=a.segment.fillStyle},myData:c});this.setSpecialDraw({code:a.ui.TextBox.specialPopColorCode,drawFunc:function(a,b){a.ctx.fillStyle=0<a.data.myData.colorStack.length?a.data.myData.colorStack.pop():
"#FF2020"},myData:c});this.setSpecialDraw({code:a.ui.TextBox.specialImageCode,measureFunc:function(b,c){var d=b.string.indexOf(a.ui.TextBox.specialImageCode,b.stringPos);d>b.stringPos?(c.consumeCharacters=d-b.stringPos+1,c.width=b.textBox.fontLineHeight,b.segment.imageKey=b.string.substring(b.stringPos,d),a.ui.TextBox.specialImageMap||a.console.logWarningOnce("textbox special image map used but missing")):(a.console.logWarningOnce("textbox special image code missing terminator"),c.consumeCharacters=
0,c.width=0)},preDrawFunc:null,drawFunc:function(b,c){c=b.ctx;var d=a.ui.TextBox.specialImageMap[b.segment.imageKey];if(d){var e=b.textBox,h=b.x;b=b.y;var k=e.fontLineHeight,l=k;e.specialImageAdjust&&(k*=e.specialImageAdjust.scale,l*=e.specialImageAdjust.scale,h+=e.specialImageAdjust.x,b+=e.specialImageAdjust.y);e.baseline===a.ui.TextBox.baselineMiddle?b-=k/2:e.baseline===a.ui.TextBox.baselineBottom&&(b-=k);d.draw(c,h,b,l,k)}}});this.value=b;this.textChanged()};a.ui.TextBox.formatText=function(c,
b){function d(a,b,c){function d(a,b,c){for(;b<a.length;b++){a:for(var d=a;d[b]===e;)if(b=d[b+1]===h?d.indexOf(h,b+2):d[b+1]===f?d.indexOf(g,b+2):d.indexOf(e,b+2),0>b){b=-1;break a}if(0>b)break;if(a[b]===c)return b}return-1}var k="",l=-1;do if(l=d(a,0,b),0<=l){var m=d(a,l+1,b);0>m&&(m=a.length);k+=a.substring(0,l);k+=e;k+=f;k+=c;k+=a.substring(l+1,m);k+=e;k+=g;a=a.substring(m+1)}while(0<=l);return k+a}if(""===c)return"";if(!c)return null;if(!b||0===b.length)return c;for(var e=a.ui.TextBox.specialCharacter,
f=a.ui.TextBox.specialPushColorCode,g=a.ui.TextBox.specialPopColorCode,h=a.ui.TextBox.specialImageCode,k=0;k<b.length;k++){var l=b[k].color;"string"===typeof l&&(l=new a.graphics.Color(l));l=String.fromCharCode(l.r,l.g,l.b);c=d(c,b[k].formatChar,l)}return c=c.split("\\n").join("\n")};a.ui.TextBox.setFontHeightOverride=function(c,b){a.ui.TextBox.fontHeightOverrides[c]=b};a.ui.TextBox.setSpecialImageMap=function(c){a.ui.TextBox.specialImageMap=c};a.ui.TextBox.makeSpecialImageString=function(c){return""+
a.ui.TextBox.specialCharacter+a.ui.TextBox.specialImageCode+c+a.ui.TextBox.specialImageCode};a.ui.TextBox.prototype.setSpecialImageAdjust=function(c){c=a.utils.copyObject(c);c.x=c.x||0;c.y=c.y||0;c.scale=c.scale||1;this.specialImageAdjust=c};a.ui.TextBox.prototype.updateFontDescriptor=function(){var a=this.fontDescriptor;this.fontDescriptor=(""+this.fontStyle+" "+this.fontSize+"px "+this.font).trim();a!==this.fontDescriptor&&this.value&&0<this.value.length&&this.textChanged()};a.ui.TextBox.prototype.setFont=
function(a,b,d){this.font=a;b&&this.setFontSize(b);d&&this.setFontStyle(d);this.updateFontDescriptor()};a.ui.TextBox.prototype.setFontStyle=function(a){this.fontStyle=a;this.updateFontDescriptor()};a.ui.TextBox.prototype.setFontSize=function(c){this.fontSize=c;var b=0;this.font&&(b=a.ui.TextBox.fontHeightOverrides[this.font]);this.fontLineHeight=b?c*b|0:c+1;this.updateFontDescriptor()};a.ui.TextBox.prototype.setLineHeight=function(a){this.fontLineHeight=a};a.ui.TextBox.prototype.setAutoWrap=function(a,
b){void 0===b&&(b=!1);var c=this.autoWrap,e=this.forceWrap;this.autoWrap=a;this.forceWrap=b;c===a&&e===b||this.textChanged()};a.ui.TextBox.prototype.setSquishToFit=function(a){this.fitParams.tryCount=a.tryCount||this.fitParams.tryCount;this.fitParams.squishPerTry=a.squishPerTry||this.fitParams.squishPerTry};a.ui.TextBox.prototype.setStopLength=function(a){this.stopLength=void 0!==a?a:-1};a.ui.TextBox.prototype.getDrawnLengthTotal=function(a){return this.drawnLengthTotal};a.ui.TextBox.prototype.overrideMaxWidth=
function(a){-1==a&&(a=9999);this.maxWidth=a;this.overriddenMaxWidth=!0;this.textChanged();this.setDirty(!0)};a.ui.TextBox.prototype.setTextInset=function(a,b){var c=!1;void 0!==a&&(this.textInset.x=a,c=!0);void 0!==b&&(this.textInset.y=b,c=!0);c&&(this.textChanged(),this.setDirty(!0))};a.ui.TextBox.prototype.centerText=function(){this.setAlign(a.ui.TextBox.alignCenter);this.setBaseline(a.ui.TextBox.baselineMiddle)};a.ui.TextBox.prototype.leftAlignText=function(){this.setAlign(a.ui.TextBox.alignLeft)};
a.ui.TextBox.prototype.rightAlignText=function(){this.setAlign(a.ui.TextBox.alignRight)};a.ui.TextBox.prototype.setAlign=function(c){"string"===typeof c&&("left"===c?c=a.ui.TextBox.alignLeft:"center"===c?c=a.ui.TextBox.alignCenter:"right"===c&&(c=a.ui.TextBox.alignRight));c!==this.align&&this.setDirty(!0);this.align=c};a.ui.TextBox.prototype.setAlignment=a.ui.TextBox.prototype.setAlign;a.ui.TextBox.prototype.setBaseline=function(c){"string"===typeof c&&("top"===c?c=a.ui.TextBox.baselineTop:"middle"===
c?c=a.ui.TextBox.baselineMiddle:"bottom"===c&&(c=a.ui.TextBox.baselineBottom));c!==this.baseline&&this.setDirty(!0);this.baseline=c};a.ui.TextBox.prototype.setStroke=function(a,b,d){a&&void 0===b&&void 0===d&&"number"!==typeof a&&(d=a.doCleanup,b=a.color,a=a.lineWidth||a.width);void 0===d&&(d=!1);a===this.strokeWidth&&this.strokeCleanup===d||this.setDirty(!0);(this.strokeColor!==b||this.strokeColor&&b&&this.strokeColor.equal&&!this.strokeColor.equal(b))&&this.setDirty(!0);this.strokeWidth=a;this.strokeColor=
b;this.strokeCleanup=d};a.ui.TextBox.prototype.setShadowEnabled=function(a){a=void 0===a?!0:!!a;this.textShadowEnabled!==a&&(this.textShadowEnabled=a,this.setDirty(!0))};a.ui.TextBox.prototype.setShadow=function(a,b,d,e){var c=!1;a&&!this.textShadowColor.equal(a)&&(c=!0,this.textShadowColor.copyFrom(a));void 0!==b&&b!==this.textShadowOffset.x&&(c=!0,this.textShadowOffset.x=b);void 0!==d&&d!==this.textShadowOffset.y&&(c=!0,this.textShadowOffset.y=d);void 0!==e&&e!==this.textShadowBlur&&(c=!0,this.textShadowBlur=
e);this.textShadowEnabled=!0;c&&this.setDirty(!0)};a.ui.TextBox.prototype.setupAlignX=function(c,b){c.textAlign="left";c=this.align===a.ui.TextBox.alignLeft?this.strokeWidth/2+this.textInset.x:this.align===a.ui.TextBox.alignCenter?this.size.x/2-b/2:this.size.x-b-this.textInset.x;this.ignoreCenter||(c-=this.center.x);return c};a.ui.TextBox.prototype.setupAlignY=function(c){this.baseline===a.ui.TextBox.baselineTop?(c.textBaseline="top",c=this.textInset.y):this.baseline===a.ui.TextBox.baselineMiddle?
(c.textBaseline="middle",c=this.size.y/2):(c.textBaseline="bottom",c=this.size.y-this.textInset.y);this.ignoreCenter||(c-=this.center.y);return c};a.ui.TextBox.prototype.textChanged=function(){this.setDirty();if(!this.value||0>=this.value.length||!a.graphics.ctx)this.lines=[],this.rawTextWidth=this.textHeight=this.textWidth=0,this.setContentSize(0,0);else{a.graphics.ctx.font=this.fontDescriptor;var c=this.maxWidth;c-=2*this.textInset.x;0<this.strokeWidth&&this.strokeColor&&(c-=this.strokeWidth);this.drawnLengthTotal=
0;this.wrapAndFitText(c);this.lines=this.makeLineSegments(this.lines,a.graphics.ctx);var b=this.processLineWidths(),d=c/b;1<d&&(d=1);for(var e=0;e<this.lines.length;e++){for(var f=this.lines[e],g=0,h=0;h<f.segments.length;h++){var k=f.segments[h];k.width*=d;k.x=g;g+=k.width}f.width*=d}this.rawTextWidth=b;b>c&&(b=c);this.textWidth=b;this.setContentSize(this.textWidth+this.textInset.x,this.textHeight+this.textInset.y)}};a.ui.TextBox.prototype.wrapAndFitText=function(c){for(var b=this.fitParams.tryCount,
d=this.fontLineHeight,e=1,f=this.fitParams.squishPerTry,g=!1,h=0;!g&&h<b;h++){this.autoWrap?(d=a.ui.TextBox.specialCharacter,this.specialDraws||(d=0),this.lines=a.wordwrap.wrapString(this.value,c*e,a.graphics.ctx,d,this.specialDraws,this.forceWrap)):this.lines=this.value.split("\n");if(!this.lines||1>this.lines.length){this.lines=[];this.setContentSize(0,0);return}d=this.fontLineHeight*this.lines.length+this.fontLineSpacing*(this.lines.length-1);var k=this.size.y-2*this.textInset.y;1<this.lines.length&&
d>k?e+=f:g=!0}this.textHeight=d};a.ui.TextBox.prototype.makeLineSegments=function(c,b){for(var d={ctx:b,textBox:this},e={},f=this.specialDraws,g=0;g<c.length;g++){var h=c[g];if(f&&0<=h.indexOf(a.ui.TextBox.specialCharacter)){for(var k=function(a,c){a={text:h.substring(a,c)};c=b.measureText(a.text);a.width=c.width||c;l.segments.push(a)},l={segments:[]},m=0,n=0;n<h.length;n++)for(;h[n]===a.ui.TextBox.specialCharacter;){m<n&&k(m,n);m={isSpecial:!0};var p=0,r=2,w=h[n+1];m.code=w;d.string=h;d.stringPos=
n+2;d.segment=m;var q=f[w];q?(d.data=q,q.measure(d,e),p=e.width||0,r+=e.consumeCharacters||0):a.console.logWarningOnce("textbox segmenting special code "+w+" not handled.");m.text=h.substring(n,n+r);m.width=p;l.segments.push(m);m=n+=r}m<h.length&&k(m,h.length);c[g]=l}else k={text:h,width:b.measureText(h).width},c[g]={segments:[k]}}return c};a.ui.TextBox.prototype.processLineWidths=function(){for(var a=0,b=0;b<this.lines.length;b++){for(var d=0,e=this.lines[b],f=0;f<e.segments.length;f++){var g=e.segments[f];
d+=g.width;g.isSpecial||(this.drawnLengthTotal+=g.text.length)}e.width=d;e.width>a&&(a=e.width)}return a};a.ui.TextBox.prototype.getTextWidth=function(){return this.maxWidth<this.textWidth?this.maxWidth:this.textWidth};a.ui.TextBox.prototype.getTextHeight=function(){return this.textHeight};a.ui.TextBox.prototype.getRawTextWidth=function(){return this.rawTextWidth};a.ui.TextBox.prototype.prepStyle=function(a){a.font=this.fontDescriptor;a.fillStyle=this.color.a?this.color.toString():this.color;0<this.strokeWidth&&
this.strokeColor&&(a.strokeStyle=this.strokeColor.toString(),a.lineWidth=this.strokeWidth);this.textShadowEnabled&&0<this.textShadowColor.a&&(a.shadowColor=this.textShadowColor.toString(),a.shadowOffsetX=this.textShadowOffset.x,a.shadowOffsetY=this.textShadowOffset.y,a.shadowBlur=this.textShadowBlur)};a.ui.TextBox.prototype.drawSegment=function(a,b,d,e,f){0<this.strokeWidth&&this.strokeColor&&a.strokeText(f,b,d,e);a.fillText(f,b,d,e);if(this.strokeCleanup&&0<=this.strokeWidth&&this.strokeColor){var c=
a.globalAlpha,h=a.lineWidth,k=h/50;1>k&&(k=1);a.globalAlpha*=.3;a.lineWidth=k;a.strokeText(f,b,d,e);a.globalAlpha=c;a.lineWidth=h}};a.ui.TextBox.prototype.drawLine=function(a,b,d,e){for(var c=0;c<e.segments.length&&!(0<=this.stopLength&&this.drawnLength>=this.stopLength);c++){var g=e.segments[c];if(g.isSpecial){var h=this.specialDraws[g.code];if(!h)break;h.drawFunc({code:g.code,data:h,segment:g,ctx:a,textBox:this,string:g.text,stringPos:2,x:b,y:d,width:g.width},{})}else{h=g.text;var k=g.text.length;
0<=this.stopLength&&this.drawnLength+k>=this.stopLength&&(k=this.stopLength-this.drawnLength,h=h.substr(0,k));this.drawSegment(a,b,d,g.width,h);this.drawnLength+=k}b+=g.width}};a.ui.TextBox.prototype.drawSelf=function(){if(this.value){var c=a.graphics.getContext();this.prepStyle(c);for(var b in this.specialDraws){var d=this.specialDraws[b];d.preDrawFunc&&d.preDrawFunc({code:b,data:d,ctx:c,textBox:this},{})}this.drawnLength=0;if(0<this.lines.length){b=this.setupAlignY(c);d=this.fontLineHeight+this.fontLineSpacing;
var e=this.lines.length*d;this.baseline===a.ui.TextBox.baselineMiddle?b-=(e-d)/2:this.baseline===a.ui.TextBox.baselineBottom&&(b-=e-d);for(var f=0;f<this.lines.length;f++)e=this.setupAlignX(c,this.lines[f].width),this.drawLine(c,e,b,this.lines[f]),b+=d}else e=this.setupAlignX(c,this.textWidth),b=this.setupAlignY(c),this.drawLine(c,e,b,{segments:[{text:this.value}]})}};a.ui.TextBox.prototype.boundsChanged=function(){this.overriddenMaxWidth||(this.maxWidth=this.size.x);a.ui.TextBox.prototype.parentPrototype.boundsChanged.call(this);
this.textChanged();this.setDirty(!0)};a.ui.TextBox.standardFontEditProperties={label:"font",props:[{label:"font",propName:"font.font",type:"string",defValue:"impact"},{label:"size",propName:"font.size",type:"float",defValue:40},{label:"style",propName:"font.style",type:"string"},{label:"lineHeight",propName:"font.lineHeight",type:"float"}]};a.ui.TextBox.standardFontStrokeEditProperties={label:"stroke",props:[{label:"width",propName:"font.stroke.width",type:"float"},{label:"color",propName:"font.stroke.color",
type:"color"},{label:"cleanup",propName:"font.stroke.doCleanup",type:"boolean",tipText:"expensive way to try to make edges nicer"}]};a.ui.TextBox.editProperties=[{label:"text",props:[{propName:"text",type:"string"},{propName:"translateText",type:"string",tipText:"overrides text, tries to translate first"},{propName:"autoWrap",type:"boolean"}]},a.ui.TextBox.standardFontEditProperties,{label:"align",props:[{propName:"align",type:"string",defValue:"left"},{propName:"baseline",type:"string",defValue:"middle",
tipText:"vertical alignment"}]},a.ui.TextBox.standardFontStrokeEditProperties];a.ui.TextBox.setupFromData=function(c,b,d){a.ui.data.callParentSetupFromData(a.ui.TextBox,c,b,d);b.font&&(void 0!=b.font.font&&c.setFont(b.font.font),void 0!=b.font.size&&c.setFontSize(b.font.size),void 0!=b.font.style&&c.setFontStyle(b.font.style),b.font.lineHeight&&c.setLineHeight(b.font.lineHeight),void 0!=b.font.stroke&&c.setStroke(b.font.stroke.width,a.graphics.fixColorStyle(b.font.stroke.color),b.font.stroke.doCleanup));
"left"===b.align?c.setAlign(a.ui.TextBox.alignLeft):"center"===b.align?c.setAlign(a.ui.TextBox.alignCenter):"right"===b.align&&c.setAlign(a.ui.TextBox.alignRight);"top"===b.baseline?c.setBaseline(a.ui.TextBox.baselineTop):"middle"===b.baseline||"center"===b.baseline?c.setBaseline(a.ui.TextBox.baselineMiddle):"bottom"===b.baseline&&c.setBaseline(a.ui.TextBox.baselineBottom);void 0!==b.autoWrap&&c.setAutoWrap(!!b.autoWrap);b.translateText?c.translateAndSetTextValue(b.translateText||""):c.setTextValue(b.text||
"")};a.ui.TranslatedTextBox=function(c){a.string&&(c=a.string.getString(c));a.ui.TranslatedTextBox.prototype.parentConstructor.call(this,c)};a.utils.inheritClassFrom(a.ui.TranslatedTextBox,a.ui.TextBox);a.ui.TranslatedTextBox.prototype.setTextValue=function(c){a.ui.TranslatedTextBox.prototype.parentPrototype.translateAndSetTextValue.call(this,c)};a.ui.TranslatedTextBox.prototype.setTextValueRaw=function(c){a.ui.TranslatedTextBox.prototype.parentPrototype.setTextValue.call(this,c)}});
rat.modules.add("rat.ui.r_ui_data",[{name:"rat.utils.r_utils",processBefore:!0},{name:"rat.ui.r_ui",processBefore:!0},"rat.debug.r_console","rat.utils.r_shapes"],function(a){function c(a,b){void 0!==a.val&&(a.percent&&(a.val*=b),a.fromParent&&(a.val+=b),a=a.val);return a}function b(a,b,c){void 0===a.val&&(a={val:a});a.percent&&(a.val*=b);if(a.fromCenter)a.val+=b/2;else if(a.fromParentEdge||a.fromParentFarEdge)a.val=b-a.val;if(a.centered||a.drawCentered||a.center)a.val-=c/2;else if(a.fromMyEdge||a.fromMyFarEdge)a.val-=
c;return a=a.val}a.ui.data={};a.ui.data.inDesignTime=!1;a.ui.data.calcBounds=function(d,e){d=a.utils.copyObject(d.bounds||{},!0);d.x=d.x||0;d.y=d.y||0;d.w=d.w||0;d.h=d.h||0;if(d.noChange)return void 0!==d.x.val&&(d.x.val=d.x.val),void 0!==d.y.val&&(d.y.val=d.y.val),void 0!==d.w.val&&(d.w.val=d.w.val),void 0!==d.h.val&&(d.h.val=d.h.val),d;if(d.autoFill)return{x:0,y:0,w:e.w,h:e.h};d.w=c(d.w,e.w);d.h=c(d.h,e.h);d.x=b(d.x,e.w,d.w);d.y=b(d.y,e.h,d.h);return d};a.ui.data.getSetupCallsForType=function(b){"Container"===
b&&(b="Element");a.ui[b]||(a.console.logWarning("WARNING! Unknown pane type '"+b+"' hit in createPaneFromData.  Falling back to Element."),b="Element");var c=a.ui[b];c||(a.console.logWarning("WARNING! Unable to find createFromData for element of type "+b+".  Reverting to rat.ui.Element.createFromData"),c=a.ui.Element);for(var d=c;d&&!d.setupFromData;)d=d.prototype?d.prototype.parentConstructor:void 0;d||(a.console.logWarning("WARNING! Unable to find createFromData for element of type "+b+".  Reverting to rat.ui.Element.createFromData"),
d=a.ui.Element);return{paneType:b,elementClass:c,setupClass:d}};a.ui.data.createPaneFromData=function(b,c){if(b._editor&&b._editor.designTimeOnly)return null;c=c?c.getBounds():{x:0,y:0,w:0,h:0};var d=a.ui.data.getSetupCallsForType(b.type),e=new d.elementClass;d.setupClass.setupFromData&&d.setupClass.setupFromData(e,b,c);a.ui.data.createChildrenFromData(e,b.children);if(b.onCreate)b.onCreate(e);return e};a.ui.data.createChildrenFromData=function(b,c){if(b&&c)for(var d=0;d!==c.length;++d){var e=a.ui.data.createPaneFromData(c[d],
b);e&&b.appendSubElement(e)}};a.ui.data.callParentSetupFromData=function(a,b,c,g){do a&&(a=a.prototype?a.prototype.parentConstructor:void 0);while(a&&!a.setupFromData);a&&a.setupFromData(b,c,g)};a.ui.data.createTreeFromData=function(b,c){return a.ui.data.createPaneFromData(b,{getBounds:function(){return c?c:new a.shapes.Rect(0,0,a.graphics.SCREEN_WIDTH,a.graphics.SCREEN_HEIGHT)}})};a.ui.data.preLoadAssetsFromData=function(b){var c=[],d=function(a){if("object"===typeof a&&null!==a)for(var b in a){var e=
a[b];if(void 0!==e&&a.hasOwnProperty(b))if("string"===typeof e){var f=e.substring(e.length-4).toLowerCase();".png"!==f&&".jpg"!==f&&".gif"!==f&&".svg"!==f&&".bmp"!==f&&".ico"!==f||c.push(e)}else"object"===typeof e&&d(e)}};0<c.length&&a.graphics.preLoadImages(c);d(b)}});
rat.modules.add("rat.utils.r_eventmap",["rat.debug.r_console"],function(a){a.eventMap={};var c={};a.eventMap.register=function(a,d){d&&(a=a.toUpperCase(),c[a]?c[a].push(d):c[a]=[d])};a.eventMap.registerHandler=a.eventMap.register;a.eventMap.add=a.eventMap.register;a.eventMap.fireEvent=function(a,d){a=a.toUpperCase();var b=c[a];if(b){var f=Array.prototype.slice.call(arguments);f.splice(0,2);for(var g=b.length,h=0;h<g;++h)b[h].apply(d,f)}};a.eventMap.fire=a.eventMap.fireEvent});
rat.modules.add("rat.ui.r_ui_shape",[{name:"rat.ui.r_ui",processBefore:!0},{name:"rat.utils.r_utils",processBefore:!0},"rat.debug.r_console","rat.ui.r_ui_data","rat.graphics.r_graphics","rat.math.r_math"],function(a){a.ui.Shape=function(c,b){var d=c;"number"===typeof c&&(d=null,b=c);a.ui.Shape.prototype.parentConstructor.call(this,d);void 0===b?this.shapeType=a.ui.circleShape:this.setShapeType(b);this.cornerRadius=5;this.strokeWidth=-1;this.strokeColor=null};a.utils.inheritClassFrom(a.ui.Shape,a.ui.Element);
a.ui.Shape.prototype.elementType="shape";a.ui.noShape=0;a.ui.circleShape=1;a.ui.squareShape=2;a.ui.roundRectShape=3;a.ui.triangleShape=4;a.ui.pathShape=5;a.ui.Shape.typeNames={none:a.ui.noShape,circle:a.ui.circleShape,square:a.ui.squareShape,rect:a.ui.squareShape,roundRect:a.ui.roundRectShape,roundrect:a.ui.roundRectShape,triangle:a.ui.triangleShape,tri:a.ui.triangleShape,path:a.ui.pathShape};a.ui.Shape.prototype.setShapeType=function(c){"string"===typeof c&&(c=a.ui.Shape.typeNames[c]);c!=this.shapeType&&
this.setDirty(!0);this.shapeType=c};a.ui.Shape.prototype.setCornerRadius=function(a){0>a&&(a=0);a!=this.cornerRadius&&this.setDirty(!0);this.cornerRadius=a};a.ui.Shape.prototype.setStroke=function(a,b){a===this.strokeWidth&&b==this.strokeColor||this.setDirty(!0);this.strokeWidth=a;this.strokeColor=b};a.ui.Shape.prototype.drawSelf=function(){var c=a.graphics.getContext();if(this.shapeType===a.ui.circleShape){c.beginPath();var b=a.math.min(this.size.x,this.size.y)/2;c.arc(this.size.x/2-this.center.x,
this.size.y/2-this.center.y,b,0,2*Math.PI,!0);c.closePath()}else if(this.shapeType===a.ui.squareShape)c.beginPath(),c.rect(0-this.center.x,0-this.center.y,this.size.x,this.size.y),c.closePath();else if(this.shapeType===a.ui.triangleShape)c.beginPath(),c.moveTo(0-this.center.x,0-this.center.y),c.lineTo(0-this.center.x,this.size.y-this.center.y),c.lineTo(this.size.x-this.center.x,this.size.y/2-this.center.y),c.closePath();else if(this.shapeType===a.ui.roundRectShape)a.graphics.roundRect({x:0-this.center.x,
y:0-this.center.y,w:this.size.x,h:this.size.y},this.cornerRadius);else return;c.fillStyle=this.color.toString();c.fill();this.strokeWidth&&this.strokeColor&&(c.lineWidth=this.strokeWidth,c.strokeStyle=this.strokeColor.toString(),c.stroke())};a.ui.Shape.editProperties=[{label:"shape",props:[{propName:"shapeType",type:"integer"},{propName:"cornerRadius",type:"float"},{label:"strokeWidth",propName:"strokeWidth",type:"float"},{label:"strokeColor",propName:"strokeColor",type:"color"}]}];a.ui.Shape.setupFromData=
function(c,b,d){a.ui.data.callParentSetupFromData(a.ui.Shape,c,b,d);void 0!==b.shapeType&&(c.shapeType=b.shapeType);void 0!==b.cornerRadius&&c.setCornerRadius(b.cornerRadius);void 0!==b.strokeWidth&&(c.strokeWidth=b.strokeWidth);void 0!==b.strokeColor&&(c.strokeColor=b.strokeColor)}});
rat.modules.add("rat.input.r_inputmap",["rat.input.r_input"],function(a){a.InputMap=function(c,b){this.events={};this.map=c;b&&0!==b||!this.checkBounds(b)||!this.map[b]?this.index=this.defaultIndex=-1:this.index=this.defaultIndex=b;this.validateMap();this.navigateSound=a.InputMap.defaultNavigateSound;0<=this.index&&this.focusButton(this.index,!0)};a.InputMap.defaultNavigateSound=void 0;a.InputMap.prototype.setOnChange=function(a){this.events.onChange=a};a.InputMap.prototype.validateMap=function(){for(var a,
b=0;b<this.map.length;++b){var d=this.map[b],e=["up","left","right","down","select"];for(a=0;a<e.length;a++){var f=d[e[a]];if(f){for(var g=null,h=0;h<this.map.length;++h)this.map[h].currObj===f&&(g=f);g||(d[e[a]]=null)}}}};a.InputMap.prototype.setDirectionMapping=function(a,b,d){a=this.getIndexByButton(a);var c=this.getIndexByButton(d);0>a||null!==d&&0>c||(this.map[a][b]=d)};a.InputMap.prototype.handleKeyDown=function(c){switch(c.which){case a.keys.leftArrow:var b="left";break;case a.keys.upArrow:b=
"up";break;case a.keys.rightArrow:b="right";break;case a.keys.downArrow:b="down";break;case a.keys.enter:b="select";break;default:return}return this.handleDirection(b,c)};a.InputMap.prototype.handleDirection=function(c,b){if(this.checkBounds(this.index)){var d=this.map[this.index];if("select"===c)this.doPress(this.map[this.index].currObj,b);else{if(d&&d[c]&&d.currObj!==d[c]){var e;c=d[c];for(b=0;b<this.map.length;++b)this.map[b].currObj===c&&(e=b);this.navigateSound&&a.audio&&a.audio.playSound(this.navigateSound);
this.focusButton(e);return!0}if(d&&(this.doFocus(d.currObj),d.currObj.handleDirection&&d.currObj.handleDirection(c)))return!0}}else if(-1===this.index&&(-1===this.defaultIndex&&0<this.map.length?this.index=0:this.checkBounds(this.defaultIndex)&&(this.index=this.defaultIndex),this.checkBounds(this.index)))return this.doFocus(this.map[this.index].currObj),!0;return!1};a.InputMap.prototype.handleTab=function(a){var b=1;a.sysEvent.shiftKey&&(b=-1);if(this.checkBounds(this.index)){var c=this.map[this.index],
e=0;if(void 0!==c.tabOrder)for(newOrder=c.tabOrder+b,0>newOrder?newOrder=this.map.length-1:newOrder>this.map.length-1&&(newOrder=0),b=0;b<this.map.length;++b){if(this.map[b].tabOrder===newOrder){e=b;break}}else e=this.index+b,0>e?e=this.map.length-1:e>this.map.length-1&&(e=0);this.focusButton(e);this.index===e&&(e=this.map[e].currObj,e.handleTabbedTo&&e.handleTabbedTo(a));return!0}return!1};a.InputMap.prototype.doFocus=function(a,b){return a.Focus?a.Focus():a.focus?a.focus(b):!1};a.InputMap.prototype.doBlur=
function(a){return a.Blur?a.Blur():a.blur?a.blur():!1};a.InputMap.prototype.doPress=function(a,b){return a.Press?a.Press(b):a.press?a.press(b):!1};a.InputMap.prototype.getButtonCount=function(){return this.map.length};a.InputMap.prototype.getButton=function(a){return this.checkBounds(a)?this.map[a].currObj:null};a.InputMap.prototype.getCurrIndexButton=function(){return this.checkBounds(this.index)?this.map[this.index].currObj:null};a.InputMap.prototype.getCurrentFocusedButton=a.InputMap.prototype.getCurrIndexButton;
a.InputMap.prototype.getTarget=a.InputMap.prototype.getCurrIndexButton;a.InputMap.prototype.getTargetForEvent=function(a){return this.getTarget()};a.InputMap.prototype.getIndexByButton=function(a){for(var b=0;b<this.map.length;++b)if(this.map[b].currObj===a)return b;return-1};a.InputMap.prototype.focusButton=function(a,b){var c=this.index;if(a===this.index)if(b)c=-1;else return;if(this.checkBounds(a)&&this.map[a]&&(this.doFocus(this.map[a].currObj,b)&&this.checkBounds(c)&&this.map[c]&&this.doBlur(this.map[c].currObj),
this.index=a,this.events.onChange))this.events.onChange(this.map[a].currObj,this.map[c]?this.map[c].currObj:void 0)};a.InputMap.prototype.focusByButton=function(a,b){a=this.getIndexByButton(a);0>a||this.focusButton(a,b)};a.InputMap.prototype.clearIndex=function(){this.index=-1};a.InputMap.prototype.unFocusCurrent=function(){var a=this.getCurrIndexButton();a&&this.doBlur(a);this.index=-1};a.InputMap.prototype.reset=function(){this.index!==this.defaultIndex&&(this.checkBounds(this.index)&&this.doBlur(this.map[this.index].currObj),
this.checkBounds(this.defaultIndex)&&this.doFocus(this.map[this.defaultIndex].currObj),this.index=this.defaultIndex)};a.InputMap.prototype.checkBounds=function(a){return 0<=a&&a<this.map.length?!0:!1};a.InputMap.prototype.dumpList=function(c){a.console.log("inputmap: "+this.map.length+" elements:");for(c=0;c<this.map.length;++c){var b=this.map[c].currObj;a.console.log(""+c+" : "+(b.name||"(no name)")+" "+("type: "+(b.elementType||"?")))}};a.InputMap.prototype.drawDebug=function(c){c.fillStyle="#FF00FF";
c.strokeStyle="#FF00FF";var b=a.graphics.SCREEN_WIDTH/2048,d=50*b;c.lineWidth=3*b;for(b=0;b<this.map.length;++b){var e=this.map[b],f=e.currObj,g=f.getGlobalPos();g.x+=f.size.x/2;g.y+=f.size.y/2;c.strokeStyle="#FF00FF";c.beginPath();c.arc(g.x,g.y,d,0,2*Math.PI);c.closePath();c.stroke();c.strokeStyle="rgba(255, 0, 255, 0.3)";f=["up","left","right","down"];for(dIndex=0;dIndex<f.length;dIndex++){var h=e[f[dIndex]];if(h){var k=h.getGlobalPos();k.x+=h.size.x/2;k.y+=h.size.y/2;c.beginPath();c.moveTo(g.x,
g.y);c.lineTo(k.x,k.y);c.closePath();c.stroke()}}}}});
rat.modules.add("rat.ui.r_ui_button",[{name:"rat.utils.r_utils",processBefore:!0},{name:"rat.ui.r_ui",processBefore:!0},{name:"rat.ui.r_ui_textbox",processBefore:!0},"rat.ui.r_ui_bubblebox","rat.ui.r_ui_sprite","rat.graphics.r_image","rat.graphics.r_graphics"],function(a){function c(a){a.setSize(a.buttonImage.size.x,a.buttonImage.size.y)}a.ui.Button=function(b,c,e,f,g,h,k,l){var d=arguments,n=b;"object"!==typeof b||b&&!b.elementType?n=null:(d=Array.prototype.slice.call(arguments),d.splice(0,1));a.ui.Button.prototype.parentConstructor.call(this,
n);this.flags|=a.ui.Element.autoSizeAfterLoadFlag;this.setTargetable(!0);this.isSetup=!1;void 0!==d[0]&&this.setupButton.apply(this,d)};a.utils.inheritClassFrom(a.ui.Button,a.ui.Element);a.ui.Button.prototype.elementType="button";a.ui.Button.prototype.flagsThatDirtyMe=a.ui.Element.highlightedFlag|a.ui.Element.enabledFlag|a.ui.Element.pressedFlag|a.ui.Element.toggledFlag;a.ui.Button.prototype.textInset=8;a.ui.Button.prototype.textOffsetX=0;a.ui.Button.prototype.textOffsetY=0;a.ui.Button.prototype.useFontSize=
!1;a.ui.Button.spriteType=1;a.ui.Button.bubbleType=2;a.ui.Button.cheapType=3;a.ui.Button.coolType=4;a.ui.Button.typeNames={sprite:a.ui.Button.spriteType,bubble:a.ui.Button.bubbleType,cheap:a.ui.Button.cheapType,cool:a.ui.Button.coolType};a.ui.Button.defaultClickSound="click";a.ui.Button.defaultFocusSound=void 0;a.ui.Button.standardCornerScale=1/6;a.ui.Button.prototype.setupButton=function(b,c,e,f,g,h,k){this.isSetup&&(this.removeAllSubElements(),this.text=this.buttonImage=null,this.colorStates=void 0);
this.isSetup=!0;"string"===typeof b&&(b=a.ui.Button.typeNames[b]);this.type=b;b===a.ui.Button.spriteType?this.buttonImage=new a.ui.Sprite:b===a.ui.Button.bubbleType?this.buttonImage=new a.ui.BubbleBox:b!==a.ui.Button.cheapType&&b!==a.ui.Button.coolType||!c||(this.buttonImage=new a.ui.Sprite);this.buttonImage&&(this.appendSubElement(this.buttonImage),this.buttonImage.name+="(button)",this.copyContentFlagsToImage());(c||e||f||g)&&this.setStandardImages(c,e,f,g);this.toggles=!1;this.clickSound=a.ui.Button.defaultClickSound;
this.focusSound=a.ui.Button.defaultFocusSound;this.name="<but>"+this.id;this.buttonImage&&this.boundsChanged();this.cornerRadius=10;this.cornerRadiusSet=!1;this.setDirty(!0)};a.ui.makeSpriteButton=function(b,c,e,f,g,h){return new a.ui.Button(a.ui.Button.spriteType,b,c,e,f,g,h)};a.ui.makeBubbleButton=function(b,c,e,f){return new a.ui.Button(a.ui.Button.bubbleType,b,c,e,f)};a.ui.Button.createStandardColorStates=function(b,c){"string"===typeof b&&(b=new a.graphics.Color(b));"undefined"===typeof c&&(c=
4);var d=[];d.push({flags:a.ui.Element.enabledFlag,color:b.copy(),textColor:new a.graphics.Color(4*b.r,4*b.g,4*b.b,b.a),frameColor:new a.graphics.Color(b.r/4,b.g/4,b.b/4,b.a),frameWidth:c});d.push({flags:a.ui.Element.enabledFlag|a.ui.Element.highlightedFlag,color:new a.graphics.Color(b.r+50,b.g+50,b.b+50,b.a),textColor:new a.graphics.Color(6*b.r,6*b.g,6*b.b,b.a),frameColor:new a.graphics.Color(b.r/5,b.g/5,b.b/5,b.a),frameWidth:c});d.push({flags:a.ui.Element.enabledFlag|a.ui.Element.pressedFlag,color:new a.graphics.Color(b.r/
2,b.g/2,b.b/2,b.a),textColor:new a.graphics.Color(4*b.r,4*b.g,4*b.b,b.a),frameColor:new a.graphics.Color(b.r/5,b.g/5,b.b/5,b.a),frameWidth:c});var f=d[d.length-1];d.push({flags:a.ui.Element.enabledFlag|a.ui.Element.highlightedFlag|a.ui.Element.pressedFlag,color:f.color.copy(),textColor:d[1].textColor.copy(),frameColor:f.frameColor.copy(),frameWidth:f.frameWidth});d.push({flags:a.ui.Element.enabledFlag|a.ui.Element.toggledFlag,color:d[0].color.copy(),textColor:new a.graphics.Color(10*b.r,10*b.g,10*
b.b,b.a),frameColor:new a.graphics.Color(4*b.r,4*b.g,4*b.b,b.a),frameWidth:c});d.push({flags:a.ui.Element.enabledFlag|a.ui.Element.toggledFlag|a.ui.Element.highlightedFlag,color:d[1].color.copy(),textColor:d[1].textColor.copy(),frameColor:new a.graphics.Color(4*b.r,4*b.g,4*b.b,b.a),frameWidth:c});d.push({flags:a.ui.Element.enabledFlag|a.ui.Element.toggledFlag|a.ui.Element.pressedFlag,color:d[2].color.copy(),textColor:d[2].textColor.copy(),frameColor:new a.graphics.Color(4*b.r,4*b.g,4*b.b,b.a),frameWidth:c});
d.push({flags:0,color:new a.graphics.Color(120,120,120,b.a),textColor:new a.graphics.Color(64,64,64,b.a),frameColor:new a.graphics.Color(64,64,64,b.a),frameWidth:c});return d};a.ui.makeCheapButton=function(b,c){c=a.ui.Button.createStandardColorStates(c);return a.ui.makeCheapButtonWithColors(b,c)};a.ui.makeCoolButton=function(b,c){c=a.ui.Button.createStandardColorStates(c);b=new a.ui.Button(a.ui.Button.coolType,b);b.colorStates=c;return b};a.ui.makeCheapButtonWithColors=function(b,c){b=new a.ui.Button(a.ui.Button.cheapType,
b);b.colorStates=c;return b};a.ui.Button.prototype.checkDirty=function(){return this.buttonImage&&this.buttonImage.isDirty||this.text&&this.text.isDirty||this.isDirty?!0:!1};a.ui.Button.prototype.setOutline=function(a,c){this.buttonImage&&this.buttonImage.setOutline(a,c)};a.ui.Button.prototype.copyContentFlagsToImage=function(){if(this.buttonImage){var b=0|a.ui.Element.autoSizeAfterLoadFlag|a.ui.Element.autoScaleAfterLoadFlag|a.ui.Element.autoCenterAfterLoadFlag,c=this.buttonImage.flags;this.buttonImage.flags&=
~b;this.buttonImage.flags|=this.flags&b;this.buttonImage.checkFlagsChanged(c)}};a.ui.Button.prototype.setFlag=function(b,c){a.ui.Button.prototype.parentPrototype.setFlag.call(this,b,c);this.copyContentFlagsToImage()};a.ui.Button.prototype.boundsChanged=function(){this.setContentSize(this.size.x,this.size.y);this.type===a.ui.Button.bubbleType?this.buttonImage&&this.buttonImage.setSize(this.size.x,this.size.y):this.type===a.ui.Button.spriteType&&this.buttonImage&&this.buttonImage.setSize(this.size.x,
this.size.y);this.text&&this.resizeTextBox();this.type!==a.ui.Button.coolType||this.cornerRadiusSet||(this.cornerRadius=this.size.y*a.ui.Button.standardCornerScale|0);a.ui.Button.prototype.parentPrototype.boundsChanged.call(this)};a.ui.Button.prototype.setSize=function(b,c){this.flags&=~a.ui.Element.autoSizeAfterLoadFlag;a.ui.Button.prototype.parentPrototype.setSize.call(this,b,c)};a.ui.Button.prototype.centerContent=function(){this.buttonImage&&this.buttonImage.centerInParent();this.text&&this.text.centerInParent()};
a.ui.Button.prototype.scaleImageToSize=function(){this.buttonImage&&this.buttonImage.scaleImageToSize()};a.ui.Button.prototype.setAdjustForScale=function(b){a.ui.Element.prototype.setAdjustForScale.call(this,b);this.buttonImage&&this.buttonImage.setAdjustForScale(b)};a.ui.Button.prototype.setAutoRepeat=function(b){if(b){var c={initialDelay:1,startDelay:.5,delayMultiplier:1,minimumDelay:.1,isTracking:!1};a.utils.extendObject(c,b,!0,!0);this.autoRepeat=c;this.resetAutoRepeat()}else this.autoRepeat=
null};a.ui.Button.prototype.resetAutoRepeat=function(a){if(a=this.autoRepeat)a.timer=a.initialDelay,a.delay=a.initialDelay,a.pressCount=0,a.isTracking=!1};a.ui.Button.prototype.startAutoRepeat=function(a){this.autoRepeat&&(this.autoRepeat.isTracking=!0)};a.ui.Button.prototype.stopAutoRepeat=function(a){this.autoRepeat&&(this.autoRepeat.isTracking=!1)};a.ui.Button.prototype.trackAutoRepeat=function(a){var b=this.autoRepeat;b&&(this.isPressed()||b.isTracking)&&(b.timer-=a,0>=b.timer&&(this.press(),
1===b.pressCount?b.delay=b.startDelay:(b.delay*=b.delayMultiplier,b.delay=Math.max(b.delay,b.minimumDelay)),b.timer=b.delay))};a.ui.Button.prototype.setTextInset=function(a){this.textInset!=a&&(this.textInset=a,this.resizeTextBox())};a.ui.Button.prototype.setTextOffset=function(a,c){if(this.textOffsetX!==a||this.textOffsetY!==c)this.textOffsetX=a,this.textOffsetY=c,this.resizeTextBox()};a.ui.Button.prototype.setTextPosition=function(b,c){this.text&&(this.text.place.pos.x===b&&this.text.place.pos.y===
c||this.setDirty(!0),this.text.place.pos.x=b,this.text.place.pos.y=c,this.text.setAlign(a.ui.TextBox.alignLeft),this.text.setBaseline(a.ui.TextBox.baselineTop))};a.ui.Button.prototype.getTextBox=function(){return this.text};a.ui.Button.prototype.checkAndMakeTextBox=function(){this.text||(this.text=new a.ui.TextBox(""),this.text.setEnabled(!1),this.resizeTextBox(),this.appendSubElement(this.text),this.text.centerText());return this.text};a.ui.Button.prototype.resizeTextBox=function(){this.text&&(this.text.setPos(this.textInset+
this.textOffsetX,this.textOffsetY),this.text.setSize(this.size.x-2*this.textInset,this.size.y),this.useFontSize?this.text.setFontSize(this.useFontSize):this.text.setFontSize(.7*this.size.y|0))};a.ui.Button.prototype.removeTextBox=function(){this.text&&(this.removeSubElement(this.text),this.text=null)};a.ui.Button.prototype.getImage=function(){return this.buttonImage};a.ui.Button.prototype.setTextValue=function(a){this.checkAndMakeTextBox().setTextValue(a);this.name="<but>"+this.id+"("+a+")";this.telemetryName=
a};a.ui.Button.prototype.translateAndSetTextValue=function(a){this.name="<but>"+this.id+"("+a+")";this.telemetryName=a;this.checkAndMakeTextBox().translateAndSetTextValue(a)};a.ui.Button.prototype.setFont=function(a,c,e){this.checkAndMakeTextBox().setFont(a,c,e);c&&(this.useFontSize=c)};a.ui.Button.prototype.setFontStyle=function(a){this.checkAndMakeTextBox().setFontStyle(a)};a.ui.Button.prototype.setFontSize=function(a){this.checkAndMakeTextBox().setFontSize(a);this.useFontSize=a};a.ui.Button.prototype.setCornerRadius=
function(a){a!=this.cornerRadius&&this.setDirty(!0);this.cornerRadius=a;this.cornerRadiusSet=!0};a.ui.Button.prototype.setTextColors=function(b,c,e,f){"undefined"===typeof c&&(c=b);"undefined"===typeof e&&(e=b);"undefined"===typeof f&&(f=b);var d=a.ui.Element;this.setStateTextColors([{state:d.enabledFlag,textColor:b},{state:d.enabledFlag|d.highlightedFlag,textColor:c},{state:d.enabledFlag|d.pressedFlag,textColor:e},{state:d.enabledFlag|d.highlightedFlag|d.pressedFlag,textColor:e},{state:d.enabledFlag|
d.toggledFlag,textColor:e},{state:d.enabledFlag|d.toggledFlag|d.highlightedFlag,textColor:c},{state:d.enabledFlag|d.toggledFlag|d.pressedFlag,textColor:b},{state:0,textColor:f}])};a.ui.Button.prototype.setTextColor=a.ui.Button.prototype.setTextColors;a.ui.Button.prototype.setStandardImages=function(b,c,e,f){void 0===c&&(c=b);void 0===e&&(e=b);void 0===f&&(f=b);if("string"!==typeof b){var d=b;b=void 0}if("string"!==typeof c){var h=c;c=void 0}if("string"!==typeof e){var k=e;e=void 0}if("string"!==typeof f){var l=
f;f=void 0}var m=a.ui.Element;this.setStateImages([{state:m.enabledFlag,resource:b,imageRef:d},{state:m.enabledFlag|m.highlightedFlag,resource:c,imageRef:h},{state:m.enabledFlag|m.pressedFlag,resource:e,imageRef:k},{state:m.enabledFlag|m.highlightedFlag|m.pressedFlag,resource:e,imageRef:k},{state:m.enabledFlag|m.toggledFlag,resource:e,imageRef:k},{state:m.enabledFlag|m.toggledFlag|m.highlightedFlag,resource:c,imageRef:h},{state:m.enabledFlag|m.toggledFlag|m.pressedFlag,resource:b,imageRef:d},{state:0,
resource:f,imageRef:l}])};a.ui.Button.prototype.setStateTextColors=function(a){this.setStatesByField(a,"textColor")};a.ui.Button.prototype.setTextColorStates=a.ui.Button.prototype.setStateTextColors;a.ui.Button.prototype.setStateColors=function(a){this.setStatesByField(a,"color")};a.ui.Button.prototype.setStateFrameColors=function(a){this.setStatesByField(a,"frameColor")};a.ui.Button.prototype.setStateFrameWidth=function(a){this.setStatesByField(a,"frameWidth")};a.ui.Button.prototype.setStateImages=
function(b,c,e){for(var d=0;d<b.length;d++){var g=b[d],h=!1;"undefined"===typeof g.imageRef&&(g.resource||a.console.logError("Error:  no imageRef or image specified in setStateImages"),g.imageRef=a.graphics.makeImage(g.resource,c,e),Array.isArray(g.resource)?g.imageRef.setAnimSpeed(1):h=!0);"undefined"===typeof g.doUpdate&&(g.doUpdate=h||!g.imageRef?!1:!0)}this.setStatesByField(b,"imageRef");this.setStatesByField(b,"doUpdate")};a.ui.Button.prototype.setStatesByField=function(b,c){this.colorStates||
(this.colorStates=[]);for(var d=null,f=0;f<b.length;f++){var g=b[f],h=this.getMyMatchingStateIndex(g.state,!0);g=g[c];"textColor"!==c&&"color"!==c&&"frameColor"!==c||"string"!==typeof g||(g=a.graphics.Color.makeFromStyleString(g));"imageRef"===c&&g&&!d&&(d=g);this.colorStates[h][c]=g}d&&this.buttonImage&&(this.buttonImage.useImageRef(d),this.setContentSize(this.buttonImage.size.x,this.buttonImage.size.y),this.flags&a.ui.Element.autoSizeAfterLoadFlag&&this.autoSize());this.setDirty(!0)};a.ui.Button.prototype.setAllStatesByField=
function(a,c){for(var b=[],d=0;d<this.colorStates.length;d++){var g={state:this.colorStates[d].flags};g[a]=c;b.push(g)}this.setStatesByField(b,a)};a.ui.Button.prototype.setFrameWidth=function(a){this.setAllStatesByField("frameWidth",a)};a.ui.Button.getMatchingStateIndex=function(b,c,e){if(!b)return-1;if(!Array.isArray(b))return a.console.logError("using getMatchingStateIndex instead of getMyMatchingStateIndex?"),-1;for(var d=-1,g=0;g<b.length;g++)if(b[g].flags===c)return g;if(0>d){if(!e)return-1;
d=b.length;b[d]={flags:c,textColor:a.graphics.white}}return d};a.ui.Button.getMatchingState=function(b,c){if(!Array.isArray(b))return a.console.logError("using getMatchingStateIndex instead of getMyMatchingStateIndex?"),null;c=a.ui.Button.getMatchingStateIndex(b,c);return 0<=c?b[c]:null};a.ui.Button.prototype.getMyMatchingStateIndex=function(b,c){return a.ui.Button.getMatchingStateIndex(this.colorStates,b,c)};a.ui.Button.prototype.getMyMatchingState=function(b){return a.ui.Button.getMatchingState(this.colorStates,
b)};a.ui.Button.copyStates=function(b){for(var c=a.utils.copyObject(b,!0),e=0;e<b.length;e++)b[e].color&&(c[e].color=new a.graphics.Color(b[e].color)),b[e].textColor&&(c[e].textColor=new a.graphics.Color(b[e].textColor)),b[e].frameColor&&(c[e].frameColor=new a.graphics.Color(b[e].frameColor));return c};a.ui.Button.prototype.setStroke=function(a,c,e){this.checkAndMakeTextBox();this.text.setStroke(a,c,e)};a.ui.Button.prototype.findBestStateMatch=function(a,c){"undefined"===typeof a&&(a=this.flags);
c||(c=this.colorStates);if(!c)return null;for(var b=0,d=0,g=0;g<c.length;g++){for(var h=0,k=0;4>k;k++){var l=1<<k;(a&l)===(c[g].flags&l)&&h++}h>=d&&(b=g,d=h)}return c[b]};a.ui.Button.prototype.updateDisplayState=function(){if(this.colorStates){var a=this.findBestStateMatch(this.flags,this.colorStates);this.text&&(a.textColor&&this.text.setColor(a.textColor),a.font&&(a.font.font&&this.text.setFont(a.font.font),a.font.size&&this.text.setFontSize(a.font.size)),a.stroke&&this.text.setStroke(a.stroke.lineWidth||
0,a.stroke.color,a.stroke.doCleanup))}return a};a.ui.Button.prototype.getCurrentDisplayState=function(){return this.displayState};a.ui.Button.prototype.drawSelf=function(){var b=a.graphics.getContext(),c=this.updateDisplayState();this.displayState=c;if(this.type===a.ui.Button.cheapType&&"undefined"!==typeof c){b.fillStyle=c.color.toString();b.fillRect(-this.center.x,-this.center.y,this.size.x,this.size.y);var e=4;void 0!==c.frameWidth&&(e=c.frameWidth);e&&(b.lineWidth=e,b.strokeStyle=c.frameColor.toString(),
b.strokeRect(-this.center.x-e/2,-this.center.y-e/2,this.size.x+e,this.size.y+e))}else this.type===a.ui.Button.coolType&&"undefined"!==typeof c?(a.graphics.roundRect({x:0-this.center.x,y:0-this.center.y,w:this.size.x,h:this.size.y},this.cornerRadius),b.fillStyle=c.color.toString(),b.fill(),e=4,void 0!==c.frameWidth&&(e=c.frameWidth),e&&(b.lineWidth=e,b.lineCap="round",b.strokeStyle=c.frameColor.toString(),b.stroke())):"undefined"!==typeof this.buttonImage&&c&&(this.buttonImage.imageRef=c.imageRef)};
a.ui.Button.prototype.updateSelf=function(a){if("undefined"!==typeof this.colorStates)for(var b=0;b<this.colorStates.length;b++)this.buttonImage&&this.buttonImage.imageRef&&this.buttonImage.imageRef===this.colorStates[b].imageRef||this.colorStates[b].imageRef&&this.colorStates[b].doUpdate&&this.colorStates[b].imageRef.update(a);this.trackAutoRepeat(a)};a.ui.Button.prototype.flagsChanged=function(b){a.ui.Button.prototype.parentPrototype.flagsChanged.call(this);var c=this.findBestStateMatch();c&&c.imageRef&&
c.imageRef.isAnimOneShot()&&c.imageRef.restartAnim();(b&a.ui.Element.highlightedFlag&&!(this.flags&a.ui.Element.highlightedFlag)||(b&a.ui.Element.enabledFlag)!=(this.flags&a.ui.Element.enabledFlag))&&this.stopAutoRepeat()};a.ui.Button.prototype.handleUIInput=function(b){var c=!1;"enter"===b.which&&(this.autoRepeat&&(this.resetAutoRepeat(),this.startAutoRepeat()),(c=this.trigger(b))&&a.eventMap.fireEvent("uiTriggered",this));return c};a.ui.Button.prototype.handleUIUpInput=function(a){this.stopAutoRepeat();
return!1};a.ui.Button.prototype.trigger=function(b){if(this.toggles){var c=this.flags;this.flags=this.flags&a.ui.Element.toggledFlag?this.flags&~a.ui.Element.toggledFlag:this.flags|a.ui.Element.toggledFlag;this.checkFlagsChanged(c)}if(this.autoRepeat){if(0<this.autoRepeat.pressCount&&b&&("mouseup"===b.eventType||"buttonup"===b.eventType||"uiup"===b.eventType))return!1;this.autoRepeat.pressCount++}return a.ui.Button.prototype.parentPrototype.trigger.call(this,b)};a.ui.Button.prototype.mouseDown=function(b,
c){a.ui.Button.prototype.parentPrototype.mouseDown.call(this);this.resetAutoRepeat();this.autoRepeat&&this.press(c);return this.flags&a.ui.Element.enabledFlag?!0:!1};a.ui.Button.prototype.autoSize=function(){0===this.buttonImage.size.x&&this.buttonImage.setOnLoad?this.buttonImage.setOnLoad(c,this):c(this)};a.ui.Button.prototype.setToggles=function(a){this.toggles=a};a.ui.Button.setDefaultTextInset=function(b){a.ui.Button.prototype.textInset=b};a.ui.Button.editProperties=[{label:"button",props:[{propName:"buttonType",
type:"integer",defValue:a.ui.Button.coolType,tipText:"1=sprite,2=bubble,3=cheap,4=cool"},{propName:"toggles",type:"boolean"},{propName:"text",type:"string",tipText:"button text (if needed)"},{propName:"textColor",type:"color"},{propName:"textInset",type:"float",tipText:"how far in from edges text draws"},{propName:"textUseOffscreen",type:"boolean"},{propName:"cornerRadius",type:"float",tipText:"for button type 4 (cool)"}]},{label:"resources",defaultClosed:!0,props:[{propName:"resource",type:"resource"},
{propName:"resourceHi",type:"resource"},{propName:"resPressed",type:"resource"},{propName:"resDisabled",type:"resource"},{propName:"extra1",type:"resource"},{propName:"extra2",type:"resource"}]},a.ui.TextBox.standardFontEditProperties];a.ui.Button.setupFromData=function(b,c,e){a.ui.data.callParentSetupFromData(a.ui.Button,b,c,e);c.extra1=c.extra1||void 0;c.extra2=c.extra2||void 0;"string"===typeof c.buttonType&&(c.buttonType=a.ui.Button.typeNames[c.buttonType]);if(c.buttonType===a.ui.Button.cheapType||
c.buttonType===a.ui.Button.coolType)b.setupButton(c.buttonType,void 0,void 0,void 0,void 0,c.extra1,c.extra2),b.colorStates=c.colors||c.color,void 0===b.colorStates&&(b.colorStates=new a.graphics.Color(140,140,140)),!1===Array.isArray(b.colorStates)&&(b.colorStates=a.ui.Button.createStandardColorStates(b.colorStates)),void 0!==c.toggles&&(b.setToggles(!0),b.setToggled(!!c.toggled));else if(c.buttonType===a.ui.Button.bubbleType||c.buttonType===a.ui.Button.spriteType)b.setupButton(c.buttonType,c.res||
c.resource,c.resHi||c.resourceHi,c.resPressed||c.resourcePressed,c.resDisabled||c.resourceDisabled,c.extra1,c.extra2),c.toggles&&(b.setToggles(!0),b.setToggled(!!c.toggled));void 0!==c.cornerRadius?b.setCornerRadius(c.cornerRadius):b.cornerRadius=b.size.y*a.ui.Button.standardCornerScale|0;c.font&&(c.font.font&&b.setFont(c.font.font),c.font.size&&b.setFontSize(c.font.size),c.font.style&&b.setFontStyle(c.font.style),c.font.stroke&&b.setStroke(c.font.stroke.width,c.font.stroke.color));if(c.textColor&&
(b.checkAndMakeTextBox().setColor(c.textColor),c.buttonType===a.ui.Button.cheapType||c.buttonType===a.ui.Button.coolType))for(e=0;e<b.colorStates.length;e++)b.colorStates[e].textColor=new a.graphics.Color(c.textColor);c.text&&b.translateAndSetTextValue(c.text);c.textInset&&b.setTextInset(c.textInset);void 0!==c.textUseOffscreen&&b.checkAndMakeTextBox().setUseOffscreen(c.textUseOffscreen)}});
rat.modules.add("rat.graphics.r_image",[{name:"rat.graphics.r_graphics",processBefore:!0},{name:"rat.debug.r_console",processBefore:!0},"rat.graphics.r_image_load","rat.graphics.r_spritesheet","rat.os.r_system","rat.math.r_math"],function(a){a.graphics.Image=function(){this.imageFrames=[];this.frames=null;this.frameEvents=void 0;this.loadedTargetCount=this.loadedCount=0};a.graphics.Image.prototype.isImage=!0;a.graphics.Image.centeredX=1;a.graphics.Image.centeredY=2;a.graphics.Image.flipX=4;a.graphics.Image.flipY=
8;a.graphics.Image.perFrameDrawCount=0;a.graphics.Image.perFrameBubblePartCount=0;a.graphics.Image.rawLoadCount=0;a.graphics.Image.reportRawLoads=!1;a.graphics.Image.beginFrame=function(){a.graphics.Image.perFrameDrawCount=0;a.graphics.Image.perFrameBubblePartCount=0};a.graphics.Image.prototype.getImageFrame=function(c,b){return this.imageFrames?0>c||c>=this.imageFrames.length?(b&&b.noWarn||(0>=this.imageFrames.length?a.console.log("Bad image frame! Failed to specify/load any images?"):a.console.log("Bad image frame! "+
c+" / "+this.imageFrames.length)),null):this.imageFrames[c].valid?this.imageFrames[c]:null:null};a.graphics.Image.prototype.isLoaded=function(){for(var a=0;a<this.imageFrames.length;a++)if(!this.imageFrames[a].valid&&!this.imageFrames[a].error)return!1;return!0};a.graphics.Image.prototype.appendFrames=function(c){function b(a){this.loadedCount++;if(this.loadedCount>=this.loadedTargetCount&&this.onLoad)this.onLoad(a)}function d(a){this.loadedCount++}if(c){var e=c;Array.isArray(c)||(e=[c]);c=typeof e[0];
"string"===c&&(this.debugName=e[0]);if("string"!==c||!this.findAndBuildFromSpriteSheets(e)){this.loadedTargetCount=e.length;for(var f=0;f<e.length;f++){var g=null;"string"===c&&(g=a.graphics.findInCache(e[f]));null!==g?this.loadedCount++:"string"===c?(g=a.system.fixPath(e[f]),g=a.graphics.imageLoad.load(g,b.bind(this),d.bind(this)).image,g.origSrc=a.utils.cleanPath(e[f]),a.graphics.Image.rawLoadCount++):"object"===c&&e[f]&&e[f].width?(g=e[f],g.valid=!0,this.loadedCount++):console.logError("ERROR:  We don't understand this image source and type:"+
e[f]+" :"+c);this.imageFrames.push(g)}}}};a.graphics.Image.prototype.findAndBuildFromSpriteSheets=function(c){c=a.graphics.spritesheet.findInSpriteSheet(c);if(!c)return!1;this.buildFramesFromSpriteSheets(c.sheetIndex,c.frameList);return!0};a.graphics.Image.prototype.buildFramesFromSpriteSheets=function(c,b){c=a.graphics.spritesheet.sheets[c];this.appendFrames(c.image);this.frames=a.graphics.spritesheet.processFramesFromSpriteSheet(c,b)};a.graphics.Image.prototype.buildFromSpriteSheet=function(c){var b=
a.graphics.spritesheet.getSpriteSheetIndex(c);0>b||(c=a.graphics.spritesheet.getFullFrameList(c))&&this.buildFramesFromSpriteSheets(b,c)};a.graphics.Image.prototype.frameCount=function(){return this.frames?this.frames.length:this.imageFrames.length};a.graphics.Image.prototype.getNamedFrame=function(a){if(this.frames)for(var b=0;b<this.frames.length;b++)if(this.frames[b].name===a)return b;return-1};a.graphics.Image.prototype.getFrameSize=function(c){if(this.frames)return this.frames[c].origSize;if((c=
this.getImageFrame(c))&&c.width)return{w:c.width,h:c.height};a.console.logWarningOnce("r_image: warning:  asking for size of image that hasn't been loaded : "+(this.debugName||""),"imageSizeError");return{w:32,h:32}};a.graphics.Image.prototype.getFrameVisibleSize=function(a){return this.frames?(a=this.frames[a].box,{w:a.w,h:a.h,isKnown:!0}):this.getFrameSize(a)};a.graphics.Image.prototype.setOnLoad=function(c){(this.onLoad=c)&&this.loadedCount>=this.loadedTargetCount&&(this.imageFrames[0].valid||
a.console.logWarningOnce("  WARNING: onLoad for cached image not fully loaded. "+this.imageFrames[0].src,"cachenotfullyloaded"),this.onLoad(this.imageFrames[0]),this.onLoad=void 0)};a.graphics.Image.prototype.draw=function(c,b,d,e,f,g,h,k,l,m,n){c=c||a.graphics.ctx;var p=1,r=1,w=!1;d=d||0;e=e||0;if(this.frames){var q=this.getImageFrame(0);if(!q)return;var t=this.frames[b];void 0===f&&(f=t.origSize.w);void 0===g&&(g=t.origSize.h);k=k||0;l=l||0;m=m||t.origSize.w;n=n||t.origSize.h;var v=f/m,x=g/n,y=
t.trimRect.x,u=t.trimRect.y,D=t.box.x,A=t.box.y,B=t.box.w,z=t.box.h;k+m<t.trimRect.x+t.trimRect.w&&(B-=t.trimRect.x+t.trimRect.w-(k+m));k>y?(D+=k-y,B-=k-y,y=0):y-=k;l+n<u+t.trimRect.h&&(z-=u+t.trimRect.h-(l+n));l>u?(A+=l-u,z-=l-u,u=0):u-=l;k=B*v;l=z*x;b=y*v;var C=u*x;h&a.graphics.Image.flipX&&(w=!0,c.save(),p=-1,c.translate(k,0),b=(t.origSize.w-(y+t.box.w))*v,c.scale(-1,1));h&a.graphics.Image.flipY&&(w||(w=!0,c.save()),r=-1,c.translate(0,l),b=(t.origSize.h-(u+t.box.h))*x,c.scale(1,-1));h&a.graphics.Image.centeredX&&
(b-=f/2);h&a.graphics.Image.centeredY&&(C-=g/2);c.drawImage(q,D*t.scaledBy,A*t.scaledBy,B*t.scaledBy,z*t.scaledBy,(d+b)*p,(e+C)*r,k,l)}else{q=this.getImageFrame(b);if(!q)return;void 0===f&&(f=q.width);void 0===g&&(g=q.height);void 0===k&&(k=0);void 0===l&&(l=0);void 0===m&&(m=q.width);void 0===n&&(n=q.height);C=b=0;h&a.graphics.Image.centeredX&&(b=-f/2);h&a.graphics.Image.centeredY&&(C=-g/2);h&a.graphics.Image.flipX&&(w=!0,c.save(),p=-1,c.translate(f,0),c.scale(-1,1));h&a.graphics.Image.flipY&&(w||
(w=!0,c.save()),r=-1,c.translate(0,g),c.scale(1,-1));c.drawImage(q,k,l,m,n,(d+b)*p,(e+C)*r,f,g)}w&&c.restore();a.graphics.Image.perFrameDrawCount++};a.graphics.ImageRef=function(c){"object"===typeof c&&c.isImageRef?this.copyFrom(c):("object"===typeof c&&c.isImage?this.image=c:(this.image=new a.graphics.Image,c&&this.image.appendFrames(c)),this.animSpeed=this.frame=0,this.animDir=1,this.hasRunOnce=this.animOneShot=this.animAutoReverse=this.animPaused=!1,this.flags=this.time=0)};a.graphics.ImageRef.prototype.isImageRef=
!0;a.graphics.ImageRef.prototype.copyFrom=function(a){this.image=a.image;this.frame=a.frame;this.animSpeed=a.animSpeed;this.animDir=a.animDir;this.animPaused=a.animPaused;this.animAutoReverse=a.animAutoReverse;this.animOneShot=a.animOneShot;this.animRandom=a.animRandom;this.time=a.time;this.flags=a.flags;this.frameEvents=a.frameEvents;this.hasRunOnce=a.hasRunOnce};a.graphics.ImageRef.prototype.copy=function(c){return new a.graphics.ImageRef(this)};a.graphics.ImageRef.prototype.setFrameEvents=function(a){this.frameEvents=
a};a.graphics.ImageRef.prototype.fireEventsForFrame=function(c){this.frameEvents&&this.frameEvents[c]&&a.eventMap&&a.eventMap.fire(this.frameEvents[c],this)};a.graphics.ImageRef.buildFromSpriteSheet=function(c,b){a.graphics.Image.registerSpriteSheet(c,b);c=new a.graphics.ImageRef;c.image.buildFromSpriteSheet(b);return c};a.graphics.ImageRef.prototype.setOnLoad=function(a){this.image.setOnLoad(a)};a.graphics.ImageRef.prototype.isLoaded=function(){return this.image.isLoaded()};a.graphics.ImageRef.prototype.getImage=
function(){return this.image.getImageFrame(this.frame)};a.graphics.ImageRef.prototype.getImageFrame=function(a){return this.image.getImageFrame(a)};a.graphics.ImageRef.prototype.getNamedFrame=function(a){return this.image.getNamedFrame(a)};a.graphics.ImageRef.prototype.getFrameCount=function(){return this.image.frameCount()};a.graphics.ImageRef.prototype.setFrame=function(a){var b=this.image.frameCount();0>a&&(a=0);a%=b;b=this.frame;this.time=this.frame=a;this.hasRunOnce=!1;b!==this.frame&&this.frameEvents&&
this.fireEventsForFrame(this.frame)};a.graphics.ImageRef.prototype.setFrameByName=function(a){this.setFrame(this.getNamedFrame(a))};a.graphics.ImageRef.prototype.setRandomFrame=function(){var a=this.image.frameCount();this.setFrame(Math.random()*a|0)};a.graphics.ImageRef.prototype.getFrame=function(){return this.frame};a.graphics.ImageRef.prototype.getFrameSize=function(a){return this.image.getFrameSize(a)};a.graphics.ImageRef.prototype.getFrameVisibleSize=function(a){return this.image.getFrameVisibleSize(a)};
a.graphics.ImageRef.prototype.getSize=function(){return this.getFrameSize(this.frame)};a.graphics.ImageRef.prototype.setAnimSpeed=function(a){this.animSpeed=a};a.graphics.ImageRef.prototype.getAnimSpeed=function(){return this.animSpeed};a.graphics.ImageRef.prototype.setAnimDir=function(a){this.animDir=a};a.graphics.ImageRef.prototype.getAnimLength=function(){return this.getFrameCount()/this.animSpeed};a.graphics.ImageRef.prototype.setAnimAutoReverse=function(a){this.hasRunOnce=!1;this.animAutoReverse=
a};a.graphics.ImageRef.prototype.setAnimOneShot=function(a){void 0===a&&(a=!0);this.hasRunOnce=!1;this.animOneShot=a};a.graphics.ImageRef.prototype.setAnimRandom=function(a){this.hasRunOnce=!1;this.animRandom=a};a.graphics.ImageRef.prototype.setAnimPaused=function(a){this.animPaused=void 0===a?!0:a};a.graphics.ImageRef.prototype.setAnimFinished=function(){this.hasRunOnce=!0;this.setTime(this.image.frameCount())};a.graphics.ImageRef.prototype.setAnimEnd=function(){this.setTime(this.image.frameCount())};
a.graphics.ImageRef.prototype.isAnimFinished=function(){return this.time>=this.image.frameCount()};a.graphics.ImageRef.prototype.isAnimOneShot=function(){return this.animOneShot};a.graphics.ImageRef.prototype.restartAnim=function(){this.setTime(0)};a.graphics.ImageRef.prototype.getAnimCompletion=function(){return this.time/this.image.frameCount()};a.graphics.ImageRef.prototype.setRandomTime=function(){this.setTime(Math.random()*this.image.frameCount())};a.graphics.ImageRef.prototype.setTime=function(a){this.hasRunOnce=
!1;this.time=a;this.update(0)};a.graphics.ImageRef.prototype.update=function(a){if(0<this.animSpeed){var b=this.frame,c=this.image.frameCount();if(!this.animPaused)if(this.time+=this.animSpeed*this.animDir*a,this.animAutoReverse)this.time>c&&(this.time=c-(this.time-c),this.animDir=-1),0>this.time&&(this.animOneShot?this.time=0:(this.time=-this.time,this.animDir=1),this.hasRunOnce=!0);else if(this.animOneShot)0<this.animDir&&this.time>c&&(this.time=c,this.hasRunOnce=!0),0>this.animDir&&0>=this.time&&
(this.time=0,this.hasRunOnce=!0);else{if(this.animRandom){1<=this.time&&(--this.time,this.frame=(this.frame+((Math.random()*(c-1)|0)+1))%c,this.frameEvents&&b!==this.frame&&this.fireEventsForFrame(this.frame));return}for(;this.time>c;)this.time-=c,this.hasRunOnce=!0}this.frame=this.time|0;0>this.frame&&(this.frame=0);this.frame>=c&&(this.frame=c-1);this.frameEvents&&b!==this.frame&&this.fireEventsForFrame(this.frame)}};a.graphics.ImageRef.prototype.draw=function(a,b,d,e,f,g,h,k,l){this.image.draw(a,
this.frame,b,d,e,f,this.flags,g,h,k,l)};a.graphics.ImageRef.prototype.setCentered=function(c,b){"undefined"===typeof b&&(b=c);this.flags=c?this.flags|a.graphics.Image.centeredX:this.flags&~a.graphics.Image.centeredX;this.flags=b?this.flags|a.graphics.Image.centeredY:this.flags&~a.graphics.Image.centeredY;return this};a.graphics.ImageRef.prototype.isCenteredX=function(){return this.flags&a.graphics.Image.centeredX?!0:!1};a.graphics.ImageRef.prototype.setFlipped=function(c,b){this.flags=c?this.flags|
a.graphics.Image.flipX:this.flags&~a.graphics.Image.flipX;this.flags=b?this.flags|a.graphics.Image.flipY:this.flags&~a.graphics.Image.flipY};a.graphics.ImageRef.prototype.drawAsBubble=function(c,b,d,e,f,g,h,k,l){function m(a,b,c,d){q=d;if(0===a)return 0;if(a>=b-1)return 1<b&&2>b&&(q=(b-c)*d),2*d+(d-q);a>=c-1&&(q=(b-c)*d);return d}var n=f/h;1===k&&(n=1);k=a.math.floor(n);var p=e/g,r=a.math.floor(p),w=a.graphics.Image.perFrameDrawCount,q=0,t=0,v=0,x=0;if(l){this.getImage();t=e+b;var y=f+d;x=m(0,n,k,
h);var u=q;v=m(0,p,r,g);l=q;this.draw(c,b,d,l,u,v,x,l,u);x=m(0,n,k,h);u=q;v=m(r,p,r,g);l=q;this.draw(c,t-l,d,l,u,v,x,l,u);x=m(k,n,k,h);u=q;v=m(0,p,r,g);l=q;this.draw(c,b,y-u,l,u,v,x,l,u);x=m(k,n,k,h);u=q;v=m(r,p,r,g);l=q;this.draw(c,t-l,y-u,l,u,v,x,l,u);2<p&&(x=m(0,n,k,h),u=q,v=m(1,p,r,g),l=q,this.draw(c,l+b,d,e-2*l,u,v,x,l,u),x=m(k,n,k,h),u=q,v=m(1,p,r,g),l=q,this.draw(c,l+b,y-u,e-2*l,u,v,x,l,u));2<n&&(x=m(1,n,k,h),u=q,v=m(0,p,r,g),l=q,this.draw(c,b,u+d,l,f-2*u,v,x,l,u),x=m(1,n,k,h),u=q,v=m(r,p,
r,g),l=q,this.draw(c,t-l,u+d,l,f-2*u,v,x,l,u));2<n&&2<p&&(x=m(1,n,k,h),u=q,v=m(1,p,r,g),l=q,2<n&&2<p&&this.draw(c,l+b,u+d,e-2*l,f-2*u,v,x,l,u))}else for(e=0;e<n;e++){x=m(e,n,k,h);u=q;for(y=f=0;y<p;y++)v=m(y,p,r,g),l=q,this.draw(c,f+b,t+d,l,u,v,x,l,u),f+=l;t+=u}a.graphics.Image.perFrameBubblePartCount+=a.graphics.Image.perFrameDrawCount-w};a.graphics.imageCache=[];a.graphics.imageCache.leftToLoad=0;a.graphics.preLoadImages=function(c){Array.isArray(c)||(c=[c]);for(var b=0,d=0,e=0;e<c.length;e++)if(a.graphics.Image.findInSpriteSheet([c[e]]))b++;
else if(a.graphics.findInCache(c[e]))d++;else{a.graphics.imageCache.leftToLoad+=1;var f=new a.graphics.Image;f.appendFrames(c[e]);f.setOnLoad(function(b,c){b.setOnLoad(void 0);--a.graphics.imageCache.leftToLoad;0>a.graphics.imageCache.leftToLoad&&(a.graphics.imageCache.leftToLoad=0)}.bind(void 0,f));a.graphics.imageCache.push(f)}};a.graphics.addToCache=function(c,b){var d=a.graphics.imageCache.length,e;if(b){var f={};if(e=a.graphics.findInCache(b,f))e=a.graphics.imageCache[f.index],d=f.index}c.isImage||
(e?(e.imageFrames[0]=c,c=e):(e=c,c=new a.graphics.Image,c.appendFrames(e)),b&&(c.imageFrames[0].origSrc=a.utils.cleanPath(b)),c.imageFrames[0].valid=!0);a.graphics.imageCache[d]=c};a.graphics.clearFromCache=function(c){var b={};a.graphics.findInCache(c,b)&&a.graphics.imageCache.splice(b.index,1)};a.graphics.isCacheLoaded=function(){for(var c=0;c<a.graphics.imageCache.length;c++)if(!a.graphics.imageCache[c].isLoaded())return!1;return!0};a.graphics.getCacheState=function(){for(var c={total:a.graphics.imageCache.length,
current:0,firstWaiting:-1},b=0;b<a.graphics.imageCache.length;b++)a.graphics.imageCache[b].isLoaded()?c.current++:0>c.firstWaiting&&(c.firstWaiting=b);return c};a.graphics.reportCache=function(){var c=a.graphics.imageCache;a.console.log("-----------------------------------");a.console.log(""+c.length+" images in cache.");for(var b=0;b<c.length;b++){var d=c[b].getImageFrame(0,{noWarn:!0});a.console.log("\t "+b+" > "+(d?d.origSrc:c[b].debugName?c[b].debugName:"[failed setup]"))}a.console.log("-----------------------------------")};
a.console.registerCommand("imageCache",a.graphics.reportCache,["reportImageCache","showImageCache"]);a.graphics.findInCache=function(c,b){c=a.utils.cleanPath(c);for(var d=0;d<a.graphics.imageCache.length;d++){var e=a.graphics.imageCache[d];if(e.imageFrames&&0<e.imageFrames.length&&(e=e.imageFrames[0],null!==e&&(e.origSrc&&e.origSrc===c||e===c)))return b&&(b.index=d),e}return null};a.graphics.externalSpriteMaker=null;a.graphics.makeImage=function(c,b,d){return b&&a.graphics.externalSpriteMaker?a.graphics.externalSpriteMaker(c,
b,d):new a.graphics.ImageRef(c)};a.graphics.setExternalSpriteMaker=function(c){a.graphics.externalSpriteMaker=c}});
rat.modules.add("rat.ui.r_ui_fill",[{name:"rat.utils.r_utils",processBefore:!0},{name:"rat.ui.r_ui",processBefore:!0},"rat.ui.r_ui_data"],function(a){a.ui.Fill=function(c){a.ui.Fill.prototype.parentConstructor.call(this,c);this.fillCur=5;this.fillTotal=10;this.fillRatio=.5;this.allowUnderFill=this.allowOverFill=!1;this.fillStyle="stroke";this.fillShape="circle";this.lineWidth=1;this.setTracksMouse(!1)};a.utils.inheritClassFrom(a.ui.Fill,a.ui.Element);a.ui.Fill.prototype.elementType="fill";a.ui.Fill.prototype.setFill=
function(a,b){if(this.fillCur!==a||void 0!==b&&this.fillTotal!==b)this.fillCur=a,void 0!==b&&(this.fillTotal=b),!this.allowUnderFill&&0>this.fillCur&&(this.fillCur=0),!this.allowOverFill&&this.fillCur>this.fillTotal&&(this.fillCur=this.fillTotal),this.fillRatio=this.fillCur/this.fillTotal,this.setDirty(!0)};a.ui.Fill.prototype.setLineWidth=function(a){this.lineWidth!==a&&this.setDirty(!0);this.lineWidth=a};a.ui.Fill.setupFromData=function(c,b,d){a.ui.data.callParentSetupFromData(a.ui.Fill,c,b,d);
b.allowOverFill&&(c.allowOverFill=b.allowOverFill);b.allowUnderFill&&(c.allowUnderFill=b.allowUnderFill);c.setFill(b.currentFill||0,b.maxFill);c.fillStyle=b.fillStyle||c.fillStyle;c.fillShape=b.fillShape||c.fillShape;void 0!==b.lineWidth&&(c.lineWidth=b.lineWidth)}});
rat.modules.add("rat.ui.r_ui_droplist",[{name:"rat.ui.r_ui",processBefore:!0},"rat.ui.r_ui_button","rat.ui.r_ui_listbox",{name:"rat.utils.r_utils",processBefore:!0},"rat.debug.r_console"],function(a){a.ui.DropList=function(c){a.ui.DropList.prototype.parentConstructor.call(this,c);this.dropButton=this.listBox=this.itemList=null;this.listPos={x:0,y:0,w:0,h:0}};a.utils.inheritClassFrom(a.ui.DropList,a.ui.Element);a.ui.DropList.prototype.elementType="DropList";a.ui.DropList.prototype.setButton=function(a){var b=
this;this.dropButton=a;a.setCallback(function(a,c){b.toggleListBox()},this.props)};a.ui.DropList.prototype.replaceButton=function(a){this.dropButton&&this.dropButton.parent.removeSubElement(this.dropButton);this.setButton(a)};a.ui.DropList.prototype.getButton=function(){return this.dropButton};a.ui.DropList.prototype.setListHeight=function(a){this.listPos.h=a};a.ui.DropList.prototype.setUserData=function(a){this.userData=a};a.ui.DropList.prototype.setCurrentItem=function(a){this.itemList&&(this.currentItemIndex=
a,(a=this.itemList[a])&&this.dropButton&&"string"===typeof a&&this.dropButton.setTextValue(a))};a.ui.DropList.prototype.buildFromListText=function(c,b){var d=this;this.itemList=c;this.props=b;(c=b.buttonColorStates)||(c=a.ui.Button.createStandardColorStates(b.buttonColor||a.graphics.darkGray,0));c=a.ui.makeCheapButtonWithColors(null,c);this.appendSubElement(c);c.checkAndMakeTextBox().setAlignment("left");this.setButton(c);c.setSize(this.size.x,this.size.y);if(!b.downImageRef){c=new a.ui.Shape(c);
var e=this.size.y-10;c.setPos(this.size.x-e-5,5);c.setSize(e,e);c.drawSelf=function(b){b.fillStyle="#000000";a.graphics.fillPolygon(e/2,e/2,e/2,Math.PI/2,3)}}this.listPos.x=0;this.listPos.y=this.size.y;b.listOffset&&(this.listPos.x+=b.listOffset.x,this.listPos.y+=b.listOffset.y);this.listPos.w=this.size.x;c=this.getGlobalPos(this.listPos,this.listPos);this.listPos.h=a.graphics.SCREEN_HEIGHT-c.y;b.finalSelectCallback=b.selectCallback;b.selectCallback=function(a,c){d.setCurrentItem(a);d.toggleListBox();
b.finalSelectCallback&&b.finalSelectCallback(a,c)};this.setCurrentItem(0)};a.ui.DropList.prototype.listBoxIsVisible=function(){return null!==this.listBox};a.ui.DropList.prototype.isOpen=a.ui.DropList.prototype.listBoxIsVisible;a.ui.DropList.prototype.showListBox=function(){if(!this.listBox){var c=this.listBox=new a.ui.ListBox(this);c.setBounds(this.listPos);c.buildFromListText(this.itemList,this.props)}};a.ui.DropList.prototype.hideListBox=function(){this.listBox&&(this.removeSubElement(this.listBox),
this.listBox=null)};a.ui.DropList.prototype.toggleListBox=function(){this.listBox?this.hideListBox():this.showListBox();this.props.listShowCallback&&this.props.listShowCallback(this,this.listBoxIsVisible(),this.props)}});
rat.modules.add("rat.ui.r_ui_sprite",[{name:"rat.ui.r_ui",processBefore:!0},{name:"rat.utils.r_utils",processBefore:!0},"rat.graphics.r_graphics","rat.graphics.r_image","rat.debug.r_console","rat.ui.r_ui_data"],function(a){a.ui.Sprite=function(c,b,d){var e=null;c&&c.elementType&&(e=c,c=null);a.ui.Sprite.prototype.parentConstructor.call(this,e);this.flags|=a.ui.Element.autoSizeAfterLoadFlag;this.imageScaleX=this.imageScaleY=1;this.name="<sprite>"+this.id;this.loadImage(c,b,d);this.setTracksMouse(!1)};
a.utils.inheritClassFrom(a.ui.Sprite,a.ui.Element);a.ui.Sprite.prototype.elementType="sprite";a.ui.Sprite.prototype.handleImageFlags=function(c){c=this.imageRef;this.flags&a.ui.Element.autoScaleAfterLoadFlag?this.scaleImageToSize():this.flags&a.ui.Element.autoSizeAfterLoadFlag&&this.sizeToImage();this.flags&a.ui.Element.autoCenterAfterLoadFlag&&this.autoCenter(!0);if(c){var b=c.getFrameSize(0);this.setContentSize(b.w,b.h);1>=c.getFrameCount()?this.setNeedsUpdate(!1):this.setNeedsUpdate(!0)}this.setDirty(!0)};
a.ui.Sprite.prototype.loadImage=function(c,b,d){if(c&&void 0!==c){this.imageRef=a.graphics.makeImage(c,b,d);var e=this;this.imageRef.setOnLoad(function(){e.handleImageFlags(e.imageRef);if(e.onLoad)e.onLoad(e.onLoadArg)});"string"===typeof c&&(this.name="<sprite>"+c+this.id)}};a.ui.Sprite.prototype.useImageRef=function(a){a&&(this.imageRef=a);if(a)if(this.imageRef.isLoaded())this.handleImageFlags(this.imageRef);else{var b=this;this.imageRef.setOnLoad(function(){b.handleImageFlags(b.imageRef)})}this.setDirty(!0)};
a.ui.Sprite.prototype.getImageRef=function(){return this.imageRef};a.ui.Sprite.prototype.sizeToImage=function(){if(this.imageRef){var a=this.imageRef.getFrameSize(0);this.setSize(a.w,a.h)}};a.ui.Sprite.prototype.scaleImageToSize=function(a,b){if(this.imageRef){a=a||1;b=b||1;var c=this.imageRef.getFrameSize(0);this.imageScaleX=this.size.x/c.w*a;this.imageScaleY=this.size.y/c.h*b;this.setDirty(!0)}};a.ui.Sprite.prototype.centerSprite=function(){var a=this.imageRef.getSize(),b=this.size.y-a.h*this.imageScaleY;
this.contentOffset.x=(this.size.x-a.w*this.imageScaleX)/2;this.contentOffset.y=b/2};a.ui.Sprite.prototype.setSize=function(c,b){this.flags&=~a.ui.Element.autoSizeAfterLoadFlag;a.ui.Sprite.prototype.parentPrototype.setSize.call(this,c,b)};a.ui.Sprite.prototype.setImageScale=function(a,b){this.imageScaleX=a;this.imageScaleY=b;this.setDirty(!0)};a.ui.Sprite.prototype.getImageScale=function(){return{x:this.imageScaleX,y:this.imageScaleY}};a.ui.Sprite.prototype.autoCenter=function(c,b){void 0===c&&(c=
!0);c&&"undefined"!==typeof this.imageRef&&!this.imageRef.isLoaded()?this.flags|=a.ui.Element.autoCenterAfterLoadFlag:a.ui.Sprite.prototype.parentPrototype.autoCenter.call(this,c,b)};a.ui.Sprite.prototype.setOutline=function(a,b){this.outline===a&&this.outlineScale===b||this.setDirty(!0);this.outline=a;this.outlineScale=b};a.ui.Sprite.prototype.setCompositeOperation=function(a){this.compositeOperation!==a&&this.setDirty(!0);this.compositeOperation=a};a.ui.Sprite.prototype.updateSelf=function(a){if(this.imageRef){var b=
this.imageRef.getFrame();this.imageRef.update(a);this.imageRef.getFrame()!==b&&this.setDirty(!0)}};a.ui.Sprite.prototype.drawTiled=function(c,b){if(this.isVisible()){a.graphics.frameStats.totalElementsDrawn++;var d=a.graphics.getContext();a.graphics.save();a.graphics.translate(this.place.pos.x,this.place.pos.y);this.place.rot.angle&&a.graphics.rotate(this.place.rot.angle);1===this.scale.x&&1===this.scale.y||a.graphics.scale(this.scale.x,this.scale.y);d.globalAlpha=this.opacity;0<this.frameWidth&&
(d.strokeStyle=this.frameColor.toString(),d.lineWidth=this.frameWidth,d.strokeRect(-this.center.x-this.frameOutset,-this.center.y-this.frameOutset,this.size.x+2*this.frameOutset,this.size.y+2*this.frameOutset));this.flags&a.ui.Element.clipFlag&&(d.beginPath(),d.moveTo(0,0),d.lineTo(this.size.x,0),d.lineTo(this.size.x,this.size.y),d.lineTo(0,this.size.y),d.lineTo(0,0),d.clip());this.drawMyImageTiled(c,b);a.graphics.restore()}};a.ui.Sprite.prototype.drawMyImageTiled=function(c,b){for(var d=a.graphics.getContext(),
e=this.imageRef.getSize(),f=0;f<c;f+=e.w)for(var g=0;g<b;g+=e.h){a.graphics.save();var h=e.w+f>c?c-f:e.w;var k=e.h+g>b?b-g:e.h;a.graphics.translate(f,g);this.imageRef.draw(d,0,0,h,k,0,0,h,k);a.graphics.restore()}};a.ui.Sprite.prototype.drawSelf=function(){if(0!==(this.flags&a.ui.Element.drawTiledFlag))this.drawMyImageTiled(this.size.x,this.size.y);else if(this.imageRef){var c=a.graphics.getContext();if(this.outline){var b=this.imageRef.getSize();c.globalCompositeOperation="destination-out";var d=
b.w*this.outlineScale,e=b.h*this.outlineScale;this.imageRef.draw(c,-(this.center.x+(d-b.w)/2),-(this.center.y+(e-b.h)/2),d,e);c.globalCompositeOperation="source-over"}if(this.compositeOperation){var f=c.globalCompositeOperation;c.globalCompositeOperation=this.compositeOperation}d=this.imageRef.getSize();b=d.w*this.imageScaleX;d=d.h*this.imageScaleY;this.flags&a.ui.Element.autoScaleAfterLoadFlag&&(b=this.size.x,d=this.size.y);this.imageRef.draw(c,-this.center.x+this.contentOffset.x,-this.center.y+
this.contentOffset.y,b,d);this.compositeOperation&&(c.globalCompositeOperation=f)}};a.ui.Sprite.prototype.boundsChanged=function(){this.flags&a.ui.Element.autoScaleAfterLoadFlag&&void 0!==this.imageRef&&this.scaleImageToSize();a.ui.Sprite.prototype.parentPrototype.boundsChanged.call(this)};a.ui.Sprite.prototype.setOnLoad=function(a,b){this.onLoad=a;this.onLoadArg=b};a.ui.Sprite.editProperties=[{label:"image",props:[{propName:"resource",type:"resource"},{propName:"outline",type:"float"}]}];a.ui.Sprite.setupFromData=
function(c,b,d){a.ui.data.callParentSetupFromData(a.ui.Sprite,c,b,d);b.outline&&c.setOutline(!0,b.outline);b.onLoad&&c.setOnLoad(b.onLoad,c);b.resource&&c.loadImage(b.resource);b.animSpeed&&c.imageRef&&(c.imageRef.animSpeed=b.animSpeed)}});
rat.modules.add("rat.ui.r_ui_scrollview",[{name:"rat.ui.r_ui",processBefore:!0},{name:"rat.utils.r_utils",processBefore:!0},"rat.math.r_math","rat.math.r_vector","rat.graphics.r_graphics","rat.debug.r_console","rat.os.r_system"],function(a){function c(){this.isEnabled()&&(this.setEnabled(!1),this.setEnabled(!0));this.stopMouseTracking&&this.stopMouseTracking();this.callForSubElements(c)}a.ui.ScrollView=function(b){a.ui.ScrollView.prototype.parentConstructor.call(this,b);this.setClip(!0);this.lastMousePos=
new a.Vector(0,0);this.grabPos=new a.Vector(0,0);this.grabOffset=new a.Vector(0,0);this.wheelSensitivity=32;this.wheelAffects="y";this.allowPinchZoom=!1;this.allowFling=!0;this.flingMouse={x:0,y:0};this.flingTrack=[];for(b=0;b<a.ui.ScrollView.flingTrackFrames;b++)this.flingTrack[b]={x:0,y:0};this.flingTrackIndex=0;this.flingVelocity={x:0,y:0};this.flingHard=!1;this.flingMaxVel=3E3;this.flingHardVel=8E3};a.utils.inheritClassFrom(a.ui.ScrollView,a.ui.Element);a.ui.ScrollView.flingTrackFrames=4;a.ui.ScrollView.prototype.elementType=
"scrollView";a.ui.ScrollView.prototype.minimumDragThreshold=10;a.ui.ScrollView.prototype.meaningfulDragThreshold=15;a.ui.ScrollView.prototype.supportZoom=function(a){a||void 0===a?(this.wheelAffects="z",this.wheelSensitivity=.1,this.allowPinchZoom=!0):this.allowPinchZoom=!1};a.ui.ScrollView.prototype.mouseWheelEvent=function(a,c){return this.isEnabled()?"y"===this.wheelAffects||"x"===this.wheelAffects?("y"===this.wheelAffects?this.contentOffset.y+=c.wheelDelta*this.wheelSensitivity:this.contentOffset.x+=
c.wheelDelta*this.wheelSensitivity,this.clampScroll(),this.viewChanged&&this.viewChanged(),!0):"z"===this.wheelAffects?(this.stepZoomAnchored(c.wheelDelta*this.wheelSensitivity,this.mousePos),!0):!1:!1};a.ui.ScrollView.prototype.stepZoomAnchored=function(b,c){var d=this.getTargetContentOffset();this.contentOffset.x=d.x;this.contentOffset.y=d.y;a.ui.killAnimatorsForElement(this,a.ui.Animator.scroller);c||(c=this.parentToLocalContentPos(this.place.pos.x+this.size.x/2,this.place.pos.y+this.size.y/2));
d=c.x;c=c.y;var f=this.contentScale.x,g=this.contentScale.y;this.stepZoom(b);this.contentOffset.x-=d*this.contentScale.x-d*f;this.contentOffset.y-=c*this.contentScale.y-c*g;this.clampScroll();this.viewChanged&&this.viewChanged()};a.ui.ScrollView.prototype.mouseDown=function(b,c){if(this.isEnabled()){this.lastMousePos.x=b.x+this.place.pos.x;this.lastMousePos.y=b.y+this.place.pos.y;this.grabPos.x=b.x+this.place.pos.x;this.grabPos.y=b.y+this.place.pos.y;this.grabOffset.x=this.contentOffset.x;this.grabOffset.y=
this.contentOffset.y;this.flingMouse.x=a.mousePos.x;this.flingMouse.y=a.mousePos.y;for(var d=this.flingVelocity.x=this.flingVelocity.y=0;d<a.ui.ScrollView.flingTrackFrames;d++)this.flingTrack[d].x=this.flingTrack[d].y=0;a.ui.ScrollView.prototype.parentPrototype.mouseDown.call(this,b,c)}};a.ui.ScrollView.prototype.mouseUp=function(b,c){var d=0!==(this.flags&a.ui.Element.trackingMouseDownFlag);b=a.ui.ScrollView.prototype.parentPrototype.mouseUp.call(this,b,c);if(d&&this.allowFling){for(c=d=vy=0;c<a.ui.ScrollView.flingTrackFrames;c++)d+=
this.flingTrack[c].x,vy+=this.flingTrack[c].y;d/=a.ui.ScrollView.flingTrackFrames;vy/=a.ui.ScrollView.flingTrackFrames;c=this.flingMaxVel;var f=this.flingHardVel;this.flingHard=!1;d*d+vy*vy>f*f&&(this.flingHard=!0,console.log("hard fling "+d+", "+vy));d>c&&(d=c);d<-c&&(d=-c);vy>c&&(vy=c);vy<-c&&(vy=-c);this.flingVelocity.x=d;this.flingVelocity.y=vy}return b};a.ui.ScrollView.prototype.handleMouseMove=function(b,d,e){a.ui.ScrollView.prototype.parentPrototype.handleMouseMove.call(this,b,d,e);if(this.flags&
a.ui.Element.trackingMouseDownFlag){d=b.x-this.grabPos.x;e=b.y-this.grabPos.y;if(Math.abs(d)>this.minimumDragThreshold||Math.abs(e)>this.minimumDragThreshold){var f=this.grabOffset.y+e;this.contentOffset.x=this.grabOffset.x+d;this.contentOffset.y=f;this.clampScroll();this.lastMousePos.x=b.x;this.lastMousePos.y=b.y;this.viewChanged&&this.viewChanged()}b=this.meaningfulDragThreshold;(Math.abs(d)>b||Math.abs(e)>b)&&this.callForSubElements(c)}};a.ui.ScrollView.prototype.isFlung=function(b){return this.flags&
a.ui.Element.trackingMouseDownFlag||0===this.flingVelocity.x&&0===this.flingVelocity.y?!1:!0};a.ui.ScrollView.prototype.updateSelf=function(b){if(this.allowFling)if(this.flags&a.ui.Element.trackingMouseDownFlag){var c=a.mousePos,e=(c.x-this.flingMouse.x)/b;b=(c.y-this.flingMouse.y)/b;this.flingMouse.x=c.x;this.flingMouse.y=c.y;c=this.flingTrackIndex;this.flingTrack[c].x=e;this.flingTrack[c].y=b;this.flingTrackIndex=(c+1)%a.ui.ScrollView.flingTrackFrames}else this.isFlung()&&(this.contentOffset.x+=
this.flingVelocity.x*b,this.contentOffset.y+=this.flingVelocity.y*b,this.clampScroll(),this.viewChanged&&this.viewChanged(),e=3E3*b,0>this.flingVelocity.x?(this.flingVelocity.x+=e,0<this.flingVelocity.x&&(this.flingVelocity.x=0)):0<this.flingVelocity.x&&(this.flingVelocity.x-=e,0>this.flingVelocity.x&&(this.flingVelocity.x=0)),0>this.flingVelocity.y?(this.flingVelocity.y+=e,0<this.flingVelocity.y&&(this.flingVelocity.y=0)):0<this.flingVelocity.y&&(this.flingVelocity.y-=e,0>this.flingVelocity.y&&(this.flingVelocity.y=
0)))};a.ui.ScrollView.editProperties=[{label:"scroll",props:[{propName:"contentSize",type:"sizevector",valueType:"float"},{propName:"wheelSensitivity",type:"float",defValue:32,tipText:"If used for zoom, use a really low value, like 0.1"},{propName:"wheelAffects",type:"string",defValue:"y"},{propName:"allowPinchZoom",type:"boolean",tipText:"Not supported yet!"},{propName:"allowFling",type:"boolean"}]}];a.ui.ScrollView.setupFromData=function(b,c,e){a.ui.data.callParentSetupFromData(a.ui.ScrollView,
b,c,e);b.wheelSensitivity=c.wheelSensitivity||b.wheelSensitivity;b.wheelAffects=c.wheelAffects||b.wheelAffects;b.allowPinchZoom=c.allowPinchZoom||b.allowPinchZoom;b.allowFling=c.allowFling||b.allowFling};a.ui.ButtonScrollView=a.ui.ScrollView});
rat.modules.add("rat.os.r_clipboard",["rat.storage.r_storage"],function(a){var c={blobs:{},init:function(){c.localSave=a.storage.getStorage(a.storage.permanentLocal,"rat");if(c.localSave){var b=c.localSave.getObject("rat_clipboard");b&&2===b.version&&(c.blobs=b.blobs)}},cache:function(){c.localSave&&c.localSave.setObject("rat_clipboard",{version:2,blobs:c.blobs})},store:function(a,d){"string"===typeof a&&(a={type:a,value:d});Array.isArray(a)||(a=[a]);c.blobs={};for(d=0;d<a.length;d++){var b=a[d];
c.blobs[b.type]={type:b.type,value:b.value}}c.cache()},retrieve:function(a){return c.blobs[a]?c.blobs[a].value:null},getData:function(){return c.blobs?c.blobs:null}};a.clipboard=c});
rat.modules.add("rat.graphics.r_rectlist",[],function(a){a.RectList=function(){this.list=[]};a.RectList.prototype.clear=function(){this.list=[]};a.RectList.prototype.snap=function(a){var b={};b.x=a.x-1|0;b.y=a.y-1|0;b.w=a.w+1+(a.x-b.x)+.999999999|0;b.h=a.h+1+(a.y-b.y)+.999999999|0;return b};a.RectList.prototype.add=function(a){a=this.snapEven?this.snap(a):{x:a.x,y:a.y,w:a.w,h:a.h};for(var b=this.list.length-1;0<=b;b--){var c=this.list[b],e=a.x+a.w,f=a.y+a.h,g=c.x+c.w,h=c.y+c.h;if(a.x>=c.x&&a.y>=c.y&&
e<=g&&f<=h)return;if(a.x<=c.x&&a.y<=c.y&&e>=g&&f>=h)this.list.splice(b,1);else if(!(e<c.x||g<a.x||f<c.y||h<a.y)){if(a.x<c.x){var k=a.x;if(e>g){var l=c.w;g=e}else l=e-c.x}else k=c.x,g>e?l=a.w:(l=g-a.x,g=e);if(a.y<c.y){var m=a.y;f>h?e=c.h:(e=f-c.y,f=h)}else m=c.y,h>f?(e=a.h,f=h):e=h-a.y;l*e>a.w*a.h*.7&&(c.x+c.w>g&&console.log("LOSS"),a.x=k,a.y=m,a.w=g-k,a.h=f-m,this.list.splice(b,1))}}this.list.push(a)};a.RectList.prototype.hits=function(a){this.snapEven&&(a=this.snap(a));for(var b=0;b<this.list.length;b++){var c=
this.list[b];if(a.x+a.w>=c.x&&a.x<=c.x+c.w&&a.y+a.h>=c.y&&a.y<=c.y+c.h)return!0}return!1};a.RectList.prototype.eraseList=function(a){for(var b=0;b<this.list.length;b++){var c=this.list[b];a.clearRect(c.x,c.y,c.w,c.h)}};a.RectList.prototype.clipToList=function(a,b){a.save();this.listToPath(a,b);a.clip()};a.RectList.prototype.unclip=function(a){a.restore()};a.RectList.prototype.listToPath=function(a,b){b||(b=this.list);a.beginPath();for(var c=0;c<b.length;c++){var e=b[c];a.moveTo(e.x,e.y);a.lineTo(e.x+
e.w,e.y);a.lineTo(e.x+e.w,e.y+e.h);a.lineTo(e.x,e.y+e.h);a.lineTo(e.x,e.y)}}});
rat.modules.add("rat.utils.r_wordwrap",["rat.debug.r_console"],function(a){a.wordwrap={isWhitespace:function(a){return" "===a||"\t"===a||"\n"===a||"\r"===a||a===String.fromCharCode(12288)},skipWhitespaceAhead:function(c,b){for(;b<c.length&&a.wordwrap.isWhitespace(c.charAt(b));b++);return b},isAlphabetic:function(a){return 4096>a},isTwoPartPunctuation:function(a){return"?"===a||"!"===a||";"===a||":"===a},canBreakBetween:function(c,b){if(""===c||""===b)return!0;var d=c.charCodeAt(0),e=b.charCodeAt(0),
f=!1;a.wordwrap.isAlphabetic(d)&&a.wordwrap.isAlphabetic(e)||(f=!0);if(a.wordwrap.isWhitespace(b)||"-"===c)f=!0;if(a.wordwrap.isNonBeginningChar(e)||a.wordwrap.isNonEndingChar(d))f=!1;return f},wrapString:function(c,b,d,e,f,g){for(var h=[],k=0,l="",m=0,n=0,p=0,r={ctx:d},w={},q=0;q<c.length;q++){for(var t=c[q];e&&t===e;){t=2;var v=c[q+1];r.string=c;r.stringPos=q+2;f[v]?(f[v].measure(r,w),p+=w.width||0,t+=w.consumeCharacters||0):a.console.logWarningOnce("word wrap special code "+v+" not handled.");
q+=t;t=c[q];c[q]!==e&&(q--,t="")}if("\n"===t)h.push(c.substring(k,q)),m=n=k=q+1,p=0,l="";else if(v=l+t,d.measureText(v).width+p>=b?(v=!0,m===k&&(g?m=n=q:v=!1),v&&(h.push(c.substring(k,m)),k=m=n,p=0,q=k-1,l=t="")):l=v,""===t&&(t="x"),q>=c.length-1||c[q+1]!==e&&a.wordwrap.canBreakBetween(t,c[q+1]))m=q+1,n=a.wordwrap.skipWhitespaceAhead(c,q+1)}k!==c.length&&h.push(c.substring(k,c.length));return h},isNonBeginningChar:function(a){return 69===a||160===a||65292===a||65294===a||65306===a||65072===a||65104===
a||183===a||65110===a||65373===a||12303===a||65116===a||8221===a||58===a||93===a||8226===a||8231===a||8230===a||65105===a||65108===a||65111===a||12305===a||12301===a||65118===a||12318===a||59===a||125===a||65307===a||65281===a||65106===a||65109===a||12309===a||12297===a||65114===a||8217===a||8242===a||37===a||176===a||8243===a||8451===a||12299===a||65285===a||65341===a||65504===a||8211===a||8212===a||65377===a||65380===a||12387===a||12419===a||12421===a||12423===a||12483===a||12515===a||12517===a||
12519===a||12353===a||12355===a||12357===a||12359===a||12361===a||12430===a||12449===a||12451===a||12453===a||12455===a||12457===a||12526===a||34===a||33===a||41===a||44===a||46===a||63===a||12289===a||12290===a||12540===a||65281===a||65289===a||65311===a||65392===a||65438===a||65439===a},isNonEndingChar:function(a){return 12304===a||12300===a||65117===a||12317===a||91===a||12308===a||12296===a||65113===a||8216===a||8245===a||123===a||65371===a||12302===a||65115===a||8220===a||92===a||36===a||65505===
a||12298===a||65284===a||65339===a||65510===a||65509===a||34===a||40===a||65288===a}}});
rat.modules.add("rat.graphics.r_image_load",[{name:"rat.graphics.r_graphics",processBefore:!0},"rat.debug.r_console"],function(a){a.graphics.imageLoad={};var c=a.graphics.imageLoad;c.loading=[];c.load=function(b,d,e){for(i=0;i<c.loading.length;i++){var f=c.loading[i];if(f.source===b)return d&&f.onLoads.push(d),e&&f.onErrors.push(e),f}c.loading.push({source:b,image:null,onLoads:[],onErrors:[]});var g=c.loading[c.loading.length-1];d&&g.onLoads.push(d);e&&g.onErrors.push(e);d=new Image;g.image=d;d.valid=
!1;d.error=!1;d.onload=function(d){0===this.width&&a.console.logError("NEED UWP SIZE HACK");this.onload=null;this.valid=!0;for(d=0;d<g.onLoads.length;d++)g.onLoads[d](this,g);c.removeLoad(b)};d.onerror=function(d){this.onerror=null;a.console.logError("ERROR loading image "+this.src);this.error=!0;for(d=0;d<g.onLoads.length;d++)g.onErrors[d](this,g);c.removeLoad(b)};a.graphics.Image.reportRawLoads&&a.console.log("Loading image "+b+"...");d.src=b;return g};c.removeLoad=function(a){for(i=0;i<c.loading.length;i++)if(c.loading[i].source===
a)return c.loading.splice(i,1),!0;return!1}});
rat.modules.add("rat.graphics.r_spritesheet",[{name:"rat.graphics.r_graphics",processBefore:!0},{name:"rat.graphics.r_image",processBefore:!0},"rat.debug.r_console","rat.utils.r_utils","rat.os.r_system","rat.math.r_math"],function(a){function c(b,c,e){this.image=b;this.tpjs=c;this.opts=e;this.scaledBy=c.meta&&c.meta?Number(c.meta.scale)||1:1;this.undoScaler=1/this.scaledBy;++a.graphics.spritesheet.sheets.numInMemory}a.graphics.spritesheet={};a.graphics.spritesheet.sheets=[];a.graphics.spritesheet.sheets.numInMemory=
0;c.prototype.inMemory=!0;c.prototype.setActive=function(b){void 0===b&&(b=!0);b!=this.inMemory&&(b?(a.graphics.preLoadImages([this.image]),this.inMemory=!0,++a.graphics.spritesheet.sheets.numInMemory):(this.inMemory=!1,a.graphics.clearFromCache(this.image),--a.graphics.spritesheet.sheets.numInMemory),a.console.log((b?"":"UN-")+"loading spritesheet "+this.image))};a.graphics.spritesheet.registerSpriteSheet=function(b,d,e){if(!(0<=a.graphics.spritesheet.getSpriteSheetIndex(d))){e||(e={});void 0===
e.preloadImage&&(e.preloadImage=!0);e.preloadImage&&b&&a.graphics.preLoadImages(b);b||a.console.logError("ERROR: imagePath required when registering spritesheet!");var f=new c(b,d,e),g=d.meta.image;g?(e.forceLowerCase&&(d.meta.image=g.toLowerCase()),this.pathPrefix=a.utils.getPath(d.meta.image,!0)):this.pathPrefix="";this.frameCount=0;g=d.frames;if(Array.isArray(g)){var h=g;g=d.frames={};for(var k=0;k<h.length;k++){var l=h[k];g[l.filename]=l}}d.bylongname={};for(var m in g)e.forceLowerCase&&(m=m.toLowerCase()),
g[m].filename=m,d.bylongname[this.pathPrefix+m]=g[m],this.frameCount++;e.verbose&&a.console.log("loaded spritesheet "+b+" with "+this.frameCount+" frames");a.graphics.spritesheet.sheets.push(f)}};a.graphics.spritesheet.unregisterSpriteSheet=function(b,c){c=a.graphics.spritesheet.sheets;for(var d=0;d<c.length;d++){var f=a.graphics.spritesheet.sheets[d];if(f.image===b){a.graphics.clearFromCache(f.image);c.numInMemory=0;c.splice(d,1);return}}a.console.log("unregisterSpriteSheet couldn't find "+b)};a.graphics.spritesheet.getSpriteSheetCount=
function(b){return b&&b.inMemory?a.graphics.spritesheet.sheets.numInMemory:a.graphics.spritesheet.sheets.length};a.graphics.spritesheet.getNthSpriteSheet=function(b,c){var d=a.graphics.spritesheet.sheets;if(c&&c.inMemory)for(c=0;c<d.length;++c){var f=a.graphics.spritesheet.sheets[c];if(f.inMemory&&(--b,0>b))return f}else return d[b]};a.graphics.spritesheet.forEachSpriteSheet=function(b,c){if(b)for(var d=0,f;f=a.graphics.spritesheet.getNthSpriteSheet(d,c);)++d,b(f,c)};a.graphics.spritesheet.getSpriteSheetIndex=
function(b){for(var c=0;c<a.graphics.spritesheet.sheets.length;c++)if(a.graphics.spritesheet.sheets[c].tpjs===b)return c;return-1};a.graphics.spritesheet.getSpriteSheetIndexByImage=function(b){for(var c=0;c<a.graphics.spritesheet.sheets.length;c++)if(a.graphics.spritesheet.sheets[c].image===b)return c;return-1};a.graphics.spritesheet.getSpriteSheetJSByImage=function(b){for(var c=0;c<a.graphics.spritesheet.sheets.length;c++)if(a.graphics.spritesheet.sheets[c].image===b)return a.graphics.spritesheet.sheets[c].tpjs;
return null};a.graphics.spritesheet.findInSpriteSheet=function(b){function c(b,c){for(var d=0;d!==a.graphics.spritesheet.sheets.length;++d){var e=a.graphics.spritesheet.sheets[d],g=e.tpjs,h=g.frames;c&&(h=g.bylongname);g=[];if(e.opts.requirePath&&!c)break;for(f=0;f!==b.length;++f){var p=b[f];e.opts.forceLowerCase&&(p=p.toLowerCase());h[p]&&g.push(h[p])}if(g.length===b.length)return{sheetIndex:d,frameList:g};if(0<g.length)for(a.console.logError("ERROR: incorrect partial match in sheet search! only found:"),
e=0;e<g.length;e++)a.console.log(g[e].filename)}return null}if(!a.graphics.spritesheet.sheets||1>a.graphics.spritesheet.sheets.length)return null;for(var e=[],f=0;f!==b.length;++f)e[f]=a.utils.cleanPath(b[f]);if(e=c(e,!0))return e;e=[];for(f=0;f!==b.length;++f)e[f]=a.utils.stripPath(b[f]);return c(e,!1)};a.graphics.spritesheet.processFramesFromSpriteSheet=function(a,c){for(var b=[],d=0;d<c.length;d++){var g={},h=c[d],k=h.filename;g.name=k.substring(0,k.length-4);g.scaledBy=a.scaledBy;g.undoScaler=
a.undoScaler;g.drawBox={x:h.frame.x,y:h.frame.y,w:h.frame.w,h:h.frame.h};g.box={};g.box.x=g.drawBox.x*a.undoScaler;g.box.y=g.drawBox.y*a.undoScaler;g.box.w=g.drawBox.w*a.undoScaler;g.box.h=g.drawBox.h*a.undoScaler;k=h.spriteSourceSize;g.trimRect={x:k.x*a.undoScaler,y:k.y*a.undoScaler,w:k.w*a.undoScaler,h:k.h*a.undoScaler};k=h.spriteSourceSize;g.sourceSize={w:k.w,h:k.h};h=h.sourceSize;g.origSize={w:h.w?h.w*a.undoScaler:g.box.w,h:h.h?h.h*a.undoScaler:g.box.h};b.push(g)}return b};a.graphics.spritesheet.getFullFrameList=
function(b){var c=a.graphics.spritesheet.getSpriteSheetIndex(b);if(0>c)return null;b=[];c=a.graphics.spritesheet.sheets[c].tpjs.bylongname;for(var e in c)b.push(c[e]);return b};a.graphics.spritesheet.loadSpriteSheetSet=function(b,c,e,f){if(b){e&&a.console.log("loading "+b.length+" spritesheets.");f||(f={});for(var d=0;d<b.length;++d){var h=b[d];var k=c?c+a.utils.stripPath(h.meta.image):h.meta.image;a.graphics.preLoadImages(k);var l={forceLowerCase:!0,requirePath:""!==a.utils.getPath(h.meta.image),
verbose:e,preloadImage:!1},m;for(m in f)l[m]=f[m];a.graphics.spritesheet.registerSpriteSheet(k,h,l)}}};a.graphics.spritesheet.constructAllFromSpriteSheet=function(a){return{}};a.graphics.Image.registerSpriteSheet=a.graphics.spritesheet.registerSpriteSheet;a.graphics.Image.getSpriteSheetCount=a.graphics.spritesheet.getSpriteSheetCount;a.graphics.Image.getNthSpriteSheet=a.graphics.spritesheet.getNthSpriteSheet;a.graphics.Image.forEachSpriteSheet=a.graphics.spritesheet.forEachSpriteSheet;a.graphics.Image.getSpriteSheetIndex=
a.graphics.spritesheet.getSpriteSheetIndex;a.graphics.Image.getSpriteSheetIndexByImage=a.graphics.spritesheet.getSpriteSheetIndexByImage;a.graphics.Image.findInSpriteSheet=a.graphics.spritesheet.findInSpriteSheet;a.graphics.Image.loadSpriteSheetSet=a.graphics.spritesheet.loadSpriteSheetSet;a.graphics.ImageRef.constructAllFromSpriteSheet=a.graphics.spritesheet.constructAllFromSpriteSheet});
rat.modules.add("rat.graphics.r_layer_div",[{name:"rat.graphics.r_graphics",processBefore:!0}],function(a){var c=a.graphics.layerDiv={};c.make=function(b){b=b||a.graphics.canvas;if(!b)return null;var d=document.createElement("div");d.id="edit_div";d.style.cssText="position:fixed;display:block;";d.style.border="4px solid white";d.style["border-color"]="rgba(255,255,255, 0.1)";c.updateScale(d,b);b.parentNode.insertBefore(d,b.nextSibling);return d};c.updateScale=function(b,c){if(c=c||a.graphics.canvas){var d=
a.graphics.globalScale.x*a.graphics.outerScale;c=c.getBoundingClientRect();var f=a.graphics.SCREEN_WIDTH,g=a.graphics.SCREEN_HEIGHT;b.style.width=""+f+"px";b.style.height=""+g+"px";b.style.left=""+c.x+"px";b.style.top=""+c.y+"px";b.setAttribute("width",""+f);b.setAttribute("height",""+g);b.style.transformOrigin="0 0 0";b.style.webkitTransformOrigin="0 0 0";d="scale("+d+","+d+")";b.style.transform=d;b.style.webkitTransform=d}}});rat.load({skipLoad:!0,async:!1});
